import{r as w}from"./validators-dea6e3a5.js";import{_ as E}from"./AppAutocomplete-9ad86c49.js";import{_ as R}from"./AddQuoteInvoice-d0b26399.js";import{u as D}from"./useCustomer-2818234a.js";import{u as x}from"./useQuote-74d552d7.js";import{P as s}from"./InvoiceAddMoney-aa159e1d.js";import{s as _}from"./notifications-cae4d01c.js";import{V as N}from"./VRow-db7839b8.js";import{V as c}from"./VCol-e110b22d.js";import{V as k}from"./VCard-b8ab7ef2.js";import{V as q}from"./VCardText-974f1364.js";import{r as f,a2 as n,H as M,w as v,o as Q,f as S,e as p,b as o,n as a,a4 as B,v as I}from"./index-a54c57b2.js";import"./helpers-61e4df1a.js";import"./form-87f468b6.js";import"./VSelect-718a4a4c.js";import"./VTextField-4d59e4f8.js";/* empty css                   */import"./VCounter-9184ef99.js";import"./VImg-24ae3b8f.js";import"./VField-e400f246.js";import"./easing-9f15041e.js";import"./VInput-39bbda74.js";import"./forwardRefs-8348545e.js";import"./VList-8e53c877.js";import"./ssrBoot-0af201ab.js";import"./VAvatar-a060005e.js";import"./VDivider-18f44d6d.js";import"./dialog-transition-e1dfb8e6.js";import"./VMenu-4a4865a4.js";import"./VOverlay-55c698d2.js";import"./lazy-67a427f9.js";import"./scopeId-6c78f01e.js";import"./VCheckboxBtn-d46ea3f4.js";import"./VSelectionControl-d56c1c32.js";import"./VChip-5a84b8f9.js";import"./filter-97072b4a.js";import"./currencyFormatter-92ad4b3c.js";import"./AppTextarea-9318e309.js";import"./AppSelect-ccf756d5.js";import"./AppTextField-6f740df4.js";import"./AppDateTimePicker-fd1d1008.js";import"./VNodeRenderer-a6e0d834.js";import"./useProperty-822d3234.js";import"./api-f4900d91.js";import"./index-9c720871.js";import"./constants-1eb97e20.js";const ke={__name:"addQuote",setup(K){const{generateQuote:y}=x(),{allCustomerPaginate:V,customers:m}=D(),u=f(!1),e=f({social_reason:"",nit:"",address:"",email:"",phone:"",landline:"",workplace:"",expiration_date:null,creation_date:new Date().toISOString().split("T")[0],observations:"",payment_method:null,amount:null,initial_fee:null,percentage_initial_fee:null,balance:null,opportunity_id:null,customer_id:null,properties:[{property_id:null,price:null,price_it:null,price_contrato:null,property_type:s.DEPARTAMENT.value,property_type_name:s.DEPARTAMENT.label},{property_id:null,price:null,price_it:null,price_contrato:null,property_type:s.PARK.value,property_type_name:s.PARK.label}],differs_initial_fee:[],differs_balance:[]}),g=n(()=>e.value.social_reason&&e.value.nit&&e.value.phone&&e.value.amount&&e.value.creation_date&&e.value.expiration_date&&e.value.payment_method&&e.value.customer_id),P=n(()=>e.value.properties.every(r=>r.property_id!==null&&r.price!==null&&r.price_it!==null&&r.price_contrato!==null)),h=n(()=>e.value.differs_initial_fee.length===0?!0:e.value.differs_initial_fee.every(r=>r.amount!==null)),C=n(()=>{if(e.value.differs_initial_fee.length===0)return!0;const r=e.value.differs_initial_fee.reduce((l,F)=>l+(F.amount||0),0),t=parseFloat(r),i=parseFloat(e.value.initial_fee);return t===i}),d=n(()=>g.value&&P.value&&h.value),b=r=>{e.value.properties.push(r)},A=r=>{e.value.properties.splice(r,1)},T=async()=>{if(!d.value){_("Validación fallida","Completa todos los campos obligatorios.");return}if(!C.value){_("Validación fallida","La suma de las diferencias del anticipo no son correctas");return}u.value=!0;try{console.log(e),await y(e.value)}catch(r){console.error("Error generando la venta:",r)}finally{u.value=!1}};return M(async()=>{await V({page:1,itemsPerPage:1e3})}),v(()=>e.value.properties,r=>{let t=0;r.forEach(i=>{if(i.price){const l=parseFloat(i.price)||0;i.price_it=l*.03,i.price_contrato=l+i.price_it,t+=i.price_contrato}else i.price_it=null}),e.value.amount=t},{deep:!0}),v(()=>e.value.customer_id,r=>{const t=m.value.find(i=>i.id==r);console.log("Cliente Seleccionado: ",t),t&&(e.value.social_reason=t.name,e.value.email=t.email,e.value.phone=t.phone,e.value.nit=t.ci,e.value.opportunity_id=t.opportunity_id,t.property_id!==null?(t.property.property_type=="PARK"&&(e.value.properties[1].property_id=t.property_id,e.value.properties[0].property_id=null,e.value.properties[0].price=null,e.value.properties[0].price_it=null,e.value.properties[0].price_contrato=null),t.property.property_type=="DEPARTAMENT"&&(e.value.properties[0].property_id=t.property_id,e.value.properties[1].property_id=null,e.value.properties[1].price=null,e.value.properties[1].price_it=null,e.value.properties[1].price_contrato=null)):(e.value.properties[1].property_id=null,e.value.properties[1].price=null,e.value.properties[1].price_it=null,e.value.properties[1].price_contrato=null,e.value.properties[0].property_id=null,e.value.properties[0].price=null,e.value.properties[0].price_it=null,e.value.properties[0].price_contrato=null)),e.value.customer_id=r}),(r,t)=>{const i=E;return Q(),S(N,null,{default:p(()=>[o(c,{cols:"12",md:"9"},{default:p(()=>[o(R,{data:a(e),onPush:b,onRemove:A},null,8,["data"])]),_:1}),o(c,{cols:"12",md:"3"},{default:p(()=>[o(k,{class:"mb-8"},{default:p(()=>[o(c,{cols:"12"},{default:p(()=>[o(i,{modelValue:a(e).customer_id,"onUpdate:modelValue":t[0]||(t[0]=l=>a(e).customer_id=l),rules:["requiredValidator"in r?r.requiredValidator:a(w)],label:"Clientes",placeholder:"Selecciona un Cliente",items:a(m).map(l=>({title:l.name,value:l.id})),outlined:""},null,8,["modelValue","rules","items"])]),_:1}),o(q,null,{default:p(()=>[o(B,{loading:a(u),disabled:!a(d)||a(u),class:"mb-2",onClick:T},{default:p(()=>t[1]||(t[1]=[I(" Guardar Cotización ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})}}};export{ke as default};
