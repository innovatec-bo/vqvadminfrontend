import{r as _}from"./validators-dea6e3a5.js";import{_ as K}from"./AppAutocomplete-29ab4ab8.js";import{f as L}from"./currencyFormatter-92ad4b3c.js";import{_ as O}from"./AppTextarea-09b49e08.js";import{_ as Y}from"./AppSelect-1a2530f4.js";import{_ as S}from"./AppTextField-9186f801.js";import{_ as G}from"./AppDateTimePicker-fcfdcd84.js";import{P as v,a as H,_ as W}from"./InvoiceAddMoney-1367b288.js";import{V as N}from"./VNodeRenderer-707e30bb.js";import{r as x,w as F,H as B,o as k,f as U,e as i,d as c,c as $,F as J,i as X,b as l,n as r,x as D,v as E,z as Z,a4 as R,$ as ee,I as M,a0 as le,a2 as C}from"./index-846a41a7.js";import{u as ae}from"./useProperty-556a508c.js";import{V as A}from"./VRow-c227529d.js";import{V as u}from"./VCol-e77ea2aa.js";import{V as I}from"./VCard-dfb8409c.js";import{V as w}from"./VCardText-2d0de59d.js";import{V as z}from"./VDivider-3e3c779c.js";import{u as oe}from"./useCustomer-8aa04d26.js";import{u as te}from"./useQuote-f24cd992.js";import{c as j}from"./notifications-81bc0416.js";import"./helpers-61e4df1a.js";import"./form-afe002dd.js";import"./VSelect-17240541.js";import"./VTextField-9f5745a0.js";/* empty css                   */import"./VCounter-13a5cfec.js";import"./VImg-513936eb.js";import"./VField-a9e436a8.js";import"./easing-9f15041e.js";import"./VInput-568005d0.js";import"./forwardRefs-8348545e.js";import"./VList-b55e2e2d.js";import"./ssrBoot-002ea34f.js";import"./VAvatar-5e2cbe96.js";import"./dialog-transition-4510933c.js";import"./VMenu-c354dabd.js";import"./VOverlay-7ed6f1b5.js";import"./lazy-ed20dc3f.js";import"./scopeId-f816bc4e.js";import"./VCheckboxBtn-4f15d05f.js";import"./VSelectionControl-cd737be4.js";import"./VChip-d8145fdb.js";import"./filter-ac0ab663.js";import"./api-d2df174a.js";import"./index-9c720871.js";import"./constants-ca8ca994.js";const ie={class:"pa-5 flex-grow-1"},re={key:0,style:{"font-size":"small","padding-block":""}},ne={class:"d-flex justify-end mt-3"},de={__name:"InvoiceAddProperty",props:{properties:{type:Array,required:!0}},emits:["removeProduct","totalAmount","addProperty"],setup(h,{emit:q}){const o=h,P=q,{propertiesForType:y}=ae(),t=x([]),V=x([]),g=()=>{const e={property_id:null,price:null,property_type:v.PARK.value,property_type_name:v.PARK.label};P("addProperty",e)},T=e=>{P("removeProduct",e)},n=e=>{if(console.log("entra a update price"),e.property_type===v.DEPARTAMENT.value){const p=V.value.find(m=>m.id===e.property_id);p&&(e.price=p.base_price)}else if(e.property_type===v.PARK.value){const p=t.value.find(m=>m.id===e.property_id);p&&(e.price=p.base_price)}};return F(()=>o.properties.map(e=>e.property_id),(e,p)=>{e.forEach((m,s)=>{const d=o.properties[s];m!==p[s]&&n(d)})}),B(async()=>{try{const e=await y(v.DEPARTAMENT.value);V.value=e;const p=await y(v.PARK.value);t.value=p}catch(e){console.error("Error al obtener las propiedades:",e)}}),(e,p)=>{const m=S;return k(),U(I,{flat:"",border:"",class:"d-flex flex-row"},{default:i(()=>[c("div",ie,[(k(!0),$(J,null,X(o.properties,(s,d)=>(k(),U(A,{key:d,class:"mb-4"},{default:i(()=>[l(u,{cols:"12",sm:"4",style:{"padding-block":"0","padding-inline":"8px"}},{default:i(()=>[l(Y,{modelValue:s.property_id,"onUpdate:modelValue":a=>s.property_id=a,rules:["requiredValidator"in e?e.requiredValidator:r(_)],label:s.property_type_name,placeholder:"Selecciona una propiedad",items:s.property_type===r(v).DEPARTAMENT.value?r(V):r(t),"item-title":"title","item-value":"id",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules","label","items"]),s.property_id&&s.property_type===r(v).DEPARTAMENT.value?(k(),$("span",re,[c("strong",null,D(r(V)[s.property_id-1].departament.isfacade===1?"En fachada":"Orientacion sur")+", ",1),E(" "+D(r(V)[s.property_id-1].surface)+" ",1),p[0]||(p[0]=c("strong",null," m2",-1)),p[1]||(p[1]=c("br",null,null,-1)),E(" "+D(r(V)[s.property_id-1].departament.number_bedrooms)+" Dormitorio(s), ",1)])):Z("",!0)]),_:2},1024),l(u,{cols:"12",sm:"2",style:{"padding-block":"0","padding-inline":"8px"}},{default:i(()=>[l(m,{modelValue:s.price,"onUpdate:modelValue":a=>s.price=a,rules:["requiredValidator"in e?e.requiredValidator:r(_)],label:"Precio *",placeholder:"$us",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),l(u,{cols:"12",sm:"2",style:{"padding-block":"0","padding-inline":"8px"}},{default:i(()=>[l(m,{modelValue:s.price_it,"onUpdate:modelValue":a=>s.price_it=a,rules:["requiredValidator"in e?e.requiredValidator:r(_)],label:"3% (IT) *",placeholder:"%",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:i(()=>[l(m,{modelValue:s.price_contrato,"onUpdate:modelValue":a=>s.price_contrato=a,rules:["requiredValidator"in e?e.requiredValidator:r(_)],label:"Precio Contrato *",placeholder:"Escribe el precio",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),l(u,{cols:"12",sm:"1",class:"my-4"},{default:i(()=>[l(R,{color:"error",size:"small",onClick:a=>T(d)},{default:i(()=>[l(ee,{icon:"tabler-square-x"})]),_:2},1032,["onClick"])]),_:2},1024),l(u,{cols:"12",style:{"font-size":"small","padding-block":"0","padding-inline":"4px"}})]),_:2},1024))),128)),c("div",ne,[l(R,{color:"secondary",onClick:g},{default:i(()=>p[2]||(p[2]=[E(" Agregar Parqueo ")])),_:1})])])]),_:1})}}},se={class:"d-flex align-center justify-sm-end mx-2"},ue={style:{"inline-size":"9.5rem"}},pe={class:"d-flex align-center justify-sm-end"},me={style:{"inline-size":"9.5rem"}},ce={class:"text-center my-4"},fe={__name:"AddQuoteInvoice",props:{data:{type:null,required:!0}},emits:["push","remove"],setup(h,{emit:q}){const o=h,P=q,y=n=>{P("push",n)},t=n=>{P("remove",n)},V=["30","50","80","100"],g=x("30"),T=n=>(o.data.initial_fee=n*g.value/100,o.data.percentage_initial_fee=g.value,o.data.balance=n-o.data.initial_fee,n*g.value/100);return(n,e)=>{const p=G,m=S,s=Y,d=O;return k(),U(I,null,{default:i(()=>[l(w,{class:"d-flex flex-wrap justify-space-between gap-y-5 flex-column flex-sm-row align-center"},{default:i(()=>[l(r(N),{nodes:r(M).app.logo,class:"me-3",style:{"align-self":"center"}},null,8,["nodes"]),e[13]||(e[13]=c("h4",{class:"font-weight-bold text-h3 d-flex align-center"}," Formulario de Cotizacion ",-1)),l(r(N),{nodes:r(M).app.logopora,class:"me-3",style:{"align-self":"center"}},null,8,["nodes"])]),_:1}),l(r(A),{class:"justify-end ma-sm-2"},{default:i(()=>[c("div",se,[e[14]||(e[14]=c("span",{style:{"inline-size":"6rem"}},"Emisión ",-1)),c("span",ue,[l(p,{modelValue:o.data.creation_date,"onUpdate:modelValue":e[0]||(e[0]=a=>o.data.creation_date=a),rules:["requiredValidator"in n?n.requiredValidator:r(_)],density:"compact",placeholder:"YYYY-MM-DD",config:{position:"auto right"}},null,8,["modelValue","rules"])])]),c("div",pe,[e[15]||(e[15]=c("span",{class:"mx-2"},"Válido ",-1)),c("span",me,[l(p,{modelValue:o.data.expiration_date,"onUpdate:modelValue":e[1]||(e[1]=a=>o.data.expiration_date=a),rules:["requiredValidator"in n?n.requiredValidator:r(_)],density:"compact",placeholder:"YYYY-MM-DD",config:{position:"auto right"}},null,8,["modelValue","rules"])])])]),_:1}),l(z,{thickness:"12"}),l(w,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row gap-y-5 gap-4"},{default:i(()=>[l(r(A),null,{default:i(()=>[l(u,{cols:"12",sm:"8",style:{"padding-block":"0","padding-inline":"8px"}},{default:i(()=>[l(m,{modelValue:o.data.social_reason,"onUpdate:modelValue":e[2]||(e[2]=a=>o.data.social_reason=a),rules:["requiredValidator"in n?n.requiredValidator:r(_)],label:"Cliente *",placeholder:"Canzza",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",sm:"4",style:{"padding-block":"0","padding-inline":"8px"}},{default:i(()=>[l(m,{modelValue:o.data.nit,"onUpdate:modelValue":e[3]||(e[3]=a=>o.data.nit=a),rules:["requiredValidator"in n?n.requiredValidator:r(_)],label:"C.I./NIT *",placeholder:"0000000",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:i(()=>[l(m,{modelValue:o.data.workplace,"onUpdate:modelValue":e[4]||(e[4]=a=>o.data.workplace=a),label:"Lugar de Trabajo",placeholder:"Placeholder Text",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:i(()=>[l(m,{modelValue:o.data.email,"onUpdate:modelValue":e[5]||(e[5]=a=>o.data.email=a),rules:["requiredValidator"in n?n.requiredValidator:r(_)],label:"Correo *",placeholder:"email@gmail.com",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:i(()=>[l(m,{modelValue:o.data.address,"onUpdate:modelValue":e[6]||(e[6]=a=>o.data.address=a),label:"Dirección",placeholder:"Av/ Equipetrol ....",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:i(()=>[l(m,{modelValue:o.data.phone,"onUpdate:modelValue":e[7]||(e[7]=a=>o.data.phone=a),rules:["requiredValidator"in n?n.requiredValidator:r(_)],label:"Celular *",placeholder:"77049267",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:i(()=>[l(m,{modelValue:o.data.landline,"onUpdate:modelValue":e[8]||(e[8]=a=>o.data.landline=a),label:"Teléfono Fijo",placeholder:"33557292",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(z,{thickness:"12"}),l(w,{class:"add-products-form"},{default:i(()=>[l(r(A),null,{default:i(()=>[l(u,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"},class:"mb-2"},{default:i(()=>[l(de,{properties:o.data.properties,onAddProperty:y,onRemoveProduct:t},null,8,["properties"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:i(()=>[l(s,{modelValue:o.data.payment_method,"onUpdate:modelValue":e[9]||(e[9]=a=>o.data.payment_method=a),rules:["requiredValidator"in n?n.requiredValidator:r(_)],label:"Tipo de Pago *",placeholder:"Seleccione ",items:Object.values(r(H)),class:"custom-salesforce-input"},null,8,["modelValue","rules","items"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:i(()=>[l(m,{modelValue:o.data.amount,"onUpdate:modelValue":e[10]||(e[10]=a=>o.data.amount=a),value:o.data.amount,rules:["requiredValidator"in n?n.requiredValidator:r(_)],label:"Total *",placeholder:"1000.000,00",outlined:"",dense:""},null,8,["modelValue","value","rules"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:i(()=>[l(s,{modelValue:r(g),"onUpdate:modelValue":e[11]||(e[11]=a=>le(g)?g.value=a:null),items:V,label:"Anticipo: %",placeholder:"% Anticipo",class:"mb-2"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:i(()=>[c("div",ce,[e[16]||(e[16]=c("h4",null," Saldo por pagar: ",-1)),c("span",null,D(("formatCurrency"in n?n.formatCurrency:r(L))(o.data.amount-o.data.initial_fee)),1)])]),_:1})]),_:1})]),_:1}),l(w,{class:"add-products-form"},{default:i(()=>[l(r(A),null,{default:i(()=>[l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:i(()=>[l(W,{title:" Anticipo ",amount:T(o.data.amount),differs:o.data.differs_initial_fee,type:n.INITIAL_PAYMENT},null,8,["amount","differs","type"])]),_:1}),l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:i(()=>[l(d,{modelValue:o.data.observations,"onUpdate:modelValue":e[12]||(e[12]=a=>o.data.observations=a),"auto-grow":"",label:"Observaciones del Cliente",rows:"3",placeholder:"Descripción...","row-height":"20"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}}},rl={__name:"addQuote",setup(h){const{generateQuote:q}=te(),{allCustomerPaginate:o,customers:P}=oe(),y=x(!1),t=x({social_reason:"",nit:"",address:"",email:"",phone:"",landline:"",workplace:"",expiration_date:null,creation_date:new Date().toISOString().split("T")[0],observations:"",payment_method:null,amount:null,initial_fee:null,percentage_initial_fee:null,balance:null,opportunity_id:null,customer_id:null,properties:[{property_id:null,price:null,price_it:null,price_contrato:null,property_type:v.DEPARTAMENT.value,property_type_name:v.DEPARTAMENT.label}],differs_initial_fee:[],differs_balance:[]}),V=C(()=>t.value.social_reason&&t.value.nit&&t.value.email&&t.value.phone&&t.value.amount&&t.value.creation_date&&t.value.expiration_date&&t.value.payment_method&&t.value.balance&&t.value.customer_id),g=C(()=>t.value.properties.every(d=>d.property_id!==null&&d.price!==null&&d.price_it!==null&&d.price_contrato!==null)),T=C(()=>t.value.differs_initial_fee.length===0?!0:t.value.differs_initial_fee.every(d=>d.amount!==null)),n=C(()=>{if(t.value.differs_initial_fee.length===0)return!0;const d=t.value.differs_initial_fee.reduce((b,Q)=>b+(Q.amount||0),0),a=parseFloat(d),f=parseFloat(t.value.initial_fee);return a===f}),e=C(()=>V.value&&g.value&&T.value),p=d=>{t.value.properties.push(d)},m=d=>{t.value.properties.splice(d,1)},s=async()=>{if(!e.value){j("Validación fallida","Completa todos los campos obligatorios.");return}if(!n.value){j("Validación fallida","La suma de las diferencias del anticipo no son correctas");return}y.value=!0;try{console.log(t),await q(t.value)}catch(d){console.error("Error generando la venta:",d)}finally{y.value=!1}};return B(async()=>{await o({page:1,itemsPerPage:100})}),F(()=>t.value.properties,d=>{let a=0;d.forEach(f=>{if(f.price){const b=parseFloat(f.price)||0;f.price_it=b*.03,f.price_contrato=b+f.price_it,a+=f.price_contrato}else f.price_it=null}),t.value.amount=a},{deep:!0}),F(()=>t.value.customer_id,d=>{const a=P.value.find(f=>f.id==d);a&&(t.value.social_reason=a.name,t.value.email=a.email,t.value.phone=a.phone,t.value.nit=a.ci,t.value.opportunity_id=a.opportunity_id,a.property_id!==null&&(t.value.properties[0].property_id=a.property_id)),t.value.customer_id=d}),(d,a)=>{const f=K;return k(),U(A,null,{default:i(()=>[l(u,{cols:"12",md:"9"},{default:i(()=>[l(fe,{data:r(t),onPush:p,onRemove:m},null,8,["data"])]),_:1}),l(u,{cols:"12",md:"3"},{default:i(()=>[l(I,{class:"mb-8"},{default:i(()=>[l(u,{cols:"12"},{default:i(()=>[l(f,{modelValue:r(t).customer_id,"onUpdate:modelValue":a[0]||(a[0]=b=>r(t).customer_id=b),rules:["requiredValidator"in d?d.requiredValidator:r(_)],label:"Clientes",placeholder:"Selecciona un Cliente",items:r(P).map(b=>({title:b.name,value:b.id})),outlined:""},null,8,["modelValue","rules","items"])]),_:1}),l(w,null,{default:i(()=>[l(R,{loading:r(y),disabled:!r(e)||r(y),class:"mb-2",onClick:s},{default:i(()=>a[1]||(a[1]=[E(" Guardar Cotización ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})}}};export{rl as default};
