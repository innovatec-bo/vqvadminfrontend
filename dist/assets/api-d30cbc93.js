import{c0 as q,ac as l,ci as T}from"./index-29b7cc60.js";import{a as S,w as A}from"./index-9c720871.js";import{a as $,U as j}from"./constants-0978c720.js";class C extends Error{constructor(s,r){super(s,r),this.name="FetchError",r!=null&&r.cause&&!this.cause&&(this.cause=r.cause)}}function k(o){var i,p,e,c,d;const s=((i=o.error)==null?void 0:i.message)||((p=o.error)==null?void 0:p.toString())||"",r=((e=o.request)==null?void 0:e.method)||((c=o.options)==null?void 0:c.method)||"GET",f=((d=o.request)==null?void 0:d.url)||String(o.request)||"/",y=`[${r}] ${JSON.stringify(f)}`,a=o.response?`${o.response.status} ${o.response.statusText}`:"<no response>",h=`${y}: ${a}${s?` ${s}`:""}`,t=new C(h,o.error?{cause:o.error}:void 0);for(const n of["request","options","response"])Object.defineProperty(t,n,{get(){return o[n]}});for(const[n,u]of[["data","_data"],["status","status"],["statusCode","status"],["statusText","statusText"],["statusMessage","statusText"]])Object.defineProperty(t,n,{get(){return o.response&&o.response[u]}});return t}const P=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function w(o="GET"){return P.has(o.toUpperCase())}function U(o){if(o===void 0)return!1;const s=typeof o;return s==="string"||s==="number"||s==="boolean"||s===null?!0:s!=="object"?!1:Array.isArray(o)?!0:o.buffer?!1:o.constructor&&o.constructor.name==="Object"||typeof o.toJSON=="function"}const O=new Set(["image/svg","application/xml","application/xhtml","application/html"]),_=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function v(o=""){if(!o)return"json";const s=o.split(";").shift()||"";return _.test(s)?"json":O.has(s)||s.startsWith("text/")?"text":"blob"}function D(o,s,r,f){const y=L((s==null?void 0:s.headers)??(o==null?void 0:o.headers),r==null?void 0:r.headers,f);let a;return(r!=null&&r.query||r!=null&&r.params||s!=null&&s.params||s!=null&&s.query)&&(a={...r==null?void 0:r.params,...r==null?void 0:r.query,...s==null?void 0:s.params,...s==null?void 0:s.query}),{...r,...s,query:a,params:a,headers:y}}function L(o,s,r){if(!s)return new r(o);const f=new r(s);if(o)for(const[y,a]of Symbol.iterator in o||Array.isArray(o)?o:new r(o))f.set(y,a);return f}async function m(o,s){if(s)if(Array.isArray(s))for(const r of s)await r(o);else await s(o)}const B=new Set([408,409,425,429,500,502,503,504]),F=new Set([101,204,205,304]);function g(o={}){const{fetch:s=globalThis.fetch,Headers:r=globalThis.Headers,AbortController:f=globalThis.AbortController}=o;async function y(t){const i=t.error&&t.error.name==="AbortError"&&!t.options.timeout||!1;if(t.options.retry!==!1&&!i){let e;typeof t.options.retry=="number"?e=t.options.retry:e=w(t.options.method)?0:1;const c=t.response&&t.response.status||500;if(e>0&&(Array.isArray(t.options.retryStatusCodes)?t.options.retryStatusCodes.includes(c):B.has(c))){const d=typeof t.options.retryDelay=="function"?t.options.retryDelay(t):t.options.retryDelay||0;return d>0&&await new Promise(n=>setTimeout(n,d)),a(t.request,{...t.options,retry:e-1})}}const p=k(t);throw Error.captureStackTrace&&Error.captureStackTrace(p,a),p}const a=async function(i,p={}){const e={request:i,options:D(i,p,o.defaults,r),response:void 0,error:void 0};e.options.method&&(e.options.method=e.options.method.toUpperCase()),e.options.onRequest&&await m(e,e.options.onRequest),typeof e.request=="string"&&(e.options.baseURL&&(e.request=S(e.request,e.options.baseURL)),e.options.query&&(e.request=A(e.request,e.options.query),delete e.options.query),"query"in e.options&&delete e.options.query,"params"in e.options&&delete e.options.params),e.options.body&&w(e.options.method)&&(U(e.options.body)?(e.options.body=typeof e.options.body=="string"?e.options.body:JSON.stringify(e.options.body),e.options.headers=new r(e.options.headers||{}),e.options.headers.has("content-type")||e.options.headers.set("content-type","application/json"),e.options.headers.has("accept")||e.options.headers.set("accept","application/json")):("pipeTo"in e.options.body&&typeof e.options.body.pipeTo=="function"||typeof e.options.body.pipe=="function")&&("duplex"in e.options||(e.options.duplex="half")));let c;if(!e.options.signal&&e.options.timeout){const n=new f;c=setTimeout(()=>{const u=new Error("[TimeoutError]: The operation was aborted due to timeout");u.name="TimeoutError",u.code=23,n.abort(u)},e.options.timeout),e.options.signal=n.signal}try{e.response=await s(e.request,e.options)}catch(n){return e.error=n,e.options.onRequestError&&await m(e,e.options.onRequestError),await y(e)}finally{c&&clearTimeout(c)}if((e.response.body||e.response._bodyInit)&&!F.has(e.response.status)&&e.options.method!=="HEAD"){const n=(e.options.parseResponse?"json":e.options.responseType)||v(e.response.headers.get("content-type")||"");switch(n){case"json":{const u=await e.response.text(),R=e.options.parseResponse||q;e.response._data=R(u);break}case"stream":{e.response._data=e.response.body||e.response._bodyInit;break}default:e.response._data=await e.response[n]()}}return e.options.onResponse&&await m(e,e.options.onResponse),!e.options.ignoreResponseError&&e.response.status>=400&&e.response.status<600?(e.options.onResponseError&&await m(e,e.options.onResponseError),await y(e)):e.response},h=async function(i,p){return(await a(i,p))._data};return h.raw=a,h.native=(...t)=>s(...t),h.create=(t={},i={})=>g({...o,...i,defaults:{...o.defaults,...i.defaults,...t}}),h}const b=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}(),H=b.fetch?(...o)=>b.fetch(...o):()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!")),I=b.Headers,M=b.AbortController,E=g({fetch:H,Headers:I,AbortController:M}),G=E.create({baseURL:$,async onRequest({options:o}){const s=l("accessToken").value;s&&(o.headers={...o.headers,"Content-Type":"application/json",Authorization:`Bearer ${s}`})},async onResponseError(o){return o.response&&o.response.status===401&&(l("accessToken")&&(l("accessToken").value=null),await T.push("/login")),Promise.reject(o)}}),K=E.create({baseURL:j,async onRequest({options:o}){const s=l("accessToken").value;s&&(o.headers={...o.headers,"Content-Type":"application/json",Authorization:`Bearer ${s}`})},async onResponseError(o){return o.response&&o.response.status===401&&(l("accessToken")&&(l("accessToken").value=null),await T.push("/login")),Promise.reject(o)}});export{G as $,K as a};
