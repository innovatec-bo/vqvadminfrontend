import{c3 as E,ac as l,ck as w}from"./index-020f2097.js";import{a as S,w as $}from"./index-9c720871.js";import{U as j,a as k}from"./constants-1fe0e77f.js";class C extends Error{constructor(s,t){super(s,t),this.name="FetchError",t!=null&&t.cause&&!this.cause&&(this.cause=t.cause)}}function A(o){var h,a,e,i,d;const s=((h=o.error)==null?void 0:h.message)||((a=o.error)==null?void 0:a.toString())||"",t=((e=o.request)==null?void 0:e.method)||((i=o.options)==null?void 0:i.method)||"GET",n=((d=o.request)==null?void 0:d.url)||String(o.request)||"/",u=`[${t}] ${JSON.stringify(n)}`,f=o.response?`${o.response.status} ${o.response.statusText}`:"<no response>",y=`${u}: ${f}${s?` ${s}`:""}`,r=new C(y,o.error?{cause:o.error}:void 0);for(const p of["request","options","response"])Object.defineProperty(r,p,{get(){return o[p]}});for(const[p,c]of[["data","_data"],["status","status"],["statusCode","status"],["statusText","statusText"],["statusMessage","statusText"]])Object.defineProperty(r,p,{get(){return o.response&&o.response[c]}});return r}const O=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function m(o="GET"){return O.has(o.toUpperCase())}function P(o){if(o===void 0)return!1;const s=typeof o;return s==="string"||s==="number"||s==="boolean"||s===null?!0:s!=="object"?!1:Array.isArray(o)?!0:o.buffer?!1:o.constructor&&o.constructor.name==="Object"||typeof o.toJSON=="function"}const U=new Set(["image/svg","application/xml","application/xhtml","application/html"]),_=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function L(o=""){if(!o)return"json";const s=o.split(";").shift()||"";return _.test(s)?"json":U.has(s)||s.startsWith("text/")?"text":"blob"}function v(o,s,t=globalThis.Headers){const n={...s,...o};if(s!=null&&s.params&&(o!=null&&o.params)&&(n.params={...s==null?void 0:s.params,...o==null?void 0:o.params}),s!=null&&s.query&&(o!=null&&o.query)&&(n.query={...s==null?void 0:s.query,...o==null?void 0:o.query}),s!=null&&s.headers&&(o!=null&&o.headers)){n.headers=new t((s==null?void 0:s.headers)||{});for(const[u,f]of new t((o==null?void 0:o.headers)||{}))n.headers.set(u,f)}return n}const B=new Set([408,409,425,429,500,502,503,504]),F=new Set([101,204,205,304]);function T(o={}){const{fetch:s=globalThis.fetch,Headers:t=globalThis.Headers,AbortController:n=globalThis.AbortController}=o;async function u(r){const h=r.error&&r.error.name==="AbortError"&&!r.options.timeout||!1;if(r.options.retry!==!1&&!h){let e;typeof r.options.retry=="number"?e=r.options.retry:e=m(r.options.method)?0:1;const i=r.response&&r.response.status||500;if(e>0&&(Array.isArray(r.options.retryStatusCodes)?r.options.retryStatusCodes.includes(i):B.has(i))){const d=r.options.retryDelay||0;return d>0&&await new Promise(p=>setTimeout(p,d)),f(r.request,{...r.options,retry:e-1})}}const a=A(r);throw Error.captureStackTrace&&Error.captureStackTrace(a,f),a}const f=async function(h,a={}){var p;const e={request:h,options:v(a,o.defaults,t),response:void 0,error:void 0};e.options.method=(p=e.options.method)==null?void 0:p.toUpperCase(),e.options.onRequest&&await e.options.onRequest(e),typeof e.request=="string"&&(e.options.baseURL&&(e.request=S(e.request,e.options.baseURL)),(e.options.query||e.options.params)&&(e.request=$(e.request,{...e.options.params,...e.options.query}))),e.options.body&&m(e.options.method)&&(P(e.options.body)?(e.options.body=typeof e.options.body=="string"?e.options.body:JSON.stringify(e.options.body),e.options.headers=new t(e.options.headers||{}),e.options.headers.has("content-type")||e.options.headers.set("content-type","application/json"),e.options.headers.has("accept")||e.options.headers.set("accept","application/json")):("pipeTo"in e.options.body&&typeof e.options.body.pipeTo=="function"||typeof e.options.body.pipe=="function")&&("duplex"in e.options||(e.options.duplex="half")));let i;if(!e.options.signal&&e.options.timeout){const c=new n;i=setTimeout(()=>c.abort(),e.options.timeout),e.options.signal=c.signal}try{e.response=await s(e.request,e.options)}catch(c){return e.error=c,e.options.onRequestError&&await e.options.onRequestError(e),await u(e)}finally{i&&clearTimeout(i)}if(e.response.body&&!F.has(e.response.status)&&e.options.method!=="HEAD"){const c=(e.options.parseResponse?"json":e.options.responseType)||L(e.response.headers.get("content-type")||"");switch(c){case"json":{const R=await e.response.text(),q=e.options.parseResponse||E;e.response._data=q(R);break}case"stream":{e.response._data=e.response.body;break}default:e.response._data=await e.response[c]()}}return e.options.onResponse&&await e.options.onResponse(e),!e.options.ignoreResponseError&&e.response.status>=400&&e.response.status<600?(e.options.onResponseError&&await e.options.onResponseError(e),await u(e)):e.response},y=async function(h,a){return(await f(h,a))._data};return y.raw=f,y.native=(...r)=>s(...r),y.create=(r={})=>T({...o,defaults:{...o.defaults,...r}}),y}const b=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}(),H=b.fetch||(()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!"))),M=b.Headers,N=b.AbortController,g=T({fetch:H,Headers:M,AbortController:N}),I=g.create({baseURL:j,async onRequest({options:o}){const s=l("accessToken").value;s&&(o.headers={...o.headers,"Content-Type":"application/json",Authorization:`Bearer ${s}`})},async onResponseError(o){return o.response&&o.response.status===401&&(l("accessToken")&&(l("accessToken").value=null),await w.push("/auth/login")),Promise.reject(o)}}),G=g.create({baseURL:k,async onRequest({options:o}){const s=l("accessToken").value;s&&(o.headers={...o.headers,"Content-Type":"application/json",Authorization:`Bearer ${s}`})},async onResponseError(o){return o.response&&o.response.status===401&&(l("accessToken")&&(l("accessToken").value=null),await w.push("/auth/login")),Promise.reject(o)}});export{I as $,G as a};
