import{_ as J}from"./AppDateTimePicker-cd6911fb.js";import{_ as K}from"./AppSelect-79682b14.js";import{$ as T}from"./api-ea761cca.js";import{r as i,w as z,o as A,f as R,e as r,b as o,d as V,c as F,F as Q,i as Z,x as U,z as G,H as ee,v as j,a4 as te,n as L}from"./index-7ea6e93c.js";import{u as ae}from"./useProject-a9651d3d.js";import{L as oe}from"./LogisticsCardStatistics-09ddc3ed.js";import{_ as $}from"./AppCardActions-2122e989.js";import{m as Y}from"./vue3-apexcharts-6523687d.js";import{a as W}from"./VCard-ab6043fc.js";import{V as E}from"./VCardText-d9bf8dee.js";import{V as P}from"./VRow-64677d26.js";import{V as w}from"./VCol-a5be9b19.js";import{V as se}from"./VBadge-7ad6b43f.js";import{V as re,a as le,b as ne,c as ie}from"./VExpansionPanel-a91491db.js";import"./VField-9b92bd16.js";import"./form-32d3f16f.js";import"./easing-9f15041e.js";import"./VInput-41cea425.js";import"./VImg-08f625e0.js";import"./VSelect-0bc36668.js";import"./VTextField-5f4bfbd3.js";/* empty css                   */import"./VCounter-7d2c644f.js";import"./forwardRefs-8348545e.js";import"./VList-7b5d1d52.js";import"./ssrBoot-97876c66.js";import"./VAvatar-04485412.js";import"./VDivider-b8340ea2.js";import"./dialog-transition-ba15ce8d.js";import"./VMenu-6eb6d16e.js";import"./VOverlay-67803cc2.js";import"./lazy-5ebbba33.js";import"./scopeId-af1b5b41.js";import"./VCheckboxBtn-5481c219.js";import"./VSelectionControl-c8508d6d.js";import"./VChip-f506d678.js";import"./index-9c720871.js";import"./constants-71880aa6.js";import"./notifications-b6da0b75.js";import"./currencyFormatter-92ad4b3c.js";import"./_plugin-vue_export-helper-c27b6911.js";const de=async l=>await T("/dashboard/general",{method:"GET",params:l}),ce=async l=>await T("/dashboard/sale",{method:"GET",params:l}),ue=async l=>await T("/dashboard/properties",{method:"GET",params:l}),pe=async l=>await T("/dashboard/seller",{method:"GET",params:l});function me(){const l=i([]),a=i([]),t=i([]),p=i([]),m=i(!1),f=i(null);return{logisticsCardData:l,salesFunnelData:a,productStatusData:t,sellerSalesData:p,fetchAnalyticsData:async(s,g,y)=>{m.value=!0,f.value=null;const x={fromDate:s,toDate:g,project_id:y};try{const[S,C,k,d]=await Promise.all([de(x),ce(x),ue(x),pe(x)]);l.value=S.data,a.value=C.data,t.value=k.data,p.value=d.data}catch(S){f.value="Error fetching analytics data.",console.error(S)}finally{m.value=!1}},getLastMonthRange:()=>{const s=new Date,g=new Date(s.getFullYear(),s.getMonth()-1,1),y=new Date(s.getFullYear(),s.getMonth(),0);return[g,y]},getCurrentMonthRange:()=>{const s=new Date;return[new Date(s.getFullYear(),s.getMonth(),1),new Date]},getLastWeekRange:()=>{const s=new Date,g=new Date(s);return g.setDate(s.getDate()-7),[g,s]},getLastThreeMonthsRange:()=>{const s=new Date;return[new Date(s.getFullYear(),s.getMonth()-3,1),new Date]},getYearToDateRange:()=>{const s=new Date;return[new Date(s.getFullYear(),0,1),new Date]},isLoading:m,error:f}}function q(l){const a=new Date(l),t=a.getFullYear(),p=`0${a.getMonth()+1}`.slice(-2),m=`0${a.getDate()}`.slice(-2);return`${t}-${p}-${m}`}const ge="rgba(var(--v-theme-on-background), var(--v-high-emphasis-opacity))",he="rgba(var(--v-theme-on-background), var(--v-medium-emphasis-opacity))",fe={__name:"ProductStatusStatistics",props:{data:{type:Object,required:!0},isLoading:{type:Boolean,required:!0}},setup(l){const a=l,t={donut:{series1:"#666666",series2:"#474747",series3:"#292929",series4:"#0A0A0A"}},p=i([]),m=i({chart:{height:400,type:"donut",toolbar:{show:!1}},plotOptions:{pie:{donut:{size:"75%",labels:{show:!0,value:{fontSize:"26px",color:ge,fontWeight:500,offsetY:-15,formatter(e){return`${Number.parseInt(e)} Unidades`}},name:{offsetY:30},total:{show:!0,fontSize:"0.75rem",fontWeight:400,label:"Total",color:he,formatter(){return`${a.data.total_property||0} Unidades`}}}}}},labels:["Disponibles","Vendidas","En entrega"],colors:[t.donut.series1,t.donut.series2,t.donut.series3,t.donut.series4],grid:{padding:{top:15}},stroke:{width:0},dataLabels:{enabled:!1},legend:{show:!0,position:"bottom",offsetY:10,markers:{width:8,height:8,offsetX:-3},itemMargin:{horizontal:15,vertical:5},fontSize:"13px",fontWeight:400},tooltip:{theme:"dark"},responsive:[{breakpoint:420,options:{chart:{height:200}}}]}),f=e=>{p.value=[e.total_property_available||0,e.total_property_sale||0,e.total_property_delivery||0]};return z(()=>a.data,e=>{f(e)},{immediate:!0,deep:!0}),(e,c)=>{const v=Y,b=$;return A(),R(b,{loading:a.isLoading,"onUpdate:loading":c[0]||(c[0]=n=>a.isLoading=n),noActions:""},{default:r(()=>[o(W,{title:"Análisis del producto"}),o(E,null,{default:r(()=>[o(v,{type:"donut",height:"400",series:p.value,options:m.value},null,8,["series","options"])]),_:1})]),_:1},8,["loading"])}}};const _e={class:"d-flex flex-wrap gap-x-2 gap-y-4 mx-auto"},ve={class:"text-body-1",style:{"min-inline-size":"90px"}},be={class:"text-h4"},ye={__name:"SalesFunnelStatistics",props:{data:{type:Object,required:!0},isLoading:{type:Boolean,required:!0}},setup(l){const a=l,t={bar:{series1:"#858585",series2:"#666666",series3:"#474747",series4:"#292929",series5:"#0A0A0A"}},p=i([{data:[a.data.total_leads,a.data.total_prospect,a.data.total_presales,a.data.total_sales,a.data.total_delivery]}]),m=i({chart:{height:270,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{horizontal:!0,barHeight:"70%",distributed:!0,startingShape:"rounded",borderRadius:7}},labels:[],colors:[t.bar.series1,t.bar.series2,t.bar.series3,t.bar.series4,t.bar.series5],grid:{strokeDashArray:10,xaxis:{lines:{show:!0}},yaxis:{lines:{show:!1}},padding:{top:-35,bottom:-12}},dataLabels:{enabled:!0,style:{colors:["#fff"],fontWeight:200,fontSize:"13px"},offsetX:0,dropShadow:{enabled:!1},formatter(e,c){return m.value.labels[c.dataPointIndex]}},legend:{show:!1},tooltip:{enabled:!0,style:{fontSize:"12px"},onDatasetHover:{highlightDataSeries:!1}},xaxis:{categories:["Lead","Prospecto","Preventa","Venta","Entrega"],axisBorder:{show:!1},axisTicks:{show:!1},labels:{style:{colors:"rgba(var(--v-theme-on-background), var(--v-disabled-opacity))",fontSize:"13px"},formatter(e){return`${e}`}}},yaxis:{labels:{style:{colors:"rgba(var(--v-theme-on-background), var(--v-disabled-opacity))",fontSize:"13px"}}}}),f=i([{title:"Lead",value:a.data.total_leads,color:t.bar.series1},{title:"Prospecto",value:a.data.total_prospect,color:t.bar.series2},{title:"Preventa",value:a.data.total_presales,color:t.bar.series3},{title:"Venta",value:a.data.total_sales,color:t.bar.series4},{title:"Entrega",value:a.data.total_delivery,color:t.bar.series5}]);return z(()=>a.data,e=>{p.value[0].data=[e.total_leads,e.total_prospect,e.total_presales,e.total_sales,e.total_delivery],f.value=[{title:"Lead",value:e.total_leads,color:t.bar.series1},{title:"Prospecto",value:e.total_prospect,color:t.bar.series2},{title:"Preventa",value:e.total_presales,color:t.bar.series3},{title:"Venta",value:e.total_sales,color:t.bar.series4},{title:"Entrega",value:e.total_delivery,color:t.bar.series5}]},{deep:!0}),(e,c)=>{const v=Y,b=$;return A(),R(b,{loading:a.isLoading,"onUpdate:loading":c[0]||(c[0]=n=>a.isLoading=n),noActions:""},{default:r(()=>[o(W,{title:"Reporte por etapas"}),o(E,null,{default:r(()=>[o(P,null,{default:r(()=>[o(w,{cols:"12",md:"12"},{default:r(()=>[V("div",null,[o(v,{type:"bar",height:"300",series:p.value,options:m.value},null,8,["series","options"])])]),_:1}),o(w,{cols:"12",md:"12"},{default:r(()=>[V("div",_e,[(A(!0),F(Q,null,Z(f.value,n=>(A(),F("div",{key:n.title,class:"d-flex gap-x-1"},[o(se,{dot:"",inline:"",class:"mt-1 custom-badge",color:n.color},null,8,["color"]),V("div",null,[V("div",ve,U(n.title),1),V("h4",be,U(n.value),1)])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])}}};const xe="rgba(var(--v-theme-on-background), var(--v-high-emphasis-opacity))",N="rgba(var(--v-theme-on-background), var(--v-medium-emphasis-opacity))",Se="rgba(var(--v-border-color), var(--v-border-opacity))",De={__name:"SellerSalesStatistics",props:{data:{type:Object,required:!0},isLoading:{type:Boolean,required:!0}},setup(l){const a=l,t={line:{series1:"#858585",series2:"#666666",series3:"#474747",series4:"#292929",series5:"#0A0A0A"}},p=i([]),m=i({chart:{height:420,type:"line",stacked:!1,parentHeightOffset:0,toolbar:{show:!1},zoom:{enabled:!1}},plotOptions:{bar:{columnWidth:"30%",startingShape:"rounded",endingShape:"rounded",borderRadius:4}},colors:[t.line.series1,t.line.series2,t.line.series3,t.line.series4,t.line.series5],grid:{strokeDashArray:8,borderColor:Se},markers:{size:3,colors:["#FFFFFF"],strokeColors:[t.line.series1,t.line.series2,t.line.series3,t.line.series4,t.line.series5],hover:{size:4},borderRadius:2},stroke:{curve:"smooth",width:[2,2,2,2,2],lineCap:"round"},dataLabels:{enabled:!1},legend:{show:!0,position:"bottom",markers:{width:8,height:8,offsetX:-3},height:40,itemMargin:{horizontal:10,vertical:0},fontSize:"15px",fontFamily:"Open Sans",fontWeight:400,labels:{colors:xe,useSeriesColors:!1},offsetY:10},fill:{opacity:[1,1,1,1,1]},xaxis:{tickAmount:10,categories:[],labels:{style:{colors:N,fontSize:"13px",fontWeight:400}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{style:{colors:N,fontSize:"13px",fontWeight:400},formatter(e){return`${e}`}}},responsive:[{breakpoint:1400,options:{chart:{height:320},xaxis:{labels:{style:{fontSize:"10px"}}},legend:{itemMargin:{vertical:0,horizontal:10},fontSize:"13px",offsetY:12}}},{breakpoint:1025,options:{chart:{height:415},plotOptions:{bar:{columnWidth:"50%"}}}},{breakpoint:982,options:{plotOptions:{bar:{columnWidth:"30%"}}}},{breakpoint:480,options:{chart:{height:250},legend:{offsetY:5}}}]}),f=e=>{var c,v,b,n,D,s;if(e!=null&&e.total_prospect){const g=(c=e.total_prospect)==null?void 0:c.map(d=>d.user.name),y=(v=e.total_prospect)==null?void 0:v.map(d=>d.lead_count),x=(b=e.total_prospect)==null?void 0:b.map(d=>d.prospect_count),S=(n=e.total_prospect)==null?void 0:n.map(d=>d.presale_count),C=(D=e.total_prospect)==null?void 0:D.map(d=>d.sale_count),k=(s=e.total_prospect)==null?void 0:s.map(d=>d.delivery_count);m.value.xaxis.categories=g,p.value=[{name:"Lead",type:"column",data:y},{name:"Prospecto",type:"line",data:x},{name:"Preventa",type:"line",data:S},{name:"Venta",type:"line",data:C},{name:"Entrega",type:"line",data:k}]}};return z(()=>a.data,e=>{f(e)},{immediate:!0,deep:!0}),(e,c)=>{const v=Y,b=$;return A(),R(b,{loading:a.isLoading,"onUpdate:loading":c[0]||(c[0]=n=>a.isLoading=n),noActions:""},{default:r(()=>{var n;return[o(W,{title:"Reporte por vendedores"}),(n=l.data)!=null&&n.total_prospect?(A(),R(E,{key:0},{default:r(()=>[o(v,{id:"shipment-statistics",type:"line",height:"420",series:p.value,options:m.value},null,8,["series","options"])]),_:1})):G("",!0)]}),_:1},8,["loading"])}}};const ke={class:"d-flex flex-wrap align-end mb-3 gap-x-5"},Le={style:{"min-inline-size":"15rem"}},we={style:{"min-inline-size":"15rem"}},Ve={key:0,style:{"min-inline-size":"15rem"}},ht={__name:"analytics",setup(l){const{logisticsCardData:a,salesFunnelData:t,productStatusData:p,sellerSalesData:m,fetchAnalyticsData:f,getLastWeekRange:e,getLastMonthRange:c,getCurrentMonthRange:v,getLastThreeMonthsRange:b,getYearToDateRange:n,isLoading:D,error:s}=me(),{getallProjects:g,projects:y}=ae(),x=i(0),S=i(1),C=i([]),k=i("lastWeek"),d=i(""),h=i(e()),H=[{title:"Última semana",value:"lastWeek"},{title:"Mes anterior",value:"lastMonth"},{title:"Mes actual",value:"currentMonth"},{title:"Últimos 3 meses",value:"lastThreeMonths"},{title:"Lo que va del año",value:"yearToDate"},{title:"Otro rango de fecha",value:"dateRange"}],I=()=>{O()},O=()=>{var M;((M=h==null?void 0:h.value)==null?void 0:M.length)==2&&f(q(h.value[0]),q(h.value[1]),S.value)};return z(()=>k.value,M=>{switch(M){case"lastWeek":h.value=e();break;case"lastMonth":h.value=c();break;case"currentMonth":h.value=v();break;case"lastThreeMonths":h.value=b();break;case"yearToDate":h.value=n();break;default:h.value=[],d.value=""}},{deep:!0}),ee(()=>{g({itemsPerPage:10,page:1}).then(()=>{C.value=[{id:0,title:"TODOS"},...y.value]}),O()}),(M,_)=>{const B=K,X=J;return A(),R(P,{class:"match-height"},{default:r(()=>[o(w,{cols:"12"},{default:r(()=>[o(re,{modelValue:x.value,"onUpdate:modelValue":_[3]||(_[3]=u=>x.value=u)},{default:r(()=>[o(le,null,{default:r(()=>[o(ne,null,{default:r(()=>_[4]||(_[4]=[j(" Filtro avanzado ")])),_:1}),o(ie,null,{default:r(()=>[o(P,null,{default:r(()=>[o(w,{cols:"12",md:"12"},{default:r(()=>[V("div",ke,[V("span",Le,[o(B,{modelValue:S.value,"onUpdate:modelValue":_[0]||(_[0]=u=>S.value=u),label:"Por proyecto",placeholder:"Seleccione una opción",items:C.value,"item-title":u=>u.title,"item-value":u=>u.id,config:{position:"auto right"}},null,8,["modelValue","items","item-title","item-value"])]),V("span",we,[o(B,{modelValue:k.value,"onUpdate:modelValue":_[1]||(_[1]=u=>k.value=u),label:"En el tiempo",placeholder:"Seleccione una opción",items:H,config:{position:"auto right"}},null,8,["modelValue"])]),k.value==="dateRange"?(A(),F("span",Ve,[o(X,{modelValue:d.value,"onUpdate:modelValue":_[2]||(_[2]=u=>d.value=u),label:"Rango de fecha",placeholder:"Seleccione las fechas",config:{mode:"range",dateFormat:"Y-m-d",maxDate:new Date,defaultDate:h.value,onValueUpdate:u=>{(u==null?void 0:u.length)>0&&(h.value=u)}}},null,8,["modelValue","config"])])):G("",!0),o(te,{type:"submit",onClick:I,class:"clear-filter-btn"},{default:r(()=>_[5]||(_[5]=[j(" Filtrar ")])),_:1})])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(w,{cols:"12"},{default:r(()=>[o(oe,{data:L(a),isLoading:L(D)},null,8,["data","isLoading"])]),_:1}),o(w,{cols:"12",md:"8"},{default:r(()=>[o(ye,{data:L(a),isLoading:L(D)},null,8,["data","isLoading"])]),_:1}),o(w,{cols:"12",md:"4"},{default:r(()=>[o(fe,{data:L(p),isLoading:L(D)},null,8,["data","isLoading"])]),_:1}),o(w,{cols:"12",md:"12"},{default:r(()=>[o(De,{data:L(m),isLoading:L(D)},null,8,["data","isLoading"])]),_:1})]),_:1})}}};export{ht as default};
