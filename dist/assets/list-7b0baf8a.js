import{u as oe,p as xe,S as De,_ as Ce,a as he,d as Ne}from"./PreSaleForm-c1f72f1e.js";import{r as K,e as Re}from"./validators-dea6e3a5.js";import{_ as $e}from"./AppTextarea-358bf1ee.js";import{_ as Le}from"./AppDateTimePicker-6f0a5857.js";import{_ as _e}from"./AppTextField-4f4d9147.js";import{_ as be}from"./AppSelect-1a075632.js";import{f as ae}from"./currencyFormatter-92ad4b3c.js";import{$ as ue}from"./api-ae2a11ea.js";import{s as Se,a as Me,b as He,c as Ae,S as we}from"./notifications-81bc0416.js";import{r as _,o as s,c as v,d as l,F as T,i as H,b as e,e as t,n as o,v as x,x as g,z as B,f as q,$ as W,a4 as I,w as ie,a3 as ze,a as ne,a0 as R,am as X,a2 as ee,k as Ge,H as Oe,an as ke,ac as Qe}from"./index-f94095d9.js";import{V as Ue}from"./VAvatar-c3790b31.js";import{b as te,c as le,a as ve}from"./VList-e2c48a55.js";import{V as b}from"./VCol-838ada97.js";import{V as Z}from"./VChip-5b7faf6e.js";import{V as re}from"./VTooltip-18024579.js";import{V as Q}from"./VCardText-3dc531ad.js";import{a as Fe,f as Ke}from"./formatters-b3558c7d.js";import{u as We}from"./useQuote-225fdd09.js";import{_ as Je}from"./AppAutocomplete-0a0898c3.js";import{_ as pe}from"./DialogCloseBtn-c0fd0e56.js";import{u as Ye}from"./useProperty-f5f94651.js";import{V as Y,b as ce}from"./VCard-4fea3896.js";import{V as qe}from"./VForm-3fc0db88.js";import{V as G}from"./VRow-95109874.js";import{V as me}from"./VDialog-a4e9a1fa.js";import{V as ge}from"./VCheckbox-2ed47aab.js";import{V as de}from"./VTable-b061227c.js";import{V as se}from"./VTextField-93dd6ea9.js";import{P as je}from"./vue3-perfect-scrollbar.esm-a1cf510e.js";import{V as Xe,a as Ze}from"./VTimelineItem-2dcb482b.js";import{V as Ee}from"./VNavigationDrawer-c861aa68.js";import{_ as Ie}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as et}from"./AppDrawerHeaderSection-8c142ebe.js";import{V as Te,a as tt}from"./VWindowItem-d21b65a2.js";import{V as lt,a as Pe}from"./VRadioGroup-25e1ff1b.js";import{V as at}from"./VDivider-a363289b.js";import{V as ot,a as it}from"./VTabs-e4403997.js";import{V as st}from"./VOverlay-6192c92c.js";import"./useSales-43629b47.js";import"./InvoiceAddMoney-3a8ca586.js";import"./VNodeRenderer-82748b31.js";import"./helpers-61e4df1a.js";import"./form-18e1924d.js";/* empty css                   */import"./VCounter-9a612d18.js";import"./VImg-3354e329.js";import"./VField-1fa9033b.js";import"./easing-9f15041e.js";import"./VInput-c597175f.js";import"./forwardRefs-8348545e.js";import"./VSelect-b0bb8e86.js";import"./dialog-transition-5ead864c.js";import"./VMenu-521a5f9c.js";import"./scopeId-8a3eae16.js";import"./VCheckboxBtn-795dda96.js";import"./VSelectionControl-35c6f02e.js";import"./index-9c720871.js";import"./constants-f3b5ca65.js";import"./ssrBoot-64b400bf.js";import"./filter-225d9a06.js";import"./VSpacer-140c23d4.js";import"./lazy-e7830d47.js";import"./VSlideGroup-c4cc0052.js";const nt=async(C,S)=>await ue(`/opportunity/${C}/stage/${S}`,{method:"GET"}),rt=async(C,S,a)=>await ue(`/opportunity/${C}/procedure/${S}`,{method:"PATCH",body:a});function ye(){const C=_(null),S=_(!1),a=_(!1),y=_([]);return{process:C,loadingProcess:S,errorProcess:a,processes:y,allProcessesOpportunityForStage:async(V,n)=>{try{const c=await nt(V,n);y.value=c.data}catch(c){console.log(c)}},checkProcessForOpportunity:async(V,n,c)=>{try{console.log(c);const d=await rt(V,n,c);Se("¡Proceso completado exitosamente!","El proceso ha sido llevado a cabo sin inconvenientes. ")}catch(d){console.log(d)}}}}const ut={class:"my-5"},dt={key:0},pt=["src"],ct={class:"my-5"},mt={key:0,class:"d-flex flex-wrap gap-2 my-5"},yt={key:1},ft={__name:"EditDeliveryOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","complet"],setup(C,{emit:S}){const a=C,y=S,{changeStatusByOpportunity:U}=oe(),{checkProcessForOpportunity:h}=ye(),V=async()=>{try{await U(a.opportunity.id,7,{}),y("complet")}catch(c){console.error("Error updating customer:",c)}},n=async(c,d)=>{console.log(`Procedimiento ${c} marcado como: ${d?"realizado":"no realizado"}`),await h(a.opportunity.id,c,{is_check:!d}),y("updateStageId",a.opportunity.id)};return(c,d)=>(s(),v(T,null,[l("div",ut,[d[0]||(d[0]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Propiedades ",-1)),a.opportunity.sales.length>0?(s(),v("div",dt,[(s(!0),v(T,null,H(a.opportunity.sales,w=>(s(),v("div",{key:w.id},[(s(!0),v(T,null,H(w.properties,F=>(s(),v("div",{key:F.id,class:"d-flex align-center justify-between"},[e(Ue,{size:"50",rounded:""},{default:t(()=>[l("img",{src:o(xe),alt:"Logo pora",style:{"border-radius":"30%"}},null,8,pt)]),_:1}),e(b,{cols:"12",md:"7"},{default:t(()=>[e(te,{class:"font-weight-medium"},{default:t(()=>[x(g(F.project_title)+" | "+g(F.title),1)]),_:2},1024),e(le,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",null,g(("formatCurrency"in c?c.formatCurrency:o(ae))(F.pivot_price)),1)]),_:2},1024)]),_:2},1024)]))),128))]))),128))])):B("",!0)]),l("div",ct,[d[2]||(d[2]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),a.opportunity.procedure&&a.opportunity.procedure.length>0?(s(),v("div",mt,[(s(!0),v(T,null,H(a.opportunity.procedure,w=>(s(),v("div",{key:w.id},[e(Z,{color:w.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:F=>n(w.id,w.pivot.is_check)},{default:t(()=>[w.pivot.is_check?(s(),q(W,{key:0,icon:"tabler-check",class:"mr-2"})):B("",!0),x(" "+g(w.title),1)]),_:2},1032,["color","onClick"]),e(re,{activator:"parent",location:"top"},{default:t(()=>[x(g(w.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(s(),v("div",yt,d[1]||(d[1]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(Q,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(I,{color:"primary",size:"small",onClick:V},{default:t(()=>d[3]||(d[3]=[x(" Finalizar Oportunidad ")])),_:1})]),_:1})],64))}},Be={__name:"EditCustomerDialog",props:{isDialogVisible:{type:Boolean,required:!0},opportunityKanban:{type:Object,required:!0}},emits:["update:isDialogVisible","update:newProperty"],setup(C,{emit:S}){const a=C,y=S;Object.values(De).map(f=>({title:f.label,value:f.value}));const{propertiesAvailbles:U,properties:h}=Ye(),{getOpportunitybyId:V,opportunity:n,changeOpportunity:c,loadingOpportunity:d}=oe(),w=()=>{y("update:isDialogVisible",!1)},F=async()=>{console.log("antes del save:",n);const f={id:n.value.id,description:n.value.description,property_id:n.value.property_id,customer:{id:n.value.customer.id,name:n.value.customer.name,email:n.value.customer.email,ci:n.value.customer.ci,cod_phone:n.value.cod_phone,phone:n.value.customer.phone}};await c(n.value.id,f),n.value.property_id&&(console.log("Cambio y geenero el Emit Principal"),y("update:newProperty",n.value.property_id)),y("update:isDialogVisible",!1)},A=async()=>{var f;(f=a.opportunityKanban)!=null&&f.id&&await V(a.opportunityKanban.id)},k=async()=>{await U()};return ie(()=>a.isDialogVisible,async f=>{f===!0&&(A(),await k())}),(f,p)=>{const O=pe,L=_e,i=be,m=Je,M=$e;return s(),q(me,{"max-width":"800","model-value":a.isDialogVisible,persistent:"","close-on-esc":!1,"onUpdate:modelValue":w},{default:t(()=>[e(O,{onClick:w}),e(Y,{title:"Información del Cliente y Oportunidad",class:"pa-sm-8 pa-5"},{default:t(()=>[e(Q,null,{default:t(()=>[e(qe,{onSubmit:ze(F,["prevent"])},{default:t(()=>[e(G,{dense:""},{default:t(()=>[e(b,{cols:"12",md:"6"},{default:t(()=>[e(L,{modelValue:o(n).customer.name,"onUpdate:modelValue":p[0]||(p[0]=D=>o(n).customer.name=D),label:"Nombre del Cliente",placeholder:"Ingresa el nombre",outlined:""},null,8,["modelValue"])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(L,{modelValue:o(n).customer.email,"onUpdate:modelValue":p[1]||(p[1]=D=>o(n).customer.email=D),label:"Email del Cliente",placeholder:"Ingresa el email",outlined:""},null,8,["modelValue"])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(G,null,{default:t(()=>[e(b,{cols:"4"},{default:t(()=>[e(i,{modelValue:o(n).customer.cod_phone,"onUpdate:modelValue":p[2]||(p[2]=D=>o(n).customer.cod_phone=D),label:"Código",items:["+591","+1","+52"],placeholder:"Cód.",outlined:""},null,8,["modelValue"])]),_:1}),e(b,{cols:"8"},{default:t(()=>[e(L,{modelValue:o(n).customer.phone,"onUpdate:modelValue":p[3]||(p[3]=D=>o(n).customer.phone=D),label:"Número de Teléfono",placeholder:"Ingresa el teléfono",outlined:"",dense:"",maxlength:"9"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(L,{modelValue:o(n).customer.ci,"onUpdate:modelValue":p[4]||(p[4]=D=>o(n).customer.ci=D),label:"CI del Cliente",placeholder:"Ingresa el CI",outlined:""},null,8,["modelValue"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(m,{modelValue:o(n).property_id,"onUpdate:modelValue":p[5]||(p[5]=D=>o(n).property_id=D),label:"Departamento de Interés",placeholder:"Selecciona un Departamento",items:o(h).map(D=>({title:D.title,value:D.id})),outlined:""},null,8,["modelValue","items"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(M,{modelValue:o(n).description,"onUpdate:modelValue":p[6]||(p[6]=D=>o(n).description=D),label:"Descripción de la Oportunidad",placeholder:"Ingresa una descripción",rows:"3","auto-grow":"",outlined:""},null,8,["modelValue"])]),_:1}),e(b,{cols:"12",class:"text-center"},{default:t(()=>[e(I,{type:"submit",color:"primary",class:"me-3",disabled:o(d),loading:o(d)},{default:t(()=>p[7]||(p[7]=[x(" Guardar ")])),_:1},8,["disabled","loading"]),e(I,{color:"secondary",variant:"tonal",onClick:w},{default:t(()=>p[8]||(p[8]=[x(" Cancelar ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},vt={class:"d-flex align-bottom flex-sm-row flex-column"},gt={class:"user-profile-info"},_t={class:"d-flex align-center justify-center justify-sm-space-between flex-wrap gap-4"},bt={class:"d-flex align-center gap-x-3"},Vt={class:"text-4xl font-weight-medium"},wt={class:"d-flex flex-column py-2",style:{"font-size":"14px"}},kt={class:"text-sm text-disabled"},Pt={key:0,class:"d-flex flex-wrap gap-2 my-5"},xt={key:1},Dt={key:0,class:"d-flex flex-wrap gap-2 my-5"},Ct={key:1},ht={__name:"EditPreSaleOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","update:newProperty"],setup(C,{emit:S}){const a=C,y=S,{checkProcessForOpportunity:U}=ye(),{changeStatusQuotes:h}=We(),V=_(!1),n=_(!1),c=()=>{V.value=!0},d=()=>{console.log("Se escucho el evento en EditProspectOpportunity"),y("update:newProperty")},w=()=>{n.value=!0},F=async f=>{y("updateStageId",f)},A=async(f,p)=>{console.log(`Procedimiento ${f} marcado como: ${p?"realizado":"no realizado"}`),await U(a.opportunity.id,f,{is_check:!p}),y("updateStageId",a.opportunity.id)},k=async(f,p)=>{const O=p==="APPROVED"?"NOT_APPROVED":"APPROVED";console.log(`Procedimiento ${f} marcado como: ${p}`),await h(f,{status:O}),y("updateStageId",a.opportunity.id)};return(f,p)=>{const O=ne("RouterLink"),L=ne("IconBtn");return s(),v(T,null,[l("div",vt,[l("div",gt,[p[3]||(p[3]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Perfil ",-1)),l("div",_t,[l("div",bt,[l("span",Vt,g(("avatarText"in f?f.avatarText:o(Fe))(a.opportunity.customer.name)),1),l("div",wt,[e(O,{to:{name:"apps-ecommerce-customer-details-id",params:{id:1}},class:"font-weight-base"},{default:t(()=>[x(g(a.opportunity.customer.name),1)]),_:1}),l("span",kt,g(a.opportunity.customer.phone),1)]),e(I,{color:"secondary",variant:"tonal",size:"small",onClick:c},{default:t(()=>p[2]||(p[2]=[x(" Editar Perfil ")])),_:1})])])])]),l("div",null,[p[5]||(p[5]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),a.opportunity.procedure&&a.opportunity.procedure.length>0?(s(),v("div",Pt,[(s(!0),v(T,null,H(a.opportunity.procedure,i=>(s(),v("div",{key:i.id},[e(Z,{color:i.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:m=>A(i.id,i.pivot.is_check)},{default:t(()=>[i.pivot.is_check?(s(),q(W,{key:0,icon:"tabler-check",class:"mr-2"})):B("",!0),x(" "+g(i.title),1)]),_:2},1032,["color","onClick"]),e(re,{activator:"parent",location:"top"},{default:t(()=>[x(g(i.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(s(),v("div",xt,p[4]||(p[4]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),l("div",null,[p[8]||(p[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Cotizaciones ",-1)),a.opportunity.quotes&&a.opportunity.quotes.length>0?(s(),v("div",Dt,[e(de,{density:"compact",class:"text-no-wrap",style:{"font-size":"12px"}},{default:t(()=>[p[6]||(p[6]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th")])],-1)),l("tbody",null,[(s(!0),v(T,null,H(a.opportunity.quotes,i=>(s(),v("tr",{key:i.id},[l("td",null,g(i.properties[0].title),1),l("td",null,g(i.created_at),1),l("td",null,g(("formatCurrency"in f?f.formatCurrency:o(ae))(i.amount)),1),l("td",null,[e(G,null,{default:t(()=>[e(ge,{modelValue:i.status,"onUpdate:modelValue":m=>i.status=m,"true-value":"APPROVED","false-value":"NOT_APPROVED",onClick:m=>k(i.id,i.status)},{default:t(()=>[e(re,{activator:"parent",location:"top"},{default:t(()=>[x(g(i.status=="NOT_APPROVED"?"Aprobar Cotización ":"Cancelar Aprobacion"),1)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","onClick"]),e(O,{to:{name:"quote-id",params:{id:i.id}}},{default:t(()=>[e(L,null,{default:t(()=>[e(W,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])]),_:2},1024)])]))),128))])]),_:1})])):(s(),v("div",Ct,p[7]||(p[7]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(Q,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(O,{to:{name:"quote-add-quote"},class:"text-white"},{default:t(()=>[e(I,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>p[9]||(p[9]=[x(" Generar Cotización ")])),_:1})]),_:1}),e(I,{color:"primary",class:"mx-auto",size:"small",onClick:w},{default:t(()=>p[10]||(p[10]=[x(" Generar Venta ")])),_:1})]),_:1}),e(Be,{"is-dialog-visible":o(V),"onUpdate:isDialogVisible":p[0]||(p[0]=i=>R(V)?V.value=i:null),"opportunity-kanban":a.opportunity,"onUpdate:newProperty":d},null,8,["is-dialog-visible","opportunity-kanban"]),e(Ce,{"is-dialog-visible":o(n),"onUpdate:isDialogVisible":p[1]||(p[1]=i=>R(n)?n.value=i:null),opportunity:a.opportunity,stage:"PRESALE",onRegisterSale:F},null,8,["is-dialog-visible","opportunity"])],64)}}},$t={class:"d-flex align-bottom flex-sm-row flex-column"},St={class:"user-profile-info"},At={class:"d-flex align-center justify-center justify-sm-space-between flex-wrap gap-4"},zt={class:"d-flex align-center gap-x-3"},Ot={class:"text-4xl font-weight-medium"},Ut={class:"d-flex flex-column py-2",style:{"font-size":"14px"}},Ft={class:"text-sm text-disabled"},qt={key:0,class:"d-flex flex-wrap gap-2 my-5"},jt={key:1},Et={key:0,class:"d-flex flex-wrap gap-2 my-5"},It={key:1},Tt={__name:"EditProspectOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","update:newProperty"],setup(C,{emit:S}){const a=C,y=S,{checkProcessForOpportunity:U}=ye(),{changeStatusByOpportunity:h,loadingOpportunity:V}=oe(),n=_(!1),c=()=>{n.value=!0},d=()=>{console.log("Se escucho el evento en EditProspectOpportunity"),y("update:newProperty")},w=async A=>{await h(A,De.PRESALE.value,{}),y("updateStageId",A)},F=async A=>{console.log(`Procedimiento ${A.id} marcado como: ${A.pivot.is_check?"realizado":"no realizado"}`),await U(a.opportunity.id,A.id,{is_check:!A.pivot.is_check}),A.pivot.is_check=!A.pivot.is_check,y("updateStageId",a.opportunity.id)};return(A,k)=>{const f=ne("RouterLink"),p=ne("IconBtn");return s(),v(T,null,[l("div",$t,[l("div",St,[k[3]||(k[3]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Perfil ",-1)),l("div",At,[l("div",zt,[l("span",Ot,g(("avatarText"in A?A.avatarText:o(Fe))(a.opportunity.customer.name)),1),l("div",Ut,[e(f,{to:{name:"apps-ecommerce-customer-details-id",params:{id:1}},class:"font-weight-base"},{default:t(()=>[x(g(a.opportunity.customer.name),1)]),_:1}),l("span",Ft,g(a.opportunity.customer.phone),1)]),l("div",null,[e(I,{color:"secondary",variant:"tonal",size:"small",onClick:c},{default:t(()=>k[2]||(k[2]=[x(" Editar Perfil ")])),_:1})])])])])]),l("div",null,[k[5]||(k[5]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),a.opportunity.procedure&&a.opportunity.procedure.length>0?(s(),v("div",qt,[(s(!0),v(T,null,H(a.opportunity.procedure,O=>(s(),v("div",{key:O.id},[e(Z,{color:O.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:L=>F(O)},{default:t(()=>[O.pivot.is_check?(s(),q(W,{key:0,icon:"tabler-check",class:"mr-2"})):B("",!0),x(" "+g(O.title),1)]),_:2},1032,["color","onClick"]),e(re,{activator:"parent",location:"top"},{default:t(()=>[x(g(O.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(s(),v("div",jt,k[4]||(k[4]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),l("div",null,[k[8]||(k[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Cotizaciones ",-1)),a.opportunity.quotes&&a.opportunity.quotes.length>0?(s(),v("div",Et,[e(de,{density:"compact",class:"text-no-wrap",style:{"font-size":"12px"}},{default:t(()=>[k[6]||(k[6]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th")])],-1)),l("tbody",null,[(s(!0),v(T,null,H(a.opportunity.quotes,O=>(s(),v("tr",{key:O.id},[l("td",null,g(O.properties[0].title),1),l("td",null,g(O.created_at),1),l("td",null,g(("formatCurrency"in A?A.formatCurrency:o(ae))(O.amount)),1),l("td",null,[e(f,{to:{name:"quote-id",params:{id:O.id}}},{default:t(()=>[e(p,null,{default:t(()=>[e(W,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])])]))),128))])]),_:1})])):(s(),v("div",It,k[7]||(k[7]=[l("span",null,"No hay cotizaciones disponibles.",-1)])))]),e(Q,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(f,{to:{name:"quote-add-quote"},class:"text-white"},{default:t(()=>[e(I,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>k[9]||(k[9]=[x(" Generar Cotización ")])),_:1})]),_:1}),e(I,{color:"primary",class:"mx-auto",size:"small",disabled:o(V),loading:o(V),onClick:k[0]||(k[0]=O=>w(a.opportunity.id))},{default:t(()=>k[10]||(k[10]=[x(" Siguiente Etapa ")])),_:1},8,["disabled","loading"])]),_:1}),e(Be,{"is-dialog-visible":o(n),"onUpdate:isDialogVisible":k[1]||(k[1]=O=>R(n)?n.value=O:null),"opportunity-kanban":a.opportunity,"onUpdate:newProperty":d},null,8,["is-dialog-visible","opportunity-kanban"])],64)}}},Bt=async C=>await ue(`/sale/paymentPlans/${C}/confirm`,{method:"PATCH"}),Nt=async(C,S)=>await ue(`/sale/paymentPlans/${C}`,{method:"PATCH",body:S});function Ve(){const C=_(!1),S=_([]),a=_(null),y=_(null);return{loadingPaymentPlans:C,paymentPlan:y,error:a,paymentPlans:S,confirmPaymentPlans:async V=>{try{const n=await Bt(V);Se("Actualizacion Exitosa","Se confirmo el pago")}catch(n){console.log(n)}},updatePaymentPlans:async(V,n)=>{C.value=!0,a.value=null;try{console.log(n);const c=await Nt(V,n);y.value=c.data,Me("¡Planes de pago actualizados exitosamente! ","Los planes de pago han sido modificados y guardados correctamente."),console.log(c)}catch(c){console.log(c),c.response&&c.response.status==422&&He("Advertencia","Faltan datos por Completar"),a.value=c.message}finally{C.value=!1}}}}const Rt={__name:"DeliveryForm",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(C,{emit:S}){const a=C,y=S,{changeStatusByOpportunity:U}=oe(),h=d=>{y("update:isDialogVisible",d)},V=_(structuredClone(X(a.opportunity)));ie(a,()=>{V.value=structuredClone(X(a.opportunity))});const n=async()=>{y("update:isDialogVisible",!1);try{await U(a.opportunity.id,5,{delivery_date:V.value.sales.delivery_date}),y("updateDeliveryDate",V.value.id)}catch(d){console.error("Error updating customer:",d)}},c=()=>{y("update:isDialogVisible",!1)};return(d,w)=>{const F=pe;return s(),q(me,{"model-value":a.isDialogVisible,"max-width":"800","onUpdate:modelValue":h},{default:t(()=>[e(F,{onClick:w[0]||(w[0]=A=>d.$emit("update:isDialogVisible",!1))}),e(Y,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(ce,{class:"text-h3 text-center"},{default:t(()=>w[2]||(w[2]=[x(" Confirmar Fecha ")])),_:1}),e(Q,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(G,null,{default:t(()=>[e(b,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(se,{modelValue:o(V).sales.delivery_date,"onUpdate:modelValue":w[1]||(w[1]=A=>o(V).sales.delivery_date=A),label:"Fecha de Entrega",type:"date",rules:["requiredValidator"in d?d.requiredValidator:o(K)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),e(b,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(I,{onClick:n},{default:t(()=>w[3]||(w[3]=[x(" Pasar a Entrega ")])),_:1}),e(I,{color:"secondary",variant:"tonal",onClick:c},{default:t(()=>w[4]||(w[4]=[x(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Lt={key:0},Mt={__name:"PaymentPlanEdit",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},payment:{type:Object,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(C,{emit:S}){const a=C,y=S,{updatePaymentPlans:U}=Ve(),h=_(!1),V=i=>{y("update:isDialogVisible",i)},n=_(structuredClone(X(a.payment))),c=_(structuredClone(X(a.opportunity))),d=_([]);ie(a,()=>{n.value=structuredClone(X(a.payment)),c.value=structuredClone(X(a.opportunity))});const w=()=>{d.value.push({amount:"",date:"",type:n.value.type})},F=i=>{d.value.splice(i,1)},A=ee(()=>d.value.reduce((i,m)=>{const M=parseFloat(m.amount)||0;return i+M},0)),k=ee(()=>d.value.length>0&&d.value.every(i=>i.amount&&i.date&&i.type)),f=ee(()=>{if(d.value.length===0)return!0;const i=d.value.reduce((D,P)=>D+(parseFloat(P.amount)||0),0),m=parseFloat(i),M=parseFloat(n.value.amount);return m===M}),p=ee(()=>d.value.length===0?!0:k.value&&f.value),O=async()=>{if(!f.value){Ae("Validación fallida","La suma de las diferencias no es correcta");return}if(!p.value){alert("Por favor, completa todos los campos obligatorios.");return}h.value=!0;try{await U(n.value.id,{date:n.value.date,differData:d.value})}catch(i){console.error("Error updating customer:",i)}finally{y("updateDeliveryDate",c.value.id),y("update:isDialogVisible",!1),d.value=[],h.value=!1}},L=()=>{y("update:isDialogVisible",!1),d.value=[],errorMessage.value=""};return(i,m)=>{const M=pe;return s(),q(me,{"model-value":a.isDialogVisible,"max-width":"800","onUpdate:modelValue":V},{default:t(()=>[e(M,{onClick:m[0]||(m[0]=D=>i.$emit("update:isDialogVisible",!1))}),e(Y,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(ce,{class:"text-h3 text-center"},{default:t(()=>m[2]||(m[2]=[x(" Editar Pago ")])),_:1}),e(Q,null,{default:t(()=>[e(G,{class:"mx-5"},{default:t(()=>[e(b,{cols:"6"},{default:t(()=>[l("h3",null," Monto a Pagar : $ "+g(o(n).amount),1)]),_:1}),e(b,{cols:"6"},{default:t(()=>[e(se,{modelValue:o(n).date,"onUpdate:modelValue":m[1]||(m[1]=D=>o(n).date=D),label:"Cambiar Fecha",type:"date",rules:["requiredValidator"in i?i.requiredValidator:o(K)]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(Y,{flat:"",class:"d-flex flex-column pa-5 px-5"},{default:t(()=>[(s(!0),v(T,null,H(o(d),(D,P)=>(s(),v("div",{key:D.id,class:"d-flex align-center my-4"},[e(se,{modelValue:D.amount,"onUpdate:modelValue":r=>D.amount=r,label:"Monto *",type:"number",class:"mr-4",outlined:"",rules:["requiredValidator"in i?i.requiredValidator:o(K)]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(se,{modelValue:D.date,"onUpdate:modelValue":r=>D.date=r,label:"Fecha de Pago *",type:"date",class:"mr-3",outlined:"",rules:["requiredValidator"in i?i.requiredValidator:o(K)]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(I,{color:"error",onClick:r=>F(P)},{default:t(()=>[e(W,{icon:"tabler-square-x"})]),_:2},1032,["onClick"])]))),128)),o(d).length>0?(s(),v("div",Lt,[m[3]||(m[3]=l("strong",null,"Monto Restante:",-1)),x(" $"+g((o(n).amount-o(A)).toFixed(2)),1)])):B("",!0),e(I,{color:"primary",variant:"tonal",class:"mt-4",size:"small",onClick:w},{default:t(()=>m[4]||(m[4]=[x(" Diferir Pago ")])),_:1})]),_:1}),e(b,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(I,{loading:o(h),disabled:!o(p)||o(h),onClick:O},{default:t(()=>m[5]||(m[5]=[x(" Guardar ")])),_:1},8,["loading","disabled"]),e(I,{color:"error",variant:"tonal",onClick:L},{default:t(()=>m[6]||(m[6]=[x(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Ht={__name:"SalePaymentPlan",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},salesPayment:{type:Array,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(C,{emit:S}){const a=C,y=S;Ve();const U=c=>{y("update:isDialogVisible",c)},h=_(structuredClone(X(a.opportunity)));ie(a,()=>{h.value=structuredClone(X(a.opportunity)),console.log("Sales Payment:",a.salesPayment)});const V=_([]),n=()=>{y("update:isDialogVisible",!1),V.value=[]};return(c,d)=>{const w=pe;return s(),q(me,{"model-value":a.isDialogVisible,"max-width":"800","onUpdate:modelValue":U},{default:t(()=>[e(w,{onClick:d[0]||(d[0]=F=>c.$emit("update:isDialogVisible",!1))}),e(Y,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(ce,{class:"text-h3 text-center"},{default:t(()=>d[1]||(d[1]=[x(" Confirmar Fecha ")])),_:1}),e(Q,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(G,null,{default:t(()=>[e(b,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l("span",null," Monto a Pagar : "+g(o(h)),1)]),_:1})]),_:1})]),_:1}),e(b,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(I,{onClick:c.onFormSubmit},{default:t(()=>d[2]||(d[2]=[x(" Guardar ")])),_:1},8,["onClick"]),e(I,{color:"error",variant:"tonal",onClick:n},{default:t(()=>d[3]||(d[3]=[x(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Gt={class:"text-h6"},Qt={class:"text-h6"},Kt={class:"text-h6"},Wt={class:"my-5"},Jt={key:0},Yt=["src"],Xt={class:"mb-4"},Zt=["onClick"],el=["onClick"],tl={class:"my-5"},ll={key:0,class:"d-flex flex-wrap gap-2 my-5"},al={key:1},ol={__name:"EditSaleOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId"],setup(C,{emit:S}){const a=C,y=S,{checkProcessForOpportunity:U}=ye(),{confirmPaymentPlans:h}=Ve(),{changeStatusByOpportunity:V,loadingOpportunity:n}=oe(),c=_(!1),d=_(!1),w=_(!1),F=_(""),A=ee(()=>a.opportunity.sales.reduce((P,r)=>P+r.amount,0)),k=ee(()=>a.opportunity.sales.reduce((P,r)=>P+r.initial_fee,0)),f=ee(()=>A.value-k.value),p=()=>{w.value=!0},O=P=>{if(P.is_paid===1){Ae("Advertencia","No se puede editar un pago ya realizado.");return}console.log("entro aqui"),d.value=!0,F.value={...P}},L=async P=>{y("updateStageId",P)},i=async P=>{console.log(`Procedimiento ${P.id} marcado como: ${P.pivot.is_check?"realizado":"no realizado"}`),await U(a.opportunity.id,P.id,{is_check:!P.pivot.is_check}),P.pivot.is_check=!P.pivot.is_check,y("updateStageId",a.opportunity.id)},m=async P=>{console.log(P),await h(P),y("updateStageId",a.opportunity.id)},M=async P=>{await V(P,5,{}),y("updateStageId",P)},D=async P=>{y("updateStageId",P)};return(P,r)=>(s(),v(T,null,[l("div",null,[e(Y,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(G,null,{default:t(()=>[e(b,{cols:"4",class:"border rounded-sm mx-1"},{default:t(()=>[e(te,{class:"font-weight-medium"},{default:t(()=>r[5]||(r[5]=[x(" Saldo ")])),_:1}),e(le,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Gt,g(("formatCurrency"in P?P.formatCurrency:o(ae))(o(f))),1)]),_:1})]),_:1}),e(b,{cols:"3",class:"border rounded-sm mx-1"},{default:t(()=>[e(te,{class:"font-weight-medium"},{default:t(()=>r[6]||(r[6]=[x(" Anticipo ")])),_:1}),e(le,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Qt,g(("formatCurrency"in P?P.formatCurrency:o(ae))(o(k))),1)]),_:1})]),_:1}),e(b,{cols:"4",class:"border rounded-sm mx-1"},{default:t(()=>[e(te,{class:"font-weight-medium"},{default:t(()=>r[7]||(r[7]=[x(" Precio Final ")])),_:1}),e(le,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Kt,g(("formatCurrency"in P?P.formatCurrency:o(ae))(o(A))),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),l("div",Wt,[r[8]||(r[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Propiedades ",-1)),a.opportunity.sales.length>0?(s(),v("div",Jt,[(s(!0),v(T,null,H(a.opportunity.sales,$=>(s(),v("div",{key:$.id},[(s(!0),v(T,null,H($.properties,z=>(s(),v("div",{key:z.id,class:"d-flex align-center justify-between"},[e(Ue,{size:"50",rounded:""},{default:t(()=>[l("img",{src:o(xe),alt:"Logo pora",style:{"border-radius":"30%"}},null,8,Yt)]),_:1}),e(b,{cols:"12",md:"7"},{default:t(()=>[e(te,{class:"font-weight-medium"},{default:t(()=>[x(g(z.project_title)+" | "+g(z.title),1)]),_:2},1024),e(le,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",null,"$ "+g(z.pivot_price),1)]),_:2},1024)]),_:2},1024)]))),128))]))),128))])):B("",!0)]),l("div",Xt,[r[10]||(r[10]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Anticipo ",-1)),a.opportunity.initial_payments&&a.opportunity.initial_payments.length>0?(s(),q(de,{key:0,density:"compact",class:"text-no-wrap my-2",style:{"font-size":"12px"}},{default:t(()=>[r[9]||(r[9]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th",null," Action ")])],-1)),l("tbody",null,[(s(!0),v(T,null,H(a.opportunity.initial_payments,$=>(s(),v("tr",{key:$.id},[l("td",null,g($.property_title),1),l("td",null,g($.date),1),l("td",null,g($.amount),1),l("td",null,[e(G,null,{default:t(()=>[e(ge,{modelValue:$.is_paid,"onUpdate:modelValue":z=>$.is_paid=z,"true-value":1,"false-value":0,disabled:$.is_paid===1,onChange:z=>m($.id)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"]),$.is_paid===0?(s(),v("div",{key:0,"fill-dot":"",onClick:z=>O($)},[e(W,{size:"25",icon:"tabler-edit"})],8,Zt)):B("",!0)]),_:2},1024)])]))),128))])]),_:1})):B("",!0)]),l("div",null,[r[13]||(r[13]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Saldos ",-1)),a.opportunity.balance_payments&&a.opportunity.balance_payments.length>0?(s(),q(de,{key:0,density:"compact",class:"text-no-wrap my-2",style:{"font-size":"12px"}},{default:t(()=>[r[12]||(r[12]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th",null," Action ")])],-1)),l("tbody",null,[(s(!0),v(T,null,H(a.opportunity.balance_payments,$=>(s(),v("tr",{key:$.id},[l("td",null,g($.property_title),1),l("td",null,g($.date),1),l("td",null,g($.amount),1),l("td",null,[e(G,null,{default:t(()=>[e(ge,{modelValue:$.is_paid,"onUpdate:modelValue":z=>$.is_paid=z,"true-value":1,"false-value":0,disabled:$.is_paid===1,onChange:z=>m($.id)},{default:t(()=>[e(re,{activator:"parent",location:"top"},{default:t(()=>r[11]||(r[11]=[x(" Confirmar Pago ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"]),$.is_paid===0?(s(),v("div",{key:0,"fill-dot":"",onClick:z=>O($)},[e(W,{size:"25",icon:"tabler-edit"})],8,el)):B("",!0)]),_:2},1024)])]))),128))])]),_:1})):B("",!0)]),l("div",tl,[r[15]||(r[15]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),a.opportunity.procedure&&a.opportunity.procedure.length>0?(s(),v("div",ll,[(s(!0),v(T,null,H(a.opportunity.procedure,$=>(s(),v("div",{key:$.id},[e(Z,{color:$.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:z=>i($)},{default:t(()=>[$.pivot.is_check?(s(),q(W,{key:0,icon:"tabler-check",class:"mr-2"})):B("",!0),x(" "+g($.title),1)]),_:2},1032,["color","onClick"])]))),128))])):(s(),v("div",al,r[14]||(r[14]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(Q,{class:"d-flex mt-4"},{default:t(()=>[e(I,{color:"primary",variant:"tonal",class:"mx-auto",size:"small",onClick:p},{default:t(()=>r[16]||(r[16]=[x(" Generar Venta ")])),_:1}),e(I,{color:"primary",class:"mx-auto",size:"small",onClick:r[0]||(r[0]=$=>M(a.opportunity.id))},{default:t(()=>r[17]||(r[17]=[x(" Siguiente Etapa ")])),_:1})]),_:1}),e(Rt,{"is-dialog-visible":o(c),"onUpdate:isDialogVisible":r[1]||(r[1]=$=>R(c)?c.value=$:null),opportunity:a.opportunity,onUpdateDeliveryDate:D},null,8,["is-dialog-visible","opportunity"]),e(Mt,{"is-dialog-visible":o(d),"onUpdate:isDialogVisible":r[2]||(r[2]=$=>R(d)?d.value=$:null),payment:o(F),opportunity:a.opportunity,onUpdateDeliveryDate:D},null,8,["is-dialog-visible","payment","opportunity"]),e(Ce,{"is-dialog-visible":o(w),"onUpdate:isDialogVisible":r[3]||(r[3]=$=>R(w)?w.value=$:null),opportunity:a.opportunity,stage:"SALE",onRegisterSale:L},null,8,["is-dialog-visible","opportunity"]),e(Ht,{"is-dialog-visible":P.openSaleEditPaymentPlan,"onUpdate:isDialogVisible":r[4]||(r[4]=$=>P.openSaleEditPaymentPlan=$),opportunity:a.opportunity,"sales-payment":P.salePaymentPlan,onUpdateDeliveryDate:D},null,8,["is-dialog-visible","opportunity","sales-payment"])],64))}},il=async C=>await ue(`/customer/${C}/bitacora`,{method:"GET"});function sl(){const C=_(!1),S=_([]);return Ge(),_(0),{getBitacorabyId:async y=>{try{const U=await il(y);S.value=U,console.log(U)}catch(U){console.error(U)}},loadingBitacora:C,bitacoras:ee(()=>S.value)}}const nl={class:"my-5"},rl={class:"d-flex justify-space-between align-center gap-2 flex-wrap"},ul={class:"app-timeline-title"},dl={class:"app-timeline-meta"},pl={class:"app-timeline-text"},cl={key:0,class:"empty-state my-2"},ml={__name:"BitacoraCustomer",props:{customer:{type:String,required:!0}},setup(C){const S=C,{bitacoras:a,getBitacorabyId:y}=sl();Oe(async()=>{await y(S.customer)});const U=h=>{switch(h){case 1:return"Visita";case 2:return"Llamada";case 3:return"Cotización";default:return"Otro"}};return(h,V)=>(s(),v("div",null,[e(Y,{title:"Historial del cliente"},{default:t(()=>[e(Q,null,{default:t(()=>[e(G,{class:"d-flex justify-space-between"},{default:t(()=>[e(b,{cols:"12"},{default:t(()=>[l("div",nl,[e(Xe,{side:"end",align:"start","line-inset":"8","truncate-line":"both",density:"compact"},{default:t(()=>[(s(!0),v(T,null,H(o(a),n=>(s(),q(Ze,{key:n.id,size:"x-small","dot-color":"warning"},{default:t(()=>[l("div",rl,[l("span",ul,g(n.log_name),1),l("span",dl,g(("formatDate"in h?h.formatDate:o(Ke))(n.created_at)),1)]),l("div",pl,[l("p",null,g(n.description),1),n.properties.activity?(s(),q(Z,{key:0},{default:t(()=>[x(g(U(n.properties.activity.type_activity_id)),1)]),_:2},1024)):B("",!0)])]),_:2},1024))),128))]),_:1}),!o(a)||o(a).length===0?(s(),v("div",cl,V[0]||(V[0]=[l("p",null,"No hay actividades registradas para este cliente.",-1)]))):B("",!0)])]),_:1})]),_:1})]),_:1})]),_:1})]))}},yl={__name:"DrawerBitacora",props:{isDrawerOpen:{type:Boolean,required:!0},customer:{type:String,required:!1}},emits:["update:isDrawerOpen"],setup(C,{emit:S}){const a=C,y=S,U=h=>{y("update:isDrawerOpen",h)};return(h,V)=>(s(),q(Ee,{temporary:"",width:500,location:"end",class:"scrollable-content","model-value":a.isDrawerOpen,"onUpdate:modelValue":U},{default:t(()=>[e(o(je),{options:{wheelPropagation:!1}},{default:t(()=>[e(ml,{customer:"1"})]),_:1})]),_:1},8,["model-value"]))}};const fl={__name:"SellerReport",setup(C){return _([{title:"Actividad 1",date:"2024-10-09",status:"Pendiente"},{title:"Actividad 2",date:"2024-10-10",status:"Completada"},{title:"Actividad 3",date:"2024-10-11",status:"En Progreso"}]),(S,a)=>(s(),q(Q,null,{default:t(()=>a[0]||(a[0]=[l("p",null,"No hay actividades seleccionadas. Aquí tienes un resumen de las actividades:",-1)])),_:1}))}},vl=Ie(fl,[["__scopeId","data-v-c9cbe3f1"]]),gl={__name:"CustomerHistory",props:{isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","userData"],setup(C,{emit:S}){const a=C,y=S,U=_(!1),h=_(),V=_(""),n=_(""),c=_(""),d=_(""),w=_(),F=_(""),A=_(),k=_(),f=_(),p=()=>{y("update:isDrawerOpen",!1),ke(()=>{var i,m;(i=h.value)==null||i.reset(),(m=h.value)==null||m.resetValidation()})},O=()=>{var i;(i=h.value)==null||i.validate().then(({valid:m})=>{m&&(y("userData",{id:0,fullName:V.value,company:d.value,role:A.value,country:w.value,contact:F.value,email:c.value,currentPlan:k.value,status:f.value,avatar:"",billing:"Auto Debit"}),y("update:isDrawerOpen",!1),ke(()=>{var M,D;(M=h.value)==null||M.reset(),(D=h.value)==null||D.resetValidation()}))})},L=i=>{y("update:isDrawerOpen",i)};return(i,m)=>{const M=et,D=_e,P=be;return s(),q(Ee,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":a.isDrawerOpen,"onUpdate:modelValue":L},{default:t(()=>[e(M,{title:"Historial del Cliente",onCancel:p}),e(o(je),{options:{wheelPropagation:!1}},{default:t(()=>[e(Y,{flat:""},{default:t(()=>[e(Q,null,{default:t(()=>[e(qe,{ref_key:"refForm",ref:h,modelValue:o(U),"onUpdate:modelValue":m[9]||(m[9]=r=>R(U)?U.value=r:null),onSubmit:ze(O,["prevent"])},{default:t(()=>[e(G,null,{default:t(()=>[e(b,{cols:"12"},{default:t(()=>[e(D,{modelValue:o(V),"onUpdate:modelValue":m[0]||(m[0]=r=>R(V)?V.value=r:null),rules:["requiredValidator"in i?i.requiredValidator:o(K)],label:"Full Name",placeholder:"John Doe"},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(D,{modelValue:o(n),"onUpdate:modelValue":m[1]||(m[1]=r=>R(n)?n.value=r:null),rules:["requiredValidator"in i?i.requiredValidator:o(K)],label:"Username",placeholder:"Johndoe"},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(D,{modelValue:o(c),"onUpdate:modelValue":m[2]||(m[2]=r=>R(c)?c.value=r:null),rules:["requiredValidator"in i?i.requiredValidator:o(K),"emailValidator"in i?i.emailValidator:o(Re)],label:"Email",placeholder:"johndoe@email.com"},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(D,{modelValue:o(d),"onUpdate:modelValue":m[3]||(m[3]=r=>R(d)?d.value=r:null),rules:["requiredValidator"in i?i.requiredValidator:o(K)],label:"Company",placeholder:"PixInvent"},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(P,{modelValue:o(w),"onUpdate:modelValue":m[4]||(m[4]=r=>R(w)?w.value=r:null),label:"Select Country",placeholder:"Select Country",rules:["requiredValidator"in i?i.requiredValidator:o(K)],items:["USA","UK","India","Australia"]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(D,{modelValue:o(F),"onUpdate:modelValue":m[5]||(m[5]=r=>R(F)?F.value=r:null),type:"number",rules:["requiredValidator"in i?i.requiredValidator:o(K)],label:"Contact",placeholder:"+1-541-754-3010"},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(P,{modelValue:o(A),"onUpdate:modelValue":m[6]||(m[6]=r=>R(A)?A.value=r:null),label:"Select Role",placeholder:"Select Role",rules:["requiredValidator"in i?i.requiredValidator:o(K)],items:["Admin","Author","Editor","Maintainer","Subscriber"]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(P,{modelValue:o(k),"onUpdate:modelValue":m[7]||(m[7]=r=>R(k)?k.value=r:null),label:"Select Plan",placeholder:"Select Plan",rules:["requiredValidator"in i?i.requiredValidator:o(K)],items:["Basic","Company","Enterprise","Team"]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(P,{modelValue:o(f),"onUpdate:modelValue":m[8]||(m[8]=r=>R(f)?f.value=r:null),label:"Select Status",placeholder:"Select Status",rules:["requiredValidator"in i?i.requiredValidator:o(K)],items:[{title:"Active",value:"active"},{title:"Inactive",value:"inactive"},{title:"Pending",value:"pending"}]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(I,{type:"submit",class:"me-3"},{default:t(()=>m[10]||(m[10]=[x(" Submit ")])),_:1}),e(I,{type:"reset",variant:"outlined",color:"secondary",onClick:p},{default:t(()=>m[11]||(m[11]=[x(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},_l={class:"d-flex justify-space-between align-center"},bl={class:"mb-2"},Vl={style:{"font-size":"14px","font-weight":"500"}},wl={style:{"font-size":"12px","font-weight":"500"}},kl={__name:"AddActivity",props:{activitiesData:{type:Object,required:!0,default:()=>({title:"",description:"",schedule_at:""})},isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","refreshActivities"],setup(C,{emit:S}){const a=C,y=S,U=_(!1);_(!1);const h=_("radio-1"),V=_(!1),n=()=>{V.value=!0},c=_({title:"",description:"",type_activity_id:null,opportunity_id:null,assigned_to:null,scheduled_at:null,status:"COMPLETED"}),{completedActivityAndRegister:d,getallTypeActivities:w,typeActivities:F,loadingActivity:A}=he(),{getOpportunitybyId:k,opportunity:f}=oe(),p=_(structuredClone(X(a.activitiesData))),O=z=>{console.log("esta consultando de nuevo despues de cambiar etapa "),k(z)};ie(a,()=>{p.value=structuredClone(X(a.activitiesData)),k(p.value.opportunity_id),L()});const L=async()=>{await w()},i=()=>{k(p.value.opportunity_id)},m=()=>{y("update:isDrawerOpen",!1),c.value={title:null,description:null,type_activity_id:null,scheduled_at:null,opportunity_id:null,assigned_to:null,status:"COMPLETED"},y("refreshActivities")},M=async()=>{let z="";h.value==="radio-1"?z="COMPLETED":h.value==="radio-2"&&(z="CANCELLED"),d(p.value.id,{title:c.value.title,description:c.value.description,type_activity_id:c.value.type_activity_id,scheduled_at:c.value.scheduled_at,assigned_to:f.value.user_id,property_id:f.value.property_id,opportunity_id:f.value.id,status:z}),m()},D=async()=>{we.fire({title:"Quieres dar de baja al cliente ?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"confirmar"}).then(z=>{z.isConfirmed&&(Ne(p.value.id),m(),we.fire({text:"EL cliente fue dado de baja",icon:"success"}))})},P=async()=>{y("update:isDrawerOpen",!1),y("refreshActivities")},r=()=>{console.log("Se escucho el evento en AddActivity"),y("refreshActivities")},$=z=>{const u=new Date(z),J=u.getDate(),N=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][u.getMonth()],E=u.getHours().toString().padStart(2,"0"),fe=u.getMinutes().toString().padStart(2,"0");return`${J} de ${N}, ${E}:${fe}`};return(z,u)=>{const J=_e,j=Le,N=$e;return s(),v(T,null,[e(G,{class:"d-flex justify-space-between"},{default:t(()=>[e(b,{cols:"12"},{default:t(()=>[C.isDrawerOpen?(s(),q(Y,{key:0},{default:t(()=>[e(Q,null,{default:t(()=>[e(Te,{class:"mx-2 my-2"},{default:t(()=>[e(G,null,{default:t(()=>[e(b,{cols:"12",sm:"5"},{default:t(()=>[e(G,null,{default:t(()=>[e(b,{cols:"12"},{default:t(()=>[l("div",_l,[u[8]||(u[8]=l("span",{style:{"font-size":"18px","font-weight":"500"}}," Actividad ",-1)),e(Z,{color:"warning",onClick:n},{default:t(()=>u[7]||(u[7]=[x(" historial ")])),_:1})])]),_:1}),e(b,{cols:"12"},{default:t(()=>[l("div",bl,[l("span",Vl,g(a.activitiesData.title)+" • "+g($(a.activitiesData.scheduled_at)),1),u[9]||(u[9]=l("br",null,null,-1)),l("span",wl,g(a.activitiesData.description)+" "+g(o(f).customer_id),1)]),e(lt,{modelValue:o(h),"onUpdate:modelValue":u[0]||(u[0]=E=>R(h)?h.value=E:null),style:{"font-size":"14px"},inline:""},{default:t(()=>[u[10]||(u[10]=l("span",{class:"my-1"}," ¿Se realizó? ",-1)),e(Pe,{label:"Si",value:"radio-1",density:"compact",class:"mx-2"}),e(Pe,{label:"No",value:"radio-2",class:"mx-2",density:"compact"})]),_:1},8,["modelValue"]),e(at,{class:"mt-2"})]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(J,{modelValue:o(c).title,"onUpdate:modelValue":u[1]||(u[1]=E=>o(c).title=E),label:"Título de la actividad",placeholder:"..."},null,8,["modelValue"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(be,{modelValue:o(c).type_activity_id,"onUpdate:modelValue":u[2]||(u[2]=E=>o(c).type_activity_id=E),label:"Tipo de actividad",placeholder:"Selecciona el tipo de actividad",items:o(F).map(E=>({title:E.name,value:E.id}))},null,8,["modelValue","items"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(j,{modelValue:o(c).scheduled_at,"onUpdate:modelValue":u[3]||(u[3]=E=>o(c).scheduled_at=E),label:"Seleccione la fecha y hora",placeholder:"Seleccione la fecha y hora",config:{enableTime:!0,dateFormat:"Y-m-d H:i"},rules:["requiredValidator"in z?z.requiredValidator:o(K)]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(N,{modelValue:o(c).description,"onUpdate:modelValue":u[4]||(u[4]=E=>o(c).description=E),label:"Descripción",rows:"3",rules:["requiredValidator"in z?z.requiredValidator:o(K)]},null,8,["modelValue","rules"])]),_:1}),e(b,null,{default:t(()=>[e(I,{color:"primary",class:"mx-auto",size:"small",loading:o(A),disabled:o(A),onClick:M},{default:t(()=>u[11]||(u[11]=[x(" Crear Actividad ")])),_:1},8,["loading","disabled"]),e(I,{color:"primary",class:"mx-1",variant:"tonal",size:"small",onClick:D},{default:t(()=>u[12]||(u[12]=[x(" Dar de Baja ")])),_:1})]),_:1})]),_:1})]),_:1}),e(b,{cols:"12",sm:"7",style:{"align-items":"center"}},{default:t(()=>[e(G,{class:"mb-2"},{default:t(()=>[e(b,{cols:"6"},{default:t(()=>u[13]||(u[13]=[l("span",{style:{"font-size":"18px","font-weight":"500"}}," Etapa ",-1)])),_:1}),e(b,{cols:"12",md:"6",class:"d-flex justify-end align-center"},{default:t(()=>[e(Z,{label:"",color:"primary"},{default:t(()=>[x(g(o(f).stage.title),1)]),_:1})]),_:1})]),_:1}),o(f).stage_id===2?(s(),q(Tt,{key:0,opportunity:o(f),onUpdateStageId:O,"onUpdate:newProperty":r},null,8,["opportunity"])):B("",!0),o(f).stage_id===3?(s(),q(ht,{key:1,opportunity:o(f),onUpdateStageId:O,"onUpdate:newProperty":r},null,8,["opportunity"])):B("",!0),o(f).stage_id===4?(s(),q(ol,{key:2,opportunity:o(f),onRefreshActivities:i,onUpdateStageId:O},null,8,["opportunity"])):B("",!0),o(f).stage_id===5?(s(),q(ft,{key:3,opportunity:o(f),onRefreshActivities:i,onUpdateStageId:O,onComplet:P},null,8,["opportunity"])):B("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):(s(),q(Y,{key:1,title:"Reporte de Actividades"},{default:t(()=>[e(vl)]),_:1}))]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(gl,{"is-drawer-open":o(U),"onUpdate:isDrawerOpen":u[5]||(u[5]=E=>R(U)?U.value=E:null)},null,8,["is-drawer-open"])]),_:1})]),_:1}),e(yl,{"is-drawer-open":o(V),"onUpdate:isDrawerOpen":u[6]||(u[6]=E=>R(V)?V.value=E:null),customer:o(f).customer_id},null,8,["is-drawer-open","customer"])],64)}}};const Pl={class:"mt-2 mx-3"},xl={style:{"font-size":"14px"}},Dl={key:0,class:"no-activities-message d-flex flex-column justify-center align-center",style:{"min-block-size":"200px","text-align":"center"}},Cl=["onClick"],hl={class:"mx-2"},$l={class:"d-flex justify-content-between",style:{"font-size":"0.9em"}},Sl={__name:"list",setup(C){const S=_(""),a=_("Anteriores");_(["Todos","PORA"]),_("Todos");const{getallActivitiesByAsesorFecha:y,getallActivitiesByFechaPast:U,getallActivitiesByFechaFuture:h,activities:V,activitiesPast:n,activitiesFuture:c}=he(),d=_(""),w=Qe("userData").value,F=_(!0),A=_([]),k=_([]),f=_([]),p=async()=>{await y(w.id),A.value=V.value},O=async()=>{await U(w.id),k.value=n.value},L=async()=>{await h(w.id),f.value=c.value};Oe(async()=>{await p(),await O(),await L(),F.value=!1});const i=_(!1),m=z=>{i.value=!0,d.value={...z}},M=async()=>{F.value=!0,await p(),await O(),await L(),F.value=!1},D=ee(()=>[{tabName:"Anteriores",icon:"tabler-calendar",actividades:k,badge:k.value.length},{tabName:"Hoy",icon:"tabler-edit",actividades:A,badge:A.value.length},{tabName:"Futuros",icon:"tabler-calendar",actividades:f,badge:f.value.length}]),P=[{type:"Visita",icon:"tabler-current-location"},{type:"Llamada",icon:"tabler-phone"},{type:"Cotizacion",icon:"tabler-cash"},{type:"Otro",icon:"tabler-table"}],r=z=>{const u=P.find(J=>J.type===z);return u?u.icon:"tabler-default"},$=z=>{const u=new Date(z),J=u.getDate(),N=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][u.getMonth()],E=u.getHours().toString().padStart(2,"0"),fe=u.getMinutes().toString().padStart(2,"0");return`${J} de ${N}, ${E}:${fe}`};return ie(S,z=>{const u=J=>J.filter(j=>{const N=j.name_opportunity.toLowerCase().includes(z.toLowerCase()),E=j.phone_opportunity.toLowerCase().includes(z.toLowerCase());return N||E});z.length>2?(A.value=u(V.value),k.value=u(n.value),f.value=u(c.value)):(A.value=V.value,k.value=n.value,f.value=c.value)}),(z,u)=>{const J=ne("VCircularProgress");return s(),q(G,{class:"match-height",style:{display:"flex","block-size":"100vh"}},{default:t(()=>[e(b,{cols:"12",md:"4",style:{display:"flex","flex-direction":"column"}},{default:t(()=>[e(Y,{class:"flex-grow-1"},{default:t(()=>[e(ce,{class:"d-flex justify-between align-center flex-wrap"},{default:t(()=>[u[5]||(u[5]=l("h4",{class:"mt-5"}," Mis Actividades ",-1)),l("div",Pl,[e(se,{modelValue:S.value,"onUpdate:modelValue":u[0]||(u[0]=j=>S.value=j),placeholder:"Buscar actividad...",class:"search-field",variant:"plain","hide-details":"",dense:"","prepend-inner-icon":"tabler-search"},null,8,["modelValue"])])]),_:1}),e(ot,{modelValue:a.value,"onUpdate:modelValue":u[1]||(u[1]=j=>a.value=j),grow:""},{default:t(()=>[(s(!0),v(T,null,H(D.value,j=>(s(),q(it,{key:j.tabName},{default:t(()=>[l("span",xl,g(j.tabName),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),u[11]||(u[11]=l("br",null,null,-1)),e(Q,{style:{"flex-grow":"1","overflow-y":"auto"}},{default:t(()=>[F.value?(s(),q(st,{key:0,absolute:"",opacity:"0.7"},{default:t(()=>[e(J,{indeterminate:"",size:"70"})]),_:1})):B("",!0),e(Te,{modelValue:a.value,"onUpdate:modelValue":u[2]||(u[2]=j=>a.value=j),class:"disable-tab-transition",style:{"max-block-size":"500px","overflow-y":"auto"}},{default:t(()=>[(s(!0),v(T,null,H(D.value,j=>(s(),q(tt,{key:j.tabName,value:j.tabName},{default:t(()=>[j.actividades.value.length===0?(s(),v("div",Dl,[e(W,{size:"64",color:"grey",icon:"tabler-calendar-off",class:"mb-4",style:{animation:"bounce 1s infinite"}}),u[6]||(u[6]=l("div",{style:{color:"#888","font-size":"1.2em"}}," ¡No tienes actividades pendientes! ",-1)),u[7]||(u[7]=l("div",{style:{color:"#aaa","font-size":"0.9em","margin-block-start":"8px"}}," ¡Relájate y disfruta tu día! ",-1))])):(s(!0),v(T,{key:1},H(j.actividades.value,N=>(s(),v("div",{key:N.id,"fill-dot":"",class:"border mb-2 rounded-sm py-2",onClick:E=>m(N)},[e(ve,null,{default:t(()=>[e(G,null,{default:t(()=>[e(b,{cols:"12",md:"2",style:{"padding-inline-end":"0"}},{default:t(()=>[e(Z,{class:"d-flex justify-center align-center",style:{display:"inline-flex","border-radius":"4px","block-size":"36px","inline-size":"36px"}},{default:t(()=>[e(W,{size:"25",icon:"tabler-home"})]),_:1})]),_:1}),N.project_name?(s(),q(b,{key:0,cols:"12",md:"5",class:"d-flex flex-column align-start",style:{"padding-inline-start":"0"}},{default:t(()=>[e(le,{class:"text-left"},{default:t(()=>[l("strong",null,g(N.property_title),1)]),_:2},1024),e(te,{class:"font-weight-medium text-left"},{default:t(()=>[l("span",null,"$ "+g(N.price),1)]),_:2},1024)]),_:2},1024)):B("",!0),N.project_name?B("",!0):(s(),q(b,{key:1,cols:"12",md:"5"},{default:t(()=>[e(le,{class:"text-left"},{default:t(()=>u[8]||(u[8]=[l("strong",{style:{"font-size":"12px"}}," Departamento ",-1)])),_:1}),e(te,{class:"font-weight-medium text-left"},{default:t(()=>u[9]||(u[9]=[l("span",null,"Indefinido",-1)])),_:1})]),_:1})),e(b,{cols:"12",md:"5",class:"d-flex justify-end align-center"},{default:t(()=>[e(Z,{label:"",color:"primary",class:"ml-auto",style:{"font-size":"10px"}},{default:t(()=>[x(g(N.stage),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(ve,{class:""},{default:t(()=>[e(Z,{label:"",color:"secondary",class:"w-100 h-48"},{default:t(()=>[e(W,{size:"20",icon:r(N.type_activity)},null,8,["icon"]),l("div",hl,g(N.type_activity)+"   •   "+g(N.name_opportunity),1)]),_:2},1024)]),_:2},1024),e(ve,null,{default:t(()=>[l("div",$l,[u[10]||(u[10]=l("div",{style:{"flex-grow":"1"}}," Ver ",-1)),l("div",null,g($(N.scheduled_at)),1)])]),_:2},1024)],8,Cl))),128))]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(b,{cols:"12",md:"8",style:{display:"flex","flex-direction":"column"}},{default:t(()=>[e(kl,{"is-drawer-open":i.value,"onUpdate:isDrawerOpen":u[3]||(u[3]=j=>i.value=j),"activities-data":d.value,class:"flex-grow-1",onRefreshActivities:M,onLoaded:u[4]||(u[4]=j=>F.value=!1)},null,8,["is-drawer-open","activities-data"])]),_:1})]),_:1})}}},Ta=Ie(Sl,[["__scopeId","data-v-c22010e9"]]);export{Ta as default};
