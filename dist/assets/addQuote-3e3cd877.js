import{r as _}from"./validators-dea6e3a5.js";import{_ as Q}from"./AppAutocomplete-8fe2925c.js";import{_ as K}from"./AppTextarea-cbb85b21.js";import{_ as S}from"./AppSelect-ab40609c.js";import{_ as Y}from"./AppTextField-f5d3b8ee.js";import{_ as L}from"./AppDateTimePicker-896d50cc.js";import{P as v,a as O,_ as G}from"./InvoiceAddMoney-a3741cc7.js";import{V as H}from"./VNodeRenderer-88a79e97.js";import{r as C,w as F,H as j,o as k,f as U,e as t,d as c,c as I,F as W,i as J,b as l,n as r,x,v as E,z as X,a4 as R,$ as Z,I as N,a0 as ee,a2 as q}from"./index-b4bea750.js";import{u as le}from"./useProperty-b2071d9e.js";import{V as w,a as u}from"./VRow-bc11a231.js";import{V as z}from"./VCard-1cfd8877.js";import{V as T}from"./VCardText-a5c39627.js";import{V as $}from"./VDivider-f285f37d.js";import{u as ae}from"./useCustomer-0e6ac953.js";import{u as oe}from"./useQuote-91611965.js";import{c as M}from"./notifications-ada6c777.js";import"./helpers-61e4df1a.js";import"./form-fce97c39.js";import"./VSelect-daad5e4e.js";import"./VTextField-a9844dab.js";/* empty css                   */import"./VCounter-911d0828.js";import"./VImg-bb3f5fef.js";import"./VField-099959c0.js";import"./easing-9f15041e.js";import"./VInput-cf59e3bd.js";import"./forwardRefs-8348545e.js";import"./VList-9a1c22e8.js";import"./ssrBoot-66342520.js";import"./VAvatar-91c9c0c6.js";import"./dialog-transition-1404d7b9.js";import"./VMenu-c358c80a.js";import"./VOverlay-5a76c00a.js";import"./lazy-fe7f6497.js";import"./scopeId-1116c792.js";import"./VCheckboxBtn-ab7b6b76.js";import"./VSelectionControl-adab1655.js";import"./VChip-e7473304.js";import"./filter-a190cb7b.js";import"./api-8079bf60.js";import"./index-9c720871.js";import"./constants-8e30317b.js";const te={class:"pa-5 flex-grow-1"},ie={key:0,style:{"font-size":"smaller","padding-block":""}},re={class:"d-flex justify-end mt-3"},se={__name:"InvoiceAddProperty",props:{properties:{type:Array,required:!0}},emits:["removeProduct","totalAmount","addProperty"],setup(D,{emit:A}){const i=D,P=A,{propertiesForType:g}=le(),o=C([]),V=C([]),y=()=>{const e={property_id:null,price:null,property_type:v.PARK.value,property_type_name:v.PARK.label};P("addProperty",e)},h=e=>{P("removeProduct",e)},s=e=>{if(console.log("entra a update price"),e.property_type===v.DEPARTAMENT.value){const m=V.value.find(p=>p.id===e.property_id);m&&(e.price=m.base_price)}else if(e.property_type===v.PARK.value){const m=o.value.find(p=>p.id===e.property_id);m&&(e.price=m.base_price)}};return F(()=>i.properties.map(e=>e.property_id),(e,m)=>{e.forEach((p,n)=>{const d=i.properties[n];p!==m[n]&&s(d)})}),j(async()=>{try{const e=await g(v.DEPARTAMENT.value);V.value=e;const m=await g(v.PARK.value);o.value=m}catch(e){console.error("Error al obtener las propiedades:",e)}}),(e,m)=>{const p=Y;return k(),U(z,{flat:"",border:"",class:"d-flex flex-row"},{default:t(()=>[c("div",te,[(k(!0),I(W,null,J(i.properties,(n,d)=>(k(),U(w,{key:d},{default:t(()=>[l(u,{cols:"12",sm:"4",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(S,{modelValue:n.property_id,"onUpdate:modelValue":a=>n.property_id=a,rules:["requiredValidator"in e?e.requiredValidator:r(_)],label:n.property_type_name,placeholder:"Selecciona una propiedad",items:n.property_type===r(v).DEPARTAMENT.value?r(V):r(o),"item-title":"title","item-value":"id",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules","label","items"]),n.property_id&&n.property_type===r(v).DEPARTAMENT.value?(k(),I("span",ie,[c("strong",null,x(r(V)[n.property_id-1].departament.isfacade===1?"Con Fachada":"Sin Fachada")+", ",1),E(" "+x(r(V)[n.property_id-1].surface)+" ",1),m[0]||(m[0]=c("strong",null," m2,",-1)),E(" "+x(r(V)[n.property_id-1].departament.number_bedrooms)+" Habitacion(s), ",1)])):X("",!0)]),_:2},1024),l(u,{cols:"12",sm:"2",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(p,{modelValue:n.price,"onUpdate:modelValue":a=>n.price=a,rules:["requiredValidator"in e?e.requiredValidator:r(_)],label:"Precio *",placeholder:"$",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),l(u,{cols:"12",sm:"2",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(p,{modelValue:n.price_it,"onUpdate:modelValue":a=>n.price_it=a,rules:["requiredValidator"in e?e.requiredValidator:r(_)],label:"3% (IT) *",placeholder:"%",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(p,{modelValue:n.price_contrato,"onUpdate:modelValue":a=>n.price_contrato=a,rules:["requiredValidator"in e?e.requiredValidator:r(_)],label:"Precio Contrato *",placeholder:"Escribe el precio",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),l(u,{cols:"12",sm:"1",class:"my-4"},{default:t(()=>[l(R,{color:"error",size:"small",onClick:a=>h(d)},{default:t(()=>[l(Z,{icon:"tabler-square-x"})]),_:2},1032,["onClick"])]),_:2},1024),l(u,{cols:"12",style:{"font-size":"small","padding-block":"0","padding-inline":"4px"}})]),_:2},1024))),128)),c("div",re,[l(R,{color:"secondary",onClick:y},{default:t(()=>m[1]||(m[1]=[E(" Agregar Parqueo ")])),_:1})])])]),_:1})}}},de={class:"ma-sm-4"},ne={class:"d-flex align-center mb-6"},ue={class:"font-weight-bold text-capitalize text-h3"},pe={class:"mt-4 ma-sm-4"},me={class:"d-flex align-center justify-sm-end mb-3"},ce={style:{"inline-size":"9.5rem"}},fe={class:"d-flex align-center justify-sm-end mb-3"},_e={style:{"inline-size":"9.5rem"}},Ve={class:"text-center my-4"},ve={__name:"AddQuoteInvoice",props:{data:{type:null,required:!0}},emits:["push","remove"],setup(D,{emit:A}){const i=D,P=A,g=s=>{P("push",s)},o=s=>{P("remove",s)},V=["10","20","30"],y=C("10"),h=s=>(i.data.initial_fee=s*y.value/100,i.data.balance=s-i.data.initial_fee,s*y.value/100);return(s,e)=>{const m=L,p=Y,n=S,d=K;return k(),U(z,null,{default:t(()=>[l(T,{class:"d-flex flex-wrap justify-space-between gap-y-5 flex-column flex-sm-row"},{default:t(()=>[c("div",de,[c("div",ne,[l(r(H),{nodes:r(N).app.logo,class:"me-3"},null,8,["nodes"]),c("h4",ue,x(r(N).app.title),1)]),e[12]||(e[12]=c("p",{class:"mb-0"}," Formulario de Cotizacion ",-1))]),c("div",pe,[c("div",me,[e[13]||(e[13]=c("span",{class:"me-3",style:{"inline-size":"6rem"}},"Emision",-1)),c("span",ce,[l(m,{modelValue:i.data.creation_date,"onUpdate:modelValue":e[0]||(e[0]=a=>i.data.creation_date=a),rules:["requiredValidator"in s?s.requiredValidator:r(_)],density:"compact",placeholder:"YYYY-MM-DD",config:{position:"auto right"}},null,8,["modelValue","rules"])])]),c("div",fe,[e[14]||(e[14]=c("span",{class:"me-3",style:{"inline-size":"6rem"}},"Vigente hasta",-1)),c("span",_e,[l(m,{modelValue:i.data.expiration_date,"onUpdate:modelValue":e[1]||(e[1]=a=>i.data.expiration_date=a),rules:["requiredValidator"in s?s.requiredValidator:r(_)],density:"compact",placeholder:"YYYY-MM-DD",config:{position:"auto right"}},null,8,["modelValue","rules"])])])])]),_:1}),l($,{thickness:"12"}),l(T,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row gap-y-5 gap-4"},{default:t(()=>[l(w,null,{default:t(()=>[l(u,{cols:"12",sm:"8",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(p,{modelValue:i.data.social_reason,"onUpdate:modelValue":e[2]||(e[2]=a=>i.data.social_reason=a),rules:["requiredValidator"in s?s.requiredValidator:r(_)],label:"Razón Social *",placeholder:"Canzza",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",sm:"4",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(p,{modelValue:i.data.nit,"onUpdate:modelValue":e[3]||(e[3]=a=>i.data.nit=a),rules:["requiredValidator"in s?s.requiredValidator:r(_)],label:"C.I./NIT *",placeholder:"0000000",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(p,{modelValue:i.data.workplace,"onUpdate:modelValue":e[4]||(e[4]=a=>i.data.workplace=a),label:"Lugar de Trabajo",placeholder:"Placeholder Text",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(p,{modelValue:i.data.email,"onUpdate:modelValue":e[5]||(e[5]=a=>i.data.email=a),rules:["requiredValidator"in s?s.requiredValidator:r(_)],label:"Correo *",placeholder:"email@gmail.com",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(p,{modelValue:i.data.address,"onUpdate:modelValue":e[6]||(e[6]=a=>i.data.address=a),label:"Direccion",placeholder:"Av/ Equipetrol ....",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(p,{modelValue:i.data.phone,"onUpdate:modelValue":e[7]||(e[7]=a=>i.data.phone=a),rules:["requiredValidator"in s?s.requiredValidator:r(_)],label:"Celular *",placeholder:"77049267",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(p,{label:"Telefono Fijo",placeholder:"33557292",outlined:"",dense:"",class:"custom-salesforce-input"})]),_:1})]),_:1})]),_:1}),l($,{thickness:"12"}),l(T,{class:"add-products-form"},{default:t(()=>[l(w,null,{default:t(()=>[l(u,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"},class:"mb-2"},{default:t(()=>[l(se,{properties:i.data.properties,onAddProperty:g,onRemoveProduct:o},null,8,["properties"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(n,{modelValue:i.data.payment_method,"onUpdate:modelValue":e[8]||(e[8]=a=>i.data.payment_method=a),rules:["requiredValidator"in s?s.requiredValidator:r(_)],label:"Tipo de Pago *",placeholder:"Seleccione ",items:Object.values(r(O)),class:"custom-salesforce-input"},null,8,["modelValue","rules","items"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(p,{modelValue:i.data.amount,"onUpdate:modelValue":e[9]||(e[9]=a=>i.data.amount=a),rules:["requiredValidator"in s?s.requiredValidator:r(_)],label:"Total *",placeholder:"Placeholder Text",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(n,{modelValue:r(y),"onUpdate:modelValue":e[10]||(e[10]=a=>ee(y)?y.value=a:null),items:V,label:"Anticipo: %",placeholder:"% Anticipo",class:"mb-2"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[c("div",Ve,[e[15]||(e[15]=c("h4",null," Saldo: ",-1)),c("span",null,x(i.data.amount-i.data.initial_fee),1)])]),_:1})]),_:1})]),_:1}),l(T,{class:"add-products-form"},{default:t(()=>[l(w,null,{default:t(()=>[l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(G,{title:" Anticipo ",amount:h(i.data.amount),differs:i.data.differs_initial_fee,type:s.INITIAL_PAYMENT},null,8,["amount","differs","type"])]),_:1}),l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(d,{modelValue:i.data.observations,"onUpdate:modelValue":e[11]||(e[11]=a=>i.data.observations=a),"auto-grow":"",label:"Observaciones del Cliente",rows:"3",placeholder:"Descripcion...","row-height":"20"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}}},sl={__name:"addQuote",setup(D){const{generateQuote:A}=oe(),{allCustomerPaginate:i,customers:P}=ae(),g=C(!1),o=C({social_reason:"",nit:"",address:"",email:"",phone:"",workplace:"",expiration_date:null,creation_date:new Date().toISOString().split("T")[0],observations:"",payment_method:null,amount:null,initial_fee:null,balance:null,opportunity_id:null,customer_id:null,properties:[{property_id:null,price:null,price_it:null,price_contrato:null,property_type:v.DEPARTAMENT.value,property_type_name:v.DEPARTAMENT.label}],differs_initial_fee:[],differs_balance:[]}),V=q(()=>o.value.social_reason&&o.value.nit&&o.value.email&&o.value.phone&&o.value.amount&&o.value.creation_date&&o.value.expiration_date&&o.value.payment_method&&o.value.balance&&o.value.customer_id),y=q(()=>o.value.properties.every(d=>d.property_id!==null&&d.price!==null&&d.price_it!==null&&d.price_contrato!==null)),h=q(()=>o.value.differs_initial_fee.length===0?!0:o.value.differs_initial_fee.every(d=>d.amount!==null)),s=q(()=>{if(o.value.differs_initial_fee.length===0)return!0;const d=o.value.differs_initial_fee.reduce((b,B)=>b+(B.amount||0),0),a=parseFloat(d),f=parseFloat(o.value.initial_fee);return a===f}),e=q(()=>V.value&&y.value&&h.value),m=d=>{o.value.properties.push(d)},p=d=>{o.value.properties.splice(d,1)},n=async()=>{if(!e.value){M("Validación fallida","Completa todos los campos obligatorios.");return}if(!s.value){M("Validación fallida","La suma de las diferencias de la cuota inicial no son correctas");return}g.value=!0;try{console.log(o),await A(o.value)}catch(d){console.error("Error generando la venta:",d)}finally{g.value=!1}};return j(async()=>{await i({page:1,itemsPerPage:100})}),F(()=>o.value.properties,d=>{let a=0;d.forEach(f=>{if(f.price){const b=parseFloat(f.price)||0;f.price_it=b*.03,f.price_contrato=b+f.price_it,a+=f.price_contrato}else f.price_it=null}),o.value.amount=a},{deep:!0}),F(()=>o.value.customer_id,d=>{const a=P.value.find(f=>f.id==d);a&&(o.value.social_reason=a.name,o.value.email=a.email,o.value.phone=a.phone,o.value.nit=a.ci,o.value.opportunity_id=a.opportunity_id,a.property_id!==null&&(o.value.properties[0].property_id=a.property_id)),o.value.customer_id=d}),(d,a)=>{const f=Q;return k(),U(w,null,{default:t(()=>[l(u,{cols:"12",md:"9"},{default:t(()=>[l(ve,{data:r(o),onPush:m,onRemove:p},null,8,["data"])]),_:1}),l(u,{cols:"12",md:"3"},{default:t(()=>[l(z,{class:"mb-8"},{default:t(()=>[l(u,{cols:"12"},{default:t(()=>[l(f,{modelValue:r(o).customer_id,"onUpdate:modelValue":a[0]||(a[0]=b=>r(o).customer_id=b),rules:["requiredValidator"in d?d.requiredValidator:r(_)],label:"Clientes",placeholder:"Selecciona un Cliente",items:r(P).map(b=>({title:b.name,value:b.id})),outlined:""},null,8,["modelValue","rules","items"])]),_:1}),l(T,null,{default:t(()=>[l(R,{loading:r(g),disabled:!r(e)||r(g),class:"mb-2",onClick:n},{default:t(()=>a[1]||(a[1]=[E(" Guardar Cotizacion ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})}}};export{sl as default};
