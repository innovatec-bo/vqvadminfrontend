import{f as v}from"./currencyFormatter-92ad4b3c.js";import{_ as H}from"./AppSelect-daf71013.js";import{_ as K}from"./AppTextField-44fc1f10.js";import{u as Y}from"./useSales-02195e43.js";import{p as q}from"./paginationMeta-4ad053a4.js";import{l as J}from"./lodash-4c395e6a.js";import{S as D}from"./notifications-b6da0b75.js";import{r as f,ac as W,w as X,a as P,o as u,c as p,b as r,e as n,d as i,n as s,f as A,v as c,a4 as y,z as E,F as C,i as V,x as l,s as h,$ as Z}from"./index-1b227831.js";import{_ as ee}from"./_plugin-vue_export-helper-c27b6911.js";import{V as te}from"./VCard-09efc574.js";import{V as ae}from"./VCardText-520eb94b.js";import{V as w}from"./VDivider-ed4e04b7.js";import{V as oe}from"./VDataTableServer-b15e8db5.js";import{V as ne}from"./VPagination-6e9c46b4.js";import{V as ie}from"./VCheckbox-7902ce07.js";import{V as re}from"./VTooltip-999127b3.js";import"./form-593ede5a.js";import"./VSelect-68fca8ea.js";import"./VTextField-e8500e6f.js";/* empty css                   */import"./VCounter-dcd827ab.js";import"./VImg-8d00fb1c.js";import"./VField-689ad7b3.js";import"./easing-9f15041e.js";import"./VInput-bbd3a5f5.js";import"./forwardRefs-8348545e.js";import"./VList-6d5356af.js";import"./ssrBoot-6076e3ab.js";import"./VAvatar-a01bde99.js";import"./dialog-transition-a4b1c076.js";import"./VMenu-4335078d.js";import"./VOverlay-03ad66c9.js";import"./lazy-7bf81604.js";import"./scopeId-b3dc2386.js";import"./VCheckboxBtn-50b671c1.js";import"./VSelectionControl-3345e294.js";import"./VChip-ecf02ebd.js";import"./api-33861f4a.js";import"./index-9c720871.js";import"./constants-f448659b.js";import"./VDataTable-7a312186.js";import"./VTable-34b44b52.js";import"./filter-31e12615.js";const le={class:"d-flex justify-space-between flex-wrap gap-y-4"},se={class:"d-flex flex-row gap-4 align-center flex-wrap"},me={class:"v-data-table__tr"},ue=["colspan"],de={class:"mb-2 mx-10"},pe={class:"mb-2 mx-10"},ce={class:"mb-2 mx-10"},fe={class:"d-flex align-center justify-sm-space-between justify-center flex-wrap gap-3 pa-5 pt-3"},ge={class:"text-sm text-disabled mb-0"},_e={class:"d-flex items-center gap-x-2"},ve={__name:"listSales",setup(ye){const{AllSalesPaginated:I,exportSaleExcel:B,SaleChangeStageDiscard:N,SaleChangeSignature:R,sales:T,totalSales:g}=Y(),_=f(""),m=f(10),d=f(1);f(),f();const x=W("userAbilityRules").value,S=[{title:"",key:"data-table-expand"},{title:"Nit/CI",key:"nit"},{title:"Cliente",key:"social_reason"},{title:"Método de Pago",key:"payment_method"},{title:"Total Contrato",key:"amount"},{title:"Estado",key:"status"},{title:"Firma",key:"confirmation_signature"},{title:"Acción",key:"action"}],M=a=>a==="CASH"?"Al Contado":a==="DIRECTCREDIT"?"Crédito Directo":a==="BANKCREDIT"?"Crédito Bancario":a,L=a=>a==="SALE"?"VENDIDO":a==="DISCARD"?"CANCELADO":a==="DELIVERY"?"ENTREGADO":a,U=a=>{d.value=a.page,m.value=a.itemsPerPage},j=a=>{D.fire({title:"Quieres dar de baja la venta?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"confirmar"}).then(t=>{t.isConfirmed&&(N(a),k(),D.fire({text:"La Venta fue dado de baja",icon:"success"}))})},k=()=>{I({page:d.value,itemsPerPage:m.value,search:_.value})},F=async a=>{console.log("entra a firma"),await R(a)},O=async()=>{await B()},$=J.debounce(k,300);return X([_,m,d],$,{immediate:!0}),(a,t)=>{const z=K,Q=H,b=P("IconBtn"),G=P("RouterLink");return u(),p("div",null,[r(te,{title:"Lista de Ventas"},{default:n(()=>[r(ae,null,{default:n(()=>[i("div",le,[r(z,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=e=>_.value=e),style:{"max-inline-size":"200px","min-inline-size":"200px"},placeholder:"Buscar...",density:"compact"},null,8,["modelValue"]),s(x).some(e=>e.action==="manage"&&e.subject==="ADMINISTRADOR")?(u(),A(y,{key:0,"prepend-icon":"tabler-screen-share",variant:"tonal",color:"secondary",class:"mx-3",onClick:O},{default:n(()=>t[5]||(t[5]=[c(" Export ")])),_:1})):E("",!0),i("div",se,[r(Q,{modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=e=>m.value=e),density:"compact",items:[5,10,20,50,100]},null,8,["modelValue"])])])]),_:1}),r(w),r(s(oe),{"items-per-page":m.value,"onUpdate:itemsPerPage":t[3]||(t[3]=e=>m.value=e),page:d.value,"onUpdate:page":t[4]||(t[4]=e=>d.value=e),items:s(T),headers:S,"items-length":s(g),class:"text-no-wrap","expand-on-click":"","onUpdate:options":U},{"expanded-row":n(({item:e})=>[i("tr",me,[i("td",{colspan:S.length},[i("div",de,[t[6]||(t[6]=i("strong",null,"Propiedades:",-1)),i("ul",null,[(u(!0),p(C,null,V(e.properties,o=>(u(),p("li",{key:o.id},l(o.title)+" | "+l(o.code)+" | ("+l(o.surface)+" m²) ",1))),128))])]),i("div",pe,[t[7]||(t[7]=i("strong",null,"Pagos Iniciales:",-1)),i("ul",null,[(u(!0),p(C,null,V(e.initial_payments,o=>(u(),p("li",{key:o.id}," Fecha: "+l(o.date)+" | Monto: "+l(("formatCurrency"in a?a.formatCurrency:s(v))(o.amount))+" | Pagado: "+l(o.is_paid?"Sí":"No"),1))),128))])]),i("div",ce,[t[8]||(t[8]=i("strong",null,"Pagos de Saldo:",-1)),i("ul",null,[(u(!0),p(C,null,V(e.balance_payments,o=>(u(),p("li",{key:o.id}," Fecha: "+l(o.date)+" | Monto: "+l(("formatCurrency"in a?a.formatCurrency:s(v))(o.amount))+" | Pagado: "+l(o.is_paid?"Sí":"No"),1))),128))])])],8,ue)])]),bottom:n(()=>[r(w),i("div",fe,[i("p",ge,l(s(q)({page:d.value,itemsPerPage:m.value},s(g))),1),r(ne,{modelValue:d.value,"onUpdate:modelValue":t[2]||(t[2]=e=>d.value=e),length:Math.ceil(s(g)/m.value),"total-visible":a.$vuetify.display.xs?1:Math.min(Math.ceil(s(g)/m.value),5)},{prev:n(e=>[r(y,h({variant:"tonal",color:"default"},e,{icon:!1}),{default:n(()=>t[9]||(t[9]=[c(" Anterior ")])),_:2},1040)]),next:n(e=>[r(y,h({variant:"tonal",color:"default"},e,{icon:!1}),{default:n(()=>t[10]||(t[10]=[c(" Siguiente ")])),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),"item.payment_method":n(({item:e})=>[c(l(M(e.payment_method)),1)]),"item.amount":n(({item:e})=>[c(l(("formatCurrency"in a?a.formatCurrency:s(v))(e.amount)),1)]),"item.status":n(({item:e})=>[c(l(L(e.status)),1)]),"item.confirmation_signature":n(({item:e})=>[r(ie,{modelValue:e.confirmation_signature,"onUpdate:modelValue":o=>e.confirmation_signature=o,"true-value":1,"false-value":0,onChange:o=>F(e.id)},{default:n(()=>[r(re,{activator:"parent",location:"top"},{default:n(()=>t[11]||(t[11]=[c(" Confirmar firma ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),"item.action":n(({item:e})=>[i("div",_e,[r(G,{to:{name:"sale-id",params:{id:e.id}}},{default:n(()=>[r(b,null,{default:n(()=>[r(Z,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"]),s(x).some(o=>o.action==="manage"&&o.subject==="ADMINISTRADOR")?(u(),A(b,{key:0,icon:"tabler-trash",onClick:o=>j(e.id)},null,8,["onClick"])):E("",!0)])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1})])}}},st=ee(ve,[["__scopeId","data-v-93fd7e04"]]);export{st as default};
