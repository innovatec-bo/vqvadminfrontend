import{p as De,_ as Ce,u as Pe,d as Re}from"./PreSaleForm-ced92ed5.js";import{r as Q,e as Be}from"./validators-dea6e3a5.js";import{_ as Le}from"./AppTextarea-cad16e31.js";import{_ as Me}from"./AppDateTimePicker-f811ee84.js";import{_ as Se}from"./AppTextField-29b22b24.js";import{_ as $e}from"./AppSelect-efaf9105.js";import{f as ae}from"./currencyFormatter-92ad4b3c.js";import{u as ue,a as ce,S as Ye,b as ve}from"./usePaymentPlans-be72a567.js";import{V as Ae}from"./VAvatar-a0558956.js";import{b as le,c as ie,a as fe}from"./VList-b9114e4f.js";import{V as b}from"./VCol-11309398.js";import{o as n,c as m,d as a,F as T,i as Y,b as e,e as t,n as l,v as h,x as f,z as R,f as U,$ as J,a4 as N,r as w,a as re,a0 as L,am as Z,w as de,a2 as X,ac as ze,H as Oe,ag as He,a3 as We,an as be,y as Ge}from"./index-c2e96262.js";import{V as ee}from"./VChip-e912eeed.js";import{V as te}from"./VTooltip-6699a366.js";import{V as W}from"./VCardText-df626bb1.js";import{a as Ue}from"./formatters-58bf909e.js";import{u as Qe}from"./useQuote-7faa696a.js";import{_ as qe,a as Je}from"./BitacoraCustomer-fb1b4a46.js";import{V as H}from"./VRow-7348eabc.js";import{V as se}from"./VCheckbox-510e1275.js";import{V as pe}from"./VTable-d0b86b7f.js";import{u as Xe}from"./useSales-25539597.js";import{_ as ge}from"./DialogCloseBtn-fe2a9ed0.js";import{V as oe,b as me,a as ye}from"./VCard-f5bbdae8.js";import{V as ne}from"./VTextField-86db8845.js";import{V as _e}from"./VDialog-dfbe258f.js";import{s as Fe,S as Ve}from"./notifications-cae4d01c.js";import{P as je}from"./vue3-perfect-scrollbar.esm-9aba3144.js";import{V as Ee}from"./VNavigationDrawer-af4d4086.js";import{m as Ke}from"./vue3-apexcharts-aa9cc9e7.js";import{_ as Ze}from"./AppCardActions-ee8d4737.js";import{u as et,f as he}from"./dateFormatter-a251d4c8.js";import{_ as Te}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as tt}from"./AppDrawerHeaderSection-ba7b1db0.js";import{V as at}from"./VForm-378c8e9d.js";import{V as Ie,a as ot}from"./VWindowItem-4a57e62c.js";import{V as lt,a as we}from"./VRadioGroup-c3f006af.js";import{V as it}from"./VDivider-88128b79.js";import{V as st,a as nt}from"./VTabs-a6425204.js";import{V as rt}from"./VOverlay-ca90609e.js";import"./api-aa8c13ee.js";import"./index-9c720871.js";import"./constants-b7e4fea4.js";import"./AppAutocomplete-73517056.js";import"./form-b8ba296f.js";import"./VSelect-b13256b2.js";import"./forwardRefs-8348545e.js";import"./VImg-31fed283.js";import"./dialog-transition-00941f89.js";import"./easing-9f15041e.js";import"./VMenu-b0d8fe43.js";import"./scopeId-10fccddb.js";import"./VCheckboxBtn-fffadaff.js";import"./VSelectionControl-e3762066.js";import"./filter-fd4c1098.js";import"./InvoiceAddMoney-7bae0c04.js";import"./VNodeRenderer-c6452534.js";import"./useProperty-f00a9a2f.js";import"./helpers-61e4df1a.js";/* empty css                   */import"./VCounter-7567efe3.js";import"./VField-e94b1a76.js";import"./VInput-66adbaa5.js";import"./ssrBoot-de99a4c4.js";import"./VTimelineItem-df6e03a9.js";import"./VSpacer-5cccd6ed.js";import"./lazy-b6b07144.js";import"./VSlideGroup-61412060.js";const ut={class:"my-5"},dt={key:0},pt=["src"],ct={class:"my-5"},mt={key:0,class:"d-flex flex-wrap gap-2 my-5"},ft={key:1},yt={__name:"EditDeliveryOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","complet"],setup(q,{emit:k}){const o=q,v=k,{changeStatusByOpportunity:O}=ue(),{checkProcessForOpportunity:$}=ce(),C=async()=>{try{await O(o.opportunity.id,7,{}),v("complet")}catch(y){console.error("Error updating customer:",y)}},x=async(y,u)=>{console.log(`Procedimiento ${y} marcado como: ${u?"realizado":"no realizado"}`),await $(o.opportunity.id,y,{is_check:!u}),v("updateStageId",o.opportunity.id)};return(y,u)=>(n(),m(T,null,[a("div",ut,[u[0]||(u[0]=a("span",{style:{"font-size":"14px","font-weight":"500"}}," Propiedades ",-1)),o.opportunity.sales.length>0?(n(),m("div",dt,[(n(!0),m(T,null,Y(o.opportunity.sales,_=>(n(),m("div",{key:_.id},[(n(!0),m(T,null,Y(_.properties,A=>(n(),m("div",{key:A.id,class:"d-flex align-center justify-between"},[e(Ae,{size:"50",rounded:""},{default:t(()=>[a("img",{src:l(De),alt:"Logo pora",style:{"border-radius":"30%"}},null,8,pt)]),_:1}),e(b,{cols:"12",md:"7"},{default:t(()=>[e(le,{class:"font-weight-medium"},{default:t(()=>[h(f(A.project_title)+" | "+f(A.title),1)]),_:2},1024),e(ie,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[a("span",null,f(("formatCurrency"in y?y.formatCurrency:l(ae))(A.pivot_price)),1)]),_:2},1024)]),_:2},1024)]))),128))]))),128))])):R("",!0)]),a("div",ct,[u[2]||(u[2]=a("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(n(),m("div",mt,[(n(!0),m(T,null,Y(o.opportunity.procedure,_=>(n(),m("div",{key:_.id},[e(ee,{color:_.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:A=>x(_.id,_.pivot.is_check)},{default:t(()=>[_.pivot.is_check?(n(),U(J,{key:0,icon:"tabler-check",class:"mr-2"})):R("",!0),h(" "+f(_.title),1)]),_:2},1032,["color","onClick"]),e(te,{activator:"parent",location:"top"},{default:t(()=>[h(f(_.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(n(),m("div",ft,u[1]||(u[1]=[a("span",null,"No hay procedimientos disponibles.",-1)])))]),e(W,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(N,{color:"primary",size:"small",onClick:C},{default:t(()=>u[3]||(u[3]=[h(" Finalizar Oportunidad ")])),_:1})]),_:1})],64))}},vt={class:"d-flex align-bottom flex-sm-row flex-column"},gt={class:"user-profile-info"},_t={class:"d-flex align-center justify-center justify-sm-space-between flex-wrap gap-4"},bt={class:"d-flex align-center gap-x-3"},Vt={class:"text-4xl font-weight-medium"},ht={class:"d-flex flex-column py-2",style:{"font-size":"14px"}},wt={class:"text-sm text-disabled"},kt={key:0,class:"d-flex flex-wrap gap-2 my-5"},xt={key:1},Dt={key:0,class:"d-flex flex-wrap gap-2 my-5"},Ct={key:1},Pt={__name:"EditPreSaleOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","update:newProperty"],setup(q,{emit:k}){const o=q,v=k,{checkProcessForOpportunity:O}=ce(),{changeStatusQuotesCustomer:$}=Qe(),C=w(!1),x=w(!1),y=()=>{C.value=!0},u=()=>{console.log("Se escucho el evento en EditProspectOpportunity"),v("update:newProperty")},_=()=>{x.value=!0},A=async g=>{v("updateStageId",g)},D=async(g,p)=>{console.log(`Procedimiento ${g} marcado como: ${p?"realizado":"no realizado"}`),await O(o.opportunity.id,g,{is_check:!p}),v("updateStageId",o.opportunity.id)},V=async(g,p)=>{const P=p==="APPROVED"?"NOT_APPROVED":"APPROVED";console.log(`Procedimiento ${g} marcado como: ${p}`),await $(g,{status:P}),v("updateStageId",o.opportunity.id)};return(g,p)=>{const P=re("RouterLink"),M=re("IconBtn");return n(),m(T,null,[a("div",vt,[a("div",gt,[p[3]||(p[3]=a("span",{style:{"font-size":"14px","font-weight":"500"}}," Perfil ",-1)),a("div",_t,[a("div",bt,[a("span",Vt,f(("avatarText"in g?g.avatarText:l(Ue))(o.opportunity.customer.name)),1),a("div",ht,[e(P,{to:{name:"customers-id",params:{id:o.opportunity.customer.id}},class:"font-weight-base"},{default:t(()=>[h(f(o.opportunity.customer.name),1)]),_:1},8,["to"]),a("span",wt,f(o.opportunity.customer.phone),1)]),e(N,{color:"secondary",variant:"tonal",size:"small",onClick:y},{default:t(()=>p[2]||(p[2]=[h(" Editar Perfil ")])),_:1})])])])]),a("div",null,[p[5]||(p[5]=a("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(n(),m("div",kt,[(n(!0),m(T,null,Y(o.opportunity.procedure,s=>(n(),m("div",{key:s.id},[e(ee,{color:s.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:r=>D(s.id,s.pivot.is_check)},{default:t(()=>[s.pivot.is_check?(n(),U(J,{key:0,icon:"tabler-check",class:"mr-2"})):R("",!0),h(" "+f(s.title),1)]),_:2},1032,["color","onClick"]),e(te,{activator:"parent",location:"top"},{default:t(()=>[h(f(s.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(n(),m("div",xt,p[4]||(p[4]=[a("span",null,"No hay procedimientos disponibles.",-1)])))]),a("div",null,[p[8]||(p[8]=a("span",{style:{"font-size":"14px","font-weight":"500"}}," Cotizaciones ",-1)),o.opportunity.quotes&&o.opportunity.quotes.length>0?(n(),m("div",Dt,[e(pe,{density:"compact",class:"text-no-wrap",style:{"font-size":"12px"}},{default:t(()=>[p[6]||(p[6]=a("thead",null,[a("tr",null,[a("th",null," Propiedad "),a("th",null," Fecha "),a("th",null," Monto "),a("th")])],-1)),a("tbody",null,[(n(!0),m(T,null,Y(o.opportunity.quotes,s=>(n(),m("tr",{key:s.id},[a("td",null,f(s.properties[0].title),1),a("td",null,f(s.created_at),1),a("td",null,f(("formatCurrency"in g?g.formatCurrency:l(ae))(s.amount)),1),a("td",null,[e(H,null,{default:t(()=>[e(se,{modelValue:s.status,"onUpdate:modelValue":r=>s.status=r,"true-value":"APPROVED","false-value":"NOT_APPROVED",disabled:""},null,8,["modelValue","onUpdate:modelValue"]),e(se,{modelValue:s.status_customer,"onUpdate:modelValue":r=>s.status_customer=r,"true-value":"APPROVED","false-value":"NOT_APPROVED",onClick:r=>V(s.id,s.status_customer)},{default:t(()=>[e(te,{activator:"parent",location:"top"},{default:t(()=>[h(f(s.status_customer=="NOT_APPROVED"?"No aprobado por cliente":"Aprobado por cliente"),1)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","onClick"]),e(P,{to:{name:"quote-id",params:{id:s.id}}},{default:t(()=>[e(M,null,{default:t(()=>[e(J,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])]),_:2},1024)])]))),128))])]),_:1})])):(n(),m("div",Ct,p[7]||(p[7]=[a("span",null,"No hay procedimientos disponibles.",-1)])))]),e(W,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(P,{to:{name:"quote-add-quote"},class:"text-white"},{default:t(()=>[e(N,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>p[9]||(p[9]=[h(" Generar Cotización ")])),_:1})]),_:1}),e(N,{color:"primary",class:"mx-auto",size:"small",onClick:_},{default:t(()=>p[10]||(p[10]=[h(" Generar Venta ")])),_:1})]),_:1}),e(qe,{"is-dialog-visible":l(C),"onUpdate:isDialogVisible":p[0]||(p[0]=s=>L(C)?C.value=s:null),"opportunity-kanban":o.opportunity,"onUpdate:newProperty":u},null,8,["is-dialog-visible","opportunity-kanban"]),e(Ce,{"is-dialog-visible":l(x),"onUpdate:isDialogVisible":p[1]||(p[1]=s=>L(x)?x.value=s:null),opportunity:o.opportunity,stage:"PRESALE",onRegisterSale:A},null,8,["is-dialog-visible","opportunity"])],64)}}},St={class:"d-flex align-bottom flex-sm-row flex-column"},$t={class:"user-profile-info"},At={class:"d-flex align-center justify-center justify-sm-space-between flex-wrap gap-4"},zt={class:"d-flex align-center gap-x-3"},Ot={class:"text-4xl font-weight-medium"},Ut={class:"d-flex flex-column py-2",style:{"font-size":"14px"}},qt={class:"text-sm text-disabled"},Ft={key:0,class:"d-flex flex-wrap gap-2 my-5"},jt={key:1},Et={key:0,class:"d-flex flex-wrap gap-2 my-5"},Tt={key:1},It={__name:"EditProspectOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","update:newProperty"],setup(q,{emit:k}){const o=q,v=k,{checkProcessForOpportunity:O}=ce(),{changeStatusByOpportunity:$,loadingOpportunity:C}=ue(),x=w(!1),y=()=>{x.value=!0},u=()=>{console.log("Se escucho el evento en EditProspectOpportunity"),v("update:newProperty")},_=async D=>{await $(D,Ye.PRESALE.value,{}),v("updateStageId",D)},A=async D=>{console.log(`Procedimiento ${D.id} marcado como: ${D.pivot.is_check?"realizado":"no realizado"}`),await O(o.opportunity.id,D.id,{is_check:!D.pivot.is_check}),D.pivot.is_check=!D.pivot.is_check,v("updateStageId",o.opportunity.id)};return(D,V)=>{const g=re("RouterLink"),p=re("IconBtn");return n(),m(T,null,[a("div",St,[a("div",$t,[V[3]||(V[3]=a("span",{style:{"font-size":"14px","font-weight":"500"}}," Perfil ",-1)),a("div",At,[a("div",zt,[a("span",Ot,f(("avatarText"in D?D.avatarText:l(Ue))(o.opportunity.customer.name)),1),a("div",Ut,[e(g,{to:{name:"apps-ecommerce-customer-details-id",params:{id:1}},class:"font-weight-base"},{default:t(()=>[h(f(o.opportunity.customer.name),1)]),_:1}),a("span",qt,f(o.opportunity.customer.phone),1)]),a("div",null,[e(N,{color:"secondary",variant:"tonal",size:"small",onClick:y},{default:t(()=>V[2]||(V[2]=[h(" Editar Perfil ")])),_:1})])])])])]),a("div",null,[V[5]||(V[5]=a("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(n(),m("div",Ft,[(n(!0),m(T,null,Y(o.opportunity.procedure,P=>(n(),m("div",{key:P.id},[e(ee,{color:P.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:M=>A(P)},{default:t(()=>[P.pivot.is_check?(n(),U(J,{key:0,icon:"tabler-check",class:"mr-2"})):R("",!0),h(" "+f(P.title),1)]),_:2},1032,["color","onClick"]),e(te,{activator:"parent",location:"top"},{default:t(()=>[h(f(P.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(n(),m("div",jt,V[4]||(V[4]=[a("span",null,"No hay procedimientos disponibles.",-1)])))]),a("div",null,[V[8]||(V[8]=a("span",{style:{"font-size":"14px","font-weight":"500"}}," Cotizaciones ",-1)),o.opportunity.quotes&&o.opportunity.quotes.length>0?(n(),m("div",Et,[e(pe,{density:"compact",class:"text-no-wrap",style:{"font-size":"12px"}},{default:t(()=>[V[6]||(V[6]=a("thead",null,[a("tr",null,[a("th",null," Propiedad "),a("th",null," Fecha "),a("th",null," Monto "),a("th")])],-1)),a("tbody",null,[(n(!0),m(T,null,Y(o.opportunity.quotes,P=>(n(),m("tr",{key:P.id},[a("td",null,f(P.properties[0].title),1),a("td",null,f(P.created_at),1),a("td",null,f(("formatCurrency"in D?D.formatCurrency:l(ae))(P.amount)),1),a("td",null,[e(g,{to:{name:"quote-id",params:{id:P.id}}},{default:t(()=>[e(p,null,{default:t(()=>[e(J,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])])]))),128))])]),_:1})])):(n(),m("div",Tt,V[7]||(V[7]=[a("span",null,"No hay cotizaciones disponibles.",-1)])))]),e(W,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(g,{to:{name:"quote-add-quote"},class:"text-white"},{default:t(()=>[e(N,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>V[9]||(V[9]=[h(" Generar Cotización ")])),_:1})]),_:1}),e(N,{color:"primary",class:"mx-auto",size:"small",disabled:l(C),loading:l(C),onClick:V[0]||(V[0]=P=>_(o.opportunity.id))},{default:t(()=>V[10]||(V[10]=[h(" Siguiente Etapa ")])),_:1},8,["disabled","loading"])]),_:1}),e(qe,{"is-dialog-visible":l(x),"onUpdate:isDialogVisible":V[1]||(V[1]=P=>L(x)?x.value=P:null),"opportunity-kanban":o.opportunity,"onUpdate:newProperty":u},null,8,["is-dialog-visible","opportunity-kanban"])],64)}}},Nt={__name:"DeliveryForm",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(q,{emit:k}){const o=q,v=k,{changeStatusByOpportunity:O}=ue(),$=u=>{v("update:isDialogVisible",u)},C=w(structuredClone(Z(o.opportunity)));de(o,()=>{C.value=structuredClone(Z(o.opportunity))});const x=async()=>{v("update:isDialogVisible",!1);try{await O(o.opportunity.id,5,{delivery_date:C.value.sales.delivery_date}),v("updateDeliveryDate",C.value.id)}catch(u){console.error("Error updating customer:",u)}},y=()=>{v("update:isDialogVisible",!1)};return(u,_)=>{const A=ge;return n(),U(_e,{"model-value":o.isDialogVisible,"max-width":"800","onUpdate:modelValue":$},{default:t(()=>[e(A,{onClick:_[0]||(_[0]=D=>u.$emit("update:isDialogVisible",!1))}),e(oe,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(me,{class:"text-h3 text-center"},{default:t(()=>_[2]||(_[2]=[h(" Confirmar Fecha ")])),_:1}),e(W,null,{default:t(()=>[e(W,null,{default:t(()=>[e(H,null,{default:t(()=>[e(b,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(ne,{modelValue:l(C).sales.delivery_date,"onUpdate:modelValue":_[1]||(_[1]=D=>l(C).sales.delivery_date=D),label:"Fecha de Entrega",type:"date",rules:["requiredValidator"in u?u.requiredValidator:l(Q)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),e(b,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(N,{onClick:x},{default:t(()=>_[3]||(_[3]=[h(" Pasar a Entrega ")])),_:1}),e(N,{color:"secondary",variant:"tonal",onClick:y},{default:t(()=>_[4]||(_[4]=[h(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Rt={key:0},Bt={__name:"PaymentPlanEdit",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},payment:{type:Object,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(q,{emit:k}){const o=q,v=k,{updatePaymentPlans:O}=ve(),$=w(!1),C=s=>{v("update:isDialogVisible",s)},x=w(structuredClone(Z(o.payment))),y=w(structuredClone(Z(o.opportunity))),u=w([]);de(o,()=>{x.value=structuredClone(Z(o.payment)),y.value=structuredClone(Z(o.opportunity))});const _=()=>{u.value.push({amount:"",date:"",type:x.value.type})},A=s=>{u.value.splice(s,1)},D=X(()=>u.value.reduce((s,r)=>{const B=parseFloat(r.amount)||0;return s+B},0)),V=X(()=>u.value.length>0&&u.value.every(s=>s.amount&&s.date&&s.type)),g=X(()=>{if(u.value.length===0)return!0;const s=u.value.reduce((F,G)=>F+(parseFloat(G.amount)||0),0),r=parseFloat(s),B=parseFloat(x.value.amount);return r===B}),p=X(()=>u.value.length===0?!0:V.value&&g.value),P=async()=>{if(!g.value){Fe("Validación fallida","La suma de las diferencias no es correcta");return}if(!p.value){alert("Por favor, completa todos los campos obligatorios.");return}$.value=!0;try{await O(x.value.id,{date:x.value.date,differData:u.value})}catch(s){console.error("Error updating customer:",s)}finally{v("updateDeliveryDate",y.value.id),v("update:isDialogVisible",!1),u.value=[],$.value=!1}},M=()=>{v("update:isDialogVisible",!1),u.value=[],errorMessage.value=""};return(s,r)=>{const B=ge;return n(),U(_e,{"model-value":o.isDialogVisible,"max-width":"800","onUpdate:modelValue":C},{default:t(()=>[e(B,{onClick:r[0]||(r[0]=F=>s.$emit("update:isDialogVisible",!1))}),e(oe,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(me,{class:"text-h3 text-center"},{default:t(()=>r[2]||(r[2]=[h(" Editar Pago ")])),_:1}),e(W,null,{default:t(()=>[e(H,{class:"mx-5"},{default:t(()=>[e(b,{cols:"6"},{default:t(()=>[a("h3",null," Monto a Pagar : "+f(l(ae)(l(x).amount)),1)]),_:1}),e(b,{cols:"6"},{default:t(()=>[e(ne,{modelValue:l(x).date,"onUpdate:modelValue":r[1]||(r[1]=F=>l(x).date=F),label:"Cambiar Fecha",type:"date",rules:["requiredValidator"in s?s.requiredValidator:l(Q)]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(oe,{flat:"",class:"d-flex flex-column pa-5 px-5"},{default:t(()=>[(n(!0),m(T,null,Y(l(u),(F,G)=>(n(),m("div",{key:F.id,class:"d-flex align-center my-4"},[e(ne,{modelValue:F.amount,"onUpdate:modelValue":z=>F.amount=z,label:"Monto *",type:"number",class:"mr-4",outlined:"",rules:["requiredValidator"in s?s.requiredValidator:l(Q)]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(ne,{modelValue:F.date,"onUpdate:modelValue":z=>F.date=z,label:"Fecha de Pago *",type:"date",class:"mr-3",outlined:"",rules:["requiredValidator"in s?s.requiredValidator:l(Q)]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(N,{color:"error",onClick:z=>A(G)},{default:t(()=>[e(J,{icon:"tabler-square-x"})]),_:2},1032,["onClick"])]))),128)),l(u).length>0?(n(),m("div",Rt,[r[3]||(r[3]=a("strong",null,"Monto Restante:",-1)),h(" "+f(l(ae)(l(x).amount-l(D))),1)])):R("",!0),e(N,{color:"primary",variant:"tonal",class:"mt-4",size:"small",onClick:_},{default:t(()=>r[4]||(r[4]=[h(" Diferir Pago ")])),_:1})]),_:1}),e(b,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(N,{loading:l($),disabled:!l(p)||l($),onClick:P},{default:t(()=>r[5]||(r[5]=[h(" Guardar ")])),_:1},8,["loading","disabled"]),e(N,{color:"error",variant:"tonal",onClick:M},{default:t(()=>r[6]||(r[6]=[h(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Lt={__name:"SalePaymentPlan",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},salesPayment:{type:Array,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(q,{emit:k}){const o=q,v=k;ve();const O=y=>{v("update:isDialogVisible",y)},$=w(structuredClone(Z(o.opportunity)));de(o,()=>{$.value=structuredClone(Z(o.opportunity)),console.log("Sales Payment:",o.salesPayment)});const C=w([]),x=()=>{v("update:isDialogVisible",!1),C.value=[]};return(y,u)=>{const _=ge;return n(),U(_e,{"model-value":o.isDialogVisible,"max-width":"800","onUpdate:modelValue":O},{default:t(()=>[e(_,{onClick:u[0]||(u[0]=A=>y.$emit("update:isDialogVisible",!1))}),e(oe,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(me,{class:"text-h3 text-center"},{default:t(()=>u[1]||(u[1]=[h(" Confirmar Fecha ")])),_:1}),e(W,null,{default:t(()=>[e(W,null,{default:t(()=>[e(H,null,{default:t(()=>[e(b,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[a("span",null," Monto a Pagar : "+f(l($)),1)]),_:1})]),_:1})]),_:1}),e(b,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(N,{onClick:y.onFormSubmit},{default:t(()=>u[2]||(u[2]=[h(" Guardar ")])),_:1},8,["onClick"]),e(N,{color:"error",variant:"tonal",onClick:x},{default:t(()=>u[3]||(u[3]=[h(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Mt={class:"text-h6"},Yt={class:"text-h6"},Ht={class:"text-h6"},Wt={class:"my-5"},Gt={key:0},Qt=["src"],Jt={class:"mb-4"},Xt=["onClick"],Kt=["onClick"],Zt={class:"my-5"},ea={key:0,class:"d-flex flex-wrap gap-2 my-5"},ta={key:1},aa={__name:"EditSaleOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId"],setup(q,{emit:k}){const o=q,v=k,{checkProcessForOpportunity:O}=ce(),{confirmPaymentPlans:$}=ve(),{changeStatusByOpportunity:C,loadingOpportunity:x}=ue(),{SaleChangeSignature:y}=Xe(),u=w(!1),_=w(!1),A=w(!1),D=w(""),V=X(()=>o.opportunity.sales.reduce((S,d)=>S+d.amount,0)),g=X(()=>o.opportunity.sales.reduce((S,d)=>S+d.initial_fee,0)),p=X(()=>V.value-g.value),P=()=>{A.value=!0},M=S=>{if(S.is_paid===1){Fe("Advertencia","No se puede editar un pago ya realizado.");return}console.log("entro aqui"),_.value=!0,D.value={...S}},s=async S=>{v("updateStageId",S)},r=async S=>{console.log(`Procedimiento ${S.id} marcado como: ${S.pivot.is_check?"realizado":"no realizado"}`),await O(o.opportunity.id,S.id,{is_check:!S.pivot.is_check}),S.pivot.is_check=!S.pivot.is_check,v("updateStageId",o.opportunity.id)},B=async S=>{console.log(S),await $(S),v("updateStageId",o.opportunity.id)},F=async S=>{console.log("entra a firma"),await y(S),v("updateStageId",o.opportunity.id)},G=async S=>{await C(S,5,{}),v("updateStageId",S)},z=async S=>{v("updateStageId",S)};return(S,d)=>(n(),m(T,null,[a("div",null,[e(oe,null,{default:t(()=>[e(W,null,{default:t(()=>[e(H,null,{default:t(()=>[e(b,{cols:"4",class:"border rounded-sm mx-1"},{default:t(()=>[e(le,{class:"font-weight-medium"},{default:t(()=>d[5]||(d[5]=[h(" Saldo ")])),_:1}),e(ie,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[a("span",Mt,f(("formatCurrency"in S?S.formatCurrency:l(ae))(l(p))),1)]),_:1})]),_:1}),e(b,{cols:"3",class:"border rounded-sm mx-1"},{default:t(()=>[e(le,{class:"font-weight-medium"},{default:t(()=>d[6]||(d[6]=[h(" Anticipo ")])),_:1}),e(ie,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[a("span",Yt,f(("formatCurrency"in S?S.formatCurrency:l(ae))(l(g))),1)]),_:1})]),_:1}),e(b,{cols:"4",class:"border rounded-sm mx-1"},{default:t(()=>[e(le,{class:"font-weight-medium"},{default:t(()=>d[7]||(d[7]=[h(" Precio Final ")])),_:1}),e(ie,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[a("span",Ht,f(("formatCurrency"in S?S.formatCurrency:l(ae))(l(V))),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),a("div",Wt,[d[9]||(d[9]=a("span",{style:{"font-size":"14px","font-weight":"500"}}," Propiedades ",-1)),o.opportunity.sales.length>0?(n(),m("div",Gt,[(n(!0),m(T,null,Y(o.opportunity.sales,i=>(n(),m("div",{key:i.id},[e(H,null,{default:t(()=>[(n(!0),m(T,null,Y(i.properties,c=>(n(),U(b,{key:c.id,class:"d-flex align-center justify-between",cols:"12",md:"9"},{default:t(()=>[e(Ae,{size:"50",rounded:""},{default:t(()=>[a("img",{src:l(De),alt:"Logo pora",style:{"border-radius":"30%"}},null,8,Qt)]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(le,{class:"font-weight-medium"},{default:t(()=>[h(f(c.project_title)+" | "+f(c.title),1)]),_:2},1024),e(ie,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[a("span",null,"$ "+f(c.pivot_price),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),e(se,{modelValue:i.confirmation_signature,"onUpdate:modelValue":c=>i.confirmation_signature=c,"true-value":1,"false-value":0,onChange:c=>F(i.id)},{default:t(()=>[e(te,{activator:"parent",location:"top"},{default:t(()=>d[8]||(d[8]=[h(" Confirmar firma ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]))),128))])):R("",!0)]),a("div",Jt,[d[12]||(d[12]=a("span",{style:{"font-size":"14px","font-weight":"500"}}," Anticipo ",-1)),o.opportunity.initial_payments&&o.opportunity.initial_payments.length>0?(n(),U(pe,{key:0,density:"compact",class:"text-no-wrap my-2",style:{"font-size":"12px"}},{default:t(()=>[d[11]||(d[11]=a("thead",null,[a("tr",null,[a("th",null," Propiedad "),a("th",null," Fecha "),a("th",null," Monto "),a("th",null," Action ")])],-1)),a("tbody",null,[(n(!0),m(T,null,Y(o.opportunity.initial_payments,i=>(n(),m("tr",{key:i.id},[a("td",null,f(i.property_title),1),a("td",null,f(i.date),1),a("td",null,f(i.amount),1),a("td",null,[e(H,null,{default:t(()=>[e(se,{modelValue:i.is_paid,"onUpdate:modelValue":c=>i.is_paid=c,"true-value":1,"false-value":0,disabled:i.is_paid===1,onChange:c=>B(i.id)},{default:t(()=>[e(te,{activator:"parent",location:"top"},{default:t(()=>d[10]||(d[10]=[h(" Confirmar Pago ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"]),i.is_paid===0?(n(),m("div",{key:0,"fill-dot":"",style:{cursor:"pointer"},onClick:c=>M(i)},[e(l(J),{size:"25",icon:"tabler-edit"})],8,Xt)):R("",!0)]),_:2},1024)])]))),128))])]),_:1})):R("",!0)]),a("div",null,[d[15]||(d[15]=a("span",{style:{"font-size":"14px","font-weight":"500"}}," Saldos ",-1)),o.opportunity.balance_payments&&o.opportunity.balance_payments.length>0?(n(),U(pe,{key:0,density:"compact",class:"text-no-wrap my-2",style:{"font-size":"12px"}},{default:t(()=>[d[14]||(d[14]=a("thead",null,[a("tr",null,[a("th",null," Propiedad "),a("th",null," Fecha "),a("th",null," Monto "),a("th",null," Action ")])],-1)),a("tbody",null,[(n(!0),m(T,null,Y(o.opportunity.balance_payments,i=>(n(),m("tr",{key:i.id},[a("td",null,f(i.property_title),1),a("td",null,f(i.date),1),a("td",null,f(i.amount),1),a("td",null,[e(H,null,{default:t(()=>[e(se,{modelValue:i.is_paid,"onUpdate:modelValue":c=>i.is_paid=c,"true-value":1,"false-value":0,disabled:i.is_paid===1,onChange:c=>B(i.id)},{default:t(()=>[e(te,{activator:"parent",location:"top"},{default:t(()=>d[13]||(d[13]=[h(" Confirmar Pago ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"]),i.is_paid===0?(n(),m("div",{key:0,"fill-dot":"",style:{cursor:"pointer"},onClick:c=>M(i)},[e(l(J),{size:"25",icon:"tabler-edit"})],8,Kt)):R("",!0)]),_:2},1024)])]))),128))])]),_:1})):R("",!0)]),a("div",Zt,[d[17]||(d[17]=a("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(n(),m("div",ea,[(n(!0),m(T,null,Y(o.opportunity.procedure,i=>(n(),m("div",{key:i.id},[e(ee,{color:i.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:c=>r(i)},{default:t(()=>[i.pivot.is_check?(n(),U(l(J),{key:0,icon:"tabler-check",class:"mr-2"})):R("",!0),h(" "+f(i.title),1)]),_:2},1032,["color","onClick"]),e(te,{activator:"parent",location:"top"},{default:t(()=>[h(f(i.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(n(),m("div",ta,d[16]||(d[16]=[a("span",null,"No hay procedimientos disponibles.",-1)])))]),e(W,{class:"d-flex mt-4"},{default:t(()=>[e(N,{color:"primary",variant:"tonal",class:"mx-auto",size:"small",onClick:P},{default:t(()=>d[18]||(d[18]=[h(" Generar Venta ")])),_:1}),e(N,{color:"primary",class:"mx-auto",size:"small",onClick:d[0]||(d[0]=i=>G(o.opportunity.id))},{default:t(()=>d[19]||(d[19]=[h(" Siguiente Etapa ")])),_:1})]),_:1}),e(Nt,{"is-dialog-visible":l(u),"onUpdate:isDialogVisible":d[1]||(d[1]=i=>L(u)?u.value=i:null),opportunity:o.opportunity,onUpdateDeliveryDate:z},null,8,["is-dialog-visible","opportunity"]),e(Bt,{"is-dialog-visible":l(_),"onUpdate:isDialogVisible":d[2]||(d[2]=i=>L(_)?_.value=i:null),payment:l(D),opportunity:o.opportunity,onUpdateDeliveryDate:z},null,8,["is-dialog-visible","payment","opportunity"]),e(Ce,{"is-dialog-visible":l(A),"onUpdate:isDialogVisible":d[3]||(d[3]=i=>L(A)?A.value=i:null),opportunity:o.opportunity,stage:"SALE",onRegisterSale:s},null,8,["is-dialog-visible","opportunity"]),e(Lt,{"is-dialog-visible":S.openSaleEditPaymentPlan,"onUpdate:isDialogVisible":d[4]||(d[4]=i=>S.openSaleEditPaymentPlan=i),opportunity:o.opportunity,"sales-payment":S.salePaymentPlan,onUpdateDeliveryDate:z},null,8,["is-dialog-visible","opportunity","sales-payment"])],64))}},oa={__name:"DrawerBitacora",props:{isDrawerOpen:{type:Boolean,required:!0},customer:{type:String,required:!0}},emits:["update:isDrawerOpen"],setup(q,{emit:k}){const o=q,v=k,O=$=>{v("update:isDrawerOpen",$)};return($,C)=>(n(),U(Ee,{temporary:"",width:500,location:"end",class:"scrollable-content","model-value":o.isDrawerOpen,"onUpdate:modelValue":O},{default:t(()=>[e(l(je),{options:{wheelPropagation:!1}},{default:t(()=>[e(Je,{customer:q.customer},null,8,["customer"])]),_:1})]),_:1},8,["model-value"]))}};function la(q){const k=new Date(q),o=k.getFullYear(),v=String(k.getMonth()+1).padStart(2,"0"),O=String(k.getDate()).padStart(2,"0"),$=String(k.getHours()).padStart(2,"0"),C=String(k.getMinutes()).padStart(2,"0"),x=String(k.getSeconds()).padStart(2,"0");return`${o}-${v}-${O} ${$}:${C}:${x}`}const ia={class:"d-flex align-center gap-1"},sa={class:"text-body-1 text-high-emphasis font-weight-medium"},na={class:"d-flex flex-column"},ra={class:"text-h6 font-weight-medium"},ua={class:"text-xs"},ke="rgba(var(--v-theme-on-background), var(--v-high-emphasis-opacity))",xe="rgba(var(--v-theme-on-background), var(--v-medium-emphasis-opacity))",da={__name:"SellerReport",setup(q){const{pastSellerActivityData:k,futureSellerActivityData:o,fetchPastSellerActivity:v,fetchFutureSellerActivity:O,isLoading:$,error:C}=et(),x=ze("userData").value,y=(p,P)=>P>0?Math.round(p/P*100):0,u=X(()=>{const p=o.value.total_activity||0;return[{title:"Visita",tasks:o.value.total_activity_visit||0,progress:y(o.value.total_activity_visit,p),color:"primary"},{title:"Llamada",tasks:o.value.total_activity_call||0,progress:y(o.value.total_activity_call,p),color:"success"},{title:"Cotización",tasks:o.value.total_activity_quote||0,progress:y(o.value.total_activity_quote,p),color:"secondary"},{title:"Otros",tasks:o.value.total_activity_other||0,progress:y(o.value.total_activity_other,p),color:"warning"}]}),_=X(()=>[k.value.total_activity_pending||0,k.value.total_activity_complet||0,k.value.total_activity_cancell||0,k.value.total_activity_discard||0]),A=X(()=>[k.value.total_activity_visit||0,k.value.total_activity_call||0,k.value.total_activity_quote||0,k.value.total_activity_other||0]),D={chart:{height:300,type:"donut",toolbar:{show:!1}},plotOptions:{pie:{donut:{size:"70%",labels:{show:!0,value:{fontSize:"16px",color:ke,fontWeight:500,offsetY:-15,formatter(p){return`${Number.parseInt(p)} Actividades`}},name:{offsetY:30},total:{show:!0,fontSize:"0.75rem",fontWeight:400,label:"Total",color:xe,formatter(){return`${k.value.total_activity||0} Actividades`}}}}}},labels:["Pendiente","Completado","Cancelado","Descartado"],colors:["rgb(168, 170, 174)","rgb(40, 199, 111)","rgb(255, 159, 67)","rgb(234, 84, 85)"],grid:{padding:{top:15}},stroke:{width:0},dataLabels:{enabled:!1},legend:{show:!0,position:"bottom",offsetY:10,markers:{width:8,height:8,offsetX:-3},itemMargin:{horizontal:15,vertical:5},fontSize:"13px",fontWeight:400},tooltip:{theme:"dark"},responsive:[{breakpoint:420,options:{chart:{height:200}}}]},V={chart:{height:300,type:"donut",toolbar:{show:!1}},plotOptions:{pie:{donut:{size:"70%",labels:{show:!0,value:{fontSize:"16px",color:ke,fontWeight:500,offsetY:-15,formatter(p){return`${Number.parseInt(p)} Actividades`}},name:{offsetY:30},total:{show:!0,fontSize:"0.75rem",fontWeight:400,label:"Total",color:xe,formatter(){return`${k.value.total_activity||0} Actividades`}}}}}},labels:["Visita","Llamada","Cotización","Otros"],colors:["rgb(0, 207, 232)","rgb(40, 199, 111)","rgb(168, 170, 174)","rgb(255, 159, 67)"],grid:{padding:{top:15}},stroke:{width:0},dataLabels:{enabled:!1},legend:{show:!0,position:"bottom",offsetY:10,markers:{width:8,height:8,offsetX:-3},itemMargin:{horizontal:15,vertical:5},fontSize:"13px",fontWeight:400},tooltip:{theme:"dark"},responsive:[{breakpoint:420,options:{chart:{height:200}}}]},g=()=>{v("2024-01-01",he(new Date),0,x.id),O(la(new Date),he(new Date(new Date().setFullYear(new Date().getFullYear()+1))),0,x.id)};return Oe(()=>{g()}),(p,P)=>{const M=Ze,s=Ke;return n(),U(H,null,{default:t(()=>[e(b,{cols:"12",md:"12"},{default:t(()=>[e(M,{"no-actions":""},{default:t(()=>[e(ye,{title:"Actividades futuras"}),e(W,null,{default:t(()=>[e(H,null,{default:t(()=>[(n(!0),m(T,null,Y(l(u),r=>(n(),U(b,{key:r.title,cols:"6",md:"3"},{default:t(()=>[a("div",ia,[a("div",null,[e(He,{modelValue:r.progress,"onUpdate:modelValue":B=>r.progress=B,size:54,color:r.color},{default:t(()=>[a("span",sa,f(r.progress)+"% ",1)]),_:2},1032,["modelValue","onUpdate:modelValue","color"])]),a("div",na,[a("span",ra,f(r.title),1),a("span",ua,f(r.tasks)+" actividades ",1)])])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(M,{"no-actions":""},{default:t(()=>[e(ye,{title:"Reporte por estado"}),e(W,null,{default:t(()=>[e(s,{type:"donut",height:"300",series:l(_),options:D},null,8,["series"])]),_:1})]),_:1})]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(M,{"no-actions":""},{default:t(()=>[e(ye,{title:"Reporte por tipo"}),e(W,null,{default:t(()=>[e(s,{type:"donut",height:"300",series:l(A),options:V},null,8,["series"])]),_:1})]),_:1})]),_:1})]),_:1})}}},pa=Te(da,[["__scopeId","data-v-3bd806d3"]]),ca={__name:"CustomerHistory",props:{isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","userData"],setup(q,{emit:k}){const o=q,v=k,O=w(!1),$=w(),C=w(""),x=w(""),y=w(""),u=w(""),_=w(),A=w(""),D=w(),V=w(),g=w(),p=()=>{v("update:isDrawerOpen",!1),be(()=>{var s,r;(s=$.value)==null||s.reset(),(r=$.value)==null||r.resetValidation()})},P=()=>{var s;(s=$.value)==null||s.validate().then(({valid:r})=>{r&&(v("userData",{id:0,fullName:C.value,company:u.value,role:D.value,country:_.value,contact:A.value,email:y.value,currentPlan:V.value,status:g.value,avatar:"",billing:"Auto Debit"}),v("update:isDrawerOpen",!1),be(()=>{var B,F;(B=$.value)==null||B.reset(),(F=$.value)==null||F.resetValidation()}))})},M=s=>{v("update:isDrawerOpen",s)};return(s,r)=>{const B=tt,F=Se,G=$e;return n(),U(Ee,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":o.isDrawerOpen,"onUpdate:modelValue":M},{default:t(()=>[e(B,{title:"Historial del Cliente",onCancel:p}),e(l(je),{options:{wheelPropagation:!1}},{default:t(()=>[e(oe,{flat:""},{default:t(()=>[e(W,null,{default:t(()=>[e(at,{ref_key:"refForm",ref:$,modelValue:l(O),"onUpdate:modelValue":r[9]||(r[9]=z=>L(O)?O.value=z:null),onSubmit:We(P,["prevent"])},{default:t(()=>[e(H,null,{default:t(()=>[e(b,{cols:"12"},{default:t(()=>[e(F,{modelValue:l(C),"onUpdate:modelValue":r[0]||(r[0]=z=>L(C)?C.value=z:null),rules:["requiredValidator"in s?s.requiredValidator:l(Q)],label:"Full Name",placeholder:"John Doe"},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(F,{modelValue:l(x),"onUpdate:modelValue":r[1]||(r[1]=z=>L(x)?x.value=z:null),rules:["requiredValidator"in s?s.requiredValidator:l(Q)],label:"Username",placeholder:"Johndoe"},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(F,{modelValue:l(y),"onUpdate:modelValue":r[2]||(r[2]=z=>L(y)?y.value=z:null),rules:["requiredValidator"in s?s.requiredValidator:l(Q),"emailValidator"in s?s.emailValidator:l(Be)],label:"Email",placeholder:"johndoe@email.com"},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(F,{modelValue:l(u),"onUpdate:modelValue":r[3]||(r[3]=z=>L(u)?u.value=z:null),rules:["requiredValidator"in s?s.requiredValidator:l(Q)],label:"Company",placeholder:"PixInvent"},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(G,{modelValue:l(_),"onUpdate:modelValue":r[4]||(r[4]=z=>L(_)?_.value=z:null),label:"Select Country",placeholder:"Select Country",rules:["requiredValidator"in s?s.requiredValidator:l(Q)],items:["USA","UK","India","Australia"]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(F,{modelValue:l(A),"onUpdate:modelValue":r[5]||(r[5]=z=>L(A)?A.value=z:null),type:"number",rules:["requiredValidator"in s?s.requiredValidator:l(Q)],label:"Contact",placeholder:"+1-541-754-3010"},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(G,{modelValue:l(D),"onUpdate:modelValue":r[6]||(r[6]=z=>L(D)?D.value=z:null),label:"Select Role",placeholder:"Select Role",rules:["requiredValidator"in s?s.requiredValidator:l(Q)],items:["Admin","Author","Editor","Maintainer","Subscriber"]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(G,{modelValue:l(V),"onUpdate:modelValue":r[7]||(r[7]=z=>L(V)?V.value=z:null),label:"Select Plan",placeholder:"Select Plan",rules:["requiredValidator"in s?s.requiredValidator:l(Q)],items:["Basic","Company","Enterprise","Team"]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(G,{modelValue:l(g),"onUpdate:modelValue":r[8]||(r[8]=z=>L(g)?g.value=z:null),label:"Select Status",placeholder:"Select Status",rules:["requiredValidator"in s?s.requiredValidator:l(Q)],items:[{title:"Active",value:"active"},{title:"Inactive",value:"inactive"},{title:"Pending",value:"pending"}]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(N,{type:"submit",class:"me-3"},{default:t(()=>r[10]||(r[10]=[h(" Submit ")])),_:1}),e(N,{type:"reset",variant:"outlined",color:"secondary",onClick:p},{default:t(()=>r[11]||(r[11]=[h(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},ma={class:"d-flex justify-space-between align-center"},fa={class:"mb-2"},ya={style:{"font-size":"14px","font-weight":"500"}},va={style:{"font-size":"12px","font-weight":"500"}},ga={__name:"AddActivity",props:{activitiesData:{type:Object,required:!0,default:()=>({title:"",description:"",schedule_at:""})},isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","refreshActivities"],setup(q,{emit:k}){const o=q,v=k,O=w(!1);w(!1);const $=w("radio-1"),C=w(!1),x=()=>{C.value=!0},y=w({title:"",description:"",type_activity_id:null,opportunity_id:null,assigned_to:null,scheduled_at:null,status:"COMPLETED"}),{completedActivityAndRegister:u,getallTypeActivities:_,typeActivities:A,loadingActivity:D}=Pe(),{getOpportunitybyId:V,opportunity:g}=ue(),p=w(structuredClone(Z(o.activitiesData))),P=d=>{console.log("esta consultando de nuevo despues de cambiar etapa "),V(d)};de(o,()=>{p.value=structuredClone(Z(o.activitiesData)),V(p.value.opportunity_id),M()});const M=async()=>{await _()},s=()=>{V(p.value.opportunity_id)},r=()=>{v("update:isDrawerOpen",!1),y.value={title:null,description:null,type_activity_id:null,scheduled_at:null,opportunity_id:null,assigned_to:null,status:"COMPLETED"},v("refreshActivities")},B=async()=>{let d="";$.value==="radio-1"?d="COMPLETED":$.value==="radio-2"&&(d="CANCELLED"),u(p.value.id,{title:y.value.title,description:y.value.description,type_activity_id:y.value.type_activity_id,scheduled_at:y.value.scheduled_at,assigned_to:g.value.user_id,property_id:g.value.property_id,opportunity_id:g.value.id,status:d}),r()},F=async()=>{Ve.fire({title:"Quieres dar de baja al cliente ?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"confirmar"}).then(d=>{d.isConfirmed&&(Re(p.value.id),r(),Ve.fire({text:"EL cliente fue dado de baja",icon:"success"}))})},G=async()=>{v("update:isDrawerOpen",!1),v("refreshActivities")},z=()=>{console.log("Se escucho el evento en AddActivity"),v("refreshActivities")},S=d=>{const i=new Date(d),c=i.getDate(),j=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][i.getMonth()],E=i.getHours().toString().padStart(2,"0"),I=i.getMinutes().toString().padStart(2,"0");return`${c} de ${j}, ${E}:${I}`};return(d,i)=>{const c=Se,K=Me,j=Le;return n(),m(T,null,[e(H,{class:""},{default:t(()=>{var E;return[(E=l(p))!=null&&E.opportunity_id?(n(),U(b,{key:0,cols:"12"},{default:t(()=>[q.isDrawerOpen?(n(),U(oe,{key:0},{default:t(()=>[e(W,null,{default:t(()=>[e(Ie,{class:"mx-2 my-2"},{default:t(()=>[e(H,null,{default:t(()=>[e(b,{cols:"12",sm:"5"},{default:t(()=>[e(H,null,{default:t(()=>[e(b,{cols:"12"},{default:t(()=>[a("div",ma,[i[8]||(i[8]=a("span",{style:{"font-size":"18px","font-weight":"500"}}," Actividad ",-1)),e(ee,{color:"warning",onClick:x},{default:t(()=>i[7]||(i[7]=[h(" historial ")])),_:1})])]),_:1}),e(b,{cols:"12"},{default:t(()=>[a("div",fa,[a("span",ya,f(o.activitiesData.title)+" • "+f(S(o.activitiesData.scheduled_at)),1),i[9]||(i[9]=a("br",null,null,-1)),a("span",va,f(o.activitiesData.description),1)]),e(lt,{modelValue:l($),"onUpdate:modelValue":i[0]||(i[0]=I=>L($)?$.value=I:null),style:{"font-size":"14px"},inline:""},{default:t(()=>[i[10]||(i[10]=a("span",{class:"my-1"}," ¿Se realizó? ",-1)),e(we,{label:"Si",value:"radio-1",density:"compact",class:"mx-2"}),e(we,{label:"No",value:"radio-2",class:"mx-2",density:"compact"})]),_:1},8,["modelValue"]),e(it,{class:"mt-2"})]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(c,{modelValue:l(y).title,"onUpdate:modelValue":i[1]||(i[1]=I=>l(y).title=I),label:"Título de la actividad",placeholder:"..."},null,8,["modelValue"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e($e,{modelValue:l(y).type_activity_id,"onUpdate:modelValue":i[2]||(i[2]=I=>l(y).type_activity_id=I),label:"Tipo de actividad",placeholder:"Selecciona el tipo de actividad",items:l(A).map(I=>({title:I.name,value:I.id}))},null,8,["modelValue","items"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(K,{modelValue:l(y).scheduled_at,"onUpdate:modelValue":i[3]||(i[3]=I=>l(y).scheduled_at=I),label:"Seleccione la fecha y hora",placeholder:"Seleccione la fecha y hora",config:{enableTime:!0,dateFormat:"Y-m-d H:i"},rules:["requiredValidator"in d?d.requiredValidator:l(Q)]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(j,{modelValue:l(y).description,"onUpdate:modelValue":i[4]||(i[4]=I=>l(y).description=I),label:"Descripción",rows:"3",rules:["requiredValidator"in d?d.requiredValidator:l(Q)]},null,8,["modelValue","rules"])]),_:1}),e(b,null,{default:t(()=>[e(N,{color:"primary",class:"mx-auto",size:"small",loading:l(D),disabled:l(D),onClick:B},{default:t(()=>i[11]||(i[11]=[h(" Crear Actividad ")])),_:1},8,["loading","disabled"]),e(N,{color:"primary",class:"mx-1",variant:"tonal",size:"small",onClick:F},{default:t(()=>i[12]||(i[12]=[h(" Dar de Baja ")])),_:1})]),_:1})]),_:1})]),_:1}),e(b,{cols:"12",sm:"7",style:{"align-items":"center"}},{default:t(()=>[e(H,{class:"mb-2"},{default:t(()=>[e(b,{cols:"6"},{default:t(()=>i[13]||(i[13]=[a("span",{style:{"font-size":"18px","font-weight":"500"}}," Etapa ",-1)])),_:1}),e(b,{cols:"12",md:"6",class:"d-flex justify-end align-center"},{default:t(()=>[e(ee,{label:"",color:"primary"},{default:t(()=>[h(f(l(g).stage.title),1)]),_:1})]),_:1})]),_:1}),l(g).stage_id===2?(n(),U(It,{key:0,opportunity:l(g),onUpdateStageId:P,"onUpdate:newProperty":z},null,8,["opportunity"])):R("",!0),l(g).stage_id===3?(n(),U(Pt,{key:1,opportunity:l(g),onUpdateStageId:P,"onUpdate:newProperty":z},null,8,["opportunity"])):R("",!0),l(g).stage_id===4?(n(),U(aa,{key:2,opportunity:l(g),onRefreshActivities:s,onUpdateStageId:P},null,8,["opportunity"])):R("",!0),l(g).stage_id===5?(n(),U(yt,{key:3,opportunity:l(g),onRefreshActivities:s,onUpdateStageId:P,onComplet:G},null,8,["opportunity"])):R("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):R("",!0)]),_:1})):R("",!0),e(b,{cols:"12",md:"12"},{default:t(()=>[e(pa)]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(ca,{"is-drawer-open":l(O),"onUpdate:isDrawerOpen":i[5]||(i[5]=I=>L(O)?O.value=I:null)},null,8,["is-drawer-open"])]),_:1})]}),_:1}),e(oa,{"is-drawer-open":l(C),"onUpdate:isDrawerOpen":i[6]||(i[6]=E=>L(C)?C.value=E:null),customer:l(g).customer_id},null,8,["is-drawer-open","customer"])],64)}}};const _a={class:"mt-2 mx-3"},ba={style:{"font-size":"14px"}},Va={key:0,class:"no-activities-message d-flex flex-column justify-center align-center",style:{"min-block-size":"200px","text-align":"center"}},ha=["onClick"],wa={class:"mx-2"},ka={class:"d-flex justify-content-between",style:{"font-size":"0.9em"}},xa={__name:"list",setup(q){const k=w(""),o=w("Anteriores");w(["Todos","PORA"]),w("Todos");const{getallActivitiesByAsesorFecha:v,getallActivitiesByFechaPast:O,getallActivitiesByFechaFuture:$,activities:C,activitiesPast:x,activitiesFuture:y}=Pe(),u=w(""),_=ze("userData").value,A=w(!0),D=w([]),V=w([]),g=w([]),p=async()=>{await v(_.id),D.value=C.value},P=async()=>{await O(_.id),V.value=x.value},M=async()=>{await $(_.id),g.value=y.value};Oe(async()=>{await p(),await P(),await M(),A.value=!1});const s=w(!1),r=w(null),B=i=>{s.value=!0,u.value={...i},r.value=i.id},F=async()=>{A.value=!0,await p(),await P(),await M(),A.value=!1},G=X(()=>[{tabName:"Anteriores",icon:"tabler-calendar",actividades:V,badge:V.value.length},{tabName:"Hoy",icon:"tabler-edit",actividades:D,badge:D.value.length},{tabName:"Futuros",icon:"tabler-calendar",actividades:g,badge:g.value.length}]),z=[{type:"Visita",icon:"tabler-current-location"},{type:"Llamada",icon:"tabler-phone"},{type:"Cotizacion",icon:"tabler-cash"},{type:"Otro",icon:"tabler-table"}],S=i=>{const c=z.find(K=>K.type===i);return c?c.icon:"tabler-default"},d=i=>{const c=new Date(i),K=c.getDate(),E=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][c.getMonth()],I=c.getHours().toString().padStart(2,"0"),Ne=c.getMinutes().toString().padStart(2,"0");return`${K} de ${E}, ${I}:${Ne}`};return de(k,i=>{const c=K=>K.filter(j=>{const E=j.name_opportunity.toLowerCase().includes(i.toLowerCase()),I=j.phone_opportunity.toLowerCase().includes(i.toLowerCase());return E||I});i.length>2?(D.value=c(C.value),V.value=c(x.value),g.value=c(y.value)):(D.value=C.value,V.value=x.value,g.value=y.value)}),(i,c)=>{const K=re("VCircularProgress");return n(),U(H,{class:"match-height"},{default:t(()=>[e(b,{cols:"12",md:"4",style:{display:"flex","flex-direction":"column","block-size":"100vh"}},{default:t(()=>[e(oe,{class:"flex-grow-1"},{default:t(()=>[e(me,{class:"d-flex justify-between align-center flex-wrap"},{default:t(()=>[c[5]||(c[5]=a("h4",{class:"mt-5"}," Mis Actividades ",-1)),a("div",_a,[e(ne,{modelValue:k.value,"onUpdate:modelValue":c[0]||(c[0]=j=>k.value=j),placeholder:"Buscar actividad...",class:"search-field",variant:"plain","hide-details":"",dense:"","prepend-inner-icon":"tabler-search"},null,8,["modelValue"])])]),_:1}),e(st,{modelValue:o.value,"onUpdate:modelValue":c[1]||(c[1]=j=>o.value=j),grow:""},{default:t(()=>[(n(!0),m(T,null,Y(G.value,j=>(n(),U(nt,{key:j.tabName},{default:t(()=>[a("span",ba,f(j.tabName),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),c[11]||(c[11]=a("br",null,null,-1)),e(W,{style:{"flex-grow":"1","overflow-y":"auto"}},{default:t(()=>[A.value?(n(),U(rt,{key:0,absolute:"",opacity:"0.7"},{default:t(()=>[e(K,{indeterminate:"",size:"70"})]),_:1})):R("",!0),e(Ie,{modelValue:o.value,"onUpdate:modelValue":c[2]||(c[2]=j=>o.value=j),class:"disable-tab-transition",style:{"max-block-size":"500px","overflow-y":"auto"}},{default:t(()=>[(n(!0),m(T,null,Y(G.value,j=>(n(),U(ot,{key:j.tabName,value:j.tabName},{default:t(()=>[j.actividades.value.length===0?(n(),m("div",Va,[e(J,{size:"64",color:"grey",icon:"tabler-calendar-off",class:"mb-4",style:{animation:"bounce 1s infinite"}}),c[6]||(c[6]=a("div",{style:{color:"#888","font-size":"1.2em"}}," ¡No tienes actividades pendientes! ",-1)),c[7]||(c[7]=a("div",{style:{color:"#aaa","font-size":"0.9em","margin-block-start":"8px"}}," ¡Relájate y disfruta tu día! ",-1))])):(n(!0),m(T,{key:1},Y(j.actividades.value,E=>(n(),m("div",{key:E.id,"fill-dot":"",class:Ge(["border mb-2 rounded-sm py-2",[{"selected-activity":E.id===r.value}]]),style:{cursor:"pointer"},onClick:I=>B(E)},[e(fe,null,{default:t(()=>[e(H,null,{default:t(()=>[e(b,{cols:"12",md:"2",style:{"padding-inline-end":"0"}},{default:t(()=>[e(ee,{class:"d-flex justify-center align-center",style:{display:"inline-flex","border-radius":"4px","block-size":"36px","inline-size":"36px"}},{default:t(()=>[e(J,{size:"25",icon:"tabler-home"})]),_:1})]),_:1}),E.project_name?(n(),U(b,{key:0,cols:"12",md:"5",class:"d-flex flex-column align-start",style:{"padding-inline-start":"0"}},{default:t(()=>[e(ie,{class:"text-left"},{default:t(()=>[a("strong",null,f(E.property_title),1)]),_:2},1024),e(le,{class:"font-weight-medium text-left"},{default:t(()=>[a("span",null,"$ "+f(E.price),1)]),_:2},1024)]),_:2},1024)):R("",!0),E.project_name?R("",!0):(n(),U(b,{key:1,cols:"12",md:"5"},{default:t(()=>[e(ie,{class:"text-left"},{default:t(()=>c[8]||(c[8]=[a("strong",{style:{"font-size":"12px"}}," Departamento ",-1)])),_:1}),e(le,{class:"font-weight-medium text-left"},{default:t(()=>c[9]||(c[9]=[a("span",null,"Indefinido",-1)])),_:1})]),_:1})),e(b,{cols:"12",md:"5",class:"d-flex justify-end align-center"},{default:t(()=>[e(ee,{label:"",color:"primary",class:"ml-auto",style:{"font-size":"10px"}},{default:t(()=>[h(f(E.stage),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(fe,{class:""},{default:t(()=>[e(ee,{label:"",color:"secondary",class:"w-100 h-48"},{default:t(()=>[e(J,{size:"20",icon:S(E.type_activity)},null,8,["icon"]),a("div",wa,f(E.type_activity)+"   •   "+f(E.name_opportunity),1)]),_:2},1024)]),_:2},1024),e(fe,null,{default:t(()=>[a("div",ka,[c[10]||(c[10]=a("div",{style:{"flex-grow":"1"}}," Ver ",-1)),a("div",null,f(d(E.scheduled_at)),1)])]),_:2},1024)],10,ha))),128))]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(b,{cols:"12",md:"8",style:{display:"flex","flex-direction":"column"}},{default:t(()=>[e(ga,{"is-drawer-open":s.value,"onUpdate:isDrawerOpen":c[3]||(c[3]=j=>s.value=j),"activities-data":u.value,class:"flex-grow-1",onRefreshActivities:F,onLoaded:c[4]||(c[4]=j=>A.value=!1)},null,8,["is-drawer-open","activities-data"])]),_:1})]),_:1})}}},No=Te(xa,[["__scopeId","data-v-a63b9f08"]]);export{No as default};
