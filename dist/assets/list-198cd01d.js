import{u as ae,p as ke,S as Pe,_ as De,a as Ce,d as Ne}from"./PreSaleForm-5854a736.js";import{r as K,e as Re}from"./validators-dea6e3a5.js";import{_ as he}from"./AppTextarea-9c4030e7.js";import{_ as Le}from"./AppDateTimePicker-d494146e.js";import{_ as ge}from"./AppTextField-6e09d0a2.js";import{_ as _e}from"./AppSelect-378db062.js";import{$ as ne}from"./api-ebe57097.js";import{s as $e,a as Me,b as He,c as Se,S as Ve}from"./notifications-81bc0416.js";import{r as g,o as i,c as v,d as l,F as T,i as H,b as e,e as t,n as o,v as $,x as b,z as B,f as q,$ as W,a4 as I,w as oe,a3 as Ae,a as se,a0 as R,am as X,a2 as ee,k as Ge,H as ze,an as we,ac as Qe}from"./index-abca3b05.js";import{V as Oe}from"./VAvatar-95b730bc.js";import{b as te,c as le,a as ye}from"./VList-43b1f8f7.js";import{V as _}from"./VCol-4428418e.js";import{V as Z}from"./VChip-b8ffeaa5.js";import{V as Q}from"./VCardText-a54eaa3c.js";import{a as Ue,f as Ke}from"./formatters-b3558c7d.js";import{u as We}from"./useQuote-47a42daf.js";import{_ as Je}from"./AppAutocomplete-6d64a744.js";import{_ as ue}from"./DialogCloseBtn-84b7f54e.js";import{u as Ye}from"./useProperty-2b18f02c.js";import{V as Y,b as de}from"./VCard-d7a5abbd.js";import{V as Fe}from"./VForm-708e1b58.js";import{V as G}from"./VRow-15b88eab.js";import{V as pe}from"./VDialog-d13bf450.js";import{V as ve}from"./VCheckbox-f5da1867.js";import{V as qe}from"./VTooltip-8013e203.js";import{V as re}from"./VTable-73f2f66e.js";import{f as fe}from"./currencyFormatter-96e3a729.js";import{V as ie}from"./VTextField-d18ef4f1.js";import{P as je}from"./vue3-perfect-scrollbar.esm-511f3703.js";import{V as Xe,a as Ze}from"./VTimelineItem-2e14b817.js";import{V as Ee}from"./VNavigationDrawer-056c10ac.js";import{_ as Ie}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as et}from"./AppDrawerHeaderSection-b4595768.js";import{V as Te,a as tt}from"./VWindowItem-e9a54a6b.js";import{V as lt,a as xe}from"./VRadioGroup-91e32486.js";import{V as at}from"./VDivider-fcfb774d.js";import{V as ot,a as it}from"./VTabs-87326f53.js";import{V as st}from"./VOverlay-ec1e7633.js";import"./useSales-64df57a7.js";import"./InvoiceAddMoney-f22b9c15.js";import"./VNodeRenderer-37743759.js";import"./helpers-61e4df1a.js";import"./form-1e6a4b7e.js";/* empty css                   */import"./VCounter-76dc9578.js";import"./VImg-e43769fd.js";import"./VField-62cbe187.js";import"./easing-9f15041e.js";import"./VInput-15d77076.js";import"./forwardRefs-8348545e.js";import"./VSelect-1990aa24.js";import"./dialog-transition-19d085b2.js";import"./VMenu-90115126.js";import"./scopeId-dbdf2b2d.js";import"./VCheckboxBtn-a6dc7aaf.js";import"./VSelectionControl-2de9ab6a.js";import"./index-9c720871.js";import"./constants-f3b5ca65.js";import"./ssrBoot-c815d6c5.js";import"./filter-2efc4ddc.js";import"./VSpacer-ab642546.js";import"./lazy-9ab93c91.js";import"./VSlideGroup-6faf34ea.js";const nt=async(D,S)=>await ne(`/opportunity/${D}/stage/${S}`,{method:"GET"}),rt=async(D,S,a)=>await ne(`/opportunity/${D}/procedure/${S}`,{method:"PATCH",body:a});function ce(){const D=g(null),S=g(!1),a=g(!1),y=g([]);return{process:D,loadingProcess:S,errorProcess:a,processes:y,allProcessesOpportunityForStage:async(V,n)=>{try{const c=await nt(V,n);y.value=c.data}catch(c){console.log(c)}},checkProcessForOpportunity:async(V,n,c)=>{try{console.log(c);const p=await rt(V,n,c);$e("¡Proceso completado exitosamente!","El proceso ha sido llevado a cabo sin inconvenientes. ")}catch(p){console.log(p)}}}}const ut={class:"my-5"},dt={key:0},pt=["src"],ct={class:"my-5"},mt={key:0,class:"d-flex flex-wrap gap-2 my-5"},yt={key:1},ft={__name:"EditDeliveryOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","complet"],setup(D,{emit:S}){const a=D,y=S,{changeStatusByOpportunity:U}=ae(),{checkProcessForOpportunity:C}=ce(),V=async()=>{try{await U(a.opportunity.id,7,{}),y("complet")}catch(c){console.error("Error updating customer:",c)}},n=async(c,p)=>{console.log(`Procedimiento ${c} marcado como: ${p?"realizado":"no realizado"}`),await C(a.opportunity.id,c,{is_check:!p}),y("updateStageId",a.opportunity.id)};return(c,p)=>(i(),v(T,null,[l("div",ut,[p[0]||(p[0]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Propiedades ",-1)),a.opportunity.sales.length>0?(i(),v("div",dt,[(i(!0),v(T,null,H(a.opportunity.sales,w=>(i(),v("div",{key:w.id},[(i(!0),v(T,null,H(w.properties,F=>(i(),v("div",{key:F.id,class:"d-flex align-center justify-between"},[e(Oe,{size:"50",rounded:""},{default:t(()=>[l("img",{src:o(ke),alt:"Logo pora",style:{"border-radius":"30%"}},null,8,pt)]),_:1}),e(_,{cols:"12",md:"7"},{default:t(()=>[e(te,{class:"font-weight-medium"},{default:t(()=>[$(b(F.project_title)+" | "+b(F.title),1)]),_:2},1024),e(le,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",null,"$ "+b(F.pivot_price),1)]),_:2},1024)]),_:2},1024)]))),128))]))),128))])):B("",!0)]),l("div",ct,[p[2]||(p[2]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),a.opportunity.procedure&&a.opportunity.procedure.length>0?(i(),v("div",mt,[(i(!0),v(T,null,H(a.opportunity.procedure,w=>(i(),v("div",{key:w.id},[e(Z,{color:w.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:F=>n(w.id,w.pivot.is_check)},{default:t(()=>[w.pivot.is_check?(i(),q(W,{key:0,icon:"tabler-check",class:"mr-2"})):B("",!0),$(" "+b(w.title),1)]),_:2},1032,["color","onClick"])]))),128))])):(i(),v("div",yt,p[1]||(p[1]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(Q,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(I,{color:"primary",size:"small",onClick:V},{default:t(()=>p[3]||(p[3]=[$(" Finalizar Oportunidad ")])),_:1})]),_:1})],64))}},Be={__name:"EditCustomerDialog",props:{isDialogVisible:{type:Boolean,required:!0},opportunityKanban:{type:Object,required:!0}},emits:["update:isDialogVisible","update:newProperty"],setup(D,{emit:S}){const a=D,y=S;Object.values(Pe).map(f=>({title:f.label,value:f.value}));const{propertiesAvailbles:U,properties:C}=Ye(),{getOpportunitybyId:V,opportunity:n,changeOpportunity:c,loadingOpportunity:p}=ae(),w=()=>{y("update:isDialogVisible",!1)},F=async()=>{console.log("antes del save:",n);const f={id:n.value.id,description:n.value.description,property_id:n.value.property_id,customer:{id:n.value.customer.id,name:n.value.customer.name,email:n.value.customer.email,ci:n.value.customer.ci,cod_phone:n.value.cod_phone,phone:n.value.customer.phone}};await c(n.value.id,f),n.value.property_id&&(console.log("Cambio y geenero el Emit Principal"),y("update:newProperty",n.value.property_id)),y("update:isDialogVisible",!1)},z=async()=>{var f;(f=a.opportunityKanban)!=null&&f.id&&await V(a.opportunityKanban.id)},x=async()=>{await U()};return oe(()=>a.isDialogVisible,async f=>{f===!0&&(z(),await x())}),(f,d)=>{const O=ue,L=ge,s=_e,m=Je,M=he;return i(),q(pe,{"max-width":"800","model-value":a.isDialogVisible,persistent:"","close-on-esc":!1,"onUpdate:modelValue":w},{default:t(()=>[e(O,{onClick:w}),e(Y,{title:"Información del Cliente y Oportunidad",class:"pa-sm-8 pa-5"},{default:t(()=>[e(Q,null,{default:t(()=>[e(Fe,{onSubmit:Ae(F,["prevent"])},{default:t(()=>[e(G,{dense:""},{default:t(()=>[e(_,{cols:"12",md:"6"},{default:t(()=>[e(L,{modelValue:o(n).customer.name,"onUpdate:modelValue":d[0]||(d[0]=P=>o(n).customer.name=P),label:"Nombre del Cliente",placeholder:"Ingresa el nombre",outlined:""},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",md:"6"},{default:t(()=>[e(L,{modelValue:o(n).customer.email,"onUpdate:modelValue":d[1]||(d[1]=P=>o(n).customer.email=P),label:"Email del Cliente",placeholder:"Ingresa el email",outlined:""},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",md:"6"},{default:t(()=>[e(G,null,{default:t(()=>[e(_,{cols:"4"},{default:t(()=>[e(s,{modelValue:o(n).customer.cod_phone,"onUpdate:modelValue":d[2]||(d[2]=P=>o(n).customer.cod_phone=P),label:"Código",items:["+591","+1","+52"],placeholder:"Cód.",outlined:""},null,8,["modelValue"])]),_:1}),e(_,{cols:"8"},{default:t(()=>[e(L,{modelValue:o(n).customer.phone,"onUpdate:modelValue":d[3]||(d[3]=P=>o(n).customer.phone=P),label:"Número de Teléfono",placeholder:"Ingresa el teléfono",outlined:"",dense:"",maxlength:"9"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(_,{cols:"12",md:"6"},{default:t(()=>[e(L,{modelValue:o(n).customer.ci,"onUpdate:modelValue":d[4]||(d[4]=P=>o(n).customer.ci=P),label:"CI del Cliente",placeholder:"Ingresa el CI",outlined:""},null,8,["modelValue"])]),_:1}),e(_,{cols:"12"},{default:t(()=>[e(m,{modelValue:o(n).property_id,"onUpdate:modelValue":d[5]||(d[5]=P=>o(n).property_id=P),label:"Departamento de Interés",placeholder:"Selecciona un Departamento",items:o(C).map(P=>({title:P.title,value:P.id})),outlined:""},null,8,["modelValue","items"])]),_:1}),e(_,{cols:"12"},{default:t(()=>[e(M,{modelValue:o(n).description,"onUpdate:modelValue":d[6]||(d[6]=P=>o(n).description=P),label:"Descripción de la Oportunidad",placeholder:"Ingresa una descripción",rows:"3","auto-grow":"",outlined:""},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",class:"text-center"},{default:t(()=>[e(I,{type:"submit",color:"primary",class:"me-3",disabled:o(p),loading:o(p)},{default:t(()=>d[7]||(d[7]=[$(" Guardar ")])),_:1},8,["disabled","loading"]),e(I,{color:"secondary",variant:"tonal",onClick:w},{default:t(()=>d[8]||(d[8]=[$(" Cancelar ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},vt={class:"d-flex align-bottom flex-sm-row flex-column"},gt={class:"user-profile-info"},_t={class:"d-flex align-center justify-center justify-sm-space-between flex-wrap gap-4"},bt={class:"d-flex align-center gap-x-3"},Vt={class:"text-4xl font-weight-medium"},wt={class:"d-flex flex-column py-2",style:{"font-size":"14px"}},xt={class:"text-sm text-disabled"},kt={key:0,class:"d-flex flex-wrap gap-2 my-5"},Pt={key:1},Dt={key:0,class:"d-flex flex-wrap gap-2 my-5"},Ct={key:1},ht={__name:"EditPreSaleOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","update:newProperty"],setup(D,{emit:S}){const a=D,y=S,{checkProcessForOpportunity:U}=ce(),{changeStatusQuotes:C}=We(),V=g(!1),n=g(!1),c=()=>{V.value=!0},p=()=>{console.log("Se escucho el evento en EditProspectOpportunity"),y("update:newProperty")},w=()=>{n.value=!0},F=async f=>{y("updateStageId",f)},z=async(f,d)=>{console.log(`Procedimiento ${f} marcado como: ${d?"realizado":"no realizado"}`),await U(a.opportunity.id,f,{is_check:!d}),y("updateStageId",a.opportunity.id)},x=async(f,d)=>{const O=d==="APPROVED"?"NOT_APPROVED":"APPROVED";console.log(`Procedimiento ${f} marcado como: ${d}`),await C(f,{status:O}),y("updateStageId",a.opportunity.id)};return(f,d)=>{const O=se("RouterLink"),L=se("IconBtn");return i(),v(T,null,[l("div",vt,[l("div",gt,[d[3]||(d[3]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Perfil ",-1)),l("div",_t,[l("div",bt,[l("span",Vt,b(("avatarText"in f?f.avatarText:o(Ue))(a.opportunity.customer.name)),1),l("div",wt,[e(O,{to:{name:"apps-ecommerce-customer-details-id",params:{id:1}},class:"font-weight-base"},{default:t(()=>[$(b(a.opportunity.customer.name),1)]),_:1}),l("span",xt,b(a.opportunity.customer.phone),1)]),e(I,{color:"secondary",variant:"tonal",size:"small",onClick:c},{default:t(()=>d[2]||(d[2]=[$(" Editar Perfil ")])),_:1})])])])]),l("div",null,[d[5]||(d[5]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),a.opportunity.procedure&&a.opportunity.procedure.length>0?(i(),v("div",kt,[(i(!0),v(T,null,H(a.opportunity.procedure,s=>(i(),v("div",{key:s.id},[e(Z,{color:s.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:m=>z(s.id,s.pivot.is_check)},{default:t(()=>[s.pivot.is_check?(i(),q(W,{key:0,icon:"tabler-check",class:"mr-2"})):B("",!0),$(" "+b(s.title),1)]),_:2},1032,["color","onClick"])]))),128))])):(i(),v("div",Pt,d[4]||(d[4]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),l("div",null,[d[9]||(d[9]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Cotizaciones ",-1)),a.opportunity.quotes&&a.opportunity.quotes.length>0?(i(),v("div",Dt,[e(re,{density:"compact",class:"text-no-wrap",style:{"font-size":"12px"}},{default:t(()=>[d[7]||(d[7]=l("thead",null,[l("tr",null,[l("th",null," Nombre "),l("th",null," Propiedad "),l("th",null," Fecha "),l("th")])],-1)),l("tbody",null,[(i(!0),v(T,null,H(a.opportunity.quotes,s=>(i(),v("tr",{key:s.id},[l("td",null,b(s.social_reason),1),l("td",null,b(s.properties[0].title),1),l("td",null,b(s.created_at),1),l("td",null,[e(G,null,{default:t(()=>[e(ve,{modelValue:s.status,"onUpdate:modelValue":m=>s.status=m,"true-value":"APPROVED","false-value":"NOT_APPROVED",onClick:m=>x(s.id,s.status)},{default:t(()=>[e(qe,{activator:"parent",location:"top"},{default:t(()=>d[6]||(d[6]=[$(" Aprobar Cotización ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","onClick"]),e(O,{to:{name:"quote-id",params:{id:s.id}}},{default:t(()=>[e(L,null,{default:t(()=>[e(W,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])]),_:2},1024)])]))),128))])]),_:1})])):(i(),v("div",Ct,d[8]||(d[8]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(Q,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(O,{to:{name:"quote-add-quote"},class:"text-white"},{default:t(()=>[e(I,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>d[10]||(d[10]=[$(" Generar Cotización ")])),_:1})]),_:1}),e(I,{color:"primary",class:"mx-auto",size:"small",onClick:w},{default:t(()=>d[11]||(d[11]=[$(" Generar Venta ")])),_:1})]),_:1}),e(Be,{"is-dialog-visible":o(V),"onUpdate:isDialogVisible":d[0]||(d[0]=s=>R(V)?V.value=s:null),"opportunity-kanban":a.opportunity,"onUpdate:newProperty":p},null,8,["is-dialog-visible","opportunity-kanban"]),e(De,{"is-dialog-visible":o(n),"onUpdate:isDialogVisible":d[1]||(d[1]=s=>R(n)?n.value=s:null),opportunity:a.opportunity,stage:"PRESALE",onRegisterSale:F},null,8,["is-dialog-visible","opportunity"])],64)}}},$t={class:"d-flex align-bottom flex-sm-row flex-column"},St={class:"user-profile-info"},At={class:"d-flex align-center justify-center justify-sm-space-between flex-wrap gap-4"},zt={class:"d-flex align-center gap-x-3"},Ot={class:"text-4xl font-weight-medium"},Ut={class:"d-flex flex-column py-2",style:{"font-size":"14px"}},Ft={class:"text-sm text-disabled"},qt={key:0,class:"d-flex flex-wrap gap-2 my-5"},jt={key:1},Et={key:0,class:"d-flex flex-wrap gap-2 my-5"},It={key:1},Tt={__name:"EditProspectOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","update:newProperty"],setup(D,{emit:S}){const a=D,y=S,{checkProcessForOpportunity:U}=ce(),{changeStatusByOpportunity:C,loadingOpportunity:V}=ae(),n=g(!1),c=()=>{n.value=!0},p=()=>{console.log("Se escucho el evento en EditProspectOpportunity"),y("update:newProperty")},w=async z=>{await C(z,Pe.PRESALE.value,{}),y("updateStageId",z)},F=async z=>{console.log(`Procedimiento ${z.id} marcado como: ${z.pivot.is_check?"realizado":"no realizado"}`),await U(a.opportunity.id,z.id,{is_check:!z.pivot.is_check}),z.pivot.is_check=!z.pivot.is_check,y("updateStageId",a.opportunity.id)};return(z,x)=>{const f=se("RouterLink"),d=se("IconBtn");return i(),v(T,null,[l("div",$t,[l("div",St,[x[3]||(x[3]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Perfil ",-1)),l("div",At,[l("div",zt,[l("span",Ot,b(("avatarText"in z?z.avatarText:o(Ue))(a.opportunity.customer.name)),1),l("div",Ut,[e(f,{to:{name:"apps-ecommerce-customer-details-id",params:{id:1}},class:"font-weight-base"},{default:t(()=>[$(b(a.opportunity.customer.name),1)]),_:1}),l("span",Ft,b(a.opportunity.customer.phone),1)]),l("div",null,[e(I,{color:"secondary",variant:"tonal",size:"small",onClick:c},{default:t(()=>x[2]||(x[2]=[$(" Editar Perfil ")])),_:1})])])])])]),l("div",null,[x[5]||(x[5]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),a.opportunity.procedure&&a.opportunity.procedure.length>0?(i(),v("div",qt,[(i(!0),v(T,null,H(a.opportunity.procedure,O=>(i(),v("div",{key:O.id},[e(Z,{color:O.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:L=>F(O)},{default:t(()=>[O.pivot.is_check?(i(),q(W,{key:0,icon:"tabler-check",class:"mr-2"})):B("",!0),$(" "+b(O.title),1)]),_:2},1032,["color","onClick"])]))),128))])):(i(),v("div",jt,x[4]||(x[4]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),l("div",null,[x[8]||(x[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Cotizaciones ",-1)),a.opportunity.quotes&&a.opportunity.quotes.length>0?(i(),v("div",Et,[e(re,{density:"compact",class:"text-no-wrap",style:{"font-size":"12px"}},{default:t(()=>[x[6]||(x[6]=l("thead",null,[l("tr",null,[l("th",null," Nombre "),l("th",null," Propiedad "),l("th",null," Fecha "),l("th")])],-1)),l("tbody",null,[(i(!0),v(T,null,H(a.opportunity.quotes,O=>(i(),v("tr",{key:O.id},[l("td",null,b(O.social_reason),1),l("td",null,b(O.properties[0].title),1),l("td",null,b(O.created_at),1),l("td",null,[e(f,{to:{name:"quote-id",params:{id:O.id}}},{default:t(()=>[e(d,null,{default:t(()=>[e(W,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])])]))),128))])]),_:1})])):(i(),v("div",It,x[7]||(x[7]=[l("span",null,"No hay cotizaciones disponibles.",-1)])))]),e(Q,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(f,{to:{name:"quote-add-quote"},class:"text-white"},{default:t(()=>[e(I,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>x[9]||(x[9]=[$(" Generar Cotización ")])),_:1})]),_:1}),e(I,{color:"primary",class:"mx-auto",size:"small",disabled:o(V),loading:o(V),onClick:x[0]||(x[0]=O=>w(a.opportunity.id))},{default:t(()=>x[10]||(x[10]=[$(" Siguiente Etapa ")])),_:1},8,["disabled","loading"])]),_:1}),e(Be,{"is-dialog-visible":o(n),"onUpdate:isDialogVisible":x[1]||(x[1]=O=>R(n)?n.value=O:null),"opportunity-kanban":a.opportunity,"onUpdate:newProperty":p},null,8,["is-dialog-visible","opportunity-kanban"])],64)}}},Bt=async D=>await ne(`/sale/paymentPlans/${D}/confirm`,{method:"PATCH"}),Nt=async(D,S)=>await ne(`/sale/paymentPlans/${D}`,{method:"PATCH",body:S});function be(){const D=g(!1),S=g([]),a=g(null),y=g(null);return{loadingPaymentPlans:D,paymentPlan:y,error:a,paymentPlans:S,confirmPaymentPlans:async V=>{try{const n=await Bt(V);$e("Actualizacion Exitosa","Se confirmo el pago")}catch(n){console.log(n)}},updatePaymentPlans:async(V,n)=>{D.value=!0,a.value=null;try{console.log(n);const c=await Nt(V,n);y.value=c.data,Me("¡Planes de pago actualizados exitosamente! ","Los planes de pago han sido modificados y guardados correctamente."),console.log(c)}catch(c){console.log(c),c.response&&c.response.status==422&&He("Advertencia","Faltan datos por Completar"),a.value=c.message}finally{D.value=!1}}}}const Rt={__name:"DeliveryForm",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(D,{emit:S}){const a=D,y=S,{changeStatusByOpportunity:U}=ae(),C=p=>{y("update:isDialogVisible",p)},V=g(structuredClone(X(a.opportunity)));oe(a,()=>{V.value=structuredClone(X(a.opportunity))});const n=async()=>{y("update:isDialogVisible",!1);try{await U(a.opportunity.id,5,{delivery_date:V.value.sales.delivery_date}),y("updateDeliveryDate",V.value.id)}catch(p){console.error("Error updating customer:",p)}},c=()=>{y("update:isDialogVisible",!1)};return(p,w)=>{const F=ue;return i(),q(pe,{"model-value":a.isDialogVisible,"max-width":"800","onUpdate:modelValue":C},{default:t(()=>[e(F,{onClick:w[0]||(w[0]=z=>p.$emit("update:isDialogVisible",!1))}),e(Y,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(de,{class:"text-h3 text-center"},{default:t(()=>w[2]||(w[2]=[$(" Confirmar Fecha ")])),_:1}),e(Q,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(G,null,{default:t(()=>[e(_,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(ie,{modelValue:o(V).sales.delivery_date,"onUpdate:modelValue":w[1]||(w[1]=z=>o(V).sales.delivery_date=z),label:"Fecha de Entrega",type:"date",rules:["requiredValidator"in p?p.requiredValidator:o(K)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),e(_,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(I,{onClick:n},{default:t(()=>w[3]||(w[3]=[$(" Pasar a Entrega ")])),_:1}),e(I,{color:"secondary",variant:"tonal",onClick:c},{default:t(()=>w[4]||(w[4]=[$(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Lt={key:0},Mt={__name:"PaymentPlanEdit",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},payment:{type:Object,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(D,{emit:S}){const a=D,y=S,{updatePaymentPlans:U}=be(),C=g(!1),V=s=>{y("update:isDialogVisible",s)},n=g(structuredClone(X(a.payment))),c=g(structuredClone(X(a.opportunity))),p=g([]);oe(a,()=>{n.value=structuredClone(X(a.payment)),c.value=structuredClone(X(a.opportunity))});const w=()=>{p.value.push({amount:"",date:"",type:n.value.type})},F=s=>{p.value.splice(s,1)},z=ee(()=>p.value.reduce((s,m)=>{const M=parseFloat(m.amount)||0;return s+M},0)),x=ee(()=>p.value.length>0&&p.value.every(s=>s.amount&&s.date&&s.type)),f=ee(()=>{if(p.value.length===0)return!0;const s=p.value.reduce((P,k)=>P+(parseFloat(k.amount)||0),0),m=parseFloat(s),M=parseFloat(n.value.amount);return m===M}),d=ee(()=>p.value.length===0?!0:x.value&&f.value),O=async()=>{if(!f.value){Se("Validación fallida","La suma de las diferencias no es correcta");return}if(!d.value){alert("Por favor, completa todos los campos obligatorios.");return}C.value=!0;try{await U(n.value.id,{date:n.value.date,differData:p.value})}catch(s){console.error("Error updating customer:",s)}finally{y("updateDeliveryDate",c.value.id),y("update:isDialogVisible",!1),p.value=[],C.value=!1}},L=()=>{y("update:isDialogVisible",!1),p.value=[],errorMessage.value=""};return(s,m)=>{const M=ue;return i(),q(pe,{"model-value":a.isDialogVisible,"max-width":"800","onUpdate:modelValue":V},{default:t(()=>[e(M,{onClick:m[0]||(m[0]=P=>s.$emit("update:isDialogVisible",!1))}),e(Y,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(de,{class:"text-h3 text-center"},{default:t(()=>m[2]||(m[2]=[$(" Editar Pago ")])),_:1}),e(Q,null,{default:t(()=>[e(G,{class:"mx-5"},{default:t(()=>[e(_,{cols:"6"},{default:t(()=>[l("h3",null," Monto a Pagar : $ "+b(o(n).amount),1)]),_:1}),e(_,{cols:"6"},{default:t(()=>[e(ie,{modelValue:o(n).date,"onUpdate:modelValue":m[1]||(m[1]=P=>o(n).date=P),label:"Cambiar Fecha",type:"date",rules:["requiredValidator"in s?s.requiredValidator:o(K)]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(Y,{flat:"",class:"d-flex flex-column pa-5 px-5"},{default:t(()=>[(i(!0),v(T,null,H(o(p),(P,k)=>(i(),v("div",{key:P.id,class:"d-flex align-center my-4"},[e(ie,{modelValue:P.amount,"onUpdate:modelValue":r=>P.amount=r,label:"Monto *",type:"number",class:"mr-4",outlined:"",rules:["requiredValidator"in s?s.requiredValidator:o(K)]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(ie,{modelValue:P.date,"onUpdate:modelValue":r=>P.date=r,label:"Fecha de Pago *",type:"date",class:"mr-3",outlined:"",rules:["requiredValidator"in s?s.requiredValidator:o(K)]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(I,{color:"error",onClick:r=>F(k)},{default:t(()=>[e(W,{icon:"tabler-square-x"})]),_:2},1032,["onClick"])]))),128)),o(p).length>0?(i(),v("div",Lt,[m[3]||(m[3]=l("strong",null,"Monto Restante:",-1)),$(" $"+b((o(n).amount-o(z)).toFixed(2)),1)])):B("",!0),e(I,{color:"primary",variant:"tonal",class:"mt-4",size:"small",onClick:w},{default:t(()=>m[4]||(m[4]=[$(" Diferir Pago ")])),_:1})]),_:1}),e(_,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(I,{loading:o(C),disabled:!o(d)||o(C),onClick:O},{default:t(()=>m[5]||(m[5]=[$(" Guardar ")])),_:1},8,["loading","disabled"]),e(I,{color:"error",variant:"tonal",onClick:L},{default:t(()=>m[6]||(m[6]=[$(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Ht={__name:"SalePaymentPlan",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},salesPayment:{type:Array,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(D,{emit:S}){const a=D,y=S;be();const U=c=>{y("update:isDialogVisible",c)},C=g(structuredClone(X(a.opportunity)));oe(a,()=>{C.value=structuredClone(X(a.opportunity)),console.log("Sales Payment:",a.salesPayment)});const V=g([]),n=()=>{y("update:isDialogVisible",!1),V.value=[]};return(c,p)=>{const w=ue;return i(),q(pe,{"model-value":a.isDialogVisible,"max-width":"800","onUpdate:modelValue":U},{default:t(()=>[e(w,{onClick:p[0]||(p[0]=F=>c.$emit("update:isDialogVisible",!1))}),e(Y,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(de,{class:"text-h3 text-center"},{default:t(()=>p[1]||(p[1]=[$(" Confirmar Fecha ")])),_:1}),e(Q,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(G,null,{default:t(()=>[e(_,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l("span",null," Monto a Pagar : "+b(o(C)),1)]),_:1})]),_:1})]),_:1}),e(_,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(I,{onClick:c.onFormSubmit},{default:t(()=>p[2]||(p[2]=[$(" Guardar ")])),_:1},8,["onClick"]),e(I,{color:"error",variant:"tonal",onClick:n},{default:t(()=>p[3]||(p[3]=[$(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Gt={class:"text-h6"},Qt={class:"text-h6"},Kt={class:"text-h6"},Wt={class:"my-5"},Jt={key:0},Yt=["src"],Xt={class:"mb-4"},Zt=["onClick"],el=["onClick"],tl={class:"my-5"},ll={key:0,class:"d-flex flex-wrap gap-2 my-5"},al={key:1},ol={__name:"EditSaleOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId"],setup(D,{emit:S}){const a=D,y=S,{checkProcessForOpportunity:U}=ce(),{confirmPaymentPlans:C}=be(),{changeStatusByOpportunity:V,loadingOpportunity:n}=ae(),c=g(!1),p=g(!1),w=g(!1),F=g(""),z=ee(()=>a.opportunity.sales.reduce((k,r)=>k+r.amount,0)),x=ee(()=>a.opportunity.sales.reduce((k,r)=>k+r.initial_fee,0)),f=ee(()=>z.value-x.value),d=()=>{w.value=!0},O=k=>{if(k.is_paid===1){Se("Advertencia","No se puede editar un pago ya realizado.");return}console.log("entro aqui"),p.value=!0,F.value={...k}},L=async k=>{y("updateStageId",k)},s=async k=>{console.log(`Procedimiento ${k.id} marcado como: ${k.pivot.is_check?"realizado":"no realizado"}`),await U(a.opportunity.id,k.id,{is_check:!k.pivot.is_check}),k.pivot.is_check=!k.pivot.is_check,y("updateStageId",a.opportunity.id)},m=async k=>{console.log(k),await C(k),y("updateStageId",a.opportunity.id)},M=async k=>{await V(k,5,{}),y("updateStageId",k)},P=async k=>{y("updateStageId",k)};return(k,r)=>(i(),v(T,null,[l("div",null,[e(Y,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(G,null,{default:t(()=>[e(_,{cols:"4",class:"border rounded-sm mx-1"},{default:t(()=>[e(te,{class:"font-weight-medium"},{default:t(()=>r[5]||(r[5]=[$(" Saldo ")])),_:1}),e(le,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Gt,b(("formatCurrency"in k?k.formatCurrency:o(fe))(o(f))),1)]),_:1})]),_:1}),e(_,{cols:"3",class:"border rounded-sm mx-1"},{default:t(()=>[e(te,{class:"font-weight-medium"},{default:t(()=>r[6]||(r[6]=[$(" Anticipo ")])),_:1}),e(le,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Qt,b(("formatCurrency"in k?k.formatCurrency:o(fe))(o(x))),1)]),_:1})]),_:1}),e(_,{cols:"4",class:"border rounded-sm mx-1"},{default:t(()=>[e(te,{class:"font-weight-medium"},{default:t(()=>r[7]||(r[7]=[$(" Precio Final ")])),_:1}),e(le,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Kt,b(("formatCurrency"in k?k.formatCurrency:o(fe))(o(z))),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),l("div",Wt,[r[8]||(r[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Propiedades ",-1)),a.opportunity.sales.length>0?(i(),v("div",Jt,[(i(!0),v(T,null,H(a.opportunity.sales,h=>(i(),v("div",{key:h.id},[(i(!0),v(T,null,H(h.properties,A=>(i(),v("div",{key:A.id,class:"d-flex align-center justify-between"},[e(Oe,{size:"50",rounded:""},{default:t(()=>[l("img",{src:o(ke),alt:"Logo pora",style:{"border-radius":"30%"}},null,8,Yt)]),_:1}),e(_,{cols:"12",md:"7"},{default:t(()=>[e(te,{class:"font-weight-medium"},{default:t(()=>[$(b(A.project_title)+" | "+b(A.title),1)]),_:2},1024),e(le,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",null,"$ "+b(A.pivot_price),1)]),_:2},1024)]),_:2},1024)]))),128))]))),128))])):B("",!0)]),l("div",Xt,[r[10]||(r[10]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Anticipo ",-1)),a.opportunity.initial_payments&&a.opportunity.initial_payments.length>0?(i(),q(re,{key:0,density:"compact",class:"text-no-wrap my-2",style:{"font-size":"12px"}},{default:t(()=>[r[9]||(r[9]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th",null," Action ")])],-1)),l("tbody",null,[(i(!0),v(T,null,H(a.opportunity.initial_payments,h=>(i(),v("tr",{key:h.id},[l("td",null,b(h.property_title),1),l("td",null,b(h.date),1),l("td",null,b(h.amount),1),l("td",null,[e(G,null,{default:t(()=>[e(ve,{modelValue:h.is_paid,"onUpdate:modelValue":A=>h.is_paid=A,"true-value":1,"false-value":0,disabled:h.is_paid===1,onChange:A=>m(h.id)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"]),h.is_paid===0?(i(),v("div",{key:0,"fill-dot":"",onClick:A=>O(h)},[e(W,{size:"25",icon:"tabler-edit"})],8,Zt)):B("",!0)]),_:2},1024)])]))),128))])]),_:1})):B("",!0)]),l("div",null,[r[13]||(r[13]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Saldos ",-1)),a.opportunity.balance_payments&&a.opportunity.balance_payments.length>0?(i(),q(re,{key:0,density:"compact",class:"text-no-wrap my-2",style:{"font-size":"12px"}},{default:t(()=>[r[12]||(r[12]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th",null," Action ")])],-1)),l("tbody",null,[(i(!0),v(T,null,H(a.opportunity.balance_payments,h=>(i(),v("tr",{key:h.id},[l("td",null,b(h.property_title),1),l("td",null,b(h.date),1),l("td",null,b(h.amount),1),l("td",null,[e(G,null,{default:t(()=>[e(ve,{modelValue:h.is_paid,"onUpdate:modelValue":A=>h.is_paid=A,"true-value":1,"false-value":0,disabled:h.is_paid===1,onChange:A=>m(h.id)},{default:t(()=>[e(qe,{activator:"parent",location:"top"},{default:t(()=>r[11]||(r[11]=[$(" Confirmar Pago ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"]),h.is_paid===0?(i(),v("div",{key:0,"fill-dot":"",onClick:A=>O(h)},[e(W,{size:"25",icon:"tabler-edit"})],8,el)):B("",!0)]),_:2},1024)])]))),128))])]),_:1})):B("",!0)]),l("div",tl,[r[15]||(r[15]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),a.opportunity.procedure&&a.opportunity.procedure.length>0?(i(),v("div",ll,[(i(!0),v(T,null,H(a.opportunity.procedure,h=>(i(),v("div",{key:h.id},[e(Z,{color:h.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:A=>s(h)},{default:t(()=>[h.pivot.is_check?(i(),q(W,{key:0,icon:"tabler-check",class:"mr-2"})):B("",!0),$(" "+b(h.title),1)]),_:2},1032,["color","onClick"])]))),128))])):(i(),v("div",al,r[14]||(r[14]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(Q,{class:"d-flex mt-4"},{default:t(()=>[e(I,{color:"primary",variant:"tonal",class:"mx-auto",size:"small",onClick:d},{default:t(()=>r[16]||(r[16]=[$(" Generar Venta ")])),_:1}),e(I,{color:"primary",class:"mx-auto",size:"small",onClick:r[0]||(r[0]=h=>M(a.opportunity.id))},{default:t(()=>r[17]||(r[17]=[$(" Siguiente Etapa ")])),_:1})]),_:1}),e(Rt,{"is-dialog-visible":o(c),"onUpdate:isDialogVisible":r[1]||(r[1]=h=>R(c)?c.value=h:null),opportunity:a.opportunity,onUpdateDeliveryDate:P},null,8,["is-dialog-visible","opportunity"]),e(Mt,{"is-dialog-visible":o(p),"onUpdate:isDialogVisible":r[2]||(r[2]=h=>R(p)?p.value=h:null),payment:o(F),opportunity:a.opportunity,onUpdateDeliveryDate:P},null,8,["is-dialog-visible","payment","opportunity"]),e(De,{"is-dialog-visible":o(w),"onUpdate:isDialogVisible":r[3]||(r[3]=h=>R(w)?w.value=h:null),opportunity:a.opportunity,stage:"SALE",onRegisterSale:L},null,8,["is-dialog-visible","opportunity"]),e(Ht,{"is-dialog-visible":k.openSaleEditPaymentPlan,"onUpdate:isDialogVisible":r[4]||(r[4]=h=>k.openSaleEditPaymentPlan=h),opportunity:a.opportunity,"sales-payment":k.salePaymentPlan,onUpdateDeliveryDate:P},null,8,["is-dialog-visible","opportunity","sales-payment"])],64))}},il=async D=>await ne(`/customer/${D}/bitacora`,{method:"GET"});function sl(){const D=g(!1),S=g([]);return Ge(),g(0),{getBitacorabyId:async y=>{try{const U=await il(y);S.value=U,console.log(U)}catch(U){console.error(U)}},loadingBitacora:D,bitacoras:ee(()=>S.value)}}const nl={class:"my-5"},rl={class:"d-flex justify-space-between align-center gap-2 flex-wrap"},ul={class:"app-timeline-title"},dl={class:"app-timeline-meta"},pl={class:"app-timeline-text"},cl={key:0,class:"empty-state my-2"},ml={__name:"BitacoraCustomer",props:{customer:{type:String,required:!0}},setup(D){const S=D,{bitacoras:a,getBitacorabyId:y}=sl();ze(async()=>{await y(S.customer)});const U=C=>{switch(C){case 1:return"Visita";case 2:return"Llamada";case 3:return"Cotización";default:return"Otro"}};return(C,V)=>(i(),v("div",null,[e(Y,{title:"Historial del cliente"},{default:t(()=>[e(Q,null,{default:t(()=>[e(G,{class:"d-flex justify-space-between"},{default:t(()=>[e(_,{cols:"12"},{default:t(()=>[l("div",nl,[e(Xe,{side:"end",align:"start","line-inset":"8","truncate-line":"both",density:"compact"},{default:t(()=>[(i(!0),v(T,null,H(o(a),n=>(i(),q(Ze,{key:n.id,size:"x-small","dot-color":"warning"},{default:t(()=>[l("div",rl,[l("span",ul,b(n.log_name),1),l("span",dl,b(("formatDate"in C?C.formatDate:o(Ke))(n.created_at)),1)]),l("div",pl,[l("p",null,b(n.description),1),n.properties.activity?(i(),q(Z,{key:0},{default:t(()=>[$(b(U(n.properties.activity.type_activity_id)),1)]),_:2},1024)):B("",!0)])]),_:2},1024))),128))]),_:1}),!o(a)||o(a).length===0?(i(),v("div",cl,V[0]||(V[0]=[l("p",null,"No hay actividades registradas para este cliente.",-1)]))):B("",!0)])]),_:1})]),_:1})]),_:1})]),_:1})]))}},yl={__name:"DrawerBitacora",props:{isDrawerOpen:{type:Boolean,required:!0},customer:{type:String,required:!1}},emits:["update:isDrawerOpen"],setup(D,{emit:S}){const a=D,y=S,U=C=>{y("update:isDrawerOpen",C)};return(C,V)=>(i(),q(Ee,{temporary:"",width:500,location:"end",class:"scrollable-content","model-value":a.isDrawerOpen,"onUpdate:modelValue":U},{default:t(()=>[e(o(je),{options:{wheelPropagation:!1}},{default:t(()=>[e(ml,{customer:"1"})]),_:1})]),_:1},8,["model-value"]))}};const fl={__name:"SellerReport",setup(D){return g([{title:"Actividad 1",date:"2024-10-09",status:"Pendiente"},{title:"Actividad 2",date:"2024-10-10",status:"Completada"},{title:"Actividad 3",date:"2024-10-11",status:"En Progreso"}]),(S,a)=>(i(),q(Q,null,{default:t(()=>a[0]||(a[0]=[l("p",null,"No hay actividades seleccionadas. Aquí tienes un resumen de las actividades:",-1)])),_:1}))}},vl=Ie(fl,[["__scopeId","data-v-c9cbe3f1"]]),gl={__name:"CustomerHistory",props:{isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","userData"],setup(D,{emit:S}){const a=D,y=S,U=g(!1),C=g(),V=g(""),n=g(""),c=g(""),p=g(""),w=g(),F=g(""),z=g(),x=g(),f=g(),d=()=>{y("update:isDrawerOpen",!1),we(()=>{var s,m;(s=C.value)==null||s.reset(),(m=C.value)==null||m.resetValidation()})},O=()=>{var s;(s=C.value)==null||s.validate().then(({valid:m})=>{m&&(y("userData",{id:0,fullName:V.value,company:p.value,role:z.value,country:w.value,contact:F.value,email:c.value,currentPlan:x.value,status:f.value,avatar:"",billing:"Auto Debit"}),y("update:isDrawerOpen",!1),we(()=>{var M,P;(M=C.value)==null||M.reset(),(P=C.value)==null||P.resetValidation()}))})},L=s=>{y("update:isDrawerOpen",s)};return(s,m)=>{const M=et,P=ge,k=_e;return i(),q(Ee,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":a.isDrawerOpen,"onUpdate:modelValue":L},{default:t(()=>[e(M,{title:"Historial del Cliente",onCancel:d}),e(o(je),{options:{wheelPropagation:!1}},{default:t(()=>[e(Y,{flat:""},{default:t(()=>[e(Q,null,{default:t(()=>[e(Fe,{ref_key:"refForm",ref:C,modelValue:o(U),"onUpdate:modelValue":m[9]||(m[9]=r=>R(U)?U.value=r:null),onSubmit:Ae(O,["prevent"])},{default:t(()=>[e(G,null,{default:t(()=>[e(_,{cols:"12"},{default:t(()=>[e(P,{modelValue:o(V),"onUpdate:modelValue":m[0]||(m[0]=r=>R(V)?V.value=r:null),rules:["requiredValidator"in s?s.requiredValidator:o(K)],label:"Full Name",placeholder:"John Doe"},null,8,["modelValue","rules"])]),_:1}),e(_,{cols:"12"},{default:t(()=>[e(P,{modelValue:o(n),"onUpdate:modelValue":m[1]||(m[1]=r=>R(n)?n.value=r:null),rules:["requiredValidator"in s?s.requiredValidator:o(K)],label:"Username",placeholder:"Johndoe"},null,8,["modelValue","rules"])]),_:1}),e(_,{cols:"12"},{default:t(()=>[e(P,{modelValue:o(c),"onUpdate:modelValue":m[2]||(m[2]=r=>R(c)?c.value=r:null),rules:["requiredValidator"in s?s.requiredValidator:o(K),"emailValidator"in s?s.emailValidator:o(Re)],label:"Email",placeholder:"johndoe@email.com"},null,8,["modelValue","rules"])]),_:1}),e(_,{cols:"12"},{default:t(()=>[e(P,{modelValue:o(p),"onUpdate:modelValue":m[3]||(m[3]=r=>R(p)?p.value=r:null),rules:["requiredValidator"in s?s.requiredValidator:o(K)],label:"Company",placeholder:"PixInvent"},null,8,["modelValue","rules"])]),_:1}),e(_,{cols:"12"},{default:t(()=>[e(k,{modelValue:o(w),"onUpdate:modelValue":m[4]||(m[4]=r=>R(w)?w.value=r:null),label:"Select Country",placeholder:"Select Country",rules:["requiredValidator"in s?s.requiredValidator:o(K)],items:["USA","UK","India","Australia"]},null,8,["modelValue","rules"])]),_:1}),e(_,{cols:"12"},{default:t(()=>[e(P,{modelValue:o(F),"onUpdate:modelValue":m[5]||(m[5]=r=>R(F)?F.value=r:null),type:"number",rules:["requiredValidator"in s?s.requiredValidator:o(K)],label:"Contact",placeholder:"+1-541-754-3010"},null,8,["modelValue","rules"])]),_:1}),e(_,{cols:"12"},{default:t(()=>[e(k,{modelValue:o(z),"onUpdate:modelValue":m[6]||(m[6]=r=>R(z)?z.value=r:null),label:"Select Role",placeholder:"Select Role",rules:["requiredValidator"in s?s.requiredValidator:o(K)],items:["Admin","Author","Editor","Maintainer","Subscriber"]},null,8,["modelValue","rules"])]),_:1}),e(_,{cols:"12"},{default:t(()=>[e(k,{modelValue:o(x),"onUpdate:modelValue":m[7]||(m[7]=r=>R(x)?x.value=r:null),label:"Select Plan",placeholder:"Select Plan",rules:["requiredValidator"in s?s.requiredValidator:o(K)],items:["Basic","Company","Enterprise","Team"]},null,8,["modelValue","rules"])]),_:1}),e(_,{cols:"12"},{default:t(()=>[e(k,{modelValue:o(f),"onUpdate:modelValue":m[8]||(m[8]=r=>R(f)?f.value=r:null),label:"Select Status",placeholder:"Select Status",rules:["requiredValidator"in s?s.requiredValidator:o(K)],items:[{title:"Active",value:"active"},{title:"Inactive",value:"inactive"},{title:"Pending",value:"pending"}]},null,8,["modelValue","rules"])]),_:1}),e(_,{cols:"12"},{default:t(()=>[e(I,{type:"submit",class:"me-3"},{default:t(()=>m[10]||(m[10]=[$(" Submit ")])),_:1}),e(I,{type:"reset",variant:"outlined",color:"secondary",onClick:d},{default:t(()=>m[11]||(m[11]=[$(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},_l={class:"d-flex justify-space-between align-center"},bl={class:"mb-2"},Vl={style:{"font-size":"14px","font-weight":"500"}},wl={style:{"font-size":"12px","font-weight":"500"}},xl={__name:"AddActivity",props:{activitiesData:{type:Object,required:!0,default:()=>({title:"",description:"",schedule_at:""})},isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","refreshActivities"],setup(D,{emit:S}){const a=D,y=S,U=g(!1);g(!1);const C=g("radio-1"),V=g(!1),n=()=>{V.value=!0},c=g({title:"",description:"",type_activity_id:null,opportunity_id:null,assigned_to:null,scheduled_at:null,status:"COMPLETED"}),{completedActivityAndRegister:p,getallTypeActivities:w,typeActivities:F,loadingActivity:z}=Ce(),{getOpportunitybyId:x,opportunity:f}=ae(),d=g(structuredClone(X(a.activitiesData))),O=A=>{console.log("esta consultando de nuevo despues de cambiar etapa "),x(A)};oe(a,()=>{d.value=structuredClone(X(a.activitiesData)),x(d.value.opportunity_id),L()});const L=async()=>{await w()},s=()=>{x(d.value.opportunity_id)},m=()=>{y("update:isDrawerOpen",!1),c.value={title:null,description:null,type_activity_id:null,scheduled_at:null,opportunity_id:null,assigned_to:null,status:"COMPLETED"},y("refreshActivities")},M=async()=>{let A="";C.value==="radio-1"?A="COMPLETED":C.value==="radio-2"&&(A="CANCELLED"),p(d.value.id,{title:c.value.title,description:c.value.description,type_activity_id:c.value.type_activity_id,scheduled_at:c.value.scheduled_at,assigned_to:f.value.user_id,property_id:f.value.property_id,opportunity_id:f.value.id,status:A}),m()},P=async()=>{Ve.fire({title:"Quieres dar de baja al cliente ?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"confirmar"}).then(A=>{A.isConfirmed&&(Ne(d.value.id),m(),Ve.fire({text:"EL cliente fue dado de baja",icon:"success"}))})},k=async()=>{y("update:isDrawerOpen",!1),y("refreshActivities")},r=()=>{console.log("Se escucho el evento en AddActivity"),y("refreshActivities")},h=A=>{const u=new Date(A),J=u.getDate(),N=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][u.getMonth()],E=u.getHours().toString().padStart(2,"0"),me=u.getMinutes().toString().padStart(2,"0");return`${J} de ${N}, ${E}:${me}`};return(A,u)=>{const J=ge,j=Le,N=he;return i(),v(T,null,[e(G,{class:"d-flex justify-space-between"},{default:t(()=>[e(_,{cols:"12"},{default:t(()=>[D.isDrawerOpen?(i(),q(Y,{key:0},{default:t(()=>[e(Q,null,{default:t(()=>[e(Te,{class:"mx-2 my-2"},{default:t(()=>[e(G,null,{default:t(()=>[e(_,{cols:"12",sm:"5"},{default:t(()=>[e(G,null,{default:t(()=>[e(_,{cols:"12"},{default:t(()=>[l("div",_l,[u[8]||(u[8]=l("span",{style:{"font-size":"18px","font-weight":"500"}}," Actividad ",-1)),e(Z,{color:"warning",onClick:n},{default:t(()=>u[7]||(u[7]=[$(" historial ")])),_:1})])]),_:1}),e(_,{cols:"12"},{default:t(()=>[l("div",bl,[l("span",Vl,b(a.activitiesData.title)+" • "+b(h(a.activitiesData.scheduled_at)),1),u[9]||(u[9]=l("br",null,null,-1)),l("span",wl,b(a.activitiesData.description)+" "+b(o(f).customer_id),1)]),e(lt,{modelValue:o(C),"onUpdate:modelValue":u[0]||(u[0]=E=>R(C)?C.value=E:null),style:{"font-size":"14px"},inline:""},{default:t(()=>[u[10]||(u[10]=l("span",{class:"my-1"}," ¿Se realizó? ",-1)),e(xe,{label:"Si",value:"radio-1",density:"compact",class:"mx-2"}),e(xe,{label:"No",value:"radio-2",class:"mx-2",density:"compact"})]),_:1},8,["modelValue"]),e(at,{class:"mt-2"})]),_:1}),e(_,{cols:"12"},{default:t(()=>[e(J,{modelValue:o(c).title,"onUpdate:modelValue":u[1]||(u[1]=E=>o(c).title=E),label:"Título de la actividad",placeholder:"..."},null,8,["modelValue"])]),_:1}),e(_,{cols:"12"},{default:t(()=>[e(_e,{modelValue:o(c).type_activity_id,"onUpdate:modelValue":u[2]||(u[2]=E=>o(c).type_activity_id=E),label:"Tipo de actividad",placeholder:"Selecciona el tipo de actividad",items:o(F).map(E=>({title:E.name,value:E.id}))},null,8,["modelValue","items"])]),_:1}),e(_,{cols:"12"},{default:t(()=>[e(j,{modelValue:o(c).scheduled_at,"onUpdate:modelValue":u[3]||(u[3]=E=>o(c).scheduled_at=E),label:"Seleccione la fecha y hora",placeholder:"Seleccione la fecha y hora",config:{enableTime:!0,dateFormat:"Y-m-d H:i"},rules:["requiredValidator"in A?A.requiredValidator:o(K)]},null,8,["modelValue","rules"])]),_:1}),e(_,{cols:"12"},{default:t(()=>[e(N,{modelValue:o(c).description,"onUpdate:modelValue":u[4]||(u[4]=E=>o(c).description=E),label:"Descripción",rows:"3",rules:["requiredValidator"in A?A.requiredValidator:o(K)]},null,8,["modelValue","rules"])]),_:1}),e(_,null,{default:t(()=>[e(I,{color:"primary",class:"mx-auto",size:"small",loading:o(z),disabled:o(z),onClick:M},{default:t(()=>u[11]||(u[11]=[$(" Crear Actividad ")])),_:1},8,["loading","disabled"]),e(I,{color:"primary",class:"mx-1",variant:"tonal",size:"small",onClick:P},{default:t(()=>u[12]||(u[12]=[$(" Dar de Baja ")])),_:1})]),_:1})]),_:1})]),_:1}),e(_,{cols:"12",sm:"7",style:{"align-items":"center"}},{default:t(()=>[e(G,{class:"mb-2"},{default:t(()=>[e(_,{cols:"6"},{default:t(()=>u[13]||(u[13]=[l("span",{style:{"font-size":"18px","font-weight":"500"}}," Etapa ",-1)])),_:1}),e(_,{cols:"12",md:"6",class:"d-flex justify-end align-center"},{default:t(()=>[e(Z,{label:"",color:"primary"},{default:t(()=>[$(b(o(f).stage.title),1)]),_:1})]),_:1})]),_:1}),o(f).stage_id===2?(i(),q(Tt,{key:0,opportunity:o(f),onUpdateStageId:O,"onUpdate:newProperty":r},null,8,["opportunity"])):B("",!0),o(f).stage_id===3?(i(),q(ht,{key:1,opportunity:o(f),onUpdateStageId:O,"onUpdate:newProperty":r},null,8,["opportunity"])):B("",!0),o(f).stage_id===4?(i(),q(ol,{key:2,opportunity:o(f),onRefreshActivities:s,onUpdateStageId:O},null,8,["opportunity"])):B("",!0),o(f).stage_id===5?(i(),q(ft,{key:3,opportunity:o(f),onRefreshActivities:s,onUpdateStageId:O,onComplet:k},null,8,["opportunity"])):B("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):(i(),q(Y,{key:1,title:"Reporte de Actividades"},{default:t(()=>[e(vl)]),_:1}))]),_:1}),e(_,{cols:"12",md:"6"},{default:t(()=>[e(gl,{"is-drawer-open":o(U),"onUpdate:isDrawerOpen":u[5]||(u[5]=E=>R(U)?U.value=E:null)},null,8,["is-drawer-open"])]),_:1})]),_:1}),e(yl,{"is-drawer-open":o(V),"onUpdate:isDrawerOpen":u[6]||(u[6]=E=>R(V)?V.value=E:null),customer:o(f).customer_id},null,8,["is-drawer-open","customer"])],64)}}};const kl={class:"mt-2 mx-3"},Pl={style:{"font-size":"14px"}},Dl={key:0,class:"no-activities-message d-flex flex-column justify-center align-center",style:{"min-block-size":"200px","text-align":"center"}},Cl=["onClick"],hl={class:"mx-2"},$l={class:"d-flex justify-content-between",style:{"font-size":"0.9em"}},Sl={__name:"list",setup(D){const S=g(""),a=g("Anteriores");g(["Todos","PORA"]),g("Todos");const{getallActivitiesByAsesorFecha:y,getallActivitiesByFechaPast:U,getallActivitiesByFechaFuture:C,activities:V,activitiesPast:n,activitiesFuture:c}=Ce(),p=g(""),w=Qe("userData").value,F=g(!0),z=g([]),x=g([]),f=g([]),d=async()=>{await y(w.id),z.value=V.value},O=async()=>{await U(w.id),x.value=n.value},L=async()=>{await C(w.id),f.value=c.value};ze(async()=>{await d(),await O(),await L(),F.value=!1});const s=g(!1),m=A=>{s.value=!0,p.value={...A}},M=async()=>{F.value=!0,await d(),await O(),await L(),F.value=!1},P=ee(()=>[{tabName:"Anteriores",icon:"tabler-calendar",actividades:x,badge:x.value.length},{tabName:"Hoy",icon:"tabler-edit",actividades:z,badge:z.value.length},{tabName:"Futuros",icon:"tabler-calendar",actividades:f,badge:f.value.length}]),k=[{type:"Visita",icon:"tabler-current-location"},{type:"Llamada",icon:"tabler-phone"},{type:"Cotizacion",icon:"tabler-cash"},{type:"Otro",icon:"tabler-table"}],r=A=>{const u=k.find(J=>J.type===A);return u?u.icon:"tabler-default"},h=A=>{const u=new Date(A),J=u.getDate(),N=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][u.getMonth()],E=u.getHours().toString().padStart(2,"0"),me=u.getMinutes().toString().padStart(2,"0");return`${J} de ${N}, ${E}:${me}`};return oe(S,A=>{const u=J=>J.filter(j=>{const N=j.name_opportunity.toLowerCase().includes(A.toLowerCase()),E=j.phone_opportunity.toLowerCase().includes(A.toLowerCase());return N||E});A.length>2?(z.value=u(V.value),x.value=u(n.value),f.value=u(c.value)):(z.value=V.value,x.value=n.value,f.value=c.value)}),(A,u)=>{const J=se("VCircularProgress");return i(),q(G,{class:"match-height",style:{display:"flex","block-size":"100vh"}},{default:t(()=>[e(_,{cols:"12",md:"4",style:{display:"flex","flex-direction":"column"}},{default:t(()=>[e(Y,{class:"flex-grow-1"},{default:t(()=>[e(de,{class:"d-flex justify-between align-center flex-wrap"},{default:t(()=>[u[5]||(u[5]=l("h4",{class:"mt-5"}," Mis Actividades ",-1)),l("div",kl,[e(ie,{modelValue:S.value,"onUpdate:modelValue":u[0]||(u[0]=j=>S.value=j),placeholder:"Buscar actividad...",class:"search-field",variant:"plain","hide-details":"",dense:"","prepend-inner-icon":"tabler-search"},null,8,["modelValue"])])]),_:1}),e(ot,{modelValue:a.value,"onUpdate:modelValue":u[1]||(u[1]=j=>a.value=j),grow:""},{default:t(()=>[(i(!0),v(T,null,H(P.value,j=>(i(),q(it,{key:j.tabName},{default:t(()=>[l("span",Pl,b(j.tabName),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),u[11]||(u[11]=l("br",null,null,-1)),e(Q,{style:{"flex-grow":"1","overflow-y":"auto"}},{default:t(()=>[F.value?(i(),q(st,{key:0,absolute:"",opacity:"0.7"},{default:t(()=>[e(J,{indeterminate:"",size:"70"})]),_:1})):B("",!0),e(Te,{modelValue:a.value,"onUpdate:modelValue":u[2]||(u[2]=j=>a.value=j),class:"disable-tab-transition",style:{"max-block-size":"500px","overflow-y":"auto"}},{default:t(()=>[(i(!0),v(T,null,H(P.value,j=>(i(),q(tt,{key:j.tabName,value:j.tabName},{default:t(()=>[j.actividades.value.length===0?(i(),v("div",Dl,[e(W,{size:"64",color:"grey",icon:"tabler-calendar-off",class:"mb-4",style:{animation:"bounce 1s infinite"}}),u[6]||(u[6]=l("div",{style:{color:"#888","font-size":"1.2em"}}," ¡No tienes actividades pendientes! ",-1)),u[7]||(u[7]=l("div",{style:{color:"#aaa","font-size":"0.9em","margin-block-start":"8px"}}," ¡Relájate y disfruta tu día! ",-1))])):(i(!0),v(T,{key:1},H(j.actividades.value,N=>(i(),v("div",{key:N.id,"fill-dot":"",class:"border mb-2 rounded-sm py-2",onClick:E=>m(N)},[e(ye,null,{default:t(()=>[e(G,null,{default:t(()=>[e(_,{cols:"12",md:"2",style:{"padding-inline-end":"0"}},{default:t(()=>[e(Z,{class:"d-flex justify-center align-center",style:{display:"inline-flex","border-radius":"4px","block-size":"36px","inline-size":"36px"}},{default:t(()=>[e(W,{size:"25",icon:"tabler-home"})]),_:1})]),_:1}),N.project_name?(i(),q(_,{key:0,cols:"12",md:"5",class:"d-flex flex-column align-start",style:{"padding-inline-start":"0"}},{default:t(()=>[e(le,{class:"text-left"},{default:t(()=>[l("strong",null,b(N.property_title),1)]),_:2},1024),e(te,{class:"font-weight-medium text-left"},{default:t(()=>[l("span",null,"$ "+b(N.price),1)]),_:2},1024)]),_:2},1024)):B("",!0),N.project_name?B("",!0):(i(),q(_,{key:1,cols:"12",md:"5"},{default:t(()=>[e(le,{class:"text-left"},{default:t(()=>u[8]||(u[8]=[l("strong",null," Departamento ",-1)])),_:1}),e(te,{class:"font-weight-medium text-left"},{default:t(()=>u[9]||(u[9]=[l("span",null,"Indefinido",-1)])),_:1})]),_:1})),e(_,{cols:"12",md:"5",class:"d-flex justify-end align-center"},{default:t(()=>[e(Z,{label:"",color:"primary",class:"ml-auto",style:{"font-size":"10px"}},{default:t(()=>[$(b(N.stage),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(ye,{class:""},{default:t(()=>[e(Z,{label:"",color:"secondary",class:"w-100 h-48"},{default:t(()=>[e(W,{size:"20",icon:r(N.type_activity)},null,8,["icon"]),l("div",hl,b(N.type_activity)+"   •   "+b(N.name_opportunity),1)]),_:2},1024)]),_:2},1024),e(ye,null,{default:t(()=>[l("div",$l,[u[10]||(u[10]=l("div",{style:{"flex-grow":"1"}}," Ver ",-1)),l("div",null,b(h(N.scheduled_at)),1)])]),_:2},1024)],8,Cl))),128))]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(_,{cols:"12",md:"8",style:{display:"flex","flex-direction":"column"}},{default:t(()=>[e(xl,{"is-drawer-open":s.value,"onUpdate:isDrawerOpen":u[3]||(u[3]=j=>s.value=j),"activities-data":p.value,class:"flex-grow-1",onRefreshActivities:M,onLoaded:u[4]||(u[4]=j=>F.value=!1)},null,8,["is-drawer-open","activities-data"])]),_:1})]),_:1})}}},Ta=Ie(Sl,[["__scopeId","data-v-9195a066"]]);export{Ta as default};
