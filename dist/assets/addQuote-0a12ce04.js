import{r as f}from"./validators-dea6e3a5.js";import{_ as j}from"./AppAutocomplete-76a83529.js";import{f as K}from"./currencyFormatter-92ad4b3c.js";import{_ as L}from"./AppTextarea-d2631f7a.js";import{_ as O}from"./AppSelect-fc9f5ce3.js";import{_ as S}from"./AppTextField-573dfa9e.js";import{_ as G}from"./AppDateTimePicker-52e64e4d.js";import{P as v,a as H,_ as W}from"./InvoiceAddMoney-ed340ee5.js";import{V as N}from"./VNodeRenderer-6ba12db2.js";import{r as h,w as F,H as B,o as k,f as U,e as r,d as c,c as $,F as J,i as X,b as l,n,x as D,v as E,z as Z,a4 as R,$ as ee,I as M,a0 as le,a2 as C}from"./index-68e95a2c.js";import{u as ae}from"./useProperty-ae870a3a.js";import{V as A}from"./VRow-d4af8073.js";import{V as u}from"./VCol-d048d19b.js";import{V as I}from"./VCard-256cd9e2.js";import{V as w}from"./VCardText-9cedea5a.js";import{V as z}from"./VDivider-b944e9f8.js";import{u as oe}from"./useCustomer-342e7b75.js";import{u as te}from"./useQuote-d7626bff.js";import{c as Y}from"./notifications-81bc0416.js";import"./helpers-61e4df1a.js";import"./form-fba70313.js";import"./VSelect-3e6b0d8d.js";import"./VTextField-f4b3009a.js";/* empty css                   */import"./VCounter-5a821690.js";import"./VImg-7128b667.js";import"./VField-b22b7733.js";import"./easing-9f15041e.js";import"./VInput-e17576be.js";import"./forwardRefs-8348545e.js";import"./VList-09b889bd.js";import"./ssrBoot-dd1e392d.js";import"./VAvatar-d35978d1.js";import"./dialog-transition-1a825243.js";import"./VMenu-4ce195c3.js";import"./VOverlay-fce03585.js";import"./lazy-9285f4e4.js";import"./scopeId-a32a1a23.js";import"./VCheckboxBtn-ff516c3e.js";import"./VSelectionControl-49b6a718.js";import"./VChip-b5342e29.js";import"./filter-4fea19c5.js";import"./api-8916a5a9.js";import"./index-9c720871.js";import"./constants-ca8ca994.js";const ie={class:"pa-5 flex-grow-1"},re={key:0,style:{"font-size":"small","padding-block":""}},ne={class:"d-flex justify-end mt-3"},de={__name:"InvoiceAddProperty",props:{properties:{type:Array,required:!0}},emits:["removeProduct","totalAmount","addProperty"],setup(x,{emit:q}){const t=x,P=q,{propertiesForType:y}=ae(),i=h([]),V=h([]),g=()=>{const e={property_id:null,price:null,property_type:v.PARK.value,property_type_name:v.PARK.label};P("addProperty",e)},T=e=>{P("removeProduct",e)},d=e=>{if(console.log("entra a update price"),e.property_type===v.DEPARTAMENT.value){const p=V.value.find(m=>m.id===e.property_id);p&&(e.price=p.base_price)}else if(e.property_type===v.PARK.value){const p=i.value.find(m=>m.id===e.property_id);p&&(e.price=p.base_price)}};return F(()=>t.properties.map(e=>e.property_id),(e,p)=>{e.forEach((m,_)=>{const o=t.properties[_];m!==p[_]&&d(o)})}),B(async()=>{try{const e=await y(v.DEPARTAMENT.value);V.value=e;const p=await y(v.PARK.value);i.value=p}catch(e){console.error("Error al obtener las propiedades:",e)}}),(e,p)=>{const m=j,_=S;return k(),U(I,{flat:"",border:"",class:"d-flex flex-row"},{default:r(()=>[c("div",ie,[(k(!0),$(J,null,X(t.properties,(o,a)=>(k(),U(A,{key:a,class:"mb-4"},{default:r(()=>[l(u,{cols:"12",sm:"4",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(m,{modelValue:o.property_id,"onUpdate:modelValue":s=>o.property_id=s,rules:["requiredValidator"in e?e.requiredValidator:n(f)],label:o.property_type_name,placeholder:"Selecciona una propiedad",items:o.property_type===n(v).DEPARTAMENT.value?n(V):n(i),"item-title":"title","item-value":"id",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules","label","items"]),o.property_id&&o.property_type===n(v).DEPARTAMENT.value?(k(),$("span",re,[c("strong",null,D(n(V)[o.property_id-1].departament.isfacade===1?"En fachada":"Orientacion sur")+", ",1),E(" "+D(n(V)[o.property_id-1].surface)+" ",1),p[0]||(p[0]=c("strong",null," m2",-1)),p[1]||(p[1]=c("br",null,null,-1)),E(" "+D(n(V)[o.property_id-1].departament.number_bedrooms)+" Dormitorio(s), ",1)])):Z("",!0)]),_:2},1024),l(u,{cols:"12",sm:"2",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(_,{modelValue:o.price,"onUpdate:modelValue":s=>o.price=s,rules:["requiredValidator"in e?e.requiredValidator:n(f)],label:"Precio *",placeholder:"$us",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),l(u,{cols:"12",sm:"2",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(_,{modelValue:o.price_it,"onUpdate:modelValue":s=>o.price_it=s,rules:["requiredValidator"in e?e.requiredValidator:n(f)],label:"3% (IT) *",placeholder:"%",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(_,{modelValue:o.price_contrato,"onUpdate:modelValue":s=>o.price_contrato=s,rules:["requiredValidator"in e?e.requiredValidator:n(f)],label:"Precio Contrato *",placeholder:"Escribe el precio",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),l(u,{cols:"12",sm:"1",class:"my-4"},{default:r(()=>[l(R,{color:"error",size:"small",onClick:s=>T(a)},{default:r(()=>[l(ee,{icon:"tabler-square-x"})]),_:2},1032,["onClick"])]),_:2},1024),l(u,{cols:"12",style:{"font-size":"small","padding-block":"0","padding-inline":"4px"}})]),_:2},1024))),128)),c("div",ne,[l(R,{color:"secondary",onClick:g},{default:r(()=>p[2]||(p[2]=[E(" Agregar Parqueo ")])),_:1})])])]),_:1})}}},se={class:"d-flex align-center justify-sm-end mx-2"},ue={style:{"inline-size":"9.5rem"}},pe={class:"d-flex align-center justify-sm-end"},me={style:{"inline-size":"9.5rem"}},ce={class:"text-center my-4"},fe={__name:"AddQuoteInvoice",props:{data:{type:null,required:!0}},emits:["push","remove"],setup(x,{emit:q}){const t=x,P=q,y=d=>{P("push",d)},i=d=>{P("remove",d)},V=["30","50","80","100"],g=h("30"),T=d=>(t.data.initial_fee=d*g.value/100,t.data.percentage_initial_fee=g.value,t.data.balance=d-t.data.initial_fee,d*g.value/100);return(d,e)=>{const p=G,m=S,_=O,o=L;return k(),U(I,null,{default:r(()=>[l(w,{class:"d-flex flex-wrap justify-space-between gap-y-5 flex-column flex-sm-row align-center"},{default:r(()=>[l(n(N),{nodes:n(M).app.logo,class:"me-3",style:{"align-self":"center"}},null,8,["nodes"]),e[12]||(e[12]=c("h4",{class:"font-weight-bold text-h3 d-flex align-center"}," Formulario de Cotizacion ",-1)),l(n(N),{nodes:n(M).app.logopora,class:"me-3",style:{"align-self":"center"}},null,8,["nodes"])]),_:1}),l(n(A),{class:"justify-end ma-sm-2"},{default:r(()=>[c("div",se,[e[13]||(e[13]=c("span",{style:{"inline-size":"6rem"}},"Emisión ",-1)),c("span",ue,[l(p,{modelValue:t.data.creation_date,"onUpdate:modelValue":e[0]||(e[0]=a=>t.data.creation_date=a),rules:["requiredValidator"in d?d.requiredValidator:n(f)],density:"compact",placeholder:"YYYY-MM-DD",config:{position:"auto right"}},null,8,["modelValue","rules"])])]),c("div",pe,[e[14]||(e[14]=c("span",{class:"mx-2"},"Válido ",-1)),c("span",me,[l(p,{modelValue:t.data.expiration_date,"onUpdate:modelValue":e[1]||(e[1]=a=>t.data.expiration_date=a),rules:["requiredValidator"in d?d.requiredValidator:n(f)],density:"compact",placeholder:"YYYY-MM-DD",config:{position:"auto right"}},null,8,["modelValue","rules"])])])]),_:1}),l(z,{thickness:"12"}),l(w,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row gap-y-5 gap-4"},{default:r(()=>[l(n(A),null,{default:r(()=>[l(u,{cols:"12",sm:"8",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(m,{modelValue:t.data.social_reason,"onUpdate:modelValue":e[2]||(e[2]=a=>t.data.social_reason=a),rules:["requiredValidator"in d?d.requiredValidator:n(f)],label:"Cliente *",placeholder:"Canzza",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",sm:"4",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(m,{modelValue:t.data.nit,"onUpdate:modelValue":e[3]||(e[3]=a=>t.data.nit=a),rules:["requiredValidator"in d?d.requiredValidator:n(f)],label:"C.I./NIT *",placeholder:"0000000",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(m,{modelValue:t.data.workplace,"onUpdate:modelValue":e[4]||(e[4]=a=>t.data.workplace=a),label:"Lugar de Trabajo",placeholder:"Placeholder Text",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(m,{modelValue:t.data.email,"onUpdate:modelValue":e[5]||(e[5]=a=>t.data.email=a),rules:["requiredValidator"in d?d.requiredValidator:n(f)],label:"Correo *",placeholder:"email@gmail.com",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(m,{modelValue:t.data.address,"onUpdate:modelValue":e[6]||(e[6]=a=>t.data.address=a),label:"Dirección",placeholder:"Av/ Equipetrol ....",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(m,{modelValue:t.data.phone,"onUpdate:modelValue":e[7]||(e[7]=a=>t.data.phone=a),rules:["requiredValidator"in d?d.requiredValidator:n(f)],label:"Celular *",placeholder:"77049267",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),l(z,{thickness:"12"}),l(w,{class:"add-products-form"},{default:r(()=>[l(n(A),null,{default:r(()=>[l(u,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"},class:"mb-2"},{default:r(()=>[l(de,{properties:t.data.properties,onAddProperty:y,onRemoveProduct:i},null,8,["properties"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(_,{modelValue:t.data.payment_method,"onUpdate:modelValue":e[8]||(e[8]=a=>t.data.payment_method=a),rules:["requiredValidator"in d?d.requiredValidator:n(f)],label:"Tipo de Pago *",placeholder:"Seleccione ",items:Object.values(n(H)),class:"custom-salesforce-input"},null,8,["modelValue","rules","items"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(m,{modelValue:t.data.amount,"onUpdate:modelValue":e[9]||(e[9]=a=>t.data.amount=a),value:t.data.amount,rules:["requiredValidator"in d?d.requiredValidator:n(f)],label:"Total *",placeholder:"1000.000,00",outlined:"",dense:""},null,8,["modelValue","value","rules"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(_,{modelValue:n(g),"onUpdate:modelValue":e[10]||(e[10]=a=>le(g)?g.value=a:null),items:V,label:"Anticipo: %",placeholder:"% Anticipo",class:"mb-2"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[c("div",ce,[e[15]||(e[15]=c("h4",null," Saldo por pagar: ",-1)),c("span",null,D(("formatCurrency"in d?d.formatCurrency:n(K))(t.data.amount-t.data.initial_fee)),1)])]),_:1})]),_:1})]),_:1}),l(w,{class:"add-products-form"},{default:r(()=>[l(n(A),null,{default:r(()=>[l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(W,{title:" Anticipo ",amount:T(t.data.amount),differs:t.data.differs_initial_fee,type:d.INITIAL_PAYMENT},null,8,["amount","differs","type"])]),_:1}),l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(o,{modelValue:t.data.observations,"onUpdate:modelValue":e[11]||(e[11]=a=>t.data.observations=a),"auto-grow":"",label:"Observaciones del Cliente",rows:"3",placeholder:"Descripción...","row-height":"20"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}}},rl={__name:"addQuote",setup(x){const{generateQuote:q}=te(),{allCustomerPaginate:t,customers:P}=oe(),y=h(!1),i=h({social_reason:"",nit:"",address:"",email:"",phone:"",landline:"",workplace:"",expiration_date:null,creation_date:new Date().toISOString().split("T")[0],observations:"",payment_method:null,amount:null,initial_fee:null,percentage_initial_fee:null,balance:null,opportunity_id:null,customer_id:null,properties:[{property_id:null,price:null,price_it:null,price_contrato:null,property_type:v.DEPARTAMENT.value,property_type_name:v.DEPARTAMENT.label}],differs_initial_fee:[],differs_balance:[]}),V=C(()=>i.value.social_reason&&i.value.nit&&i.value.email&&i.value.phone&&i.value.amount&&i.value.creation_date&&i.value.expiration_date&&i.value.payment_method&&i.value.customer_id),g=C(()=>i.value.properties.every(o=>o.property_id!==null&&o.price!==null&&o.price_it!==null&&o.price_contrato!==null)),T=C(()=>i.value.differs_initial_fee.length===0?!0:i.value.differs_initial_fee.every(o=>o.amount!==null)),d=C(()=>{if(i.value.differs_initial_fee.length===0)return!0;const o=i.value.differs_initial_fee.reduce((b,Q)=>b+(Q.amount||0),0),a=parseFloat(o),s=parseFloat(i.value.initial_fee);return a===s}),e=C(()=>V.value&&g.value&&T.value),p=o=>{i.value.properties.push(o)},m=o=>{i.value.properties.splice(o,1)},_=async()=>{if(!e.value){Y("Validación fallida","Completa todos los campos obligatorios.");return}if(!d.value){Y("Validación fallida","La suma de las diferencias del anticipo no son correctas");return}y.value=!0;try{console.log(i),await q(i.value)}catch(o){console.error("Error generando la venta:",o)}finally{y.value=!1}};return B(async()=>{await t({page:1,itemsPerPage:100})}),F(()=>i.value.properties,o=>{let a=0;o.forEach(s=>{if(s.price){const b=parseFloat(s.price)||0;s.price_it=b*.03,s.price_contrato=b+s.price_it,a+=s.price_contrato}else s.price_it=null}),i.value.amount=a},{deep:!0}),F(()=>i.value.customer_id,o=>{const a=P.value.find(s=>s.id==o);a&&(i.value.social_reason=a.name,i.value.email=a.email,i.value.phone=a.phone,i.value.nit=a.ci,i.value.opportunity_id=a.opportunity_id,a.property_id!==null&&(i.value.properties[0].property_id=a.property_id)),i.value.customer_id=o}),(o,a)=>{const s=j;return k(),U(A,null,{default:r(()=>[l(u,{cols:"12",md:"9"},{default:r(()=>[l(fe,{data:n(i),onPush:p,onRemove:m},null,8,["data"])]),_:1}),l(u,{cols:"12",md:"3"},{default:r(()=>[l(I,{class:"mb-8"},{default:r(()=>[l(u,{cols:"12"},{default:r(()=>[l(s,{modelValue:n(i).customer_id,"onUpdate:modelValue":a[0]||(a[0]=b=>n(i).customer_id=b),rules:["requiredValidator"in o?o.requiredValidator:n(f)],label:"Clientes",placeholder:"Selecciona un Cliente",items:n(P).map(b=>({title:b.name,value:b.id})),outlined:""},null,8,["modelValue","rules","items"])]),_:1}),l(w,null,{default:r(()=>[l(R,{loading:n(y),disabled:!n(e)||n(y),class:"mb-2",onClick:_},{default:r(()=>a[1]||(a[1]=[E(" Guardar Cotización ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})}}};export{rl as default};
