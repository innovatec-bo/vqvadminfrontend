import{_ as P}from"./AppTextarea-9318e309.js";import{_ as j}from"./AppAutocomplete-9ad86c49.js";import{_ as R}from"./AppSelect-ccf756d5.js";import{_ as q}from"./AppTextField-6f740df4.js";import{_ as K}from"./DialogCloseBtn-795d7e2c.js";import{w as T,o as _,f as w,e as a,b as t,a3 as G,n as o,a4 as B,v as h,r as v,k as H,a2 as L,H as M,c as C,d as f,F as J,i as Q,x as g,z as O}from"./index-a54c57b2.js";import{S as W,u as X}from"./usePaymentPlans-1962d9fe.js";import{u as Y}from"./useProperty-822d3234.js";import{V as U}from"./VCard-b8ab7ef2.js";import{V as k}from"./VCardText-974f1364.js";import{V as Z}from"./VForm-46f40c9a.js";import{V as D}from"./VRow-db7839b8.js";import{V as r}from"./VCol-e110b22d.js";import{V as ee}from"./VDialog-b5a48363.js";import{f as te}from"./formatters-58bf909e.js";import{$ as ae}from"./api-f4900d91.js";import{V as oe,a as le}from"./VTimelineItem-332d6f25.js";import{V as ie}from"./VChip-5a84b8f9.js";const $e={__name:"EditCustomerDialog",props:{isDialogVisible:{type:Boolean,required:!0},opportunityKanban:{type:Object,required:!0}},emits:["update:isDialogVisible","update:newProperty","refreshCustomer"],setup(p,{emit:c}){const d=p,u=c;Object.values(W).map(s=>({title:s.label,value:s.value}));const{propertiesAvailbles:m,properties:n}=Y(),{getOpportunitybyId:y,opportunity:e,changeOpportunity:$,loadingOpportunity:x}=X(),b=()=>{u("update:isDialogVisible",!1)},A=async()=>{console.log("antes del save:",e);const s={id:e.value.id,description:e.value.description,property_id:e.value.property_id,customer:{id:e.value.customer.id,name:e.value.customer.name,email:e.value.customer.email,ci:e.value.customer.ci,cod_phone:e.value.customer.cod_phone.replace(/\+/g,""),phone:e.value.customer.phone,type_customer:e.value.customer.type_customer}};console.log("data de editar",s),await $(e.value.id,s),e.value.property_id&&(console.log("Cambio y geenero el Emit Principal"),u("update:newProperty",e.value.property_id)),u("update:isDialogVisible",!1),u("refreshCustomer")},N=async()=>{var s;(s=d.opportunityKanban)!=null&&s.id&&await y(d.opportunityKanban.id)},S=async()=>{await m()};return T(()=>d.isDialogVisible,async s=>{s===!0&&(N(),await S())}),(s,l)=>{const E=K,V=q,I=R,z=j,F=P;return _(),w(ee,{"max-width":"800","model-value":d.isDialogVisible,persistent:"","close-on-esc":!1,"onUpdate:modelValue":b},{default:a(()=>[t(E,{onClick:b}),t(U,{title:"Información del Cliente y Oportunidad",class:"pa-sm-8 pa-5"},{default:a(()=>[t(k,null,{default:a(()=>[t(Z,{onSubmit:G(A,["prevent"])},{default:a(()=>[t(D,{dense:""},{default:a(()=>[t(r,{cols:"12",md:"6"},{default:a(()=>[t(V,{modelValue:o(e).customer.name,"onUpdate:modelValue":l[0]||(l[0]=i=>o(e).customer.name=i),label:"Nombre del Cliente",placeholder:"Ingresa el nombre",outlined:""},null,8,["modelValue"])]),_:1}),t(r,{cols:"12",md:"6"},{default:a(()=>[t(V,{modelValue:o(e).customer.email,"onUpdate:modelValue":l[1]||(l[1]=i=>o(e).customer.email=i),label:"Email del Cliente",placeholder:"Ingresa el email",outlined:""},null,8,["modelValue"])]),_:1}),t(r,{cols:"12",md:"6"},{default:a(()=>[t(D,null,{default:a(()=>[t(r,{cols:"4"},{default:a(()=>[t(I,{modelValue:o(e).customer.cod_phone,"onUpdate:modelValue":l[2]||(l[2]=i=>o(e).customer.cod_phone=i),label:"Código",items:["+1","+52","+55","+54","+49","+33","+34","+39","+86","+81","+7","+591"],placeholder:"Cód.",outlined:""},null,8,["modelValue"])]),_:1}),t(r,{cols:"8"},{default:a(()=>[t(V,{modelValue:o(e).customer.phone,"onUpdate:modelValue":l[3]||(l[3]=i=>o(e).customer.phone=i),label:"Número de Teléfono",placeholder:"Ingresa el teléfono",outlined:"",dense:"",maxlength:"9"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(r,{cols:"12",md:"6"},{default:a(()=>[t(V,{modelValue:o(e).customer.ci,"onUpdate:modelValue":l[4]||(l[4]=i=>o(e).customer.ci=i),label:"CI del Cliente",placeholder:"Ingresa el CI",outlined:""},null,8,["modelValue"])]),_:1}),t(r,{cols:"6"},{default:a(()=>[t(z,{modelValue:o(e).property_id,"onUpdate:modelValue":l[5]||(l[5]=i=>o(e).property_id=i),label:"Departamento de Interés",placeholder:"Selecciona un Departamento",items:o(n).map(i=>({title:i.title,value:i.id})),outlined:""},null,8,["modelValue","items"])]),_:1}),t(r,{cols:"6"},{default:a(()=>[t(I,{modelValue:o(e).customer.type_customer,"onUpdate:modelValue":l[6]||(l[6]=i=>o(e).customer.type_customer=i),label:"Tipo de Cliente",items:["Olvidadizo","Familiar","Decidido","Indeciso","Exigente","Referido","Inversionista","Recuperado","Curioso"],placeholder:"Tipo de Cliente",outlined:""},null,8,["modelValue"])]),_:1}),t(r,{cols:"12"},{default:a(()=>[t(F,{modelValue:o(e).description,"onUpdate:modelValue":l[7]||(l[7]=i=>o(e).description=i),label:"Descripción de la Oportunidad",placeholder:"Ingresa una descripción",rows:"3","auto-grow":"",outlined:""},null,8,["modelValue"])]),_:1}),t(r,{cols:"12",class:"text-center"},{default:a(()=>[t(B,{type:"submit",color:"primary",class:"me-3",disabled:o(x),loading:o(x)},{default:a(()=>l[8]||(l[8]=[h(" Guardar ")])),_:1},8,["disabled","loading"]),t(B,{color:"secondary",variant:"tonal",onClick:b},{default:a(()=>l[9]||(l[9]=[h(" Cancelar ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},se=async p=>await ae(`/customer/${p}/bitacora`,{method:"GET"});function re(){const p=v(!1),c=v([]);return H(),v(0),{getBitacorabyId:async u=>{try{const m=await se(u);c.value=m,console.log(m)}catch(m){console.error(m)}},loadingBitacora:p,bitacoras:L(()=>c.value)}}const ne={class:"my-5"},de={class:"d-flex justify-space-between align-center gap-2 flex-wrap"},ue={class:"app-timeline-title"},me={class:"app-timeline-meta"},pe={class:"app-timeline-text"},ce={key:0,class:"empty-state my-2"},Ae={__name:"BitacoraCustomer",props:{customer:{type:String,required:!0}},setup(p){const c=p,{bitacoras:d,getBitacorabyId:u}=re();M(async()=>{await u(c.customer)}),T(()=>c.customer,async(n,y)=>{n&&(console.log("Customer actualizado:",n),await u(n))},{immediate:!0});const m=n=>{switch(n){case 1:return"Visita";case 2:return"Llamada";case 3:return"Cotización";default:return"Otro"}};return(n,y)=>(_(),C("div",null,[t(U,{title:"Historial del cliente"},{default:a(()=>[t(k,null,{default:a(()=>[t(D,{class:"d-flex justify-space-between"},{default:a(()=>[t(r,{cols:"12"},{default:a(()=>[f("div",ne,[t(oe,{side:"end",align:"start","line-inset":"8","truncate-line":"both",density:"compact"},{default:a(()=>[(_(!0),C(J,null,Q(o(d),e=>(_(),w(le,{key:e.id,size:"x-small","dot-color":"warning"},{default:a(()=>[f("div",de,[f("span",ue,g(e.log_name),1),f("span",me,g(("formatDate"in n?n.formatDate:o(te))(e.created_at)),1)]),f("div",pe,[f("p",null,g(e.description),1),e.properties.activity?(_(),w(ie,{key:0},{default:a(()=>[h(g(m(e.properties.activity.type_activity_id)),1)]),_:2},1024)):O("",!0)])]),_:2},1024))),128))]),_:1}),!o(d)||o(d).length===0?(_(),C("div",ce,y[0]||(y[0]=[f("p",null,"No hay actividades registradas para este cliente.",-1)]))):O("",!0)])]),_:1})]),_:1})]),_:1})]),_:1})]))}};export{$e as _,Ae as a};
