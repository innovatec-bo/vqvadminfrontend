import{a as D,b as J}from"./formatters-b3558c7d.js";import{P as N}from"./vue3-perfect-scrollbar.esm-511f3703.js";import{ac as E,av as K,a as P,n as a,o as h,c as C,d as t,b as o,e as f,$ as g,y,x as b,F as $,z as w,a2 as B,f as k,cK as H,a0 as j,i as U,K as Q,L as X,r as V,H as Y,v as R,a4 as Z}from"./index-abca3b05.js";import{V as I}from"./VAvatar-95b730bc.js";import{V as A}from"./VBadge-4390cd2e.js";import{V as z}from"./VImg-e43769fd.js";import{V as G}from"./VTextField-d18ef4f1.js";import{V as tt}from"./VDivider-fcfb774d.js";import{_ as et}from"./AppTextarea-9c4030e7.js";import{$ as st,a as S}from"./api-ebe57097.js";import{u as W}from"./useApi-42eb6d09.js";import{c as L}from"./createUrl-1986e398.js";import{V as at,a as ot}from"./VRadioGroup-91e32486.js";const F=E("userData").value,M=F.cod_phone+F.phone,T=K("chat",{state:()=>({contacts:[],chatsContacts:[],profileUser:void 0,activeChat:null,isAuthenticated:!1}),actions:{async fetchChats(){const{data:c}=await W(L(`/whatssap/chats/${M}`)),s=c.value;this.chatsContacts=s.chats,this.profileUser={id:M},console.log("Chats:",this.chatsContacts)},async getChat(c){console.log(c);const{data:s}=await W(L(`/whatssap/chat/${M}/${c.user}@c.us`)),n=s.value;this.activeChat=n||null},async sendMsg(c){var m,l,r,p,x;const s=(m=this.profileUser)==null?void 0:m.id,n=(r=(l=this.activeChat)==null?void 0:l.contact)==null?void 0:r.id,u=await st("/whatssap/send-message",{method:"POST",body:{message:c,to:n,clientId:s}}),{msg:e,chat:v}=u;if(v!==void 0){const d=this.activeChat;this.chatsContacts.push({...d.contact,chat:{id:v.id,lastMessage:[],unseenMsgs:0,messages:[e]}}),this.activeChat&&(this.activeChat.chat={id:v.id,messages:[e],unseenMsgs:0,userId:n})}else(x=(p=this.activeChat)==null?void 0:p.chat)==null||x.messages.push(e);const i=this.chatsContacts.find(d=>this.activeChat?d.id===this.activeChat.contact.id:!1);i.chat.lastMessage=e},async verifyAuthentication(c){}}}),O=()=>({resolveAvatarBadgeVariant:s=>s==="online"?"success":s==="busy"?"error":s==="away"?"warning":"secondary"}),nt={class:"text-center px-6"},lt={class:"text-3xl"},it={class:"text-h5"},rt={class:"mb-8"},ct={class:"d-flex align-center"},dt={class:"d-flex align-center my-3"},ut={class:"d-flex align-center"},ht={class:"d-flex align-center"},mt={class:"d-flex align-center my-3"},pt={class:"d-flex align-center mb-3"},ft={class:"d-flex align-center mb-3"},vt={class:"d-flex align-center"},ae={__name:"ChatActiveChatUserProfileSidebarContent",emits:["close"],setup(c,{emit:s}){const n=T();return(u,e)=>{const v=P("IconBtn");return a(n).activeChat?(h(),C($,{key:0},[t("div",{class:y(["pt-2 me-2",u.$vuetify.locale.isRtl?"text-left":"text-right"])},[o(v,{onClick:e[0]||(e[0]=i=>u.$emit("close"))},{default:f(()=>[o(g,{icon:"tabler-x",color:"disabled",class:"text-medium-emphasis"})]),_:1})],2),t("div",nt,[o(A,{location:"bottom right","offset-x":"7","offset-y":"4",bordered:"",color:u.success,class:"chat-user-profile-badge mb-5"},{default:f(()=>[o(I,{size:"80",variant:u.tonal,color:u.success},{default:f(()=>[t("span",lt,b(("avatarText"in u?u.avatarText:a(D))(a(n).activeChat.name)),1)]),_:1},8,["variant","color"])]),_:1},8,["color"]),t("h5",it,b(a(n).activeChat.name),1),e[1]||(e[1]=t("p",{class:"text-capitalize text-medium-emphasis"}," Cliente ",-1))]),o(a(N),{class:"ps-chat-user-profile-sidebar-content text-medium-emphasis pb-5 px-5",options:{wheelPropagation:!1}},{default:f(()=>[e[12]||(e[12]=t("div",{class:"my-8"},[t("span",{class:"text-sm text-disabled"},"ABOUT"),t("p",{class:"mt-2"}," about: ")],-1)),t("div",rt,[e[5]||(e[5]=t("span",{class:"d-block text-sm text-disabled mb-3"},"PERSONAL INFORMATION",-1)),t("div",ct,[o(g,{class:"me-2",icon:"tabler-mail",size:"24"}),e[2]||(e[2]=t("span",null,"lucifer@email.com",-1))]),t("div",dt,[o(g,{class:"me-2",icon:"tabler-phone-call",size:"24"}),e[3]||(e[3]=t("span",null,"+1(123) 456 - 7890",-1))]),t("div",ut,[o(g,{class:"me-2",icon:"tabler-clock",size:"24"}),e[4]||(e[4]=t("span",null,"Mon - Fri 10AM - 8PM",-1))])]),t("div",null,[e[11]||(e[11]=t("span",{class:"d-block text-sm text-disabled mb-3"},"OPTIONS",-1)),t("div",ht,[o(g,{class:"me-2",icon:"tabler-badge",size:"24"}),e[6]||(e[6]=t("span",null,"Add Tag",-1))]),t("div",mt,[o(g,{class:"me-2",icon:"tabler-star",size:"24"}),e[7]||(e[7]=t("span",null,"Important Contact",-1))]),t("div",pt,[o(g,{class:"me-2",icon:"tabler-photo",size:"24"}),e[8]||(e[8]=t("span",null,"Shared Media",-1))]),t("div",ft,[o(g,{class:"me-2",icon:"tabler-trash",size:"24"}),e[9]||(e[9]=t("span",null,"Delete Contact",-1))]),t("div",vt,[o(g,{class:"me-2 ms-1",size:"18",icon:"tabler-ban"}),e[10]||(e[10]=t("span",null,"Block Contact",-1))])])]),_:1})],64)):w("",!0)}}};const gt={key:1},Ct={class:"flex-grow-1 ms-4 overflow-hidden"},bt={class:"text-h6 mb-0"},xt={class:"mb-0 text-truncate text-disabled"},_t={key:0,class:"d-flex flex-column align-self-start"},yt={class:"d-block text-sm text-disabled whitespace-no-wrap"},$t={__name:"ChatContact",props:{isChatContact:{type:Boolean,required:!1,default:!1},user:{type:null,required:!0}},setup(c){const s=c,n=T(),{resolveAvatarBadgeVariant:u}=O(),e=B(()=>s.user!==null?s.user:null),v=B(()=>{var m,l;const i=((m=n.activeChat)==null?void 0:m.user)===s.user.id;return(s.isChatContact||!((l=n.activeChat)!=null&&l.chat))&&i});return(i,m)=>(h(),C("li",{key:a(n).chatsContacts.length,class:y(["chat-contact cursor-pointer d-flex align-center",{"chat-contact-active":a(v)}])},[o(A,{dot:"",location:"bottom right","offset-x":"3","offset-y":"0",color:a(u)(s.user.status),bordered:"","model-value":s.isChatContact},{default:f(()=>[o(I,{size:"38",variant:s.user.avatar?void 0:"tonal",color:s.user.avatar?void 0:a(u)(s.user.status)},{default:f(()=>[s.user.avatar?(h(),k(z,{key:0,src:s.user.avatar,alt:"John Doe"},null,8,["src"])):(h(),C("span",gt,b(("avatarText"in i?i.avatarText:a(D))(c.user.fullName)),1))]),_:1},8,["variant","color"])]),_:1},8,["color","model-value"]),t("div",Ct,[t("p",bt,b(a(e).name),1),t("p",xt,b(a(e).lastMessage.body),1)]),s.isChatContact&&"chat"in s.user?(h(),C("div",_t,[t("span",yt,b(("formatDateToMonthShort"in i?i.formatDateToMonthShort:a(J))(s.user.chat.lastMessage.time)),1),s.user.chat.unseenMsgs?(h(),k(A,{key:0,color:"error",inline:"",content:s.user.chat.unseenMsgs,class:"ms-auto"},null,8,["content"])):w("",!0)])):w("",!0)],2))}};const wt={key:0,class:"chat-list-header"},kt={class:"no-chat-items-text text-disabled"},oe={__name:"ChatLeftSidebarContent",props:{search:{type:String,required:!0},isDrawerOpen:{type:Boolean,required:!0}},emits:["openChatOfContact","showUserProfile","close","update:search"],setup(c,{emit:s}){const n=c,u=s,{resolveAvatarBadgeVariant:e}=O(),v=H(n,"search",u),i=T();return(m,l)=>{const r=P("IconBtn");return h(),C($,null,[a(i).profileUser?(h(),C("div",wt,[o(A,{dot:"",location:"bottom right","offset-x":"3","offset-y":"3",color:a(e)(a(i).profileUser.status),bordered:""},{default:f(()=>[o(I,{size:"38",class:"cursor-pointer",onClick:l[0]||(l[0]=p=>m.$emit("showUserProfile"))},{default:f(()=>[o(z,{src:a(i).profileUser.avatar,alt:"John Doe"},null,8,["src"])]),_:1})]),_:1},8,["color"]),o(G,{modelValue:a(v),"onUpdate:modelValue":l[1]||(l[1]=p=>j(v)?v.value=p:null),placeholder:"Buscar...",class:"ms-4 me-1 chat-list-search"},{"prepend-inner":f(()=>[o(g,{size:"22",icon:"tabler-search"})]),_:1},8,["modelValue"]),m.$vuetify.display.smAndDown?(h(),k(r,{key:0,onClick:l[2]||(l[2]=p=>m.$emit("close"))},{default:f(()=>[o(g,{icon:"tabler-x",class:"text-medium-emphasis"})]),_:1})):w("",!0)])):w("",!0),o(tt),o(a(N),{tag:"ul",class:"d-flex flex-column gap-y-1 chat-contacts-list px-3 list-none",options:{wheelPropagation:!1}},{default:f(()=>[l[3]||(l[3]=t("li",{class:"list-none"},[t("span",{class:"chat-contact-header d-block text-primary text-xl font-weight-medium"},"Whatssap")],-1)),(h(!0),C($,null,U(a(i).chatsContacts,p=>(h(),k($t,{key:`chat-${p.id}`,user:p,"is-chat-contact":"",onClick:x=>m.$emit("openChatOfContact",p.id)},null,8,["user","onClick"]))),128)),Q(t("span",kt,"No hay Ninguna Conversacion",512),[[X,!a(i).chatsContacts.length]])]),_:1})],64)}}},Vt=async c=>await S(`/whatssap/status/${c}`,{method:"GET"}),At=async c=>await S(`/whatssap/disconnect/${c}`,{method:"DELETE"}),It=async(c,s)=>await S(`/whatssap/messages/${c}/${s}`,{method:"GET"}),Tt=async c=>await S("/whatssap/initialize",{method:"POST",body:JSON.stringify({clientId:c})});function q(){const c=V(!1),s=V(!1),n=V(null),u=V([]),e=V(null),v=E("userData").value,i=v.cod_phone+v.phone;return{isAuthenticated:s,errorMessage:n,checkAuthStatus:async()=>{try{const d=await Vt(i);console.log("respuesta: ",d),d.status===!0?s.value=!0:s.value=!1}catch(d){console.error(d)}},getAllMessagesForChat:async d=>{try{const _=await It(i,d);u.value=_.messages}catch(_){console.error(_)}},logoutWhatssapWeb:async()=>{try{await At(i),s.value=!1}catch(d){console.error(d)}},getInfoChat:async d=>{try{const _=await getChat(i,d);e.value=_}catch(_){console.error(_)}},initializeConnectToWhatsapp:async()=>{c.value=!0;try{await Tt(i)}catch(d){console.error(d)}finally{console.log("Initialize Connect To WhatsApp"),c.value=!1}},messages:u,loadingConnect:c}}const Ut={class:"chat-log pa-5"},zt={class:"text-sm ms-1 text-disabled"},ne={__name:"ChatLog",setup(c){const s=T(),{getAllMessagesForChat:n,messages:u}=q(),e=B(()=>{var i;return(i=s.activeChat)!=null&&i.contact?{id:s.activeChat.id.user,avatar:s.activeChat.contact.avatar}:{id:null,avatar:null}});Y(async()=>{console.log(s.activeChat.chat.id.user),await n(`${s.activeChat.chat.id.user}@c.us`)});const v=i=>{const m={hour:"numeric",minute:"numeric"};return new Date(i).toLocaleTimeString([],m)};return(i,m)=>(h(),C("div",Ut,[(h(!0),C($,null,U(a(u),(l,r)=>(h(),C("div",{key:l.senderId+String(r),class:y(["chat-group d-flex align-start",[{"flex-row-reverse":l.senderId!==`${e.value.id}@c.us`,"mb-4":a(u).length-1!==r}]])},[t("div",{class:y(["chat-avatar",l.senderId!==`${e.value.id}@c.us`?"ms-4":"me-4"])},[o(I,{size:"32"},{default:f(()=>{var p;return[o(z,{src:l.senderId===`${e.value.id}@c.us`?e.value.avatar:(p=a(s).profileUser)==null?void 0:p.avatar},null,8,["src"])]}),_:2},1024)],2),t("div",{class:y(["chat-body d-inline-flex flex-column",l.senderId!==`${e.value.id}@c.us`?"align-end":"align-start"])},[(h(!0),C($,null,U(l.messages,(p,x)=>(h(),C("p",{key:p.time,class:y(["chat-content py-2 px-4 elevation-1",[l.senderId===`${e.value.id}@c.us`?"chat-left":"bg-primary text-white chat-right",l.messages.length-1!==x?"mb-3":"mb-1"]]),style:{"background-color":"rgb(var(--v-theme-surface))"}},b(p.body),3))),128)),t("div",{class:y({"text-right":l.senderId!==`${e.value.id}@c.us`})},[l.senderId!==`${e.value.id}@c.us`?(h(),k(g,{key:0,size:"18",color:i.success},{default:f(()=>m[0]||(m[0]=[R(" success ")])),_:1},8,["color"])):w("",!0),t("span",zt,b(v(l.messages[l.messages.length-1].time)),1)],2)],2)],2))),128))]))}},St={class:"pt-2 me-2 text-end"},Mt={class:"text-center px-6"},Bt={key:1,class:"text-3xl"},Dt={class:"text-h5"},Nt={class:"text-capitalize text-medium-emphasis"},Pt={class:"my-5 text-medium-emphasis"},Ot={class:"mb-5"},Wt={class:"text-medium-emphasis"},Lt={class:"d-flex align-center my-3"},Ft={class:"d-flex align-center mb-3"},Et={class:"d-flex align-center mb-3"},Rt={class:"d-flex align-center"},le={__name:"ChatUserProfileSidebarContent",emits:["close"],setup(c,{emit:s}){const n=T(),{resolveAvatarBadgeVariant:u}=O(),{isAuthenticated:e,errorMessage:v,logoutWhatssapWeb:i}=q(),m=[{title:"Online",value:"online",color:"success"},{title:"Away",value:"away",color:"warning"},{title:"Do not disturb",value:"busy",color:"error"},{title:"Offline",value:"offline",color:"secondary"}];return(l,r)=>{const p=P("IconBtn"),x=et;return a(n).profileUser?(h(),C($,{key:0},[t("div",St,[o(p,{onClick:r[0]||(r[0]=d=>l.$emit("close"))},{default:f(()=>[o(g,{class:"text-medium-emphasis",color:"disabled",icon:"tabler-x"})]),_:1})]),t("div",Mt,[o(A,{location:"bottom right","offset-x":"7","offset-y":"4",bordered:"",color:a(u)(a(n).profileUser.status),class:"chat-user-profile-badge mb-3"},{default:f(()=>[o(I,{size:"84",variant:a(n).profileUser.avatar?void 0:"tonal",color:a(n).profileUser.avatar?void 0:a(u)(a(n).profileUser.status)},{default:f(()=>[a(n).profileUser.avatar?(h(),k(z,{key:0,src:a(n).profileUser.avatar},null,8,["src"])):(h(),C("span",Bt,b(("avatarText"in l?l.avatarText:a(D))(a(n).profileUser.fullName)),1))]),_:1},8,["variant","color"])]),_:1},8,["color"]),t("h5",Dt,b(a(n).profileUser.fullName),1),t("p",Nt,b(a(n).profileUser.role),1)]),o(a(N),{class:"ps-chat-user-profile-sidebar-content pb-5 px-5",options:{wheelPropagation:!1}},{default:f(()=>[t("div",Pt,[r[3]||(r[3]=t("span",{for:"textarea-user-about",class:"text-sm text-disabled"},"ABOUT",-1)),o(x,{id:"textarea-user-about",modelValue:a(n).profileUser.about,"onUpdate:modelValue":r[1]||(r[1]=d=>a(n).profileUser.about=d),"auto-grow":"",class:"mt-1",rows:"4"},null,8,["modelValue"])]),t("div",Ot,[r[4]||(r[4]=t("span",{class:"text-sm text-disabled"},"STATUS",-1)),o(at,{modelValue:a(n).profileUser.status,"onUpdate:modelValue":r[2]||(r[2]=d=>a(n).profileUser.status=d),class:"mt-1"},{default:f(()=>[(h(),C($,null,U(m,d=>o(ot,{key:d.title,label:d.title,value:d.value,color:d.color},null,8,["label","value","color"])),64))]),_:1},8,["modelValue"])]),t("div",Wt,[r[9]||(r[9]=t("span",{class:"text-sm text-disabled"},"SETTINGS",-1)),t("div",Lt,[o(g,{class:"me-2",icon:"tabler-message-dots",size:"22"}),r[5]||(r[5]=t("span",{class:"text-high-emphasis"},"Two-step Verification",-1))]),t("div",Ft,[o(g,{class:"me-2",icon:"tabler-bell",size:"22"}),r[6]||(r[6]=t("span",{class:"text-high-emphasis"},"Notification",-1))]),t("div",Et,[o(g,{class:"me-2",icon:"tabler-user-plus",size:"22"}),r[7]||(r[7]=t("span",{class:"text-high-emphasis"},"Invite Friends",-1))]),t("div",Rt,[o(g,{class:"me-2",icon:"tabler-trash",size:"22"}),r[8]||(r[8]=t("span",{class:"text-high-emphasis"},"Delete Account",-1))])]),o(Z,{color:"primary",class:"mt-11",onClick:a(i)},{default:f(()=>r[10]||(r[10]=[R(" Logout ")])),_:1},8,["onClick"])]),_:1})],64)):w("",!0)}}};export{le as _,ae as a,oe as b,ne as c,O as d,q as e,T as u};
