import{r as _,ac as z,w as N,a as Y,o as L,f as j,e as t,b as e,d,n as o,I as O,x as K,v as k,a4 as H}from"./index-7410be13.js";import{$ as h}from"./api-05ec387b.js";import{s as I,a as M}from"./notifications-1f494767.js";import{_ as q}from"./AppTextarea-ff5ffff9.js";import{_ as Q}from"./AppSelect-bfd6a858.js";import{_ as J}from"./AppTextField-958b3a61.js";import{_ as Z}from"./AppDateTimePicker-67f957e2.js";import{_ as G}from"./DialogCloseBtn-749bf257.js";import{u as X}from"./useProperty-db092f15.js";import{P as U,a as $,b as W,_ as P}from"./InvoiceAddProperty-016bed1e.js";import{V as ee}from"./VNodeRenderer-f418ea5f.js";import{V as ae}from"./VCard-a5d11b24.js";import{V as x}from"./VCardText-24b6c6e4.js";import{V as S}from"./VDivider-9b253567.js";import{V as T,a as p}from"./VRow-ddf98130.js";import{V as le}from"./VDialog-82064960.js";const Pe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANCSURBVHgB7VZJT1NRFP5e+9pSCrSFUgUUlLGCCCIyBCISNcGFaEKICcaERBbyB3TjgpVLE2MiC4lRlyYaNSIhKooiKAqUQZAZUlpmKHOHV+q9FylUINGFsnlfmrzzes859zvfOTfvcoXXC93YRUiwyxAJiAREAiIBHv8QSoUSxXlFXv/VtTWgfbDz/xCgaO5p9Xq3TI95vXsI6DXBKL1QApfLhVX3KuaX5tHUY0TD90a2Hrs/GunxaYgJi4RDcKJrqBtVjdWI2BOOi7kFqKh8iIKcfOjUOrxr+YCa5lpkxKfiUIQB/eYBuMEhwNcf3aZeLwLShOyEMmqofFTISzuNW4/voHPoB8JJ4jOpudD4qTFKWBefLUL5swoYe1uZ78mj2Wyz8dkJZCVmEDsItcZP0Gt1SIo+ApvdhvPZ51D+/B46iOT9lgEYIuKIbyYau75tVWAdGn8tekf6cP/VI1zNv4LMhHTMETUEwQXXqgszC1Y8/fgCYcGhiCOqNPU0s7iX9VUYnjBhZMqMIP9A2Jw23H5yF0q5D9INqbALDlZM7L4oqFUBLCfFllOQdTjdY79pes+edocdoboQUlmiZ63WWAfBtQr3r4/5mHWCPWfmZ9Fr7odUwqM0vwQpscloG+yAsa8NS7alNdmlUk+eLQRowKmUHCbz3kA96+fX7hZYF2bJRF9CTnI2WfMlCoSgrr3eEycIgleezITjUCl98ZbMwgppxx6tHn5K1e/bec/AiaQsVH15jRgiU/wBA2G8jMrP1bA77Wgd6ICCVyAy9CAbSMvUKGpaalk1Mp5nR8vt3rjbWKZHERQQSIY2CjwvhVwmx/CYidnGvnai3hphbv1GpNcG48blayh7cJPJuB38yRTTQFqJw+mEr8IHApkLakskEtgcNo8vL+UZMVo97bmTnBx6unzkCjLU4xt+6wbtM+0TDdgJx0h7OI5jJKg6bpJwybYCQ3g0zJOjCAzQwjRhJv2XQO2nYS20Ls6RwVajx9TH1i3EbzO4v7kTBmt0WFxZhISTsEo8ZDn641iFfqSV88uLrG1ymYypo5Ap1twI+c0qeSnwJ5i0TnlsqsB22Kwg3ZyCktkJ4tdQJCASEAmIBH4Cka1P8RSIn3sAAAAASUVORK5CYII=",oe=async n=>await h(`/opportunity/kanban/${n}`,{method:"GET"}),te=async n=>await h(`/opportunity/get-opportunity/${n}`,{method:"GET"}),ne=async(n,m)=>await h(`/opportunity/convert-prospect/${n}`,{method:"PATCH",body:m}),se=async(n,m)=>await h(`/opportunity/update/${n}`,{method:"PATCH",body:m}),ie=async(n,m,b)=>await h(`/opportunity/${n}/stage/${m}`,{method:"PATCH",body:b});function Be(){const n=_(!1),m=_(null),b=z("userData").value,i=_({description:"",customer:{name:"",email:"",phone:"",ci:""},stage:{id:"",name:"",description:""},property:{id:"",title:"",code:"",description:""}}),V=_(null);return{loadingOpportunity:n,error:m,opportunity:i,kanban:V,allOpportunityKanbanForUser:async()=>{try{const u=await oe(b.id);V.value=u.data,console.log(V)}catch(u){console.error(u)}},changeStatusByOpportunity:async(u,f,c)=>{n.value=!0;try{const g=await ie(u,f,c);console.log("Oportunidad actualizada: ",g),i.value=g.data,I("Actualizacion Exitosa","Se actualizo el Estado de la Oportunidad")}catch(g){console.log(g),g.response&&g.response.status==500&&M("Advertencia",g.response._data.message)}finally{n.value=!1}},getOpportunitybyId:async u=>{try{const f=await te(u);i.value=f.data,console.log("esta es la oportunidad: ",i.value)}catch(f){console.error(f)}},changeOpportunity:async(u,f)=>{n.value=!0;try{const c=await se(u,f);i.value=c.data,console.log("Oportunidad actualizada: ",i.value),I("Actualizacion Exitosa","Se Actualizaron los cambios de este cliente")}catch(c){m.value=c,console.error(c)}finally{n.value=!1}},generateProspect:async(u,f)=>{try{const c=await ne(u,f);console.log(c),i.value=c.data}catch(c){console.error(c)}finally{}}}}const re={LEAD:{value:1,label:"LEAD"},PROSPECT:{value:2,label:"PROSPECTO"},PRESALE:{value:3,label:"PRE-VENTA"},SALE:{value:4,label:"VENTA"},DELIVERY:{value:5,label:"ENTREGA"},LOSS:{value:6,label:"PERDIDA"}},de=async n=>await h("/sale",{method:"POST",body:n});function pe(){const n=_(!1),m=_([]),b=_(null),i=_(null);return{loadingSale:n,sales:m,error:b,sale:i,generateSale:async w=>{n.value=!0;try{const v=await de(w);I("Venta generada con Exito","Se registro una nueva venta"),console.log("venta: ",v),i.value=v.data}catch(v){b.value=v}finally{n.value=!1}}}}const ue={class:"ma-sm-4"},ce={class:"d-flex align-center mb-6"},me={class:"font-weight-bold text-capitalize text-h4"},fe={class:"mt-4 ma-sm-4"},ge={class:"d-flex align-center font-weight-medium justify-sm-end text-xl mb-3"},ye={class:"d-flex align-center justify-sm-end mb-3"},be={style:{"inline-size":"9.5rem"}},Re={__name:"PreSaleForm",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0}},emits:["update:isDialogVisible","registerSale"],setup(n,{emit:m}){var g;const b=n,i=m;X();const{generateSale:V,loadingSale:w}=pe(),v=r=>{i("update:isDialogVisible",r)},l=_({social_reason:"",nit:null,address:"",email:"",phone:"",workplace:"",date_listing:null,obersvations:"",payment_method:null,contract_signing_date:null,amount:null,initial_fee:null,opportunity_id:((g=b.opportunity)==null?void 0:g.id)??null,stage_id:re.SALE.value,customer_id:null,properties:[{property_id:null,price:null,priceIt:null,property_type:U.DEPARTAMENT.value,property_type_name:U.DEPARTAMENT.label}],differs_initial_fee:[],differs_balance:[]}),E=r=>{l.value.properties.push(r)},D=()=>{},u=()=>{const r=l.value.differs_initial_fee.reduce((a,y)=>a+(y.amount||0),0);return l.value.initial_fee-r},f=()=>{const r=l.value.differs_balance.reduce((a,y)=>a+(y.amount||0),0);return l.value.amount-l.value.initial_fee-r},c=async()=>{const r=u();r!==0&&l.value.differs_initial_fee.push({date:new Date().toISOString().slice(0,19).replace("T"," "),amount:r});const a=f();a!==0&&l.value.differs_balance.push({date:new Date().toISOString().slice(0,19).replace("T"," "),amount:a}),console.log("data de la venta: ",l.value),await V(l.value),i("update:isDialogVisible",!1),i("registerSale",l.value.opportunity_id)};return N(()=>l.value.properties,r=>{let a=0;r.forEach(y=>{if(y.price){const C=parseFloat(y.price)||0;y.priceIt=C*.03,a+=C}else y.priceIt=null}),l.value.amount=a,l.value.initial_fee=a*.3},{deep:!0}),(r,a)=>{const y=G,C=Y("H3"),B=Z,A=J,R=Q,F=q;return L(),j(le,{"model-value":b.isDialogVisible,"max-width":"800","onUpdate:modelValue":v},{default:t(()=>[e(y,{onClick:a[0]||(a[0]=s=>r.$emit("update:isDialogVisible",!1))}),e(ae,null,{default:t(()=>[e(x,{class:"d-flex flex-wrap justify-space-between gap-y-5 flex-column flex-sm-row"},{default:t(()=>[d("div",ue,[d("div",ce,[e(o(ee),{nodes:o(O).app.logo,class:"me-3"},null,8,["nodes"]),d("h6",me,K(o(O).app.title),1)]),e(C,null,{default:t(()=>a[10]||(a[10]=[k("Formulario de Venta")])),_:1})]),d("div",fe,[d("h6",ge,[e(H,{color:"primary",loading:o(w),disabled:o(w),onClick:c},{default:t(()=>a[11]||(a[11]=[k(" Registrar Venta ")])),_:1},8,["loading","disabled"])]),d("div",ye,[a[12]||(a[12]=d("span",{class:"me-3",style:{"inline-size":"6rem"}},"Date Issued",-1)),d("span",be,[e(B,{density:"compact",placeholder:"YYYY-MM-DD",config:{position:"auto right"}})])])])]),_:1}),e(S,{thickness:"24"}),e(x,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row gap-y-5 gap-4"},{default:t(()=>[e(T,null,{default:t(()=>[e(p,{cols:"12",sm:"8",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(A,{modelValue:o(l).social_reason,"onUpdate:modelValue":a[1]||(a[1]=s=>o(l).social_reason=s),label:"Razon social:",placeholder:"Canzza",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",sm:"4",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(A,{modelValue:o(l).nit,"onUpdate:modelValue":a[2]||(a[2]=s=>o(l).nit=s),label:"C.I./NIT:",placeholder:"0000000",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(A,{modelValue:o(l).workplace,"onUpdate:modelValue":a[3]||(a[3]=s=>o(l).workplace=s),label:"Lugar de Trabajo:",placeholder:"Placeholder Text",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(A,{modelValue:o(l).address,"onUpdate:modelValue":a[4]||(a[4]=s=>o(l).address=s),label:"Direccion:",placeholder:"Av/ Equipetrol ....",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(A,{modelValue:o(l).phone,"onUpdate:modelValue":a[5]||(a[5]=s=>o(l).phone=s),label:"Celular:",placeholder:"77049267",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(A,{label:"Telefono Fijo:",placeholder:"33557292",outlined:"",dense:"",class:"custom-salesforce-input"})]),_:1})]),_:1})]),_:1}),e(S,{thickness:"24"}),e(x,{class:"add-products-form"},{default:t(()=>[e(T,null,{default:t(()=>[e(p,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e($,{properties:o(l).properties,onAddProperty:E,onRemoveProperty:D},null,8,["properties"])]),_:1}),e(p,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(R,{modelValue:o(l).payment_method,"onUpdate:modelValue":a[6]||(a[6]=s=>o(l).payment_method=s),label:"Tipo de Pago :",placeholder:"Seleccione ",items:Object.values(o(W)),class:"custom-salesforce-input"},null,8,["modelValue","items"])]),_:1}),e(p,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(A,{modelValue:o(l).amount,"onUpdate:modelValue":a[7]||(a[7]=s=>o(l).amount=s),label:"Total en Contrato :",placeholder:"Placeholder Text",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(S,{thickness:"24"}),e(x,{class:"add-products-form"},{default:t(()=>[e(T,null,{default:t(()=>[e(p,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(P,{title:"Cuota Inicial",amount:o(l).initial_fee,differs:o(l).differs_initial_fee},null,8,["amount","differs"])]),_:1}),e(p,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(P,{title:"Saldo",amount:o(l).amount-o(l).initial_fee,differs:o(l).differs_balance},null,8,["amount","differs"])]),_:1}),e(p,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(A,{modelValue:o(l).contract_signing_date,"onUpdate:modelValue":a[8]||(a[8]=s=>o(l).contract_signing_date=s),label:"Firma de Contrato :",placeholder:"Placeholder Text",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(A,{label:"Fecha de Deposito:",placeholder:"Placeholder Text",outlined:"",dense:"",class:"custom-salesforce-input"})]),_:1}),e(p,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(F,{modelValue:o(l).observations,"onUpdate:modelValue":a[9]||(a[9]=s=>o(l).observations=s),"auto-grow":"",label:"Observaciones del Cliente",rows:"2",placeholder:"Descripcion...","row-height":"20"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(S,{thickness:"24"}),e(x,null,{default:t(()=>a[13]||(a[13]=[d("div",{class:"d-flex mx-sm-4"},[d("span",null,[d("strong",null," El comprador deberá realizar todos los pagos acordados, en las cuentas indicadas de Canzza Desarrolladora Inmobiliaria Srl. y entregar el respectivo comprobante de depósito. ")])],-1)])),_:1}),e(S),e(x,null,{default:t(()=>a[14]||(a[14]=[d("div",{class:"d-flex mx-sm-4"},[d("span",null,[d("strong",null," Todos los gastos administrativos, inscripción en derechos reales y honorarios profesionales para consolidar el derecho de propiedad a favor del comprador deben ser asumidos por el comprador.")])],-1)])),_:1})]),_:1})]),_:1},8,["model-value"])}}};export{re as S,Re as _,pe as a,Pe as p,Be as u};
