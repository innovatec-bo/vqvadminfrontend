import{u as ie,S as ke,_ as xe,a as Ae,d as Ne}from"./PreSaleForm-2cecdd5e.js";import{r as K,e as Re}from"./validators-dea6e3a5.js";import{_ as De}from"./AppTextarea-b9296497.js";import{_ as Le}from"./AppDateTimePicker-f5eec909.js";import{_ as _e}from"./AppTextField-5062369f.js";import{_ as be}from"./AppSelect-153ad761.js";import{f as te}from"./currencyFormatter-92ad4b3c.js";import{$ as ue}from"./api-dda96ee4.js";import{s as he,a as Me,b as He,c as Se,S as we}from"./notifications-81bc0416.js";import{r as _,o as s,c as v,d as l,F as j,i as H,b as e,e as t,n as a,v as C,x as g,z as B,f as F,$ as Y,a4 as T,w as se,a3 as $e,a as re,a0 as R,am as Z,a2 as ee,k as Qe,H as Ue,an as Ce,ac as Ge}from"./index-2eb1505d.js";import{V as Oe}from"./VAvatar-f7cdf41f.js";import{b as le,c as oe,a as ge}from"./VList-eeea6141.js";import{V as b}from"./VCol-820c097e.js";import{V as X}from"./VChip-1979189a.js";import{V as ae}from"./VTooltip-117ef28f.js";import{V as G}from"./VCardText-3bd26a97.js";import{a as ze,f as Ke}from"./formatters-b3558c7d.js";import{u as Ye}from"./useQuote-1078a395.js";import{_ as Je}from"./AppAutocomplete-ddacf1f6.js";import{_ as ce}from"./DialogCloseBtn-cccccbdf.js";import{u as We}from"./useProperty-ab9addaa.js";import{V as W,b as me}from"./VCard-24ba86df.js";import{V as Ie}from"./VForm-2674761c.js";import{V as Q}from"./VRow-dfd8f421.js";import{V as ye}from"./VDialog-026e3690.js";import{V as de}from"./VCheckbox-aa793959.js";import{V as pe}from"./VTable-a911e61b.js";import{V as ne}from"./VTextField-1bb0ee16.js";import{P as Fe}from"./vue3-perfect-scrollbar.esm-3755cfe2.js";import{V as Ze,a as Xe}from"./VTimelineItem-89b8b4c3.js";import{V as qe}from"./VNavigationDrawer-b3a2c13f.js";import{_ as Ee}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as et}from"./AppDrawerHeaderSection-806a5d43.js";import{V as Te,a as tt}from"./VWindowItem-09791f71.js";import{V as lt,a as Pe}from"./VRadioGroup-776c5b7c.js";import{V as ot}from"./VDivider-24e0a4b7.js";import{V as at,a as it}from"./VTabs-49be8054.js";import{V as st}from"./VOverlay-2610f1b2.js";import"./useSales-6a5c8c1e.js";import"./InvoiceAddMoney-59c6aca3.js";import"./VNodeRenderer-7edf5c3b.js";import"./helpers-61e4df1a.js";import"./form-7dc945ea.js";/* empty css                   */import"./VCounter-c127849b.js";import"./VImg-be87a0e7.js";import"./VField-8f5debd9.js";import"./easing-9f15041e.js";import"./VInput-ab6bf326.js";import"./forwardRefs-8348545e.js";import"./VSelect-1575d9ab.js";import"./dialog-transition-2deecb94.js";import"./VMenu-cca3cf0d.js";import"./scopeId-22ff2182.js";import"./VCheckboxBtn-3e694008.js";import"./VSelectionControl-25ca5494.js";import"./index-9c720871.js";import"./constants-ca8ca994.js";import"./ssrBoot-e465d36c.js";import"./filter-837eaa06.js";import"./VSpacer-f20c57cf.js";import"./lazy-3f7bf9c0.js";import"./VSlideGroup-c922d720.js";const je="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANCSURBVHgB7VZJT1NRFP5e+9pSCrSFUgUUlLGCCCIyBCISNcGFaEKICcaERBbyB3TjgpVLE2MiC4lRlyYaNSIhKooiKAqUQZAZUlpmKHOHV+q9FylUINGFsnlfmrzzes859zvfOTfvcoXXC93YRUiwyxAJiAREAiIBHv8QSoUSxXlFXv/VtTWgfbDz/xCgaO5p9Xq3TI95vXsI6DXBKL1QApfLhVX3KuaX5tHUY0TD90a2Hrs/GunxaYgJi4RDcKJrqBtVjdWI2BOOi7kFqKh8iIKcfOjUOrxr+YCa5lpkxKfiUIQB/eYBuMEhwNcf3aZeLwLShOyEMmqofFTISzuNW4/voHPoB8JJ4jOpudD4qTFKWBefLUL5swoYe1uZ78mj2Wyz8dkJZCVmEDsItcZP0Gt1SIo+ApvdhvPZ51D+/B46iOT9lgEYIuKIbyYau75tVWAdGn8tekf6cP/VI1zNv4LMhHTMETUEwQXXqgszC1Y8/fgCYcGhiCOqNPU0s7iX9VUYnjBhZMqMIP9A2Jw23H5yF0q5D9INqbALDlZM7L4oqFUBLCfFllOQdTjdY79pes+edocdoboQUlmiZ63WWAfBtQr3r4/5mHWCPWfmZ9Fr7odUwqM0vwQpscloG+yAsa8NS7alNdmlUk+eLQRowKmUHCbz3kA96+fX7hZYF2bJRF9CTnI2WfMlCoSgrr3eEycIgleezITjUCl98ZbMwgppxx6tHn5K1e/bec/AiaQsVH15jRgiU/wBA2G8jMrP1bA77Wgd6ICCVyAy9CAbSMvUKGpaalk1Mp5nR8vt3rjbWKZHERQQSIY2CjwvhVwmx/CYidnGvnai3hphbv1GpNcG48blayh7cJPJuB38yRTTQFqJw+mEr8IHApkLakskEtgcNo8vL+UZMVo97bmTnBx6unzkCjLU4xt+6wbtM+0TDdgJx0h7OI5jJKg6bpJwybYCQ3g0zJOjCAzQwjRhJv2XQO2nYS20Ls6RwVajx9TH1i3EbzO4v7kTBmt0WFxZhISTsEo8ZDn641iFfqSV88uLrG1ymYypo5Ap1twI+c0qeSnwJ5i0TnlsqsB22Kwg3ZyCktkJ4tdQJCASEAmIBH4Cka1P8RSIn3sAAAAASUVORK5CYII=",nt=async(A,S)=>await ue(`/opportunity/${A}/stage/${S}`,{method:"GET"}),rt=async(A,S,o)=>await ue(`/opportunity/${A}/procedure/${S}`,{method:"PATCH",body:o});function fe(){const A=_(null),S=_(!1),o=_(!1),y=_([]);return{process:A,loadingProcess:S,errorProcess:o,processes:y,allProcessesOpportunityForStage:async(V,n)=>{try{const c=await nt(V,n);y.value=c.data}catch(c){console.log(c)}},checkProcessForOpportunity:async(V,n,c)=>{try{console.log(c);const d=await rt(V,n,c);he("¡Proceso completado exitosamente!","El proceso ha sido llevado a cabo sin inconvenientes. ")}catch(d){console.log(d)}}}}const ut={class:"my-5"},dt={key:0},pt=["src"],ct={class:"my-5"},mt={key:0,class:"d-flex flex-wrap gap-2 my-5"},yt={key:1},ft={__name:"EditDeliveryOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","complet"],setup(A,{emit:S}){const o=A,y=S,{changeStatusByOpportunity:z}=ie(),{checkProcessForOpportunity:D}=fe(),V=async()=>{try{await z(o.opportunity.id,7,{}),y("complet")}catch(c){console.error("Error updating customer:",c)}},n=async(c,d)=>{console.log(`Procedimiento ${c} marcado como: ${d?"realizado":"no realizado"}`),await D(o.opportunity.id,c,{is_check:!d}),y("updateStageId",o.opportunity.id)};return(c,d)=>(s(),v(j,null,[l("div",ut,[d[0]||(d[0]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Propiedades ",-1)),o.opportunity.sales.length>0?(s(),v("div",dt,[(s(!0),v(j,null,H(o.opportunity.sales,w=>(s(),v("div",{key:w.id},[(s(!0),v(j,null,H(w.properties,I=>(s(),v("div",{key:I.id,class:"d-flex align-center justify-between"},[e(Oe,{size:"50",rounded:""},{default:t(()=>[l("img",{src:a(je),alt:"Logo pora",style:{"border-radius":"30%"}},null,8,pt)]),_:1}),e(b,{cols:"12",md:"7"},{default:t(()=>[e(le,{class:"font-weight-medium"},{default:t(()=>[C(g(I.project_title)+" | "+g(I.title),1)]),_:2},1024),e(oe,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",null,g(("formatCurrency"in c?c.formatCurrency:a(te))(I.pivot_price)),1)]),_:2},1024)]),_:2},1024)]))),128))]))),128))])):B("",!0)]),l("div",ct,[d[2]||(d[2]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(s(),v("div",mt,[(s(!0),v(j,null,H(o.opportunity.procedure,w=>(s(),v("div",{key:w.id},[e(X,{color:w.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:I=>n(w.id,w.pivot.is_check)},{default:t(()=>[w.pivot.is_check?(s(),F(Y,{key:0,icon:"tabler-check",class:"mr-2"})):B("",!0),C(" "+g(w.title),1)]),_:2},1032,["color","onClick"]),e(ae,{activator:"parent",location:"top"},{default:t(()=>[C(g(w.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(s(),v("div",yt,d[1]||(d[1]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(G,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(T,{color:"primary",size:"small",onClick:V},{default:t(()=>d[3]||(d[3]=[C(" Finalizar Oportunidad ")])),_:1})]),_:1})],64))}},Be={__name:"EditCustomerDialog",props:{isDialogVisible:{type:Boolean,required:!0},opportunityKanban:{type:Object,required:!0}},emits:["update:isDialogVisible","update:newProperty"],setup(A,{emit:S}){const o=A,y=S;Object.values(ke).map(f=>({title:f.label,value:f.value}));const{propertiesAvailbles:z,properties:D}=We(),{getOpportunitybyId:V,opportunity:n,changeOpportunity:c,loadingOpportunity:d}=ie(),w=()=>{y("update:isDialogVisible",!1)},I=async()=>{console.log("antes del save:",n);const f={id:n.value.id,description:n.value.description,property_id:n.value.property_id,customer:{id:n.value.customer.id,name:n.value.customer.name,email:n.value.customer.email,ci:n.value.customer.ci,cod_phone:n.value.customer.cod_phone.replace(/\+/g,""),phone:n.value.customer.phone}};console.log("data de editar",f),await c(n.value.id,f),n.value.property_id&&(console.log("Cambio y geenero el Emit Principal"),y("update:newProperty",n.value.property_id)),y("update:isDialogVisible",!1)},$=async()=>{var f;(f=o.opportunityKanban)!=null&&f.id&&await V(o.opportunityKanban.id)},P=async()=>{await z()};return se(()=>o.isDialogVisible,async f=>{f===!0&&($(),await P())}),(f,p)=>{const O=ce,L=_e,i=be,m=Je,M=De;return s(),F(ye,{"max-width":"800","model-value":o.isDialogVisible,persistent:"","close-on-esc":!1,"onUpdate:modelValue":w},{default:t(()=>[e(O,{onClick:w}),e(W,{title:"Información del Cliente y Oportunidad",class:"pa-sm-8 pa-5"},{default:t(()=>[e(G,null,{default:t(()=>[e(Ie,{onSubmit:$e(I,["prevent"])},{default:t(()=>[e(Q,{dense:""},{default:t(()=>[e(b,{cols:"12",md:"6"},{default:t(()=>[e(L,{modelValue:a(n).customer.name,"onUpdate:modelValue":p[0]||(p[0]=x=>a(n).customer.name=x),label:"Nombre del Cliente",placeholder:"Ingresa el nombre",outlined:""},null,8,["modelValue"])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(L,{modelValue:a(n).customer.email,"onUpdate:modelValue":p[1]||(p[1]=x=>a(n).customer.email=x),label:"Email del Cliente",placeholder:"Ingresa el email",outlined:""},null,8,["modelValue"])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(Q,null,{default:t(()=>[e(b,{cols:"4"},{default:t(()=>[e(i,{modelValue:a(n).customer.cod_phone,"onUpdate:modelValue":p[2]||(p[2]=x=>a(n).customer.cod_phone=x),label:"Código",items:["+1","+52","+55","+54","+49","+33","+34","+39","+86","+81","+7","+591"],placeholder:"Cód.",outlined:""},null,8,["modelValue"])]),_:1}),e(b,{cols:"8"},{default:t(()=>[e(L,{modelValue:a(n).customer.phone,"onUpdate:modelValue":p[3]||(p[3]=x=>a(n).customer.phone=x),label:"Número de Teléfono",placeholder:"Ingresa el teléfono",outlined:"",dense:"",maxlength:"9"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(L,{modelValue:a(n).customer.ci,"onUpdate:modelValue":p[4]||(p[4]=x=>a(n).customer.ci=x),label:"CI del Cliente",placeholder:"Ingresa el CI",outlined:""},null,8,["modelValue"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(m,{modelValue:a(n).property_id,"onUpdate:modelValue":p[5]||(p[5]=x=>a(n).property_id=x),label:"Departamento de Interés",placeholder:"Selecciona un Departamento",items:a(D).map(x=>({title:x.title,value:x.id})),outlined:""},null,8,["modelValue","items"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(M,{modelValue:a(n).description,"onUpdate:modelValue":p[6]||(p[6]=x=>a(n).description=x),label:"Descripción de la Oportunidad",placeholder:"Ingresa una descripción",rows:"3","auto-grow":"",outlined:""},null,8,["modelValue"])]),_:1}),e(b,{cols:"12",class:"text-center"},{default:t(()=>[e(T,{type:"submit",color:"primary",class:"me-3",disabled:a(d),loading:a(d)},{default:t(()=>p[7]||(p[7]=[C(" Guardar ")])),_:1},8,["disabled","loading"]),e(T,{color:"secondary",variant:"tonal",onClick:w},{default:t(()=>p[8]||(p[8]=[C(" Cancelar ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},vt={class:"d-flex align-bottom flex-sm-row flex-column"},gt={class:"user-profile-info"},_t={class:"d-flex align-center justify-center justify-sm-space-between flex-wrap gap-4"},bt={class:"d-flex align-center gap-x-3"},Vt={class:"text-4xl font-weight-medium"},wt={class:"d-flex flex-column py-2",style:{"font-size":"14px"}},Ct={class:"text-sm text-disabled"},Pt={key:0,class:"d-flex flex-wrap gap-2 my-5"},kt={key:1},xt={key:0,class:"d-flex flex-wrap gap-2 my-5"},At={key:1},Dt={__name:"EditPreSaleOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","update:newProperty"],setup(A,{emit:S}){const o=A,y=S,{checkProcessForOpportunity:z}=fe(),{changeStatusQuotesCustomer:D}=Ye(),V=_(!1),n=_(!1),c=()=>{V.value=!0},d=()=>{console.log("Se escucho el evento en EditProspectOpportunity"),y("update:newProperty")},w=()=>{n.value=!0},I=async f=>{y("updateStageId",f)},$=async(f,p)=>{console.log(`Procedimiento ${f} marcado como: ${p?"realizado":"no realizado"}`),await z(o.opportunity.id,f,{is_check:!p}),y("updateStageId",o.opportunity.id)},P=async(f,p)=>{const O=p==="APPROVED"?"NOT_APPROVED":"APPROVED";console.log(`Procedimiento ${f} marcado como: ${p}`),await D(f,{status:O}),y("updateStageId",o.opportunity.id)};return(f,p)=>{const O=re("RouterLink"),L=re("IconBtn");return s(),v(j,null,[l("div",vt,[l("div",gt,[p[3]||(p[3]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Perfil ",-1)),l("div",_t,[l("div",bt,[l("span",Vt,g(("avatarText"in f?f.avatarText:a(ze))(o.opportunity.customer.name)),1),l("div",wt,[e(O,{to:{name:"apps-ecommerce-customer-details-id",params:{id:1}},class:"font-weight-base"},{default:t(()=>[C(g(o.opportunity.customer.name),1)]),_:1}),l("span",Ct,g(o.opportunity.customer.phone),1)]),e(T,{color:"secondary",variant:"tonal",size:"small",onClick:c},{default:t(()=>p[2]||(p[2]=[C(" Editar Perfil ")])),_:1})])])])]),l("div",null,[p[5]||(p[5]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(s(),v("div",Pt,[(s(!0),v(j,null,H(o.opportunity.procedure,i=>(s(),v("div",{key:i.id},[e(X,{color:i.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:m=>$(i.id,i.pivot.is_check)},{default:t(()=>[i.pivot.is_check?(s(),F(Y,{key:0,icon:"tabler-check",class:"mr-2"})):B("",!0),C(" "+g(i.title),1)]),_:2},1032,["color","onClick"]),e(ae,{activator:"parent",location:"top"},{default:t(()=>[C(g(i.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(s(),v("div",kt,p[4]||(p[4]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),l("div",null,[p[8]||(p[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Cotizaciones ",-1)),o.opportunity.quotes&&o.opportunity.quotes.length>0?(s(),v("div",xt,[e(pe,{density:"compact",class:"text-no-wrap",style:{"font-size":"12px"}},{default:t(()=>[p[6]||(p[6]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th")])],-1)),l("tbody",null,[(s(!0),v(j,null,H(o.opportunity.quotes,i=>(s(),v("tr",{key:i.id},[l("td",null,g(i.properties[0].title),1),l("td",null,g(i.created_at),1),l("td",null,g(("formatCurrency"in f?f.formatCurrency:a(te))(i.amount)),1),l("td",null,[e(Q,null,{default:t(()=>[e(de,{modelValue:i.status,"onUpdate:modelValue":m=>i.status=m,"true-value":"APPROVED","false-value":"NOT_APPROVED",disabled:""},null,8,["modelValue","onUpdate:modelValue"]),e(de,{modelValue:i.status_customer,"onUpdate:modelValue":m=>i.status_customer=m,"true-value":"APPROVED","false-value":"NOT_APPROVED",onClick:m=>P(i.id,i.status_customer)},{default:t(()=>[e(ae,{activator:"parent",location:"top"},{default:t(()=>[C(g(i.status_customer=="NOT_APPROVED"?"No aprobado por cliente":"Aprobado por cliente"),1)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","onClick"]),e(O,{to:{name:"quote-id",params:{id:i.id}}},{default:t(()=>[e(L,null,{default:t(()=>[e(Y,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])]),_:2},1024)])]))),128))])]),_:1})])):(s(),v("div",At,p[7]||(p[7]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(G,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(O,{to:{name:"quote-add-quote"},class:"text-white"},{default:t(()=>[e(T,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>p[9]||(p[9]=[C(" Generar Cotización ")])),_:1})]),_:1}),e(T,{color:"primary",class:"mx-auto",size:"small",onClick:w},{default:t(()=>p[10]||(p[10]=[C(" Generar Venta ")])),_:1})]),_:1}),e(Be,{"is-dialog-visible":a(V),"onUpdate:isDialogVisible":p[0]||(p[0]=i=>R(V)?V.value=i:null),"opportunity-kanban":o.opportunity,"onUpdate:newProperty":d},null,8,["is-dialog-visible","opportunity-kanban"]),e(xe,{"is-dialog-visible":a(n),"onUpdate:isDialogVisible":p[1]||(p[1]=i=>R(n)?n.value=i:null),opportunity:o.opportunity,stage:"PRESALE",onRegisterSale:I},null,8,["is-dialog-visible","opportunity"])],64)}}},ht={class:"d-flex align-bottom flex-sm-row flex-column"},St={class:"user-profile-info"},$t={class:"d-flex align-center justify-center justify-sm-space-between flex-wrap gap-4"},Ut={class:"d-flex align-center gap-x-3"},Ot={class:"text-4xl font-weight-medium"},zt={class:"d-flex flex-column py-2",style:{"font-size":"14px"}},It={class:"text-sm text-disabled"},Ft={key:0,class:"d-flex flex-wrap gap-2 my-5"},qt={key:1},Et={key:0,class:"d-flex flex-wrap gap-2 my-5"},Tt={key:1},jt={__name:"EditProspectOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","update:newProperty"],setup(A,{emit:S}){const o=A,y=S,{checkProcessForOpportunity:z}=fe(),{changeStatusByOpportunity:D,loadingOpportunity:V}=ie(),n=_(!1),c=()=>{n.value=!0},d=()=>{console.log("Se escucho el evento en EditProspectOpportunity"),y("update:newProperty")},w=async $=>{await D($,ke.PRESALE.value,{}),y("updateStageId",$)},I=async $=>{console.log(`Procedimiento ${$.id} marcado como: ${$.pivot.is_check?"realizado":"no realizado"}`),await z(o.opportunity.id,$.id,{is_check:!$.pivot.is_check}),$.pivot.is_check=!$.pivot.is_check,y("updateStageId",o.opportunity.id)};return($,P)=>{const f=re("RouterLink"),p=re("IconBtn");return s(),v(j,null,[l("div",ht,[l("div",St,[P[3]||(P[3]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Perfil ",-1)),l("div",$t,[l("div",Ut,[l("span",Ot,g(("avatarText"in $?$.avatarText:a(ze))(o.opportunity.customer.name)),1),l("div",zt,[e(f,{to:{name:"apps-ecommerce-customer-details-id",params:{id:1}},class:"font-weight-base"},{default:t(()=>[C(g(o.opportunity.customer.name),1)]),_:1}),l("span",It,g(o.opportunity.customer.phone),1)]),l("div",null,[e(T,{color:"secondary",variant:"tonal",size:"small",onClick:c},{default:t(()=>P[2]||(P[2]=[C(" Editar Perfil ")])),_:1})])])])])]),l("div",null,[P[5]||(P[5]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(s(),v("div",Ft,[(s(!0),v(j,null,H(o.opportunity.procedure,O=>(s(),v("div",{key:O.id},[e(X,{color:O.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:L=>I(O)},{default:t(()=>[O.pivot.is_check?(s(),F(Y,{key:0,icon:"tabler-check",class:"mr-2"})):B("",!0),C(" "+g(O.title),1)]),_:2},1032,["color","onClick"]),e(ae,{activator:"parent",location:"top"},{default:t(()=>[C(g(O.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(s(),v("div",qt,P[4]||(P[4]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),l("div",null,[P[8]||(P[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Cotizaciones ",-1)),o.opportunity.quotes&&o.opportunity.quotes.length>0?(s(),v("div",Et,[e(pe,{density:"compact",class:"text-no-wrap",style:{"font-size":"12px"}},{default:t(()=>[P[6]||(P[6]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th")])],-1)),l("tbody",null,[(s(!0),v(j,null,H(o.opportunity.quotes,O=>(s(),v("tr",{key:O.id},[l("td",null,g(O.properties[0].title),1),l("td",null,g(O.created_at),1),l("td",null,g(("formatCurrency"in $?$.formatCurrency:a(te))(O.amount)),1),l("td",null,[e(f,{to:{name:"quote-id",params:{id:O.id}}},{default:t(()=>[e(p,null,{default:t(()=>[e(Y,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])])]))),128))])]),_:1})])):(s(),v("div",Tt,P[7]||(P[7]=[l("span",null,"No hay cotizaciones disponibles.",-1)])))]),e(G,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(f,{to:{name:"quote-add-quote"},class:"text-white"},{default:t(()=>[e(T,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>P[9]||(P[9]=[C(" Generar Cotización ")])),_:1})]),_:1}),e(T,{color:"primary",class:"mx-auto",size:"small",disabled:a(V),loading:a(V),onClick:P[0]||(P[0]=O=>w(o.opportunity.id))},{default:t(()=>P[10]||(P[10]=[C(" Siguiente Etapa ")])),_:1},8,["disabled","loading"])]),_:1}),e(Be,{"is-dialog-visible":a(n),"onUpdate:isDialogVisible":P[1]||(P[1]=O=>R(n)?n.value=O:null),"opportunity-kanban":o.opportunity,"onUpdate:newProperty":d},null,8,["is-dialog-visible","opportunity-kanban"])],64)}}},Bt=async A=>await ue(`/sale/paymentPlans/${A}/confirm`,{method:"PATCH"}),Nt=async(A,S)=>await ue(`/sale/paymentPlans/${A}`,{method:"PATCH",body:S});function Ve(){const A=_(!1),S=_([]),o=_(null),y=_(null);return{loadingPaymentPlans:A,paymentPlan:y,error:o,paymentPlans:S,confirmPaymentPlans:async V=>{try{const n=await Bt(V);he("Actualizacion Exitosa","Se confirmo el pago")}catch(n){console.log(n)}},updatePaymentPlans:async(V,n)=>{A.value=!0,o.value=null;try{console.log(n);const c=await Nt(V,n);y.value=c.data,Me("¡Planes de pago actualizados exitosamente! ","Los planes de pago han sido modificados y guardados correctamente."),console.log(c)}catch(c){console.log(c),c.response&&c.response.status==422&&He("Advertencia","Faltan datos por Completar"),o.value=c.message}finally{A.value=!1}}}}const Rt={__name:"DeliveryForm",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(A,{emit:S}){const o=A,y=S,{changeStatusByOpportunity:z}=ie(),D=d=>{y("update:isDialogVisible",d)},V=_(structuredClone(Z(o.opportunity)));se(o,()=>{V.value=structuredClone(Z(o.opportunity))});const n=async()=>{y("update:isDialogVisible",!1);try{await z(o.opportunity.id,5,{delivery_date:V.value.sales.delivery_date}),y("updateDeliveryDate",V.value.id)}catch(d){console.error("Error updating customer:",d)}},c=()=>{y("update:isDialogVisible",!1)};return(d,w)=>{const I=ce;return s(),F(ye,{"model-value":o.isDialogVisible,"max-width":"800","onUpdate:modelValue":D},{default:t(()=>[e(I,{onClick:w[0]||(w[0]=$=>d.$emit("update:isDialogVisible",!1))}),e(W,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(me,{class:"text-h3 text-center"},{default:t(()=>w[2]||(w[2]=[C(" Confirmar Fecha ")])),_:1}),e(G,null,{default:t(()=>[e(G,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(b,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(ne,{modelValue:a(V).sales.delivery_date,"onUpdate:modelValue":w[1]||(w[1]=$=>a(V).sales.delivery_date=$),label:"Fecha de Entrega",type:"date",rules:["requiredValidator"in d?d.requiredValidator:a(K)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),e(b,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(T,{onClick:n},{default:t(()=>w[3]||(w[3]=[C(" Pasar a Entrega ")])),_:1}),e(T,{color:"secondary",variant:"tonal",onClick:c},{default:t(()=>w[4]||(w[4]=[C(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Lt={key:0},Mt={__name:"PaymentPlanEdit",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},payment:{type:Object,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(A,{emit:S}){const o=A,y=S,{updatePaymentPlans:z}=Ve(),D=_(!1),V=i=>{y("update:isDialogVisible",i)},n=_(structuredClone(Z(o.payment))),c=_(structuredClone(Z(o.opportunity))),d=_([]);se(o,()=>{n.value=structuredClone(Z(o.payment)),c.value=structuredClone(Z(o.opportunity))});const w=()=>{d.value.push({amount:"",date:"",type:n.value.type})},I=i=>{d.value.splice(i,1)},$=ee(()=>d.value.reduce((i,m)=>{const M=parseFloat(m.amount)||0;return i+M},0)),P=ee(()=>d.value.length>0&&d.value.every(i=>i.amount&&i.date&&i.type)),f=ee(()=>{if(d.value.length===0)return!0;const i=d.value.reduce((x,k)=>x+(parseFloat(k.amount)||0),0),m=parseFloat(i),M=parseFloat(n.value.amount);return m===M}),p=ee(()=>d.value.length===0?!0:P.value&&f.value),O=async()=>{if(!f.value){Se("Validación fallida","La suma de las diferencias no es correcta");return}if(!p.value){alert("Por favor, completa todos los campos obligatorios.");return}D.value=!0;try{await z(n.value.id,{date:n.value.date,differData:d.value})}catch(i){console.error("Error updating customer:",i)}finally{y("updateDeliveryDate",c.value.id),y("update:isDialogVisible",!1),d.value=[],D.value=!1}},L=()=>{y("update:isDialogVisible",!1),d.value=[],errorMessage.value=""};return(i,m)=>{const M=ce;return s(),F(ye,{"model-value":o.isDialogVisible,"max-width":"800","onUpdate:modelValue":V},{default:t(()=>[e(M,{onClick:m[0]||(m[0]=x=>i.$emit("update:isDialogVisible",!1))}),e(W,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(me,{class:"text-h3 text-center"},{default:t(()=>m[2]||(m[2]=[C(" Editar Pago ")])),_:1}),e(G,null,{default:t(()=>[e(Q,{class:"mx-5"},{default:t(()=>[e(b,{cols:"6"},{default:t(()=>[l("h3",null," Monto a Pagar : "+g(a(te)(a(n).amount)),1)]),_:1}),e(b,{cols:"6"},{default:t(()=>[e(ne,{modelValue:a(n).date,"onUpdate:modelValue":m[1]||(m[1]=x=>a(n).date=x),label:"Cambiar Fecha",type:"date",rules:["requiredValidator"in i?i.requiredValidator:a(K)]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(W,{flat:"",class:"d-flex flex-column pa-5 px-5"},{default:t(()=>[(s(!0),v(j,null,H(a(d),(x,k)=>(s(),v("div",{key:x.id,class:"d-flex align-center my-4"},[e(ne,{modelValue:x.amount,"onUpdate:modelValue":r=>x.amount=r,label:"Monto *",type:"number",class:"mr-4",outlined:"",rules:["requiredValidator"in i?i.requiredValidator:a(K)]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(ne,{modelValue:x.date,"onUpdate:modelValue":r=>x.date=r,label:"Fecha de Pago *",type:"date",class:"mr-3",outlined:"",rules:["requiredValidator"in i?i.requiredValidator:a(K)]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(T,{color:"error",onClick:r=>I(k)},{default:t(()=>[e(Y,{icon:"tabler-square-x"})]),_:2},1032,["onClick"])]))),128)),a(d).length>0?(s(),v("div",Lt,[m[3]||(m[3]=l("strong",null,"Monto Restante:",-1)),C(" "+g(a(te)(a(n).amount-a($))),1)])):B("",!0),e(T,{color:"primary",variant:"tonal",class:"mt-4",size:"small",onClick:w},{default:t(()=>m[4]||(m[4]=[C(" Diferir Pago ")])),_:1})]),_:1}),e(b,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(T,{loading:a(D),disabled:!a(p)||a(D),onClick:O},{default:t(()=>m[5]||(m[5]=[C(" Guardar ")])),_:1},8,["loading","disabled"]),e(T,{color:"error",variant:"tonal",onClick:L},{default:t(()=>m[6]||(m[6]=[C(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Ht={__name:"SalePaymentPlan",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},salesPayment:{type:Array,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(A,{emit:S}){const o=A,y=S;Ve();const z=c=>{y("update:isDialogVisible",c)},D=_(structuredClone(Z(o.opportunity)));se(o,()=>{D.value=structuredClone(Z(o.opportunity)),console.log("Sales Payment:",o.salesPayment)});const V=_([]),n=()=>{y("update:isDialogVisible",!1),V.value=[]};return(c,d)=>{const w=ce;return s(),F(ye,{"model-value":o.isDialogVisible,"max-width":"800","onUpdate:modelValue":z},{default:t(()=>[e(w,{onClick:d[0]||(d[0]=I=>c.$emit("update:isDialogVisible",!1))}),e(W,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(me,{class:"text-h3 text-center"},{default:t(()=>d[1]||(d[1]=[C(" Confirmar Fecha ")])),_:1}),e(G,null,{default:t(()=>[e(G,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(b,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l("span",null," Monto a Pagar : "+g(a(D)),1)]),_:1})]),_:1})]),_:1}),e(b,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(T,{onClick:c.onFormSubmit},{default:t(()=>d[2]||(d[2]=[C(" Guardar ")])),_:1},8,["onClick"]),e(T,{color:"error",variant:"tonal",onClick:n},{default:t(()=>d[3]||(d[3]=[C(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Qt={class:"text-h6"},Gt={class:"text-h6"},Kt={class:"text-h6"},Yt={class:"my-5"},Jt={key:0},Wt=["src"],Zt={class:"mb-4"},Xt=["onClick"],el=["onClick"],tl={class:"my-5"},ll={key:0,class:"d-flex flex-wrap gap-2 my-5"},ol={key:1},al={__name:"EditSaleOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId"],setup(A,{emit:S}){const o=A,y=S,{checkProcessForOpportunity:z}=fe(),{confirmPaymentPlans:D}=Ve(),{changeStatusByOpportunity:V,loadingOpportunity:n}=ie(),c=_(!1),d=_(!1),w=_(!1),I=_(""),$=ee(()=>o.opportunity.sales.reduce((k,r)=>k+r.amount,0)),P=ee(()=>o.opportunity.sales.reduce((k,r)=>k+r.initial_fee,0)),f=ee(()=>$.value-P.value),p=()=>{w.value=!0},O=k=>{if(k.is_paid===1){Se("Advertencia","No se puede editar un pago ya realizado.");return}console.log("entro aqui"),d.value=!0,I.value={...k}},L=async k=>{y("updateStageId",k)},i=async k=>{console.log(`Procedimiento ${k.id} marcado como: ${k.pivot.is_check?"realizado":"no realizado"}`),await z(o.opportunity.id,k.id,{is_check:!k.pivot.is_check}),k.pivot.is_check=!k.pivot.is_check,y("updateStageId",o.opportunity.id)},m=async k=>{console.log(k),await D(k),y("updateStageId",o.opportunity.id)},M=async k=>{await V(k,5,{}),y("updateStageId",k)},x=async k=>{y("updateStageId",k)};return(k,r)=>(s(),v(j,null,[l("div",null,[e(W,null,{default:t(()=>[e(G,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(b,{cols:"4",class:"border rounded-sm mx-1"},{default:t(()=>[e(le,{class:"font-weight-medium"},{default:t(()=>r[5]||(r[5]=[C(" Saldo ")])),_:1}),e(oe,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Qt,g(("formatCurrency"in k?k.formatCurrency:a(te))(a(f))),1)]),_:1})]),_:1}),e(b,{cols:"3",class:"border rounded-sm mx-1"},{default:t(()=>[e(le,{class:"font-weight-medium"},{default:t(()=>r[6]||(r[6]=[C(" Anticipo ")])),_:1}),e(oe,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Gt,g(("formatCurrency"in k?k.formatCurrency:a(te))(a(P))),1)]),_:1})]),_:1}),e(b,{cols:"4",class:"border rounded-sm mx-1"},{default:t(()=>[e(le,{class:"font-weight-medium"},{default:t(()=>r[7]||(r[7]=[C(" Precio Final ")])),_:1}),e(oe,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Kt,g(("formatCurrency"in k?k.formatCurrency:a(te))(a($))),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),l("div",Yt,[r[8]||(r[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Propiedades ",-1)),o.opportunity.sales.length>0?(s(),v("div",Jt,[(s(!0),v(j,null,H(o.opportunity.sales,h=>(s(),v("div",{key:h.id},[(s(!0),v(j,null,H(h.properties,U=>(s(),v("div",{key:U.id,class:"d-flex align-center justify-between"},[e(Oe,{size:"50",rounded:""},{default:t(()=>[l("img",{src:a(je),alt:"Logo pora",style:{"border-radius":"30%"}},null,8,Wt)]),_:1}),e(b,{cols:"12",md:"7"},{default:t(()=>[e(le,{class:"font-weight-medium"},{default:t(()=>[C(g(U.project_title)+" | "+g(U.title),1)]),_:2},1024),e(oe,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",null,"$ "+g(U.pivot_price),1)]),_:2},1024)]),_:2},1024)]))),128))]))),128))])):B("",!0)]),l("div",Zt,[r[11]||(r[11]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Anticipo ",-1)),o.opportunity.initial_payments&&o.opportunity.initial_payments.length>0?(s(),F(pe,{key:0,density:"compact",class:"text-no-wrap my-2",style:{"font-size":"12px"}},{default:t(()=>[r[10]||(r[10]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th",null," Action ")])],-1)),l("tbody",null,[(s(!0),v(j,null,H(o.opportunity.initial_payments,h=>(s(),v("tr",{key:h.id},[l("td",null,g(h.property_title),1),l("td",null,g(h.date),1),l("td",null,g(h.amount),1),l("td",null,[e(Q,null,{default:t(()=>[e(de,{modelValue:h.is_paid,"onUpdate:modelValue":U=>h.is_paid=U,"true-value":1,"false-value":0,disabled:h.is_paid===1,onChange:U=>m(h.id)},{default:t(()=>[e(ae,{activator:"parent",location:"top"},{default:t(()=>r[9]||(r[9]=[C(" Confirmar Pago ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"]),h.is_paid===0?(s(),v("div",{key:0,"fill-dot":"",style:{cursor:"pointer"},onClick:U=>O(h)},[e(Y,{size:"25",icon:"tabler-edit"})],8,Xt)):B("",!0)]),_:2},1024)])]))),128))])]),_:1})):B("",!0)]),l("div",null,[r[14]||(r[14]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Saldos ",-1)),o.opportunity.balance_payments&&o.opportunity.balance_payments.length>0?(s(),F(pe,{key:0,density:"compact",class:"text-no-wrap my-2",style:{"font-size":"12px"}},{default:t(()=>[r[13]||(r[13]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th",null," Action ")])],-1)),l("tbody",null,[(s(!0),v(j,null,H(o.opportunity.balance_payments,h=>(s(),v("tr",{key:h.id},[l("td",null,g(h.property_title),1),l("td",null,g(h.date),1),l("td",null,g(h.amount),1),l("td",null,[e(Q,null,{default:t(()=>[e(de,{modelValue:h.is_paid,"onUpdate:modelValue":U=>h.is_paid=U,"true-value":1,"false-value":0,disabled:h.is_paid===1,onChange:U=>m(h.id)},{default:t(()=>[e(ae,{activator:"parent",location:"top"},{default:t(()=>r[12]||(r[12]=[C(" Confirmar Pago ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"]),h.is_paid===0?(s(),v("div",{key:0,"fill-dot":"",style:{cursor:"pointer"},onClick:U=>O(h)},[e(Y,{size:"25",icon:"tabler-edit"})],8,el)):B("",!0)]),_:2},1024)])]))),128))])]),_:1})):B("",!0)]),l("div",tl,[r[16]||(r[16]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(s(),v("div",ll,[(s(!0),v(j,null,H(o.opportunity.procedure,h=>(s(),v("div",{key:h.id},[e(X,{color:h.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:U=>i(h)},{default:t(()=>[h.pivot.is_check?(s(),F(Y,{key:0,icon:"tabler-check",class:"mr-2"})):B("",!0),C(" "+g(h.title),1)]),_:2},1032,["color","onClick"]),e(ae,{activator:"parent",location:"top"},{default:t(()=>[C(g(h.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(s(),v("div",ol,r[15]||(r[15]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(G,{class:"d-flex mt-4"},{default:t(()=>[e(T,{color:"primary",variant:"tonal",class:"mx-auto",size:"small",onClick:p},{default:t(()=>r[17]||(r[17]=[C(" Generar Venta ")])),_:1}),e(T,{color:"primary",class:"mx-auto",size:"small",onClick:r[0]||(r[0]=h=>M(o.opportunity.id))},{default:t(()=>r[18]||(r[18]=[C(" Siguiente Etapa ")])),_:1})]),_:1}),e(Rt,{"is-dialog-visible":a(c),"onUpdate:isDialogVisible":r[1]||(r[1]=h=>R(c)?c.value=h:null),opportunity:o.opportunity,onUpdateDeliveryDate:x},null,8,["is-dialog-visible","opportunity"]),e(Mt,{"is-dialog-visible":a(d),"onUpdate:isDialogVisible":r[2]||(r[2]=h=>R(d)?d.value=h:null),payment:a(I),opportunity:o.opportunity,onUpdateDeliveryDate:x},null,8,["is-dialog-visible","payment","opportunity"]),e(xe,{"is-dialog-visible":a(w),"onUpdate:isDialogVisible":r[3]||(r[3]=h=>R(w)?w.value=h:null),opportunity:o.opportunity,stage:"SALE",onRegisterSale:L},null,8,["is-dialog-visible","opportunity"]),e(Ht,{"is-dialog-visible":k.openSaleEditPaymentPlan,"onUpdate:isDialogVisible":r[4]||(r[4]=h=>k.openSaleEditPaymentPlan=h),opportunity:o.opportunity,"sales-payment":k.salePaymentPlan,onUpdateDeliveryDate:x},null,8,["is-dialog-visible","opportunity","sales-payment"])],64))}},il=async A=>await ue(`/customer/${A}/bitacora`,{method:"GET"});function sl(){const A=_(!1),S=_([]);return Qe(),_(0),{getBitacorabyId:async y=>{try{const z=await il(y);S.value=z,console.log(z)}catch(z){console.error(z)}},loadingBitacora:A,bitacoras:ee(()=>S.value)}}const nl={class:"my-5"},rl={class:"d-flex justify-space-between align-center gap-2 flex-wrap"},ul={class:"app-timeline-title"},dl={class:"app-timeline-meta"},pl={class:"app-timeline-text"},cl={key:0,class:"empty-state my-2"},ml={__name:"BitacoraCustomer",props:{customer:{type:String,required:!0}},setup(A){const S=A,{bitacoras:o,getBitacorabyId:y}=sl();Ue(async()=>{await y(S.customer)});const z=D=>{switch(D){case 1:return"Visita";case 2:return"Llamada";case 3:return"Cotización";default:return"Otro"}};return(D,V)=>(s(),v("div",null,[e(W,{title:"Historial del cliente"},{default:t(()=>[e(G,null,{default:t(()=>[e(Q,{class:"d-flex justify-space-between"},{default:t(()=>[e(b,{cols:"12"},{default:t(()=>[l("div",nl,[e(Ze,{side:"end",align:"start","line-inset":"8","truncate-line":"both",density:"compact"},{default:t(()=>[(s(!0),v(j,null,H(a(o),n=>(s(),F(Xe,{key:n.id,size:"x-small","dot-color":"warning"},{default:t(()=>[l("div",rl,[l("span",ul,g(n.log_name),1),l("span",dl,g(("formatDate"in D?D.formatDate:a(Ke))(n.created_at)),1)]),l("div",pl,[l("p",null,g(n.description),1),n.properties.activity?(s(),F(X,{key:0},{default:t(()=>[C(g(z(n.properties.activity.type_activity_id)),1)]),_:2},1024)):B("",!0)])]),_:2},1024))),128))]),_:1}),!a(o)||a(o).length===0?(s(),v("div",cl,V[0]||(V[0]=[l("p",null,"No hay actividades registradas para este cliente.",-1)]))):B("",!0)])]),_:1})]),_:1})]),_:1})]),_:1})]))}},yl={__name:"DrawerBitacora",props:{isDrawerOpen:{type:Boolean,required:!0},customer:{type:String,required:!1}},emits:["update:isDrawerOpen"],setup(A,{emit:S}){const o=A,y=S,z=D=>{y("update:isDrawerOpen",D)};return(D,V)=>(s(),F(qe,{temporary:"",width:500,location:"end",class:"scrollable-content","model-value":o.isDrawerOpen,"onUpdate:modelValue":z},{default:t(()=>[e(a(Fe),{options:{wheelPropagation:!1}},{default:t(()=>[e(ml,{customer:"1"})]),_:1})]),_:1},8,["model-value"]))}};const fl={__name:"SellerReport",setup(A){return _([{title:"Actividad 1",date:"2024-10-09",status:"Pendiente"},{title:"Actividad 2",date:"2024-10-10",status:"Completada"},{title:"Actividad 3",date:"2024-10-11",status:"En Progreso"}]),(S,o)=>(s(),F(G,null,{default:t(()=>o[0]||(o[0]=[l("p",null,"No hay actividades seleccionadas. Aquí tienes un resumen de las actividades:",-1)])),_:1}))}},vl=Ee(fl,[["__scopeId","data-v-c9cbe3f1"]]),gl={__name:"CustomerHistory",props:{isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","userData"],setup(A,{emit:S}){const o=A,y=S,z=_(!1),D=_(),V=_(""),n=_(""),c=_(""),d=_(""),w=_(),I=_(""),$=_(),P=_(),f=_(),p=()=>{y("update:isDrawerOpen",!1),Ce(()=>{var i,m;(i=D.value)==null||i.reset(),(m=D.value)==null||m.resetValidation()})},O=()=>{var i;(i=D.value)==null||i.validate().then(({valid:m})=>{m&&(y("userData",{id:0,fullName:V.value,company:d.value,role:$.value,country:w.value,contact:I.value,email:c.value,currentPlan:P.value,status:f.value,avatar:"",billing:"Auto Debit"}),y("update:isDrawerOpen",!1),Ce(()=>{var M,x;(M=D.value)==null||M.reset(),(x=D.value)==null||x.resetValidation()}))})},L=i=>{y("update:isDrawerOpen",i)};return(i,m)=>{const M=et,x=_e,k=be;return s(),F(qe,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":o.isDrawerOpen,"onUpdate:modelValue":L},{default:t(()=>[e(M,{title:"Historial del Cliente",onCancel:p}),e(a(Fe),{options:{wheelPropagation:!1}},{default:t(()=>[e(W,{flat:""},{default:t(()=>[e(G,null,{default:t(()=>[e(Ie,{ref_key:"refForm",ref:D,modelValue:a(z),"onUpdate:modelValue":m[9]||(m[9]=r=>R(z)?z.value=r:null),onSubmit:$e(O,["prevent"])},{default:t(()=>[e(Q,null,{default:t(()=>[e(b,{cols:"12"},{default:t(()=>[e(x,{modelValue:a(V),"onUpdate:modelValue":m[0]||(m[0]=r=>R(V)?V.value=r:null),rules:["requiredValidator"in i?i.requiredValidator:a(K)],label:"Full Name",placeholder:"John Doe"},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(x,{modelValue:a(n),"onUpdate:modelValue":m[1]||(m[1]=r=>R(n)?n.value=r:null),rules:["requiredValidator"in i?i.requiredValidator:a(K)],label:"Username",placeholder:"Johndoe"},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(x,{modelValue:a(c),"onUpdate:modelValue":m[2]||(m[2]=r=>R(c)?c.value=r:null),rules:["requiredValidator"in i?i.requiredValidator:a(K),"emailValidator"in i?i.emailValidator:a(Re)],label:"Email",placeholder:"johndoe@email.com"},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(x,{modelValue:a(d),"onUpdate:modelValue":m[3]||(m[3]=r=>R(d)?d.value=r:null),rules:["requiredValidator"in i?i.requiredValidator:a(K)],label:"Company",placeholder:"PixInvent"},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(k,{modelValue:a(w),"onUpdate:modelValue":m[4]||(m[4]=r=>R(w)?w.value=r:null),label:"Select Country",placeholder:"Select Country",rules:["requiredValidator"in i?i.requiredValidator:a(K)],items:["USA","UK","India","Australia"]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(x,{modelValue:a(I),"onUpdate:modelValue":m[5]||(m[5]=r=>R(I)?I.value=r:null),type:"number",rules:["requiredValidator"in i?i.requiredValidator:a(K)],label:"Contact",placeholder:"+1-541-754-3010"},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(k,{modelValue:a($),"onUpdate:modelValue":m[6]||(m[6]=r=>R($)?$.value=r:null),label:"Select Role",placeholder:"Select Role",rules:["requiredValidator"in i?i.requiredValidator:a(K)],items:["Admin","Author","Editor","Maintainer","Subscriber"]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(k,{modelValue:a(P),"onUpdate:modelValue":m[7]||(m[7]=r=>R(P)?P.value=r:null),label:"Select Plan",placeholder:"Select Plan",rules:["requiredValidator"in i?i.requiredValidator:a(K)],items:["Basic","Company","Enterprise","Team"]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(k,{modelValue:a(f),"onUpdate:modelValue":m[8]||(m[8]=r=>R(f)?f.value=r:null),label:"Select Status",placeholder:"Select Status",rules:["requiredValidator"in i?i.requiredValidator:a(K)],items:[{title:"Active",value:"active"},{title:"Inactive",value:"inactive"},{title:"Pending",value:"pending"}]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(T,{type:"submit",class:"me-3"},{default:t(()=>m[10]||(m[10]=[C(" Submit ")])),_:1}),e(T,{type:"reset",variant:"outlined",color:"secondary",onClick:p},{default:t(()=>m[11]||(m[11]=[C(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},_l={class:"d-flex justify-space-between align-center"},bl={class:"mb-2"},Vl={style:{"font-size":"14px","font-weight":"500"}},wl={style:{"font-size":"12px","font-weight":"500"}},Cl={__name:"AddActivity",props:{activitiesData:{type:Object,required:!0,default:()=>({title:"",description:"",schedule_at:""})},isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","refreshActivities"],setup(A,{emit:S}){const o=A,y=S,z=_(!1);_(!1);const D=_("radio-1"),V=_(!1),n=()=>{V.value=!0},c=_({title:"",description:"",type_activity_id:null,opportunity_id:null,assigned_to:null,scheduled_at:null,status:"COMPLETED"}),{completedActivityAndRegister:d,getallTypeActivities:w,typeActivities:I,loadingActivity:$}=Ae(),{getOpportunitybyId:P,opportunity:f}=ie(),p=_(structuredClone(Z(o.activitiesData))),O=U=>{console.log("esta consultando de nuevo despues de cambiar etapa "),P(U)};se(o,()=>{p.value=structuredClone(Z(o.activitiesData)),P(p.value.opportunity_id),L()});const L=async()=>{await w()},i=()=>{P(p.value.opportunity_id)},m=()=>{y("update:isDrawerOpen",!1),c.value={title:null,description:null,type_activity_id:null,scheduled_at:null,opportunity_id:null,assigned_to:null,status:"COMPLETED"},y("refreshActivities")},M=async()=>{let U="";D.value==="radio-1"?U="COMPLETED":D.value==="radio-2"&&(U="CANCELLED"),d(p.value.id,{title:c.value.title,description:c.value.description,type_activity_id:c.value.type_activity_id,scheduled_at:c.value.scheduled_at,assigned_to:f.value.user_id,property_id:f.value.property_id,opportunity_id:f.value.id,status:U}),m()},x=async()=>{we.fire({title:"Quieres dar de baja al cliente ?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"confirmar"}).then(U=>{U.isConfirmed&&(Ne(p.value.id),m(),we.fire({text:"EL cliente fue dado de baja",icon:"success"}))})},k=async()=>{y("update:isDrawerOpen",!1),y("refreshActivities")},r=()=>{console.log("Se escucho el evento en AddActivity"),y("refreshActivities")},h=U=>{const u=new Date(U),J=u.getDate(),N=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][u.getMonth()],E=u.getHours().toString().padStart(2,"0"),ve=u.getMinutes().toString().padStart(2,"0");return`${J} de ${N}, ${E}:${ve}`};return(U,u)=>{const J=_e,q=Le,N=De;return s(),v(j,null,[e(Q,{class:"d-flex justify-space-between"},{default:t(()=>[e(b,{cols:"12"},{default:t(()=>[A.isDrawerOpen?(s(),F(W,{key:0},{default:t(()=>[e(G,null,{default:t(()=>[e(Te,{class:"mx-2 my-2"},{default:t(()=>[e(Q,null,{default:t(()=>[e(b,{cols:"12",sm:"5"},{default:t(()=>[e(Q,null,{default:t(()=>[e(b,{cols:"12"},{default:t(()=>[l("div",_l,[u[8]||(u[8]=l("span",{style:{"font-size":"18px","font-weight":"500"}}," Actividad ",-1)),e(X,{color:"warning",onClick:n},{default:t(()=>u[7]||(u[7]=[C(" historial ")])),_:1})])]),_:1}),e(b,{cols:"12"},{default:t(()=>[l("div",bl,[l("span",Vl,g(o.activitiesData.title)+" • "+g(h(o.activitiesData.scheduled_at)),1),u[9]||(u[9]=l("br",null,null,-1)),l("span",wl,g(o.activitiesData.description)+" "+g(a(f).customer_id),1)]),e(lt,{modelValue:a(D),"onUpdate:modelValue":u[0]||(u[0]=E=>R(D)?D.value=E:null),style:{"font-size":"14px"},inline:""},{default:t(()=>[u[10]||(u[10]=l("span",{class:"my-1"}," ¿Se realizó? ",-1)),e(Pe,{label:"Si",value:"radio-1",density:"compact",class:"mx-2"}),e(Pe,{label:"No",value:"radio-2",class:"mx-2",density:"compact"})]),_:1},8,["modelValue"]),e(ot,{class:"mt-2"})]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(J,{modelValue:a(c).title,"onUpdate:modelValue":u[1]||(u[1]=E=>a(c).title=E),label:"Título de la actividad",placeholder:"..."},null,8,["modelValue"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(be,{modelValue:a(c).type_activity_id,"onUpdate:modelValue":u[2]||(u[2]=E=>a(c).type_activity_id=E),label:"Tipo de actividad",placeholder:"Selecciona el tipo de actividad",items:a(I).map(E=>({title:E.name,value:E.id}))},null,8,["modelValue","items"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(q,{modelValue:a(c).scheduled_at,"onUpdate:modelValue":u[3]||(u[3]=E=>a(c).scheduled_at=E),label:"Seleccione la fecha y hora",placeholder:"Seleccione la fecha y hora",config:{enableTime:!0,dateFormat:"Y-m-d H:i"},rules:["requiredValidator"in U?U.requiredValidator:a(K)]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(N,{modelValue:a(c).description,"onUpdate:modelValue":u[4]||(u[4]=E=>a(c).description=E),label:"Descripción",rows:"3",rules:["requiredValidator"in U?U.requiredValidator:a(K)]},null,8,["modelValue","rules"])]),_:1}),e(b,null,{default:t(()=>[e(T,{color:"primary",class:"mx-auto",size:"small",loading:a($),disabled:a($),onClick:M},{default:t(()=>u[11]||(u[11]=[C(" Crear Actividad ")])),_:1},8,["loading","disabled"]),e(T,{color:"primary",class:"mx-1",variant:"tonal",size:"small",onClick:x},{default:t(()=>u[12]||(u[12]=[C(" Dar de Baja ")])),_:1})]),_:1})]),_:1})]),_:1}),e(b,{cols:"12",sm:"7",style:{"align-items":"center"}},{default:t(()=>[e(Q,{class:"mb-2"},{default:t(()=>[e(b,{cols:"6"},{default:t(()=>u[13]||(u[13]=[l("span",{style:{"font-size":"18px","font-weight":"500"}}," Etapa ",-1)])),_:1}),e(b,{cols:"12",md:"6",class:"d-flex justify-end align-center"},{default:t(()=>[e(X,{label:"",color:"primary"},{default:t(()=>[C(g(a(f).stage.title),1)]),_:1})]),_:1})]),_:1}),a(f).stage_id===2?(s(),F(jt,{key:0,opportunity:a(f),onUpdateStageId:O,"onUpdate:newProperty":r},null,8,["opportunity"])):B("",!0),a(f).stage_id===3?(s(),F(Dt,{key:1,opportunity:a(f),onUpdateStageId:O,"onUpdate:newProperty":r},null,8,["opportunity"])):B("",!0),a(f).stage_id===4?(s(),F(al,{key:2,opportunity:a(f),onRefreshActivities:i,onUpdateStageId:O},null,8,["opportunity"])):B("",!0),a(f).stage_id===5?(s(),F(ft,{key:3,opportunity:a(f),onRefreshActivities:i,onUpdateStageId:O,onComplet:k},null,8,["opportunity"])):B("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):(s(),F(W,{key:1,title:"Reporte de Actividades"},{default:t(()=>[e(vl)]),_:1}))]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(gl,{"is-drawer-open":a(z),"onUpdate:isDrawerOpen":u[5]||(u[5]=E=>R(z)?z.value=E:null)},null,8,["is-drawer-open"])]),_:1})]),_:1}),e(yl,{"is-drawer-open":a(V),"onUpdate:isDrawerOpen":u[6]||(u[6]=E=>R(V)?V.value=E:null),customer:a(f).customer_id},null,8,["is-drawer-open","customer"])],64)}}};const Pl={class:"mt-2 mx-3"},kl={style:{"font-size":"14px"}},xl={key:0,class:"no-activities-message d-flex flex-column justify-center align-center",style:{"min-block-size":"200px","text-align":"center"}},Al=["onClick"],Dl={class:"mx-2"},hl={class:"d-flex justify-content-between",style:{"font-size":"0.9em"}},Sl={__name:"list",setup(A){const S=_(""),o=_("Anteriores");_(["Todos","PORA"]),_("Todos");const{getallActivitiesByAsesorFecha:y,getallActivitiesByFechaPast:z,getallActivitiesByFechaFuture:D,activities:V,activitiesPast:n,activitiesFuture:c}=Ae(),d=_(""),w=Ge("userData").value,I=_(!0),$=_([]),P=_([]),f=_([]),p=async()=>{await y(w.id),$.value=V.value},O=async()=>{await z(w.id),P.value=n.value},L=async()=>{await D(w.id),f.value=c.value};Ue(async()=>{await p(),await O(),await L(),I.value=!1});const i=_(!1),m=U=>{i.value=!0,d.value={...U}},M=async()=>{I.value=!0,await p(),await O(),await L(),I.value=!1},x=ee(()=>[{tabName:"Anteriores",icon:"tabler-calendar",actividades:P,badge:P.value.length},{tabName:"Hoy",icon:"tabler-edit",actividades:$,badge:$.value.length},{tabName:"Futuros",icon:"tabler-calendar",actividades:f,badge:f.value.length}]),k=[{type:"Visita",icon:"tabler-current-location"},{type:"Llamada",icon:"tabler-phone"},{type:"Cotizacion",icon:"tabler-cash"},{type:"Otro",icon:"tabler-table"}],r=U=>{const u=k.find(J=>J.type===U);return u?u.icon:"tabler-default"},h=U=>{const u=new Date(U),J=u.getDate(),N=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][u.getMonth()],E=u.getHours().toString().padStart(2,"0"),ve=u.getMinutes().toString().padStart(2,"0");return`${J} de ${N}, ${E}:${ve}`};return se(S,U=>{const u=J=>J.filter(q=>{const N=q.name_opportunity.toLowerCase().includes(U.toLowerCase()),E=q.phone_opportunity.toLowerCase().includes(U.toLowerCase());return N||E});U.length>2?($.value=u(V.value),P.value=u(n.value),f.value=u(c.value)):($.value=V.value,P.value=n.value,f.value=c.value)}),(U,u)=>{const J=re("VCircularProgress");return s(),F(Q,{class:"match-height",style:{display:"flex","block-size":"100vh"}},{default:t(()=>[e(b,{cols:"12",md:"4",style:{display:"flex","flex-direction":"column"}},{default:t(()=>[e(W,{class:"flex-grow-1"},{default:t(()=>[e(me,{class:"d-flex justify-between align-center flex-wrap"},{default:t(()=>[u[5]||(u[5]=l("h4",{class:"mt-5"}," Mis Actividades ",-1)),l("div",Pl,[e(ne,{modelValue:S.value,"onUpdate:modelValue":u[0]||(u[0]=q=>S.value=q),placeholder:"Buscar actividad...",class:"search-field",variant:"plain","hide-details":"",dense:"","prepend-inner-icon":"tabler-search"},null,8,["modelValue"])])]),_:1}),e(at,{modelValue:o.value,"onUpdate:modelValue":u[1]||(u[1]=q=>o.value=q),grow:""},{default:t(()=>[(s(!0),v(j,null,H(x.value,q=>(s(),F(it,{key:q.tabName},{default:t(()=>[l("span",kl,g(q.tabName),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),u[11]||(u[11]=l("br",null,null,-1)),e(G,{style:{"flex-grow":"1","overflow-y":"auto"}},{default:t(()=>[I.value?(s(),F(st,{key:0,absolute:"",opacity:"0.7"},{default:t(()=>[e(J,{indeterminate:"",size:"70"})]),_:1})):B("",!0),e(Te,{modelValue:o.value,"onUpdate:modelValue":u[2]||(u[2]=q=>o.value=q),class:"disable-tab-transition",style:{"max-block-size":"500px","overflow-y":"auto"}},{default:t(()=>[(s(!0),v(j,null,H(x.value,q=>(s(),F(tt,{key:q.tabName,value:q.tabName},{default:t(()=>[q.actividades.value.length===0?(s(),v("div",xl,[e(Y,{size:"64",color:"grey",icon:"tabler-calendar-off",class:"mb-4",style:{animation:"bounce 1s infinite"}}),u[6]||(u[6]=l("div",{style:{color:"#888","font-size":"1.2em"}}," ¡No tienes actividades pendientes! ",-1)),u[7]||(u[7]=l("div",{style:{color:"#aaa","font-size":"0.9em","margin-block-start":"8px"}}," ¡Relájate y disfruta tu día! ",-1))])):(s(!0),v(j,{key:1},H(q.actividades.value,N=>(s(),v("div",{key:N.id,"fill-dot":"",class:"border mb-2 rounded-sm py-2",style:{cursor:"pointer"},onClick:E=>m(N)},[e(ge,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(b,{cols:"12",md:"2",style:{"padding-inline-end":"0"}},{default:t(()=>[e(X,{class:"d-flex justify-center align-center",style:{display:"inline-flex","border-radius":"4px","block-size":"36px","inline-size":"36px"}},{default:t(()=>[e(Y,{size:"25",icon:"tabler-home"})]),_:1})]),_:1}),N.project_name?(s(),F(b,{key:0,cols:"12",md:"5",class:"d-flex flex-column align-start",style:{"padding-inline-start":"0"}},{default:t(()=>[e(oe,{class:"text-left"},{default:t(()=>[l("strong",null,g(N.property_title),1)]),_:2},1024),e(le,{class:"font-weight-medium text-left"},{default:t(()=>[l("span",null,"$ "+g(N.price),1)]),_:2},1024)]),_:2},1024)):B("",!0),N.project_name?B("",!0):(s(),F(b,{key:1,cols:"12",md:"5"},{default:t(()=>[e(oe,{class:"text-left"},{default:t(()=>u[8]||(u[8]=[l("strong",{style:{"font-size":"12px"}}," Departamento ",-1)])),_:1}),e(le,{class:"font-weight-medium text-left"},{default:t(()=>u[9]||(u[9]=[l("span",null,"Indefinido",-1)])),_:1})]),_:1})),e(b,{cols:"12",md:"5",class:"d-flex justify-end align-center"},{default:t(()=>[e(X,{label:"",color:"primary",class:"ml-auto",style:{"font-size":"10px"}},{default:t(()=>[C(g(N.stage),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(ge,{class:""},{default:t(()=>[e(X,{label:"",color:"secondary",class:"w-100 h-48"},{default:t(()=>[e(Y,{size:"20",icon:r(N.type_activity)},null,8,["icon"]),l("div",Dl,g(N.type_activity)+"   •   "+g(N.name_opportunity),1)]),_:2},1024)]),_:2},1024),e(ge,null,{default:t(()=>[l("div",hl,[u[10]||(u[10]=l("div",{style:{"flex-grow":"1"}}," Ver ",-1)),l("div",null,g(h(N.scheduled_at)),1)])]),_:2},1024)],8,Al))),128))]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(b,{cols:"12",md:"8",style:{display:"flex","flex-direction":"column"}},{default:t(()=>[e(Cl,{"is-drawer-open":i.value,"onUpdate:isDrawerOpen":u[3]||(u[3]=q=>i.value=q),"activities-data":d.value,class:"flex-grow-1",onRefreshActivities:M,onLoaded:u[4]||(u[4]=q=>I.value=!1)},null,8,["is-drawer-open","activities-data"])]),_:1})]),_:1})}}},Bo=Ee(Sl,[["__scopeId","data-v-a55b93d4"]]);export{Bo as default};
