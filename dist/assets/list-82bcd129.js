import{u as ie,p as xe,S as De,_ as Ce,a as he,d as Ne}from"./PreSaleForm-65fc2a5b.js";import{r as K,e as Re}from"./validators-dea6e3a5.js";import{_ as $e}from"./AppTextarea-ab6af6e6.js";import{_ as Le}from"./AppDateTimePicker-c049a7d8.js";import{_ as _e}from"./AppTextField-a0f17f96.js";import{_ as be}from"./AppSelect-fa39d2c4.js";import{f as te}from"./currencyFormatter-92ad4b3c.js";import{$ as ue}from"./api-2a7c2368.js";import{s as Se,a as Me,b as He,c as Ae,S as we}from"./notifications-81bc0416.js";import{r as _,o as s,c as v,d as l,F as I,i as H,b as e,e as t,n as a,v as P,x as g,z as B,f as q,$ as W,a4 as T,w as se,a3 as Oe,a as re,a0 as R,am as X,a2 as ee,k as Ge,H as ze,an as Pe,ac as Qe}from"./index-3cd3f830.js";import{V as Ue}from"./VAvatar-46583585.js";import{b as le,c as oe,a as ge}from"./VList-7b985441.js";import{V as b}from"./VCol-92f98bf4.js";import{V as Z}from"./VChip-5553f561.js";import{V as ae}from"./VTooltip-1488171c.js";import{V as Q}from"./VCardText-e684c635.js";import{a as Fe,f as Ke}from"./formatters-b3558c7d.js";import{u as We}from"./useQuote-d14e4905.js";import{_ as Je}from"./AppAutocomplete-35b276e3.js";import{_ as ce}from"./DialogCloseBtn-8a3ea6b5.js";import{u as Ye}from"./useProperty-5cffb36a.js";import{V as Y,b as me}from"./VCard-22de6f72.js";import{V as qe}from"./VForm-3c64fe3d.js";import{V as G}from"./VRow-5cd32432.js";import{V as ye}from"./VDialog-d2d185f4.js";import{V as de}from"./VCheckbox-9b365ff3.js";import{V as pe}from"./VTable-804e0986.js";import{V as ne}from"./VTextField-b9252724.js";import{P as Ee}from"./vue3-perfect-scrollbar.esm-91b7dc86.js";import{V as Xe,a as Ze}from"./VTimelineItem-b3b35c47.js";import{V as je}from"./VNavigationDrawer-69c3079f.js";import{_ as Te}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as et}from"./AppDrawerHeaderSection-acd9d6c2.js";import{V as Ie,a as tt}from"./VWindowItem-1f1930e3.js";import{V as lt,a as ke}from"./VRadioGroup-a753585f.js";import{V as ot}from"./VDivider-28d64a52.js";import{V as at,a as it}from"./VTabs-4c19cc02.js";import{V as st}from"./VOverlay-885bc793.js";import"./useSales-8229786c.js";import"./InvoiceAddMoney-9e7ac099.js";import"./VNodeRenderer-155e3edb.js";import"./helpers-61e4df1a.js";import"./form-624ae54d.js";/* empty css                   */import"./VCounter-0c01e569.js";import"./VImg-6b2a49fd.js";import"./VField-9afe8dbc.js";import"./easing-9f15041e.js";import"./VInput-f64ff79c.js";import"./forwardRefs-8348545e.js";import"./VSelect-f80c5130.js";import"./dialog-transition-a432878a.js";import"./VMenu-a09ba739.js";import"./scopeId-ddb5abdc.js";import"./VCheckboxBtn-6f933f36.js";import"./VSelectionControl-07c79a34.js";import"./index-9c720871.js";import"./constants-f3b5ca65.js";import"./ssrBoot-cd5ad573.js";import"./filter-68086a89.js";import"./VSpacer-dd4ae4e8.js";import"./lazy-154653c9.js";import"./VSlideGroup-884576ae.js";const nt=async(C,S)=>await ue(`/opportunity/${C}/stage/${S}`,{method:"GET"}),rt=async(C,S,o)=>await ue(`/opportunity/${C}/procedure/${S}`,{method:"PATCH",body:o});function fe(){const C=_(null),S=_(!1),o=_(!1),y=_([]);return{process:C,loadingProcess:S,errorProcess:o,processes:y,allProcessesOpportunityForStage:async(V,n)=>{try{const c=await nt(V,n);y.value=c.data}catch(c){console.log(c)}},checkProcessForOpportunity:async(V,n,c)=>{try{console.log(c);const d=await rt(V,n,c);Se("¡Proceso completado exitosamente!","El proceso ha sido llevado a cabo sin inconvenientes. ")}catch(d){console.log(d)}}}}const ut={class:"my-5"},dt={key:0},pt=["src"],ct={class:"my-5"},mt={key:0,class:"d-flex flex-wrap gap-2 my-5"},yt={key:1},ft={__name:"EditDeliveryOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","complet"],setup(C,{emit:S}){const o=C,y=S,{changeStatusByOpportunity:U}=ie(),{checkProcessForOpportunity:h}=fe(),V=async()=>{try{await U(o.opportunity.id,7,{}),y("complet")}catch(c){console.error("Error updating customer:",c)}},n=async(c,d)=>{console.log(`Procedimiento ${c} marcado como: ${d?"realizado":"no realizado"}`),await h(o.opportunity.id,c,{is_check:!d}),y("updateStageId",o.opportunity.id)};return(c,d)=>(s(),v(I,null,[l("div",ut,[d[0]||(d[0]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Propiedades ",-1)),o.opportunity.sales.length>0?(s(),v("div",dt,[(s(!0),v(I,null,H(o.opportunity.sales,w=>(s(),v("div",{key:w.id},[(s(!0),v(I,null,H(w.properties,F=>(s(),v("div",{key:F.id,class:"d-flex align-center justify-between"},[e(Ue,{size:"50",rounded:""},{default:t(()=>[l("img",{src:a(xe),alt:"Logo pora",style:{"border-radius":"30%"}},null,8,pt)]),_:1}),e(b,{cols:"12",md:"7"},{default:t(()=>[e(le,{class:"font-weight-medium"},{default:t(()=>[P(g(F.project_title)+" | "+g(F.title),1)]),_:2},1024),e(oe,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",null,g(("formatCurrency"in c?c.formatCurrency:a(te))(F.pivot_price)),1)]),_:2},1024)]),_:2},1024)]))),128))]))),128))])):B("",!0)]),l("div",ct,[d[2]||(d[2]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(s(),v("div",mt,[(s(!0),v(I,null,H(o.opportunity.procedure,w=>(s(),v("div",{key:w.id},[e(Z,{color:w.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:F=>n(w.id,w.pivot.is_check)},{default:t(()=>[w.pivot.is_check?(s(),q(W,{key:0,icon:"tabler-check",class:"mr-2"})):B("",!0),P(" "+g(w.title),1)]),_:2},1032,["color","onClick"]),e(ae,{activator:"parent",location:"top"},{default:t(()=>[P(g(w.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(s(),v("div",yt,d[1]||(d[1]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(Q,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(T,{color:"primary",size:"small",onClick:V},{default:t(()=>d[3]||(d[3]=[P(" Finalizar Oportunidad ")])),_:1})]),_:1})],64))}},Be={__name:"EditCustomerDialog",props:{isDialogVisible:{type:Boolean,required:!0},opportunityKanban:{type:Object,required:!0}},emits:["update:isDialogVisible","update:newProperty"],setup(C,{emit:S}){const o=C,y=S;Object.values(De).map(f=>({title:f.label,value:f.value}));const{propertiesAvailbles:U,properties:h}=Ye(),{getOpportunitybyId:V,opportunity:n,changeOpportunity:c,loadingOpportunity:d}=ie(),w=()=>{y("update:isDialogVisible",!1)},F=async()=>{console.log("antes del save:",n);const f={id:n.value.id,description:n.value.description,property_id:n.value.property_id,customer:{id:n.value.customer.id,name:n.value.customer.name,email:n.value.customer.email,ci:n.value.customer.ci,cod_phone:n.value.customer.cod_phone.replace(/\+/g,""),phone:n.value.customer.phone}};console.log("data de editar",f),await c(n.value.id,f),n.value.property_id&&(console.log("Cambio y geenero el Emit Principal"),y("update:newProperty",n.value.property_id)),y("update:isDialogVisible",!1)},A=async()=>{var f;(f=o.opportunityKanban)!=null&&f.id&&await V(o.opportunityKanban.id)},k=async()=>{await U()};return se(()=>o.isDialogVisible,async f=>{f===!0&&(A(),await k())}),(f,p)=>{const z=ce,L=_e,i=be,m=Je,M=$e;return s(),q(ye,{"max-width":"800","model-value":o.isDialogVisible,persistent:"","close-on-esc":!1,"onUpdate:modelValue":w},{default:t(()=>[e(z,{onClick:w}),e(Y,{title:"Información del Cliente y Oportunidad",class:"pa-sm-8 pa-5"},{default:t(()=>[e(Q,null,{default:t(()=>[e(qe,{onSubmit:Oe(F,["prevent"])},{default:t(()=>[e(G,{dense:""},{default:t(()=>[e(b,{cols:"12",md:"6"},{default:t(()=>[e(L,{modelValue:a(n).customer.name,"onUpdate:modelValue":p[0]||(p[0]=D=>a(n).customer.name=D),label:"Nombre del Cliente",placeholder:"Ingresa el nombre",outlined:""},null,8,["modelValue"])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(L,{modelValue:a(n).customer.email,"onUpdate:modelValue":p[1]||(p[1]=D=>a(n).customer.email=D),label:"Email del Cliente",placeholder:"Ingresa el email",outlined:""},null,8,["modelValue"])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(G,null,{default:t(()=>[e(b,{cols:"4"},{default:t(()=>[e(i,{modelValue:a(n).customer.cod_phone,"onUpdate:modelValue":p[2]||(p[2]=D=>a(n).customer.cod_phone=D),label:"Código",items:["+1","+52","+55","+54","+49","+33","+34","+39","+86","+81","+7","+591"],placeholder:"Cód.",outlined:""},null,8,["modelValue"])]),_:1}),e(b,{cols:"8"},{default:t(()=>[e(L,{modelValue:a(n).customer.phone,"onUpdate:modelValue":p[3]||(p[3]=D=>a(n).customer.phone=D),label:"Número de Teléfono",placeholder:"Ingresa el teléfono",outlined:"",dense:"",maxlength:"9"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(L,{modelValue:a(n).customer.ci,"onUpdate:modelValue":p[4]||(p[4]=D=>a(n).customer.ci=D),label:"CI del Cliente",placeholder:"Ingresa el CI",outlined:""},null,8,["modelValue"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(m,{modelValue:a(n).property_id,"onUpdate:modelValue":p[5]||(p[5]=D=>a(n).property_id=D),label:"Departamento de Interés",placeholder:"Selecciona un Departamento",items:a(h).map(D=>({title:D.title,value:D.id})),outlined:""},null,8,["modelValue","items"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(M,{modelValue:a(n).description,"onUpdate:modelValue":p[6]||(p[6]=D=>a(n).description=D),label:"Descripción de la Oportunidad",placeholder:"Ingresa una descripción",rows:"3","auto-grow":"",outlined:""},null,8,["modelValue"])]),_:1}),e(b,{cols:"12",class:"text-center"},{default:t(()=>[e(T,{type:"submit",color:"primary",class:"me-3",disabled:a(d),loading:a(d)},{default:t(()=>p[7]||(p[7]=[P(" Guardar ")])),_:1},8,["disabled","loading"]),e(T,{color:"secondary",variant:"tonal",onClick:w},{default:t(()=>p[8]||(p[8]=[P(" Cancelar ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},vt={class:"d-flex align-bottom flex-sm-row flex-column"},gt={class:"user-profile-info"},_t={class:"d-flex align-center justify-center justify-sm-space-between flex-wrap gap-4"},bt={class:"d-flex align-center gap-x-3"},Vt={class:"text-4xl font-weight-medium"},wt={class:"d-flex flex-column py-2",style:{"font-size":"14px"}},Pt={class:"text-sm text-disabled"},kt={key:0,class:"d-flex flex-wrap gap-2 my-5"},xt={key:1},Dt={key:0,class:"d-flex flex-wrap gap-2 my-5"},Ct={key:1},ht={__name:"EditPreSaleOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","update:newProperty"],setup(C,{emit:S}){const o=C,y=S,{checkProcessForOpportunity:U}=fe(),{changeStatusQuotesCustomer:h}=We(),V=_(!1),n=_(!1),c=()=>{V.value=!0},d=()=>{console.log("Se escucho el evento en EditProspectOpportunity"),y("update:newProperty")},w=()=>{n.value=!0},F=async f=>{y("updateStageId",f)},A=async(f,p)=>{console.log(`Procedimiento ${f} marcado como: ${p?"realizado":"no realizado"}`),await U(o.opportunity.id,f,{is_check:!p}),y("updateStageId",o.opportunity.id)},k=async(f,p)=>{const z=p==="APPROVED"?"NOT_APPROVED":"APPROVED";console.log(`Procedimiento ${f} marcado como: ${p}`),await h(f,{status:z}),y("updateStageId",o.opportunity.id)};return(f,p)=>{const z=re("RouterLink"),L=re("IconBtn");return s(),v(I,null,[l("div",vt,[l("div",gt,[p[3]||(p[3]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Perfil ",-1)),l("div",_t,[l("div",bt,[l("span",Vt,g(("avatarText"in f?f.avatarText:a(Fe))(o.opportunity.customer.name)),1),l("div",wt,[e(z,{to:{name:"apps-ecommerce-customer-details-id",params:{id:1}},class:"font-weight-base"},{default:t(()=>[P(g(o.opportunity.customer.name),1)]),_:1}),l("span",Pt,g(o.opportunity.customer.phone),1)]),e(T,{color:"secondary",variant:"tonal",size:"small",onClick:c},{default:t(()=>p[2]||(p[2]=[P(" Editar Perfil ")])),_:1})])])])]),l("div",null,[p[5]||(p[5]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(s(),v("div",kt,[(s(!0),v(I,null,H(o.opportunity.procedure,i=>(s(),v("div",{key:i.id},[e(Z,{color:i.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:m=>A(i.id,i.pivot.is_check)},{default:t(()=>[i.pivot.is_check?(s(),q(W,{key:0,icon:"tabler-check",class:"mr-2"})):B("",!0),P(" "+g(i.title),1)]),_:2},1032,["color","onClick"]),e(ae,{activator:"parent",location:"top"},{default:t(()=>[P(g(i.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(s(),v("div",xt,p[4]||(p[4]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),l("div",null,[p[8]||(p[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Cotizaciones ",-1)),o.opportunity.quotes&&o.opportunity.quotes.length>0?(s(),v("div",Dt,[e(pe,{density:"compact",class:"text-no-wrap",style:{"font-size":"12px"}},{default:t(()=>[p[6]||(p[6]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th")])],-1)),l("tbody",null,[(s(!0),v(I,null,H(o.opportunity.quotes,i=>(s(),v("tr",{key:i.id},[l("td",null,g(i.properties[0].title),1),l("td",null,g(i.created_at),1),l("td",null,g(("formatCurrency"in f?f.formatCurrency:a(te))(i.amount)),1),l("td",null,[e(G,null,{default:t(()=>[e(de,{modelValue:i.status,"onUpdate:modelValue":m=>i.status=m,"true-value":"APPROVED","false-value":"NOT_APPROVED",disabled:""},null,8,["modelValue","onUpdate:modelValue"]),e(de,{modelValue:i.status_customer,"onUpdate:modelValue":m=>i.status_customer=m,"true-value":"APPROVED","false-value":"NOT_APPROVED",onClick:m=>k(i.id,i.status_customer)},{default:t(()=>[e(ae,{activator:"parent",location:"top"},{default:t(()=>[P(g(i.status_customer=="NOT_APPROVED"?"No aprobado por cliente":"Aprobado por cliente"),1)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","onClick"]),e(z,{to:{name:"quote-id",params:{id:i.id}}},{default:t(()=>[e(L,null,{default:t(()=>[e(W,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])]),_:2},1024)])]))),128))])]),_:1})])):(s(),v("div",Ct,p[7]||(p[7]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(Q,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(z,{to:{name:"quote-add-quote"},class:"text-white"},{default:t(()=>[e(T,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>p[9]||(p[9]=[P(" Generar Cotización ")])),_:1})]),_:1}),e(T,{color:"primary",class:"mx-auto",size:"small",onClick:w},{default:t(()=>p[10]||(p[10]=[P(" Generar Venta ")])),_:1})]),_:1}),e(Be,{"is-dialog-visible":a(V),"onUpdate:isDialogVisible":p[0]||(p[0]=i=>R(V)?V.value=i:null),"opportunity-kanban":o.opportunity,"onUpdate:newProperty":d},null,8,["is-dialog-visible","opportunity-kanban"]),e(Ce,{"is-dialog-visible":a(n),"onUpdate:isDialogVisible":p[1]||(p[1]=i=>R(n)?n.value=i:null),opportunity:o.opportunity,stage:"PRESALE",onRegisterSale:F},null,8,["is-dialog-visible","opportunity"])],64)}}},$t={class:"d-flex align-bottom flex-sm-row flex-column"},St={class:"user-profile-info"},At={class:"d-flex align-center justify-center justify-sm-space-between flex-wrap gap-4"},Ot={class:"d-flex align-center gap-x-3"},zt={class:"text-4xl font-weight-medium"},Ut={class:"d-flex flex-column py-2",style:{"font-size":"14px"}},Ft={class:"text-sm text-disabled"},qt={key:0,class:"d-flex flex-wrap gap-2 my-5"},Et={key:1},jt={key:0,class:"d-flex flex-wrap gap-2 my-5"},Tt={key:1},It={__name:"EditProspectOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","update:newProperty"],setup(C,{emit:S}){const o=C,y=S,{checkProcessForOpportunity:U}=fe(),{changeStatusByOpportunity:h,loadingOpportunity:V}=ie(),n=_(!1),c=()=>{n.value=!0},d=()=>{console.log("Se escucho el evento en EditProspectOpportunity"),y("update:newProperty")},w=async A=>{await h(A,De.PRESALE.value,{}),y("updateStageId",A)},F=async A=>{console.log(`Procedimiento ${A.id} marcado como: ${A.pivot.is_check?"realizado":"no realizado"}`),await U(o.opportunity.id,A.id,{is_check:!A.pivot.is_check}),A.pivot.is_check=!A.pivot.is_check,y("updateStageId",o.opportunity.id)};return(A,k)=>{const f=re("RouterLink"),p=re("IconBtn");return s(),v(I,null,[l("div",$t,[l("div",St,[k[3]||(k[3]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Perfil ",-1)),l("div",At,[l("div",Ot,[l("span",zt,g(("avatarText"in A?A.avatarText:a(Fe))(o.opportunity.customer.name)),1),l("div",Ut,[e(f,{to:{name:"apps-ecommerce-customer-details-id",params:{id:1}},class:"font-weight-base"},{default:t(()=>[P(g(o.opportunity.customer.name),1)]),_:1}),l("span",Ft,g(o.opportunity.customer.phone),1)]),l("div",null,[e(T,{color:"secondary",variant:"tonal",size:"small",onClick:c},{default:t(()=>k[2]||(k[2]=[P(" Editar Perfil ")])),_:1})])])])])]),l("div",null,[k[5]||(k[5]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(s(),v("div",qt,[(s(!0),v(I,null,H(o.opportunity.procedure,z=>(s(),v("div",{key:z.id},[e(Z,{color:z.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:L=>F(z)},{default:t(()=>[z.pivot.is_check?(s(),q(W,{key:0,icon:"tabler-check",class:"mr-2"})):B("",!0),P(" "+g(z.title),1)]),_:2},1032,["color","onClick"]),e(ae,{activator:"parent",location:"top"},{default:t(()=>[P(g(z.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(s(),v("div",Et,k[4]||(k[4]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),l("div",null,[k[8]||(k[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Cotizaciones ",-1)),o.opportunity.quotes&&o.opportunity.quotes.length>0?(s(),v("div",jt,[e(pe,{density:"compact",class:"text-no-wrap",style:{"font-size":"12px"}},{default:t(()=>[k[6]||(k[6]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th")])],-1)),l("tbody",null,[(s(!0),v(I,null,H(o.opportunity.quotes,z=>(s(),v("tr",{key:z.id},[l("td",null,g(z.properties[0].title),1),l("td",null,g(z.created_at),1),l("td",null,g(("formatCurrency"in A?A.formatCurrency:a(te))(z.amount)),1),l("td",null,[e(f,{to:{name:"quote-id",params:{id:z.id}}},{default:t(()=>[e(p,null,{default:t(()=>[e(W,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])])]))),128))])]),_:1})])):(s(),v("div",Tt,k[7]||(k[7]=[l("span",null,"No hay cotizaciones disponibles.",-1)])))]),e(Q,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(f,{to:{name:"quote-add-quote"},class:"text-white"},{default:t(()=>[e(T,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>k[9]||(k[9]=[P(" Generar Cotización ")])),_:1})]),_:1}),e(T,{color:"primary",class:"mx-auto",size:"small",disabled:a(V),loading:a(V),onClick:k[0]||(k[0]=z=>w(o.opportunity.id))},{default:t(()=>k[10]||(k[10]=[P(" Siguiente Etapa ")])),_:1},8,["disabled","loading"])]),_:1}),e(Be,{"is-dialog-visible":a(n),"onUpdate:isDialogVisible":k[1]||(k[1]=z=>R(n)?n.value=z:null),"opportunity-kanban":o.opportunity,"onUpdate:newProperty":d},null,8,["is-dialog-visible","opportunity-kanban"])],64)}}},Bt=async C=>await ue(`/sale/paymentPlans/${C}/confirm`,{method:"PATCH"}),Nt=async(C,S)=>await ue(`/sale/paymentPlans/${C}`,{method:"PATCH",body:S});function Ve(){const C=_(!1),S=_([]),o=_(null),y=_(null);return{loadingPaymentPlans:C,paymentPlan:y,error:o,paymentPlans:S,confirmPaymentPlans:async V=>{try{const n=await Bt(V);Se("Actualizacion Exitosa","Se confirmo el pago")}catch(n){console.log(n)}},updatePaymentPlans:async(V,n)=>{C.value=!0,o.value=null;try{console.log(n);const c=await Nt(V,n);y.value=c.data,Me("¡Planes de pago actualizados exitosamente! ","Los planes de pago han sido modificados y guardados correctamente."),console.log(c)}catch(c){console.log(c),c.response&&c.response.status==422&&He("Advertencia","Faltan datos por Completar"),o.value=c.message}finally{C.value=!1}}}}const Rt={__name:"DeliveryForm",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(C,{emit:S}){const o=C,y=S,{changeStatusByOpportunity:U}=ie(),h=d=>{y("update:isDialogVisible",d)},V=_(structuredClone(X(o.opportunity)));se(o,()=>{V.value=structuredClone(X(o.opportunity))});const n=async()=>{y("update:isDialogVisible",!1);try{await U(o.opportunity.id,5,{delivery_date:V.value.sales.delivery_date}),y("updateDeliveryDate",V.value.id)}catch(d){console.error("Error updating customer:",d)}},c=()=>{y("update:isDialogVisible",!1)};return(d,w)=>{const F=ce;return s(),q(ye,{"model-value":o.isDialogVisible,"max-width":"800","onUpdate:modelValue":h},{default:t(()=>[e(F,{onClick:w[0]||(w[0]=A=>d.$emit("update:isDialogVisible",!1))}),e(Y,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(me,{class:"text-h3 text-center"},{default:t(()=>w[2]||(w[2]=[P(" Confirmar Fecha ")])),_:1}),e(Q,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(G,null,{default:t(()=>[e(b,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(ne,{modelValue:a(V).sales.delivery_date,"onUpdate:modelValue":w[1]||(w[1]=A=>a(V).sales.delivery_date=A),label:"Fecha de Entrega",type:"date",rules:["requiredValidator"in d?d.requiredValidator:a(K)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),e(b,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(T,{onClick:n},{default:t(()=>w[3]||(w[3]=[P(" Pasar a Entrega ")])),_:1}),e(T,{color:"secondary",variant:"tonal",onClick:c},{default:t(()=>w[4]||(w[4]=[P(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Lt={key:0},Mt={__name:"PaymentPlanEdit",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},payment:{type:Object,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(C,{emit:S}){const o=C,y=S,{updatePaymentPlans:U}=Ve(),h=_(!1),V=i=>{y("update:isDialogVisible",i)},n=_(structuredClone(X(o.payment))),c=_(structuredClone(X(o.opportunity))),d=_([]);se(o,()=>{n.value=structuredClone(X(o.payment)),c.value=structuredClone(X(o.opportunity))});const w=()=>{d.value.push({amount:"",date:"",type:n.value.type})},F=i=>{d.value.splice(i,1)},A=ee(()=>d.value.reduce((i,m)=>{const M=parseFloat(m.amount)||0;return i+M},0)),k=ee(()=>d.value.length>0&&d.value.every(i=>i.amount&&i.date&&i.type)),f=ee(()=>{if(d.value.length===0)return!0;const i=d.value.reduce((D,x)=>D+(parseFloat(x.amount)||0),0),m=parseFloat(i),M=parseFloat(n.value.amount);return m===M}),p=ee(()=>d.value.length===0?!0:k.value&&f.value),z=async()=>{if(!f.value){Ae("Validación fallida","La suma de las diferencias no es correcta");return}if(!p.value){alert("Por favor, completa todos los campos obligatorios.");return}h.value=!0;try{await U(n.value.id,{date:n.value.date,differData:d.value})}catch(i){console.error("Error updating customer:",i)}finally{y("updateDeliveryDate",c.value.id),y("update:isDialogVisible",!1),d.value=[],h.value=!1}},L=()=>{y("update:isDialogVisible",!1),d.value=[],errorMessage.value=""};return(i,m)=>{const M=ce;return s(),q(ye,{"model-value":o.isDialogVisible,"max-width":"800","onUpdate:modelValue":V},{default:t(()=>[e(M,{onClick:m[0]||(m[0]=D=>i.$emit("update:isDialogVisible",!1))}),e(Y,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(me,{class:"text-h3 text-center"},{default:t(()=>m[2]||(m[2]=[P(" Editar Pago ")])),_:1}),e(Q,null,{default:t(()=>[e(G,{class:"mx-5"},{default:t(()=>[e(b,{cols:"6"},{default:t(()=>[l("h3",null," Monto a Pagar : "+g(a(te)(a(n).amount)),1)]),_:1}),e(b,{cols:"6"},{default:t(()=>[e(ne,{modelValue:a(n).date,"onUpdate:modelValue":m[1]||(m[1]=D=>a(n).date=D),label:"Cambiar Fecha",type:"date",rules:["requiredValidator"in i?i.requiredValidator:a(K)]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(Y,{flat:"",class:"d-flex flex-column pa-5 px-5"},{default:t(()=>[(s(!0),v(I,null,H(a(d),(D,x)=>(s(),v("div",{key:D.id,class:"d-flex align-center my-4"},[e(ne,{modelValue:D.amount,"onUpdate:modelValue":r=>D.amount=r,label:"Monto *",type:"number",class:"mr-4",outlined:"",rules:["requiredValidator"in i?i.requiredValidator:a(K)]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(ne,{modelValue:D.date,"onUpdate:modelValue":r=>D.date=r,label:"Fecha de Pago *",type:"date",class:"mr-3",outlined:"",rules:["requiredValidator"in i?i.requiredValidator:a(K)]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(T,{color:"error",onClick:r=>F(x)},{default:t(()=>[e(W,{icon:"tabler-square-x"})]),_:2},1032,["onClick"])]))),128)),a(d).length>0?(s(),v("div",Lt,[m[3]||(m[3]=l("strong",null,"Monto Restante:",-1)),P(" "+g(a(te)(a(n).amount-a(A))),1)])):B("",!0),e(T,{color:"primary",variant:"tonal",class:"mt-4",size:"small",onClick:w},{default:t(()=>m[4]||(m[4]=[P(" Diferir Pago ")])),_:1})]),_:1}),e(b,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(T,{loading:a(h),disabled:!a(p)||a(h),onClick:z},{default:t(()=>m[5]||(m[5]=[P(" Guardar ")])),_:1},8,["loading","disabled"]),e(T,{color:"error",variant:"tonal",onClick:L},{default:t(()=>m[6]||(m[6]=[P(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Ht={__name:"SalePaymentPlan",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},salesPayment:{type:Array,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(C,{emit:S}){const o=C,y=S;Ve();const U=c=>{y("update:isDialogVisible",c)},h=_(structuredClone(X(o.opportunity)));se(o,()=>{h.value=structuredClone(X(o.opportunity)),console.log("Sales Payment:",o.salesPayment)});const V=_([]),n=()=>{y("update:isDialogVisible",!1),V.value=[]};return(c,d)=>{const w=ce;return s(),q(ye,{"model-value":o.isDialogVisible,"max-width":"800","onUpdate:modelValue":U},{default:t(()=>[e(w,{onClick:d[0]||(d[0]=F=>c.$emit("update:isDialogVisible",!1))}),e(Y,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(me,{class:"text-h3 text-center"},{default:t(()=>d[1]||(d[1]=[P(" Confirmar Fecha ")])),_:1}),e(Q,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(G,null,{default:t(()=>[e(b,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l("span",null," Monto a Pagar : "+g(a(h)),1)]),_:1})]),_:1})]),_:1}),e(b,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(T,{onClick:c.onFormSubmit},{default:t(()=>d[2]||(d[2]=[P(" Guardar ")])),_:1},8,["onClick"]),e(T,{color:"error",variant:"tonal",onClick:n},{default:t(()=>d[3]||(d[3]=[P(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Gt={class:"text-h6"},Qt={class:"text-h6"},Kt={class:"text-h6"},Wt={class:"my-5"},Jt={key:0},Yt=["src"],Xt={class:"mb-4"},Zt=["onClick"],el=["onClick"],tl={class:"my-5"},ll={key:0,class:"d-flex flex-wrap gap-2 my-5"},ol={key:1},al={__name:"EditSaleOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId"],setup(C,{emit:S}){const o=C,y=S,{checkProcessForOpportunity:U}=fe(),{confirmPaymentPlans:h}=Ve(),{changeStatusByOpportunity:V,loadingOpportunity:n}=ie(),c=_(!1),d=_(!1),w=_(!1),F=_(""),A=ee(()=>o.opportunity.sales.reduce((x,r)=>x+r.amount,0)),k=ee(()=>o.opportunity.sales.reduce((x,r)=>x+r.initial_fee,0)),f=ee(()=>A.value-k.value),p=()=>{w.value=!0},z=x=>{if(x.is_paid===1){Ae("Advertencia","No se puede editar un pago ya realizado.");return}console.log("entro aqui"),d.value=!0,F.value={...x}},L=async x=>{y("updateStageId",x)},i=async x=>{console.log(`Procedimiento ${x.id} marcado como: ${x.pivot.is_check?"realizado":"no realizado"}`),await U(o.opportunity.id,x.id,{is_check:!x.pivot.is_check}),x.pivot.is_check=!x.pivot.is_check,y("updateStageId",o.opportunity.id)},m=async x=>{console.log(x),await h(x),y("updateStageId",o.opportunity.id)},M=async x=>{await V(x,5,{}),y("updateStageId",x)},D=async x=>{y("updateStageId",x)};return(x,r)=>(s(),v(I,null,[l("div",null,[e(Y,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(G,null,{default:t(()=>[e(b,{cols:"4",class:"border rounded-sm mx-1"},{default:t(()=>[e(le,{class:"font-weight-medium"},{default:t(()=>r[5]||(r[5]=[P(" Saldo ")])),_:1}),e(oe,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Gt,g(("formatCurrency"in x?x.formatCurrency:a(te))(a(f))),1)]),_:1})]),_:1}),e(b,{cols:"3",class:"border rounded-sm mx-1"},{default:t(()=>[e(le,{class:"font-weight-medium"},{default:t(()=>r[6]||(r[6]=[P(" Anticipo ")])),_:1}),e(oe,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Qt,g(("formatCurrency"in x?x.formatCurrency:a(te))(a(k))),1)]),_:1})]),_:1}),e(b,{cols:"4",class:"border rounded-sm mx-1"},{default:t(()=>[e(le,{class:"font-weight-medium"},{default:t(()=>r[7]||(r[7]=[P(" Precio Final ")])),_:1}),e(oe,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Kt,g(("formatCurrency"in x?x.formatCurrency:a(te))(a(A))),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),l("div",Wt,[r[8]||(r[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Propiedades ",-1)),o.opportunity.sales.length>0?(s(),v("div",Jt,[(s(!0),v(I,null,H(o.opportunity.sales,$=>(s(),v("div",{key:$.id},[(s(!0),v(I,null,H($.properties,O=>(s(),v("div",{key:O.id,class:"d-flex align-center justify-between"},[e(Ue,{size:"50",rounded:""},{default:t(()=>[l("img",{src:a(xe),alt:"Logo pora",style:{"border-radius":"30%"}},null,8,Yt)]),_:1}),e(b,{cols:"12",md:"7"},{default:t(()=>[e(le,{class:"font-weight-medium"},{default:t(()=>[P(g(O.project_title)+" | "+g(O.title),1)]),_:2},1024),e(oe,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",null,"$ "+g(O.pivot_price),1)]),_:2},1024)]),_:2},1024)]))),128))]))),128))])):B("",!0)]),l("div",Xt,[r[11]||(r[11]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Anticipo ",-1)),o.opportunity.initial_payments&&o.opportunity.initial_payments.length>0?(s(),q(pe,{key:0,density:"compact",class:"text-no-wrap my-2",style:{"font-size":"12px"}},{default:t(()=>[r[10]||(r[10]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th",null," Action ")])],-1)),l("tbody",null,[(s(!0),v(I,null,H(o.opportunity.initial_payments,$=>(s(),v("tr",{key:$.id},[l("td",null,g($.property_title),1),l("td",null,g($.date),1),l("td",null,g($.amount),1),l("td",null,[e(G,null,{default:t(()=>[e(de,{modelValue:$.is_paid,"onUpdate:modelValue":O=>$.is_paid=O,"true-value":1,"false-value":0,disabled:$.is_paid===1,onChange:O=>m($.id)},{default:t(()=>[e(ae,{activator:"parent",location:"top"},{default:t(()=>r[9]||(r[9]=[P(" Confirmar Pago ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"]),$.is_paid===0?(s(),v("div",{key:0,"fill-dot":"",style:{cursor:"pointer"},onClick:O=>z($)},[e(W,{size:"25",icon:"tabler-edit"})],8,Zt)):B("",!0)]),_:2},1024)])]))),128))])]),_:1})):B("",!0)]),l("div",null,[r[14]||(r[14]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Saldos ",-1)),o.opportunity.balance_payments&&o.opportunity.balance_payments.length>0?(s(),q(pe,{key:0,density:"compact",class:"text-no-wrap my-2",style:{"font-size":"12px"}},{default:t(()=>[r[13]||(r[13]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th",null," Action ")])],-1)),l("tbody",null,[(s(!0),v(I,null,H(o.opportunity.balance_payments,$=>(s(),v("tr",{key:$.id},[l("td",null,g($.property_title),1),l("td",null,g($.date),1),l("td",null,g($.amount),1),l("td",null,[e(G,null,{default:t(()=>[e(de,{modelValue:$.is_paid,"onUpdate:modelValue":O=>$.is_paid=O,"true-value":1,"false-value":0,disabled:$.is_paid===1,onChange:O=>m($.id)},{default:t(()=>[e(ae,{activator:"parent",location:"top"},{default:t(()=>r[12]||(r[12]=[P(" Confirmar Pago ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"]),$.is_paid===0?(s(),v("div",{key:0,"fill-dot":"",style:{cursor:"pointer"},onClick:O=>z($)},[e(W,{size:"25",icon:"tabler-edit"})],8,el)):B("",!0)]),_:2},1024)])]))),128))])]),_:1})):B("",!0)]),l("div",tl,[r[16]||(r[16]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(s(),v("div",ll,[(s(!0),v(I,null,H(o.opportunity.procedure,$=>(s(),v("div",{key:$.id},[e(Z,{color:$.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:O=>i($)},{default:t(()=>[$.pivot.is_check?(s(),q(W,{key:0,icon:"tabler-check",class:"mr-2"})):B("",!0),P(" "+g($.title),1)]),_:2},1032,["color","onClick"]),e(ae,{activator:"parent",location:"top"},{default:t(()=>[P(g($.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(s(),v("div",ol,r[15]||(r[15]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(Q,{class:"d-flex mt-4"},{default:t(()=>[e(T,{color:"primary",variant:"tonal",class:"mx-auto",size:"small",onClick:p},{default:t(()=>r[17]||(r[17]=[P(" Generar Venta ")])),_:1}),e(T,{color:"primary",class:"mx-auto",size:"small",onClick:r[0]||(r[0]=$=>M(o.opportunity.id))},{default:t(()=>r[18]||(r[18]=[P(" Siguiente Etapa ")])),_:1})]),_:1}),e(Rt,{"is-dialog-visible":a(c),"onUpdate:isDialogVisible":r[1]||(r[1]=$=>R(c)?c.value=$:null),opportunity:o.opportunity,onUpdateDeliveryDate:D},null,8,["is-dialog-visible","opportunity"]),e(Mt,{"is-dialog-visible":a(d),"onUpdate:isDialogVisible":r[2]||(r[2]=$=>R(d)?d.value=$:null),payment:a(F),opportunity:o.opportunity,onUpdateDeliveryDate:D},null,8,["is-dialog-visible","payment","opportunity"]),e(Ce,{"is-dialog-visible":a(w),"onUpdate:isDialogVisible":r[3]||(r[3]=$=>R(w)?w.value=$:null),opportunity:o.opportunity,stage:"SALE",onRegisterSale:L},null,8,["is-dialog-visible","opportunity"]),e(Ht,{"is-dialog-visible":x.openSaleEditPaymentPlan,"onUpdate:isDialogVisible":r[4]||(r[4]=$=>x.openSaleEditPaymentPlan=$),opportunity:o.opportunity,"sales-payment":x.salePaymentPlan,onUpdateDeliveryDate:D},null,8,["is-dialog-visible","opportunity","sales-payment"])],64))}},il=async C=>await ue(`/customer/${C}/bitacora`,{method:"GET"});function sl(){const C=_(!1),S=_([]);return Ge(),_(0),{getBitacorabyId:async y=>{try{const U=await il(y);S.value=U,console.log(U)}catch(U){console.error(U)}},loadingBitacora:C,bitacoras:ee(()=>S.value)}}const nl={class:"my-5"},rl={class:"d-flex justify-space-between align-center gap-2 flex-wrap"},ul={class:"app-timeline-title"},dl={class:"app-timeline-meta"},pl={class:"app-timeline-text"},cl={key:0,class:"empty-state my-2"},ml={__name:"BitacoraCustomer",props:{customer:{type:String,required:!0}},setup(C){const S=C,{bitacoras:o,getBitacorabyId:y}=sl();ze(async()=>{await y(S.customer)});const U=h=>{switch(h){case 1:return"Visita";case 2:return"Llamada";case 3:return"Cotización";default:return"Otro"}};return(h,V)=>(s(),v("div",null,[e(Y,{title:"Historial del cliente"},{default:t(()=>[e(Q,null,{default:t(()=>[e(G,{class:"d-flex justify-space-between"},{default:t(()=>[e(b,{cols:"12"},{default:t(()=>[l("div",nl,[e(Xe,{side:"end",align:"start","line-inset":"8","truncate-line":"both",density:"compact"},{default:t(()=>[(s(!0),v(I,null,H(a(o),n=>(s(),q(Ze,{key:n.id,size:"x-small","dot-color":"warning"},{default:t(()=>[l("div",rl,[l("span",ul,g(n.log_name),1),l("span",dl,g(("formatDate"in h?h.formatDate:a(Ke))(n.created_at)),1)]),l("div",pl,[l("p",null,g(n.description),1),n.properties.activity?(s(),q(Z,{key:0},{default:t(()=>[P(g(U(n.properties.activity.type_activity_id)),1)]),_:2},1024)):B("",!0)])]),_:2},1024))),128))]),_:1}),!a(o)||a(o).length===0?(s(),v("div",cl,V[0]||(V[0]=[l("p",null,"No hay actividades registradas para este cliente.",-1)]))):B("",!0)])]),_:1})]),_:1})]),_:1})]),_:1})]))}},yl={__name:"DrawerBitacora",props:{isDrawerOpen:{type:Boolean,required:!0},customer:{type:String,required:!1}},emits:["update:isDrawerOpen"],setup(C,{emit:S}){const o=C,y=S,U=h=>{y("update:isDrawerOpen",h)};return(h,V)=>(s(),q(je,{temporary:"",width:500,location:"end",class:"scrollable-content","model-value":o.isDrawerOpen,"onUpdate:modelValue":U},{default:t(()=>[e(a(Ee),{options:{wheelPropagation:!1}},{default:t(()=>[e(ml,{customer:"1"})]),_:1})]),_:1},8,["model-value"]))}};const fl={__name:"SellerReport",setup(C){return _([{title:"Actividad 1",date:"2024-10-09",status:"Pendiente"},{title:"Actividad 2",date:"2024-10-10",status:"Completada"},{title:"Actividad 3",date:"2024-10-11",status:"En Progreso"}]),(S,o)=>(s(),q(Q,null,{default:t(()=>o[0]||(o[0]=[l("p",null,"No hay actividades seleccionadas. Aquí tienes un resumen de las actividades:",-1)])),_:1}))}},vl=Te(fl,[["__scopeId","data-v-c9cbe3f1"]]),gl={__name:"CustomerHistory",props:{isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","userData"],setup(C,{emit:S}){const o=C,y=S,U=_(!1),h=_(),V=_(""),n=_(""),c=_(""),d=_(""),w=_(),F=_(""),A=_(),k=_(),f=_(),p=()=>{y("update:isDrawerOpen",!1),Pe(()=>{var i,m;(i=h.value)==null||i.reset(),(m=h.value)==null||m.resetValidation()})},z=()=>{var i;(i=h.value)==null||i.validate().then(({valid:m})=>{m&&(y("userData",{id:0,fullName:V.value,company:d.value,role:A.value,country:w.value,contact:F.value,email:c.value,currentPlan:k.value,status:f.value,avatar:"",billing:"Auto Debit"}),y("update:isDrawerOpen",!1),Pe(()=>{var M,D;(M=h.value)==null||M.reset(),(D=h.value)==null||D.resetValidation()}))})},L=i=>{y("update:isDrawerOpen",i)};return(i,m)=>{const M=et,D=_e,x=be;return s(),q(je,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":o.isDrawerOpen,"onUpdate:modelValue":L},{default:t(()=>[e(M,{title:"Historial del Cliente",onCancel:p}),e(a(Ee),{options:{wheelPropagation:!1}},{default:t(()=>[e(Y,{flat:""},{default:t(()=>[e(Q,null,{default:t(()=>[e(qe,{ref_key:"refForm",ref:h,modelValue:a(U),"onUpdate:modelValue":m[9]||(m[9]=r=>R(U)?U.value=r:null),onSubmit:Oe(z,["prevent"])},{default:t(()=>[e(G,null,{default:t(()=>[e(b,{cols:"12"},{default:t(()=>[e(D,{modelValue:a(V),"onUpdate:modelValue":m[0]||(m[0]=r=>R(V)?V.value=r:null),rules:["requiredValidator"in i?i.requiredValidator:a(K)],label:"Full Name",placeholder:"John Doe"},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(D,{modelValue:a(n),"onUpdate:modelValue":m[1]||(m[1]=r=>R(n)?n.value=r:null),rules:["requiredValidator"in i?i.requiredValidator:a(K)],label:"Username",placeholder:"Johndoe"},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(D,{modelValue:a(c),"onUpdate:modelValue":m[2]||(m[2]=r=>R(c)?c.value=r:null),rules:["requiredValidator"in i?i.requiredValidator:a(K),"emailValidator"in i?i.emailValidator:a(Re)],label:"Email",placeholder:"johndoe@email.com"},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(D,{modelValue:a(d),"onUpdate:modelValue":m[3]||(m[3]=r=>R(d)?d.value=r:null),rules:["requiredValidator"in i?i.requiredValidator:a(K)],label:"Company",placeholder:"PixInvent"},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(x,{modelValue:a(w),"onUpdate:modelValue":m[4]||(m[4]=r=>R(w)?w.value=r:null),label:"Select Country",placeholder:"Select Country",rules:["requiredValidator"in i?i.requiredValidator:a(K)],items:["USA","UK","India","Australia"]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(D,{modelValue:a(F),"onUpdate:modelValue":m[5]||(m[5]=r=>R(F)?F.value=r:null),type:"number",rules:["requiredValidator"in i?i.requiredValidator:a(K)],label:"Contact",placeholder:"+1-541-754-3010"},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(x,{modelValue:a(A),"onUpdate:modelValue":m[6]||(m[6]=r=>R(A)?A.value=r:null),label:"Select Role",placeholder:"Select Role",rules:["requiredValidator"in i?i.requiredValidator:a(K)],items:["Admin","Author","Editor","Maintainer","Subscriber"]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(x,{modelValue:a(k),"onUpdate:modelValue":m[7]||(m[7]=r=>R(k)?k.value=r:null),label:"Select Plan",placeholder:"Select Plan",rules:["requiredValidator"in i?i.requiredValidator:a(K)],items:["Basic","Company","Enterprise","Team"]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(x,{modelValue:a(f),"onUpdate:modelValue":m[8]||(m[8]=r=>R(f)?f.value=r:null),label:"Select Status",placeholder:"Select Status",rules:["requiredValidator"in i?i.requiredValidator:a(K)],items:[{title:"Active",value:"active"},{title:"Inactive",value:"inactive"},{title:"Pending",value:"pending"}]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(T,{type:"submit",class:"me-3"},{default:t(()=>m[10]||(m[10]=[P(" Submit ")])),_:1}),e(T,{type:"reset",variant:"outlined",color:"secondary",onClick:p},{default:t(()=>m[11]||(m[11]=[P(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},_l={class:"d-flex justify-space-between align-center"},bl={class:"mb-2"},Vl={style:{"font-size":"14px","font-weight":"500"}},wl={style:{"font-size":"12px","font-weight":"500"}},Pl={__name:"AddActivity",props:{activitiesData:{type:Object,required:!0,default:()=>({title:"",description:"",schedule_at:""})},isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","refreshActivities"],setup(C,{emit:S}){const o=C,y=S,U=_(!1);_(!1);const h=_("radio-1"),V=_(!1),n=()=>{V.value=!0},c=_({title:"",description:"",type_activity_id:null,opportunity_id:null,assigned_to:null,scheduled_at:null,status:"COMPLETED"}),{completedActivityAndRegister:d,getallTypeActivities:w,typeActivities:F,loadingActivity:A}=he(),{getOpportunitybyId:k,opportunity:f}=ie(),p=_(structuredClone(X(o.activitiesData))),z=O=>{console.log("esta consultando de nuevo despues de cambiar etapa "),k(O)};se(o,()=>{p.value=structuredClone(X(o.activitiesData)),k(p.value.opportunity_id),L()});const L=async()=>{await w()},i=()=>{k(p.value.opportunity_id)},m=()=>{y("update:isDrawerOpen",!1),c.value={title:null,description:null,type_activity_id:null,scheduled_at:null,opportunity_id:null,assigned_to:null,status:"COMPLETED"},y("refreshActivities")},M=async()=>{let O="";h.value==="radio-1"?O="COMPLETED":h.value==="radio-2"&&(O="CANCELLED"),d(p.value.id,{title:c.value.title,description:c.value.description,type_activity_id:c.value.type_activity_id,scheduled_at:c.value.scheduled_at,assigned_to:f.value.user_id,property_id:f.value.property_id,opportunity_id:f.value.id,status:O}),m()},D=async()=>{we.fire({title:"Quieres dar de baja al cliente ?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"confirmar"}).then(O=>{O.isConfirmed&&(Ne(p.value.id),m(),we.fire({text:"EL cliente fue dado de baja",icon:"success"}))})},x=async()=>{y("update:isDrawerOpen",!1),y("refreshActivities")},r=()=>{console.log("Se escucho el evento en AddActivity"),y("refreshActivities")},$=O=>{const u=new Date(O),J=u.getDate(),N=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][u.getMonth()],j=u.getHours().toString().padStart(2,"0"),ve=u.getMinutes().toString().padStart(2,"0");return`${J} de ${N}, ${j}:${ve}`};return(O,u)=>{const J=_e,E=Le,N=$e;return s(),v(I,null,[e(G,{class:"d-flex justify-space-between"},{default:t(()=>[e(b,{cols:"12"},{default:t(()=>[C.isDrawerOpen?(s(),q(Y,{key:0},{default:t(()=>[e(Q,null,{default:t(()=>[e(Ie,{class:"mx-2 my-2"},{default:t(()=>[e(G,null,{default:t(()=>[e(b,{cols:"12",sm:"5"},{default:t(()=>[e(G,null,{default:t(()=>[e(b,{cols:"12"},{default:t(()=>[l("div",_l,[u[8]||(u[8]=l("span",{style:{"font-size":"18px","font-weight":"500"}}," Actividad ",-1)),e(Z,{color:"warning",onClick:n},{default:t(()=>u[7]||(u[7]=[P(" historial ")])),_:1})])]),_:1}),e(b,{cols:"12"},{default:t(()=>[l("div",bl,[l("span",Vl,g(o.activitiesData.title)+" • "+g($(o.activitiesData.scheduled_at)),1),u[9]||(u[9]=l("br",null,null,-1)),l("span",wl,g(o.activitiesData.description)+" "+g(a(f).customer_id),1)]),e(lt,{modelValue:a(h),"onUpdate:modelValue":u[0]||(u[0]=j=>R(h)?h.value=j:null),style:{"font-size":"14px"},inline:""},{default:t(()=>[u[10]||(u[10]=l("span",{class:"my-1"}," ¿Se realizó? ",-1)),e(ke,{label:"Si",value:"radio-1",density:"compact",class:"mx-2"}),e(ke,{label:"No",value:"radio-2",class:"mx-2",density:"compact"})]),_:1},8,["modelValue"]),e(ot,{class:"mt-2"})]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(J,{modelValue:a(c).title,"onUpdate:modelValue":u[1]||(u[1]=j=>a(c).title=j),label:"Título de la actividad",placeholder:"..."},null,8,["modelValue"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(be,{modelValue:a(c).type_activity_id,"onUpdate:modelValue":u[2]||(u[2]=j=>a(c).type_activity_id=j),label:"Tipo de actividad",placeholder:"Selecciona el tipo de actividad",items:a(F).map(j=>({title:j.name,value:j.id}))},null,8,["modelValue","items"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(E,{modelValue:a(c).scheduled_at,"onUpdate:modelValue":u[3]||(u[3]=j=>a(c).scheduled_at=j),label:"Seleccione la fecha y hora",placeholder:"Seleccione la fecha y hora",config:{enableTime:!0,dateFormat:"Y-m-d H:i"},rules:["requiredValidator"in O?O.requiredValidator:a(K)]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(N,{modelValue:a(c).description,"onUpdate:modelValue":u[4]||(u[4]=j=>a(c).description=j),label:"Descripción",rows:"3",rules:["requiredValidator"in O?O.requiredValidator:a(K)]},null,8,["modelValue","rules"])]),_:1}),e(b,null,{default:t(()=>[e(T,{color:"primary",class:"mx-auto",size:"small",loading:a(A),disabled:a(A),onClick:M},{default:t(()=>u[11]||(u[11]=[P(" Crear Actividad ")])),_:1},8,["loading","disabled"]),e(T,{color:"primary",class:"mx-1",variant:"tonal",size:"small",onClick:D},{default:t(()=>u[12]||(u[12]=[P(" Dar de Baja ")])),_:1})]),_:1})]),_:1})]),_:1}),e(b,{cols:"12",sm:"7",style:{"align-items":"center"}},{default:t(()=>[e(G,{class:"mb-2"},{default:t(()=>[e(b,{cols:"6"},{default:t(()=>u[13]||(u[13]=[l("span",{style:{"font-size":"18px","font-weight":"500"}}," Etapa ",-1)])),_:1}),e(b,{cols:"12",md:"6",class:"d-flex justify-end align-center"},{default:t(()=>[e(Z,{label:"",color:"primary"},{default:t(()=>[P(g(a(f).stage.title),1)]),_:1})]),_:1})]),_:1}),a(f).stage_id===2?(s(),q(It,{key:0,opportunity:a(f),onUpdateStageId:z,"onUpdate:newProperty":r},null,8,["opportunity"])):B("",!0),a(f).stage_id===3?(s(),q(ht,{key:1,opportunity:a(f),onUpdateStageId:z,"onUpdate:newProperty":r},null,8,["opportunity"])):B("",!0),a(f).stage_id===4?(s(),q(al,{key:2,opportunity:a(f),onRefreshActivities:i,onUpdateStageId:z},null,8,["opportunity"])):B("",!0),a(f).stage_id===5?(s(),q(ft,{key:3,opportunity:a(f),onRefreshActivities:i,onUpdateStageId:z,onComplet:x},null,8,["opportunity"])):B("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):(s(),q(Y,{key:1,title:"Reporte de Actividades"},{default:t(()=>[e(vl)]),_:1}))]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(gl,{"is-drawer-open":a(U),"onUpdate:isDrawerOpen":u[5]||(u[5]=j=>R(U)?U.value=j:null)},null,8,["is-drawer-open"])]),_:1})]),_:1}),e(yl,{"is-drawer-open":a(V),"onUpdate:isDrawerOpen":u[6]||(u[6]=j=>R(V)?V.value=j:null),customer:a(f).customer_id},null,8,["is-drawer-open","customer"])],64)}}};const kl={class:"mt-2 mx-3"},xl={style:{"font-size":"14px"}},Dl={key:0,class:"no-activities-message d-flex flex-column justify-center align-center",style:{"min-block-size":"200px","text-align":"center"}},Cl=["onClick"],hl={class:"mx-2"},$l={class:"d-flex justify-content-between",style:{"font-size":"0.9em"}},Sl={__name:"list",setup(C){const S=_(""),o=_("Anteriores");_(["Todos","PORA"]),_("Todos");const{getallActivitiesByAsesorFecha:y,getallActivitiesByFechaPast:U,getallActivitiesByFechaFuture:h,activities:V,activitiesPast:n,activitiesFuture:c}=he(),d=_(""),w=Qe("userData").value,F=_(!0),A=_([]),k=_([]),f=_([]),p=async()=>{await y(w.id),A.value=V.value},z=async()=>{await U(w.id),k.value=n.value},L=async()=>{await h(w.id),f.value=c.value};ze(async()=>{await p(),await z(),await L(),F.value=!1});const i=_(!1),m=O=>{i.value=!0,d.value={...O}},M=async()=>{F.value=!0,await p(),await z(),await L(),F.value=!1},D=ee(()=>[{tabName:"Anteriores",icon:"tabler-calendar",actividades:k,badge:k.value.length},{tabName:"Hoy",icon:"tabler-edit",actividades:A,badge:A.value.length},{tabName:"Futuros",icon:"tabler-calendar",actividades:f,badge:f.value.length}]),x=[{type:"Visita",icon:"tabler-current-location"},{type:"Llamada",icon:"tabler-phone"},{type:"Cotizacion",icon:"tabler-cash"},{type:"Otro",icon:"tabler-table"}],r=O=>{const u=x.find(J=>J.type===O);return u?u.icon:"tabler-default"},$=O=>{const u=new Date(O),J=u.getDate(),N=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][u.getMonth()],j=u.getHours().toString().padStart(2,"0"),ve=u.getMinutes().toString().padStart(2,"0");return`${J} de ${N}, ${j}:${ve}`};return se(S,O=>{const u=J=>J.filter(E=>{const N=E.name_opportunity.toLowerCase().includes(O.toLowerCase()),j=E.phone_opportunity.toLowerCase().includes(O.toLowerCase());return N||j});O.length>2?(A.value=u(V.value),k.value=u(n.value),f.value=u(c.value)):(A.value=V.value,k.value=n.value,f.value=c.value)}),(O,u)=>{const J=re("VCircularProgress");return s(),q(G,{class:"match-height",style:{display:"flex","block-size":"100vh"}},{default:t(()=>[e(b,{cols:"12",md:"4",style:{display:"flex","flex-direction":"column"}},{default:t(()=>[e(Y,{class:"flex-grow-1"},{default:t(()=>[e(me,{class:"d-flex justify-between align-center flex-wrap"},{default:t(()=>[u[5]||(u[5]=l("h4",{class:"mt-5"}," Mis Actividades ",-1)),l("div",kl,[e(ne,{modelValue:S.value,"onUpdate:modelValue":u[0]||(u[0]=E=>S.value=E),placeholder:"Buscar actividad...",class:"search-field",variant:"plain","hide-details":"",dense:"","prepend-inner-icon":"tabler-search"},null,8,["modelValue"])])]),_:1}),e(at,{modelValue:o.value,"onUpdate:modelValue":u[1]||(u[1]=E=>o.value=E),grow:""},{default:t(()=>[(s(!0),v(I,null,H(D.value,E=>(s(),q(it,{key:E.tabName},{default:t(()=>[l("span",xl,g(E.tabName),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),u[11]||(u[11]=l("br",null,null,-1)),e(Q,{style:{"flex-grow":"1","overflow-y":"auto"}},{default:t(()=>[F.value?(s(),q(st,{key:0,absolute:"",opacity:"0.7"},{default:t(()=>[e(J,{indeterminate:"",size:"70"})]),_:1})):B("",!0),e(Ie,{modelValue:o.value,"onUpdate:modelValue":u[2]||(u[2]=E=>o.value=E),class:"disable-tab-transition",style:{"max-block-size":"500px","overflow-y":"auto"}},{default:t(()=>[(s(!0),v(I,null,H(D.value,E=>(s(),q(tt,{key:E.tabName,value:E.tabName},{default:t(()=>[E.actividades.value.length===0?(s(),v("div",Dl,[e(W,{size:"64",color:"grey",icon:"tabler-calendar-off",class:"mb-4",style:{animation:"bounce 1s infinite"}}),u[6]||(u[6]=l("div",{style:{color:"#888","font-size":"1.2em"}}," ¡No tienes actividades pendientes! ",-1)),u[7]||(u[7]=l("div",{style:{color:"#aaa","font-size":"0.9em","margin-block-start":"8px"}}," ¡Relájate y disfruta tu día! ",-1))])):(s(!0),v(I,{key:1},H(E.actividades.value,N=>(s(),v("div",{key:N.id,"fill-dot":"",class:"border mb-2 rounded-sm py-2",style:{cursor:"pointer"},onClick:j=>m(N)},[e(ge,null,{default:t(()=>[e(G,null,{default:t(()=>[e(b,{cols:"12",md:"2",style:{"padding-inline-end":"0"}},{default:t(()=>[e(Z,{class:"d-flex justify-center align-center",style:{display:"inline-flex","border-radius":"4px","block-size":"36px","inline-size":"36px"}},{default:t(()=>[e(W,{size:"25",icon:"tabler-home"})]),_:1})]),_:1}),N.project_name?(s(),q(b,{key:0,cols:"12",md:"5",class:"d-flex flex-column align-start",style:{"padding-inline-start":"0"}},{default:t(()=>[e(oe,{class:"text-left"},{default:t(()=>[l("strong",null,g(N.property_title),1)]),_:2},1024),e(le,{class:"font-weight-medium text-left"},{default:t(()=>[l("span",null,"$ "+g(N.price),1)]),_:2},1024)]),_:2},1024)):B("",!0),N.project_name?B("",!0):(s(),q(b,{key:1,cols:"12",md:"5"},{default:t(()=>[e(oe,{class:"text-left"},{default:t(()=>u[8]||(u[8]=[l("strong",{style:{"font-size":"12px"}}," Departamento ",-1)])),_:1}),e(le,{class:"font-weight-medium text-left"},{default:t(()=>u[9]||(u[9]=[l("span",null,"Indefinido",-1)])),_:1})]),_:1})),e(b,{cols:"12",md:"5",class:"d-flex justify-end align-center"},{default:t(()=>[e(Z,{label:"",color:"primary",class:"ml-auto",style:{"font-size":"10px"}},{default:t(()=>[P(g(N.stage),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(ge,{class:""},{default:t(()=>[e(Z,{label:"",color:"secondary",class:"w-100 h-48"},{default:t(()=>[e(W,{size:"20",icon:r(N.type_activity)},null,8,["icon"]),l("div",hl,g(N.type_activity)+"   •   "+g(N.name_opportunity),1)]),_:2},1024)]),_:2},1024),e(ge,null,{default:t(()=>[l("div",$l,[u[10]||(u[10]=l("div",{style:{"flex-grow":"1"}}," Ver ",-1)),l("div",null,g($(N.scheduled_at)),1)])]),_:2},1024)],8,Cl))),128))]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(b,{cols:"12",md:"8",style:{display:"flex","flex-direction":"column"}},{default:t(()=>[e(Pl,{"is-drawer-open":i.value,"onUpdate:isDrawerOpen":u[3]||(u[3]=E=>i.value=E),"activities-data":d.value,class:"flex-grow-1",onRefreshActivities:M,onLoaded:u[4]||(u[4]=E=>F.value=!1)},null,8,["is-drawer-open","activities-data"])]),_:1})]),_:1})}}},Bo=Te(Sl,[["__scopeId","data-v-a55b93d4"]]);export{Bo as default};
