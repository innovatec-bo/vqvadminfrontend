import{$ as f}from"./api-33861f4a.js";import{b as c,c as w}from"./notifications-b6da0b75.js";import{r as i,k as P,ac as d,ab as b}from"./index-1b227831.js";const k=async o=>await f("/authen/login",{method:"POST",body:o}),h=async o=>f("/change_password",{method:"PUT",body:o}),A=async o=>f("/authen/forgot-password",{method:"POST",body:o}),R=async(o,n)=>f(`/authen/verify-token/${o}/${n}`,{method:"GET"});function D(){const o=i(null),n=i(!1),a=i(!1),t=i(null),l=P(),m=d("accessToken");let y=b();return{user:o,isAuthenticated:n,loading:a,error:t,loginUser:async s=>{a.value=!0;try{const e=await k(s);if(console.log("Login successful:",e),e.status==403){c("",e._data.message);return}if(e.status==401){c("",e._data.message);return}const r=Object.fromEntries(Object.entries(e.data));let u=[{action:"manage",subject:"all"}];if(e.data.roles.forEach(p=>{u.push({action:"manage",subject:p})}),d("userAbilityRules").value=u,y.update(u),d("userData").value=r,d("accessToken").value=e.meta.accessToken,(r.roles||[]).includes("ADMINISTRADOR")){l.push("/dashboards/analytics");return}l.push("/activity/list")}catch(e){console.log(e),e.response&&e.response._data?(console.log(e.response._data.message),c("Advertencia",e.response._data.message)):c("Advertencia","An error occurred while logging in")}finally{a.value=!1}},logoutUser:async()=>{a.value=!0,t.value=null;try{await logout(),o.value=null,n.value=!1,m.value=null,l.push("/login")}catch(s){t.value="Logout failed: "+s.message}finally{a.value=!1}},resetUserPassword:async s=>{console.log(s),a.value=!0,t.value=null;try{const e=await h(s);console.log(e),w("contraseÃ±a actualizada exitosamente","")}catch(e){e.response&&e.response._data?c("ERROR",e.response._data.message):(t.value=e.message,alert(e.message))}finally{a.value=!1}},changeUserPassword:async s=>{a.value=!0,t.value=null;try{await h(s)}catch(e){t.value="Password reset failed: "+e.message}finally{a.value=!1}},forgotUserPassword:async s=>{a.value=!0,t.value=null;try{await A({email:s}),l.push({name:"auth-two-steps",params:{mail:s}})}catch(e){t.value="Password reset failed: "+e.message}finally{a.value=!1}},verifyCodResetPassword:async(s,e)=>{a.value=!0,t.value=null;try{const r=await R(s,e),u={id:r.data.id,username:r.data.username,email:r.data.email,token:s},g=JSON.stringify(u),v=encodeURIComponent(g);l.push({name:"auth-reset-password",params:{user:v}})}catch(r){t.value="Password reset failed: "+r.message,console.log(r)}finally{a.value=!1}},checkAuthenticationStatus:async()=>{a.value=!0,t.value=null;try{const s=await checkAuthStatus();o.value=s.data.user,n.value=!0}catch(s){t.value="Auth status check failed: "+s.message,n.value=!1}finally{a.value=!1}}}}export{D as u};
