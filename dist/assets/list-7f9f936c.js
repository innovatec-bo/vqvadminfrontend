import{u as ie,p as De,S as xe,_ as Ce,a as Pe,d as Ie}from"./PreSaleForm-4f611491.js";import{r as Q,e as Te}from"./validators-dea6e3a5.js";import{_ as he}from"./AppTextarea-a812f941.js";import{_ as Ne}from"./AppDateTimePicker-f0224b1b.js";import{_ as ge}from"./AppTextField-84caa224.js";import{_ as _e}from"./AppSelect-24ac2bef.js";import{f as le}from"./currencyFormatter-92ad4b3c.js";import{u as pe,a as be,_ as Be}from"./BitacoraCustomer-1163c423.js";import{V as Se}from"./VAvatar-9fb9e715.js";import{b as oe,c as ae,a as ve}from"./VList-49ed325f.js";import{V as v}from"./VCol-8fc37dfa.js";import{o as s,c as f,d as l,F as T,i as H,b as e,e as t,n as a,v as V,x as y,z as M,f as q,$ as J,a4 as I,w as ne,a3 as $e,r as D,a as ue,a0 as L,am as Y,a2 as ee,an as Ve,ac as Re,H as Le}from"./index-427e7513.js";import{V as Z}from"./VChip-0841c238.js";import{V as te}from"./VTooltip-61d21f95.js";import{V as K}from"./VCardText-5ee6a690.js";import{a as Ae}from"./formatters-58bf909e.js";import{u as Me}from"./useQuote-1be8b0f5.js";import{_ as Ge}from"./AppAutocomplete-e5867270.js";import{_ as ce}from"./DialogCloseBtn-ea8f6019.js";import{u as He}from"./useProperty-3160cf11.js";import{V as X,b as me}from"./VCard-b50a40fe.js";import{V as Ue}from"./VForm-67168f02.js";import{V as G}from"./VRow-c3d1a228.js";import{V as fe}from"./VDialog-315d9626.js";import{V as se}from"./VCheckbox-39708aeb.js";import{V as de}from"./VTable-a6bf57c0.js";import{u as Qe}from"./useSales-8b15f2c6.js";import{V as re}from"./VTextField-b8ccce86.js";import{s as Oe,S as we}from"./notifications-a0ff4d79.js";import{P as ze}from"./vue3-perfect-scrollbar.esm-397b78cc.js";import{V as qe}from"./VNavigationDrawer-404f07f3.js";import{_ as Fe}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as Ke}from"./AppDrawerHeaderSection-b463e119.js";import{V as je,a as We}from"./VWindowItem-8de35f4d.js";import{V as Je,a as ke}from"./VRadioGroup-29164969.js";import{V as Ye}from"./VDivider-932430e1.js";import{V as Xe,a as Ze}from"./VTabs-34725f7b.js";import{V as et}from"./VOverlay-a77d48b6.js";import"./api-6b151283.js";import"./index-9c720871.js";import"./constants-71880aa6.js";import"./InvoiceAddMoney-cc40d94e.js";import"./VNodeRenderer-12ef79a3.js";import"./helpers-61e4df1a.js";import"./form-9bfd9352.js";/* empty css                   */import"./VCounter-74e24d28.js";import"./VImg-d3f6a34a.js";import"./VField-5961e92f.js";import"./easing-9f15041e.js";import"./VInput-37ac98b4.js";import"./forwardRefs-8348545e.js";import"./VSelect-5810a2bd.js";import"./dialog-transition-36ed2d83.js";import"./VMenu-cd6def04.js";import"./scopeId-de5379c9.js";import"./VCheckboxBtn-e288c3e7.js";import"./VSelectionControl-55d161a2.js";import"./VTimelineItem-69700d0e.js";import"./ssrBoot-b152ba8f.js";import"./filter-afb65e90.js";import"./VSpacer-4e6e7b2b.js";import"./lazy-5fc91b0c.js";import"./VSlideGroup-843da282.js";const tt={class:"my-5"},lt={key:0},ot=["src"],at={class:"my-5"},it={key:0,class:"d-flex flex-wrap gap-2 my-5"},nt={key:1},st={__name:"EditDeliveryOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","complet"],setup(F,{emit:z}){const i=F,g=z,{changeStatusByOpportunity:O}=ie(),{checkProcessForOpportunity:h}=pe(),P=async()=>{try{await O(i.opportunity.id,7,{}),g("complet")}catch(b){console.error("Error updating customer:",b)}},d=async(b,p)=>{console.log(`Procedimiento ${b} marcado como: ${p?"realizado":"no realizado"}`),await h(i.opportunity.id,b,{is_check:!p}),g("updateStageId",i.opportunity.id)};return(b,p)=>(s(),f(T,null,[l("div",tt,[p[0]||(p[0]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Propiedades ",-1)),i.opportunity.sales.length>0?(s(),f("div",lt,[(s(!0),f(T,null,H(i.opportunity.sales,_=>(s(),f("div",{key:_.id},[(s(!0),f(T,null,H(_.properties,$=>(s(),f("div",{key:$.id,class:"d-flex align-center justify-between"},[e(Se,{size:"50",rounded:""},{default:t(()=>[l("img",{src:a(De),alt:"Logo pora",style:{"border-radius":"30%"}},null,8,ot)]),_:1}),e(v,{cols:"12",md:"7"},{default:t(()=>[e(oe,{class:"font-weight-medium"},{default:t(()=>[V(y($.project_title)+" | "+y($.title),1)]),_:2},1024),e(ae,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",null,y(("formatCurrency"in b?b.formatCurrency:a(le))($.pivot_price)),1)]),_:2},1024)]),_:2},1024)]))),128))]))),128))])):M("",!0)]),l("div",at,[p[2]||(p[2]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),i.opportunity.procedure&&i.opportunity.procedure.length>0?(s(),f("div",it,[(s(!0),f(T,null,H(i.opportunity.procedure,_=>(s(),f("div",{key:_.id},[e(Z,{color:_.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:$=>d(_.id,_.pivot.is_check)},{default:t(()=>[_.pivot.is_check?(s(),q(J,{key:0,icon:"tabler-check",class:"mr-2"})):M("",!0),V(" "+y(_.title),1)]),_:2},1032,["color","onClick"]),e(te,{activator:"parent",location:"top"},{default:t(()=>[V(y(_.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(s(),f("div",nt,p[1]||(p[1]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(K,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(I,{color:"primary",size:"small",onClick:P},{default:t(()=>p[3]||(p[3]=[V(" Finalizar Oportunidad ")])),_:1})]),_:1})],64))}},Ee={__name:"EditCustomerDialog",props:{isDialogVisible:{type:Boolean,required:!0},opportunityKanban:{type:Object,required:!0}},emits:["update:isDialogVisible","update:newProperty"],setup(F,{emit:z}){const i=F,g=z;Object.values(xe).map(m=>({title:m.label,value:m.value}));const{propertiesAvailbles:O,properties:h}=He(),{getOpportunitybyId:P,opportunity:d,changeOpportunity:b,loadingOpportunity:p}=ie(),_=()=>{g("update:isDialogVisible",!1)},$=async()=>{console.log("antes del save:",d);const m={id:d.value.id,description:d.value.description,property_id:d.value.property_id,customer:{id:d.value.customer.id,name:d.value.customer.name,email:d.value.customer.email,ci:d.value.customer.ci,cod_phone:d.value.customer.cod_phone.replace(/\+/g,""),phone:d.value.customer.phone}};console.log("data de editar",m),await b(d.value.id,m),d.value.property_id&&(console.log("Cambio y geenero el Emit Principal"),g("update:newProperty",d.value.property_id)),g("update:isDialogVisible",!1)},x=async()=>{var m;(m=i.opportunityKanban)!=null&&m.id&&await P(i.opportunityKanban.id)},w=async()=>{await O()};return ne(()=>i.isDialogVisible,async m=>{m===!0&&(x(),await w())}),(m,u)=>{const S=ce,N=ge,n=_e,c=Ge,B=he;return s(),q(fe,{"max-width":"800","model-value":i.isDialogVisible,persistent:"","close-on-esc":!1,"onUpdate:modelValue":_},{default:t(()=>[e(S,{onClick:_}),e(X,{title:"Información del Cliente y Oportunidad",class:"pa-sm-8 pa-5"},{default:t(()=>[e(K,null,{default:t(()=>[e(Ue,{onSubmit:$e($,["prevent"])},{default:t(()=>[e(G,{dense:""},{default:t(()=>[e(v,{cols:"12",md:"6"},{default:t(()=>[e(N,{modelValue:a(d).customer.name,"onUpdate:modelValue":u[0]||(u[0]=k=>a(d).customer.name=k),label:"Nombre del Cliente",placeholder:"Ingresa el nombre",outlined:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:t(()=>[e(N,{modelValue:a(d).customer.email,"onUpdate:modelValue":u[1]||(u[1]=k=>a(d).customer.email=k),label:"Email del Cliente",placeholder:"Ingresa el email",outlined:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:t(()=>[e(G,null,{default:t(()=>[e(v,{cols:"4"},{default:t(()=>[e(n,{modelValue:a(d).customer.cod_phone,"onUpdate:modelValue":u[2]||(u[2]=k=>a(d).customer.cod_phone=k),label:"Código",items:["+1","+52","+55","+54","+49","+33","+34","+39","+86","+81","+7","+591"],placeholder:"Cód.",outlined:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"8"},{default:t(()=>[e(N,{modelValue:a(d).customer.phone,"onUpdate:modelValue":u[3]||(u[3]=k=>a(d).customer.phone=k),label:"Número de Teléfono",placeholder:"Ingresa el teléfono",outlined:"",dense:"",maxlength:"9"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(v,{cols:"12",md:"6"},{default:t(()=>[e(N,{modelValue:a(d).customer.ci,"onUpdate:modelValue":u[4]||(u[4]=k=>a(d).customer.ci=k),label:"CI del Cliente",placeholder:"Ingresa el CI",outlined:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(c,{modelValue:a(d).property_id,"onUpdate:modelValue":u[5]||(u[5]=k=>a(d).property_id=k),label:"Departamento de Interés",placeholder:"Selecciona un Departamento",items:a(h).map(k=>({title:k.title,value:k.id})),outlined:""},null,8,["modelValue","items"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(B,{modelValue:a(d).description,"onUpdate:modelValue":u[6]||(u[6]=k=>a(d).description=k),label:"Descripción de la Oportunidad",placeholder:"Ingresa una descripción",rows:"3","auto-grow":"",outlined:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",class:"text-center"},{default:t(()=>[e(I,{type:"submit",color:"primary",class:"me-3",disabled:a(p),loading:a(p)},{default:t(()=>u[7]||(u[7]=[V(" Guardar ")])),_:1},8,["disabled","loading"]),e(I,{color:"secondary",variant:"tonal",onClick:_},{default:t(()=>u[8]||(u[8]=[V(" Cancelar ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},rt={class:"d-flex align-bottom flex-sm-row flex-column"},ut={class:"user-profile-info"},dt={class:"d-flex align-center justify-center justify-sm-space-between flex-wrap gap-4"},pt={class:"d-flex align-center gap-x-3"},ct={class:"text-4xl font-weight-medium"},mt={class:"d-flex flex-column py-2",style:{"font-size":"14px"}},ft={class:"text-sm text-disabled"},yt={key:0,class:"d-flex flex-wrap gap-2 my-5"},vt={key:1},gt={key:0,class:"d-flex flex-wrap gap-2 my-5"},_t={key:1},bt={__name:"EditPreSaleOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","update:newProperty"],setup(F,{emit:z}){const i=F,g=z,{checkProcessForOpportunity:O}=pe(),{changeStatusQuotesCustomer:h}=Me(),P=D(!1),d=D(!1),b=()=>{P.value=!0},p=()=>{console.log("Se escucho el evento en EditProspectOpportunity"),g("update:newProperty")},_=()=>{d.value=!0},$=async m=>{g("updateStageId",m)},x=async(m,u)=>{console.log(`Procedimiento ${m} marcado como: ${u?"realizado":"no realizado"}`),await O(i.opportunity.id,m,{is_check:!u}),g("updateStageId",i.opportunity.id)},w=async(m,u)=>{const S=u==="APPROVED"?"NOT_APPROVED":"APPROVED";console.log(`Procedimiento ${m} marcado como: ${u}`),await h(m,{status:S}),g("updateStageId",i.opportunity.id)};return(m,u)=>{const S=ue("RouterLink"),N=ue("IconBtn");return s(),f(T,null,[l("div",rt,[l("div",ut,[u[3]||(u[3]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Perfil ",-1)),l("div",dt,[l("div",pt,[l("span",ct,y(("avatarText"in m?m.avatarText:a(Ae))(i.opportunity.customer.name)),1),l("div",mt,[e(S,{to:{name:"apps-ecommerce-customer-details-id",params:{id:1}},class:"font-weight-base"},{default:t(()=>[V(y(i.opportunity.customer.name),1)]),_:1}),l("span",ft,y(i.opportunity.customer.phone),1)]),e(I,{color:"secondary",variant:"tonal",size:"small",onClick:b},{default:t(()=>u[2]||(u[2]=[V(" Editar Perfil ")])),_:1})])])])]),l("div",null,[u[5]||(u[5]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),i.opportunity.procedure&&i.opportunity.procedure.length>0?(s(),f("div",yt,[(s(!0),f(T,null,H(i.opportunity.procedure,n=>(s(),f("div",{key:n.id},[e(Z,{color:n.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:c=>x(n.id,n.pivot.is_check)},{default:t(()=>[n.pivot.is_check?(s(),q(J,{key:0,icon:"tabler-check",class:"mr-2"})):M("",!0),V(" "+y(n.title),1)]),_:2},1032,["color","onClick"]),e(te,{activator:"parent",location:"top"},{default:t(()=>[V(y(n.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(s(),f("div",vt,u[4]||(u[4]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),l("div",null,[u[8]||(u[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Cotizaciones ",-1)),i.opportunity.quotes&&i.opportunity.quotes.length>0?(s(),f("div",gt,[e(de,{density:"compact",class:"text-no-wrap",style:{"font-size":"12px"}},{default:t(()=>[u[6]||(u[6]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th")])],-1)),l("tbody",null,[(s(!0),f(T,null,H(i.opportunity.quotes,n=>(s(),f("tr",{key:n.id},[l("td",null,y(n.properties[0].title),1),l("td",null,y(n.created_at),1),l("td",null,y(("formatCurrency"in m?m.formatCurrency:a(le))(n.amount)),1),l("td",null,[e(G,null,{default:t(()=>[e(se,{modelValue:n.status,"onUpdate:modelValue":c=>n.status=c,"true-value":"APPROVED","false-value":"NOT_APPROVED",disabled:""},null,8,["modelValue","onUpdate:modelValue"]),e(se,{modelValue:n.status_customer,"onUpdate:modelValue":c=>n.status_customer=c,"true-value":"APPROVED","false-value":"NOT_APPROVED",onClick:c=>w(n.id,n.status_customer)},{default:t(()=>[e(te,{activator:"parent",location:"top"},{default:t(()=>[V(y(n.status_customer=="NOT_APPROVED"?"No aprobado por cliente":"Aprobado por cliente"),1)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","onClick"]),e(S,{to:{name:"quote-id",params:{id:n.id}}},{default:t(()=>[e(N,null,{default:t(()=>[e(J,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])]),_:2},1024)])]))),128))])]),_:1})])):(s(),f("div",_t,u[7]||(u[7]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(K,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(S,{to:{name:"quote-add-quote"},class:"text-white"},{default:t(()=>[e(I,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>u[9]||(u[9]=[V(" Generar Cotización ")])),_:1})]),_:1}),e(I,{color:"primary",class:"mx-auto",size:"small",onClick:_},{default:t(()=>u[10]||(u[10]=[V(" Generar Venta ")])),_:1})]),_:1}),e(Ee,{"is-dialog-visible":a(P),"onUpdate:isDialogVisible":u[0]||(u[0]=n=>L(P)?P.value=n:null),"opportunity-kanban":i.opportunity,"onUpdate:newProperty":p},null,8,["is-dialog-visible","opportunity-kanban"]),e(Ce,{"is-dialog-visible":a(d),"onUpdate:isDialogVisible":u[1]||(u[1]=n=>L(d)?d.value=n:null),opportunity:i.opportunity,stage:"PRESALE",onRegisterSale:$},null,8,["is-dialog-visible","opportunity"])],64)}}},Vt={class:"d-flex align-bottom flex-sm-row flex-column"},wt={class:"user-profile-info"},kt={class:"d-flex align-center justify-center justify-sm-space-between flex-wrap gap-4"},Dt={class:"d-flex align-center gap-x-3"},xt={class:"text-4xl font-weight-medium"},Ct={class:"d-flex flex-column py-2",style:{"font-size":"14px"}},Pt={class:"text-sm text-disabled"},ht={key:0,class:"d-flex flex-wrap gap-2 my-5"},St={key:1},$t={key:0,class:"d-flex flex-wrap gap-2 my-5"},At={key:1},Ut={__name:"EditProspectOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","update:newProperty"],setup(F,{emit:z}){const i=F,g=z,{checkProcessForOpportunity:O}=pe(),{changeStatusByOpportunity:h,loadingOpportunity:P}=ie(),d=D(!1),b=()=>{d.value=!0},p=()=>{console.log("Se escucho el evento en EditProspectOpportunity"),g("update:newProperty")},_=async x=>{await h(x,xe.PRESALE.value,{}),g("updateStageId",x)},$=async x=>{console.log(`Procedimiento ${x.id} marcado como: ${x.pivot.is_check?"realizado":"no realizado"}`),await O(i.opportunity.id,x.id,{is_check:!x.pivot.is_check}),x.pivot.is_check=!x.pivot.is_check,g("updateStageId",i.opportunity.id)};return(x,w)=>{const m=ue("RouterLink"),u=ue("IconBtn");return s(),f(T,null,[l("div",Vt,[l("div",wt,[w[3]||(w[3]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Perfil ",-1)),l("div",kt,[l("div",Dt,[l("span",xt,y(("avatarText"in x?x.avatarText:a(Ae))(i.opportunity.customer.name)),1),l("div",Ct,[e(m,{to:{name:"apps-ecommerce-customer-details-id",params:{id:1}},class:"font-weight-base"},{default:t(()=>[V(y(i.opportunity.customer.name),1)]),_:1}),l("span",Pt,y(i.opportunity.customer.phone),1)]),l("div",null,[e(I,{color:"secondary",variant:"tonal",size:"small",onClick:b},{default:t(()=>w[2]||(w[2]=[V(" Editar Perfil ")])),_:1})])])])])]),l("div",null,[w[5]||(w[5]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),i.opportunity.procedure&&i.opportunity.procedure.length>0?(s(),f("div",ht,[(s(!0),f(T,null,H(i.opportunity.procedure,S=>(s(),f("div",{key:S.id},[e(Z,{color:S.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:N=>$(S)},{default:t(()=>[S.pivot.is_check?(s(),q(J,{key:0,icon:"tabler-check",class:"mr-2"})):M("",!0),V(" "+y(S.title),1)]),_:2},1032,["color","onClick"]),e(te,{activator:"parent",location:"top"},{default:t(()=>[V(y(S.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(s(),f("div",St,w[4]||(w[4]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),l("div",null,[w[8]||(w[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Cotizaciones ",-1)),i.opportunity.quotes&&i.opportunity.quotes.length>0?(s(),f("div",$t,[e(de,{density:"compact",class:"text-no-wrap",style:{"font-size":"12px"}},{default:t(()=>[w[6]||(w[6]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th")])],-1)),l("tbody",null,[(s(!0),f(T,null,H(i.opportunity.quotes,S=>(s(),f("tr",{key:S.id},[l("td",null,y(S.properties[0].title),1),l("td",null,y(S.created_at),1),l("td",null,y(("formatCurrency"in x?x.formatCurrency:a(le))(S.amount)),1),l("td",null,[e(m,{to:{name:"quote-id",params:{id:S.id}}},{default:t(()=>[e(u,null,{default:t(()=>[e(J,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])])]))),128))])]),_:1})])):(s(),f("div",At,w[7]||(w[7]=[l("span",null,"No hay cotizaciones disponibles.",-1)])))]),e(K,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(m,{to:{name:"quote-add-quote"},class:"text-white"},{default:t(()=>[e(I,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>w[9]||(w[9]=[V(" Generar Cotización ")])),_:1})]),_:1}),e(I,{color:"primary",class:"mx-auto",size:"small",disabled:a(P),loading:a(P),onClick:w[0]||(w[0]=S=>_(i.opportunity.id))},{default:t(()=>w[10]||(w[10]=[V(" Siguiente Etapa ")])),_:1},8,["disabled","loading"])]),_:1}),e(Ee,{"is-dialog-visible":a(d),"onUpdate:isDialogVisible":w[1]||(w[1]=S=>L(d)?d.value=S:null),"opportunity-kanban":i.opportunity,"onUpdate:newProperty":p},null,8,["is-dialog-visible","opportunity-kanban"])],64)}}},Ot={__name:"DeliveryForm",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(F,{emit:z}){const i=F,g=z,{changeStatusByOpportunity:O}=ie(),h=p=>{g("update:isDialogVisible",p)},P=D(structuredClone(Y(i.opportunity)));ne(i,()=>{P.value=structuredClone(Y(i.opportunity))});const d=async()=>{g("update:isDialogVisible",!1);try{await O(i.opportunity.id,5,{delivery_date:P.value.sales.delivery_date}),g("updateDeliveryDate",P.value.id)}catch(p){console.error("Error updating customer:",p)}},b=()=>{g("update:isDialogVisible",!1)};return(p,_)=>{const $=ce;return s(),q(fe,{"model-value":i.isDialogVisible,"max-width":"800","onUpdate:modelValue":h},{default:t(()=>[e($,{onClick:_[0]||(_[0]=x=>p.$emit("update:isDialogVisible",!1))}),e(X,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(me,{class:"text-h3 text-center"},{default:t(()=>_[2]||(_[2]=[V(" Confirmar Fecha ")])),_:1}),e(K,null,{default:t(()=>[e(K,null,{default:t(()=>[e(G,null,{default:t(()=>[e(v,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(re,{modelValue:a(P).sales.delivery_date,"onUpdate:modelValue":_[1]||(_[1]=x=>a(P).sales.delivery_date=x),label:"Fecha de Entrega",type:"date",rules:["requiredValidator"in p?p.requiredValidator:a(Q)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),e(v,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(I,{onClick:d},{default:t(()=>_[3]||(_[3]=[V(" Pasar a Entrega ")])),_:1}),e(I,{color:"secondary",variant:"tonal",onClick:b},{default:t(()=>_[4]||(_[4]=[V(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},zt={key:0},qt={__name:"PaymentPlanEdit",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},payment:{type:Object,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(F,{emit:z}){const i=F,g=z,{updatePaymentPlans:O}=be(),h=D(!1),P=n=>{g("update:isDialogVisible",n)},d=D(structuredClone(Y(i.payment))),b=D(structuredClone(Y(i.opportunity))),p=D([]);ne(i,()=>{d.value=structuredClone(Y(i.payment)),b.value=structuredClone(Y(i.opportunity))});const _=()=>{p.value.push({amount:"",date:"",type:d.value.type})},$=n=>{p.value.splice(n,1)},x=ee(()=>p.value.reduce((n,c)=>{const B=parseFloat(c.amount)||0;return n+B},0)),w=ee(()=>p.value.length>0&&p.value.every(n=>n.amount&&n.date&&n.type)),m=ee(()=>{if(p.value.length===0)return!0;const n=p.value.reduce((k,W)=>k+(parseFloat(W.amount)||0),0),c=parseFloat(n),B=parseFloat(d.value.amount);return c===B}),u=ee(()=>p.value.length===0?!0:w.value&&m.value),S=async()=>{if(!m.value){Oe("Validación fallida","La suma de las diferencias no es correcta");return}if(!u.value){alert("Por favor, completa todos los campos obligatorios.");return}h.value=!0;try{await O(d.value.id,{date:d.value.date,differData:p.value})}catch(n){console.error("Error updating customer:",n)}finally{g("updateDeliveryDate",b.value.id),g("update:isDialogVisible",!1),p.value=[],h.value=!1}},N=()=>{g("update:isDialogVisible",!1),p.value=[],errorMessage.value=""};return(n,c)=>{const B=ce;return s(),q(fe,{"model-value":i.isDialogVisible,"max-width":"800","onUpdate:modelValue":P},{default:t(()=>[e(B,{onClick:c[0]||(c[0]=k=>n.$emit("update:isDialogVisible",!1))}),e(X,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(me,{class:"text-h3 text-center"},{default:t(()=>c[2]||(c[2]=[V(" Editar Pago ")])),_:1}),e(K,null,{default:t(()=>[e(G,{class:"mx-5"},{default:t(()=>[e(v,{cols:"6"},{default:t(()=>[l("h3",null," Monto a Pagar : "+y(a(le)(a(d).amount)),1)]),_:1}),e(v,{cols:"6"},{default:t(()=>[e(re,{modelValue:a(d).date,"onUpdate:modelValue":c[1]||(c[1]=k=>a(d).date=k),label:"Cambiar Fecha",type:"date",rules:["requiredValidator"in n?n.requiredValidator:a(Q)]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(X,{flat:"",class:"d-flex flex-column pa-5 px-5"},{default:t(()=>[(s(!0),f(T,null,H(a(p),(k,W)=>(s(),f("div",{key:k.id,class:"d-flex align-center my-4"},[e(re,{modelValue:k.amount,"onUpdate:modelValue":A=>k.amount=A,label:"Monto *",type:"number",class:"mr-4",outlined:"",rules:["requiredValidator"in n?n.requiredValidator:a(Q)]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(re,{modelValue:k.date,"onUpdate:modelValue":A=>k.date=A,label:"Fecha de Pago *",type:"date",class:"mr-3",outlined:"",rules:["requiredValidator"in n?n.requiredValidator:a(Q)]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(I,{color:"error",onClick:A=>$(W)},{default:t(()=>[e(J,{icon:"tabler-square-x"})]),_:2},1032,["onClick"])]))),128)),a(p).length>0?(s(),f("div",zt,[c[3]||(c[3]=l("strong",null,"Monto Restante:",-1)),V(" "+y(a(le)(a(d).amount-a(x))),1)])):M("",!0),e(I,{color:"primary",variant:"tonal",class:"mt-4",size:"small",onClick:_},{default:t(()=>c[4]||(c[4]=[V(" Diferir Pago ")])),_:1})]),_:1}),e(v,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(I,{loading:a(h),disabled:!a(u)||a(h),onClick:S},{default:t(()=>c[5]||(c[5]=[V(" Guardar ")])),_:1},8,["loading","disabled"]),e(I,{color:"error",variant:"tonal",onClick:N},{default:t(()=>c[6]||(c[6]=[V(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Ft={__name:"SalePaymentPlan",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},salesPayment:{type:Array,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(F,{emit:z}){const i=F,g=z;be();const O=b=>{g("update:isDialogVisible",b)},h=D(structuredClone(Y(i.opportunity)));ne(i,()=>{h.value=structuredClone(Y(i.opportunity)),console.log("Sales Payment:",i.salesPayment)});const P=D([]),d=()=>{g("update:isDialogVisible",!1),P.value=[]};return(b,p)=>{const _=ce;return s(),q(fe,{"model-value":i.isDialogVisible,"max-width":"800","onUpdate:modelValue":O},{default:t(()=>[e(_,{onClick:p[0]||(p[0]=$=>b.$emit("update:isDialogVisible",!1))}),e(X,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(me,{class:"text-h3 text-center"},{default:t(()=>p[1]||(p[1]=[V(" Confirmar Fecha ")])),_:1}),e(K,null,{default:t(()=>[e(K,null,{default:t(()=>[e(G,null,{default:t(()=>[e(v,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l("span",null," Monto a Pagar : "+y(a(h)),1)]),_:1})]),_:1})]),_:1}),e(v,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(I,{onClick:b.onFormSubmit},{default:t(()=>p[2]||(p[2]=[V(" Guardar ")])),_:1},8,["onClick"]),e(I,{color:"error",variant:"tonal",onClick:d},{default:t(()=>p[3]||(p[3]=[V(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},jt={class:"text-h6"},Et={class:"text-h6"},It={class:"text-h6"},Tt={class:"my-5"},Nt={key:0},Bt=["src"],Rt={class:"mb-4"},Lt=["onClick"],Mt=["onClick"],Gt={class:"my-5"},Ht={key:0,class:"d-flex flex-wrap gap-2 my-5"},Qt={key:1},Kt={__name:"EditSaleOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId"],setup(F,{emit:z}){const i=F,g=z,{checkProcessForOpportunity:O}=pe(),{confirmPaymentPlans:h}=be(),{changeStatusByOpportunity:P,loadingOpportunity:d}=ie(),{SaleChangeSignature:b}=Qe(),p=D(!1),_=D(!1),$=D(!1),x=D(""),w=ee(()=>i.opportunity.sales.reduce((C,r)=>C+r.amount,0)),m=ee(()=>i.opportunity.sales.reduce((C,r)=>C+r.initial_fee,0)),u=ee(()=>w.value-m.value),S=()=>{$.value=!0},N=C=>{if(C.is_paid===1){Oe("Advertencia","No se puede editar un pago ya realizado.");return}console.log("entro aqui"),_.value=!0,x.value={...C}},n=async C=>{g("updateStageId",C)},c=async C=>{console.log(`Procedimiento ${C.id} marcado como: ${C.pivot.is_check?"realizado":"no realizado"}`),await O(i.opportunity.id,C.id,{is_check:!C.pivot.is_check}),C.pivot.is_check=!C.pivot.is_check,g("updateStageId",i.opportunity.id)},B=async C=>{console.log(C),await h(C),g("updateStageId",i.opportunity.id)},k=async C=>{console.log("entra a firma"),await b(C),g("updateStageId",i.opportunity.id)},W=async C=>{await P(C,5,{}),g("updateStageId",C)},A=async C=>{g("updateStageId",C)};return(C,r)=>(s(),f(T,null,[l("div",null,[e(X,null,{default:t(()=>[e(K,null,{default:t(()=>[e(G,null,{default:t(()=>[e(v,{cols:"4",class:"border rounded-sm mx-1"},{default:t(()=>[e(oe,{class:"font-weight-medium"},{default:t(()=>r[5]||(r[5]=[V(" Saldo ")])),_:1}),e(ae,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",jt,y(("formatCurrency"in C?C.formatCurrency:a(le))(a(u))),1)]),_:1})]),_:1}),e(v,{cols:"3",class:"border rounded-sm mx-1"},{default:t(()=>[e(oe,{class:"font-weight-medium"},{default:t(()=>r[6]||(r[6]=[V(" Anticipo ")])),_:1}),e(ae,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Et,y(("formatCurrency"in C?C.formatCurrency:a(le))(a(m))),1)]),_:1})]),_:1}),e(v,{cols:"4",class:"border rounded-sm mx-1"},{default:t(()=>[e(oe,{class:"font-weight-medium"},{default:t(()=>r[7]||(r[7]=[V(" Precio Final ")])),_:1}),e(ae,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",It,y(("formatCurrency"in C?C.formatCurrency:a(le))(a(w))),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),l("div",Tt,[r[9]||(r[9]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Propiedades ",-1)),i.opportunity.sales.length>0?(s(),f("div",Nt,[(s(!0),f(T,null,H(i.opportunity.sales,o=>(s(),f("div",{key:o.id},[e(G,null,{default:t(()=>[(s(!0),f(T,null,H(o.properties,U=>(s(),q(v,{key:U.id,class:"d-flex align-center justify-between",cols:"12",md:"9"},{default:t(()=>[e(Se,{size:"50",rounded:""},{default:t(()=>[l("img",{src:a(De),alt:"Logo pora",style:{"border-radius":"30%"}},null,8,Bt)]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(oe,{class:"font-weight-medium"},{default:t(()=>[V(y(U.project_title)+" | "+y(U.title),1)]),_:2},1024),e(ae,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",null,"$ "+y(U.pivot_price),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),e(se,{modelValue:o.confirmation_signature,"onUpdate:modelValue":U=>o.confirmation_signature=U,"true-value":1,"false-value":0,onChange:U=>k(o.id)},{default:t(()=>[e(te,{activator:"parent",location:"top"},{default:t(()=>r[8]||(r[8]=[V(" Confirmar firma ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]))),128))])):M("",!0)]),l("div",Rt,[r[12]||(r[12]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Anticipo ",-1)),i.opportunity.initial_payments&&i.opportunity.initial_payments.length>0?(s(),q(de,{key:0,density:"compact",class:"text-no-wrap my-2",style:{"font-size":"12px"}},{default:t(()=>[r[11]||(r[11]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th",null," Action ")])],-1)),l("tbody",null,[(s(!0),f(T,null,H(i.opportunity.initial_payments,o=>(s(),f("tr",{key:o.id},[l("td",null,y(o.property_title),1),l("td",null,y(o.date),1),l("td",null,y(o.amount),1),l("td",null,[e(G,null,{default:t(()=>[e(se,{modelValue:o.is_paid,"onUpdate:modelValue":U=>o.is_paid=U,"true-value":1,"false-value":0,disabled:o.is_paid===1,onChange:U=>B(o.id)},{default:t(()=>[e(te,{activator:"parent",location:"top"},{default:t(()=>r[10]||(r[10]=[V(" Confirmar Pago ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"]),o.is_paid===0?(s(),f("div",{key:0,"fill-dot":"",style:{cursor:"pointer"},onClick:U=>N(o)},[e(a(J),{size:"25",icon:"tabler-edit"})],8,Lt)):M("",!0)]),_:2},1024)])]))),128))])]),_:1})):M("",!0)]),l("div",null,[r[15]||(r[15]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Saldos ",-1)),i.opportunity.balance_payments&&i.opportunity.balance_payments.length>0?(s(),q(de,{key:0,density:"compact",class:"text-no-wrap my-2",style:{"font-size":"12px"}},{default:t(()=>[r[14]||(r[14]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th",null," Action ")])],-1)),l("tbody",null,[(s(!0),f(T,null,H(i.opportunity.balance_payments,o=>(s(),f("tr",{key:o.id},[l("td",null,y(o.property_title),1),l("td",null,y(o.date),1),l("td",null,y(o.amount),1),l("td",null,[e(G,null,{default:t(()=>[e(se,{modelValue:o.is_paid,"onUpdate:modelValue":U=>o.is_paid=U,"true-value":1,"false-value":0,disabled:o.is_paid===1,onChange:U=>B(o.id)},{default:t(()=>[e(te,{activator:"parent",location:"top"},{default:t(()=>r[13]||(r[13]=[V(" Confirmar Pago ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"]),o.is_paid===0?(s(),f("div",{key:0,"fill-dot":"",style:{cursor:"pointer"},onClick:U=>N(o)},[e(a(J),{size:"25",icon:"tabler-edit"})],8,Mt)):M("",!0)]),_:2},1024)])]))),128))])]),_:1})):M("",!0)]),l("div",Gt,[r[17]||(r[17]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),i.opportunity.procedure&&i.opportunity.procedure.length>0?(s(),f("div",Ht,[(s(!0),f(T,null,H(i.opportunity.procedure,o=>(s(),f("div",{key:o.id},[e(Z,{color:o.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:U=>c(o)},{default:t(()=>[o.pivot.is_check?(s(),q(a(J),{key:0,icon:"tabler-check",class:"mr-2"})):M("",!0),V(" "+y(o.title),1)]),_:2},1032,["color","onClick"]),e(te,{activator:"parent",location:"top"},{default:t(()=>[V(y(o.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(s(),f("div",Qt,r[16]||(r[16]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(K,{class:"d-flex mt-4"},{default:t(()=>[e(I,{color:"primary",variant:"tonal",class:"mx-auto",size:"small",onClick:S},{default:t(()=>r[18]||(r[18]=[V(" Generar Venta ")])),_:1}),e(I,{color:"primary",class:"mx-auto",size:"small",onClick:r[0]||(r[0]=o=>W(i.opportunity.id))},{default:t(()=>r[19]||(r[19]=[V(" Siguiente Etapa ")])),_:1})]),_:1}),e(Ot,{"is-dialog-visible":a(p),"onUpdate:isDialogVisible":r[1]||(r[1]=o=>L(p)?p.value=o:null),opportunity:i.opportunity,onUpdateDeliveryDate:A},null,8,["is-dialog-visible","opportunity"]),e(qt,{"is-dialog-visible":a(_),"onUpdate:isDialogVisible":r[2]||(r[2]=o=>L(_)?_.value=o:null),payment:a(x),opportunity:i.opportunity,onUpdateDeliveryDate:A},null,8,["is-dialog-visible","payment","opportunity"]),e(Ce,{"is-dialog-visible":a($),"onUpdate:isDialogVisible":r[3]||(r[3]=o=>L($)?$.value=o:null),opportunity:i.opportunity,stage:"SALE",onRegisterSale:n},null,8,["is-dialog-visible","opportunity"]),e(Ft,{"is-dialog-visible":C.openSaleEditPaymentPlan,"onUpdate:isDialogVisible":r[4]||(r[4]=o=>C.openSaleEditPaymentPlan=o),opportunity:i.opportunity,"sales-payment":C.salePaymentPlan,onUpdateDeliveryDate:A},null,8,["is-dialog-visible","opportunity","sales-payment"])],64))}},Wt={__name:"DrawerBitacora",props:{isDrawerOpen:{type:Boolean,required:!0},customer:{type:String,required:!0}},emits:["update:isDrawerOpen"],setup(F,{emit:z}){const i=F,g=z,O=h=>{g("update:isDrawerOpen",h)};return(h,P)=>(s(),q(qe,{temporary:"",width:500,location:"end",class:"scrollable-content","model-value":i.isDrawerOpen,"onUpdate:modelValue":O},{default:t(()=>[e(a(ze),{options:{wheelPropagation:!1}},{default:t(()=>[e(Be,{customer:F.customer},null,8,["customer"])]),_:1})]),_:1},8,["model-value"]))}};const Jt={__name:"SellerReport",setup(F){return D([{title:"Actividad 1",date:"2024-10-09",status:"Pendiente"},{title:"Actividad 2",date:"2024-10-10",status:"Completada"},{title:"Actividad 3",date:"2024-10-11",status:"En Progreso"}]),(z,i)=>(s(),q(K,null,{default:t(()=>i[0]||(i[0]=[l("p",null,"No hay actividades seleccionadas. Aquí tienes un resumen de las actividades:",-1)])),_:1}))}},Yt=Fe(Jt,[["__scopeId","data-v-c9cbe3f1"]]),Xt={__name:"CustomerHistory",props:{isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","userData"],setup(F,{emit:z}){const i=F,g=z,O=D(!1),h=D(),P=D(""),d=D(""),b=D(""),p=D(""),_=D(),$=D(""),x=D(),w=D(),m=D(),u=()=>{g("update:isDrawerOpen",!1),Ve(()=>{var n,c;(n=h.value)==null||n.reset(),(c=h.value)==null||c.resetValidation()})},S=()=>{var n;(n=h.value)==null||n.validate().then(({valid:c})=>{c&&(g("userData",{id:0,fullName:P.value,company:p.value,role:x.value,country:_.value,contact:$.value,email:b.value,currentPlan:w.value,status:m.value,avatar:"",billing:"Auto Debit"}),g("update:isDrawerOpen",!1),Ve(()=>{var B,k;(B=h.value)==null||B.reset(),(k=h.value)==null||k.resetValidation()}))})},N=n=>{g("update:isDrawerOpen",n)};return(n,c)=>{const B=Ke,k=ge,W=_e;return s(),q(qe,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":i.isDrawerOpen,"onUpdate:modelValue":N},{default:t(()=>[e(B,{title:"Historial del Cliente",onCancel:u}),e(a(ze),{options:{wheelPropagation:!1}},{default:t(()=>[e(X,{flat:""},{default:t(()=>[e(K,null,{default:t(()=>[e(Ue,{ref_key:"refForm",ref:h,modelValue:a(O),"onUpdate:modelValue":c[9]||(c[9]=A=>L(O)?O.value=A:null),onSubmit:$e(S,["prevent"])},{default:t(()=>[e(G,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[e(k,{modelValue:a(P),"onUpdate:modelValue":c[0]||(c[0]=A=>L(P)?P.value=A:null),rules:["requiredValidator"in n?n.requiredValidator:a(Q)],label:"Full Name",placeholder:"John Doe"},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(k,{modelValue:a(d),"onUpdate:modelValue":c[1]||(c[1]=A=>L(d)?d.value=A:null),rules:["requiredValidator"in n?n.requiredValidator:a(Q)],label:"Username",placeholder:"Johndoe"},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(k,{modelValue:a(b),"onUpdate:modelValue":c[2]||(c[2]=A=>L(b)?b.value=A:null),rules:["requiredValidator"in n?n.requiredValidator:a(Q),"emailValidator"in n?n.emailValidator:a(Te)],label:"Email",placeholder:"johndoe@email.com"},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(k,{modelValue:a(p),"onUpdate:modelValue":c[3]||(c[3]=A=>L(p)?p.value=A:null),rules:["requiredValidator"in n?n.requiredValidator:a(Q)],label:"Company",placeholder:"PixInvent"},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(W,{modelValue:a(_),"onUpdate:modelValue":c[4]||(c[4]=A=>L(_)?_.value=A:null),label:"Select Country",placeholder:"Select Country",rules:["requiredValidator"in n?n.requiredValidator:a(Q)],items:["USA","UK","India","Australia"]},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(k,{modelValue:a($),"onUpdate:modelValue":c[5]||(c[5]=A=>L($)?$.value=A:null),type:"number",rules:["requiredValidator"in n?n.requiredValidator:a(Q)],label:"Contact",placeholder:"+1-541-754-3010"},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(W,{modelValue:a(x),"onUpdate:modelValue":c[6]||(c[6]=A=>L(x)?x.value=A:null),label:"Select Role",placeholder:"Select Role",rules:["requiredValidator"in n?n.requiredValidator:a(Q)],items:["Admin","Author","Editor","Maintainer","Subscriber"]},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(W,{modelValue:a(w),"onUpdate:modelValue":c[7]||(c[7]=A=>L(w)?w.value=A:null),label:"Select Plan",placeholder:"Select Plan",rules:["requiredValidator"in n?n.requiredValidator:a(Q)],items:["Basic","Company","Enterprise","Team"]},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(W,{modelValue:a(m),"onUpdate:modelValue":c[8]||(c[8]=A=>L(m)?m.value=A:null),label:"Select Status",placeholder:"Select Status",rules:["requiredValidator"in n?n.requiredValidator:a(Q)],items:[{title:"Active",value:"active"},{title:"Inactive",value:"inactive"},{title:"Pending",value:"pending"}]},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(I,{type:"submit",class:"me-3"},{default:t(()=>c[10]||(c[10]=[V(" Submit ")])),_:1}),e(I,{type:"reset",variant:"outlined",color:"secondary",onClick:u},{default:t(()=>c[11]||(c[11]=[V(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Zt={class:"d-flex justify-space-between align-center"},el={class:"mb-2"},tl={style:{"font-size":"14px","font-weight":"500"}},ll={style:{"font-size":"12px","font-weight":"500"}},ol={__name:"AddActivity",props:{activitiesData:{type:Object,required:!0,default:()=>({title:"",description:"",schedule_at:""})},isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","refreshActivities"],setup(F,{emit:z}){const i=F,g=z,O=D(!1);D(!1);const h=D("radio-1"),P=D(!1),d=()=>{P.value=!0},b=D({title:"",description:"",type_activity_id:null,opportunity_id:null,assigned_to:null,scheduled_at:null,status:"COMPLETED"}),{completedActivityAndRegister:p,getallTypeActivities:_,typeActivities:$,loadingActivity:x}=Pe(),{getOpportunitybyId:w,opportunity:m}=ie(),u=D(structuredClone(Y(i.activitiesData))),S=r=>{console.log("esta consultando de nuevo despues de cambiar etapa "),w(r)};ne(i,()=>{u.value=structuredClone(Y(i.activitiesData)),w(u.value.opportunity_id),N()});const N=async()=>{await _()},n=()=>{w(u.value.opportunity_id)},c=()=>{g("update:isDrawerOpen",!1),b.value={title:null,description:null,type_activity_id:null,scheduled_at:null,opportunity_id:null,assigned_to:null,status:"COMPLETED"},g("refreshActivities")},B=async()=>{let r="";h.value==="radio-1"?r="COMPLETED":h.value==="radio-2"&&(r="CANCELLED"),p(u.value.id,{title:b.value.title,description:b.value.description,type_activity_id:b.value.type_activity_id,scheduled_at:b.value.scheduled_at,assigned_to:m.value.user_id,property_id:m.value.property_id,opportunity_id:m.value.id,status:r}),c()},k=async()=>{we.fire({title:"Quieres dar de baja al cliente ?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"confirmar"}).then(r=>{r.isConfirmed&&(Ie(u.value.id),c(),we.fire({text:"EL cliente fue dado de baja",icon:"success"}))})},W=async()=>{g("update:isDrawerOpen",!1),g("refreshActivities")},A=()=>{console.log("Se escucho el evento en AddActivity"),g("refreshActivities")},C=r=>{const o=new Date(r),U=o.getDate(),R=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][o.getMonth()],E=o.getHours().toString().padStart(2,"0"),ye=o.getMinutes().toString().padStart(2,"0");return`${U} de ${R}, ${E}:${ye}`};return(r,o)=>{const U=ge,j=Ne,R=he;return s(),f(T,null,[e(G,{class:"d-flex justify-space-between"},{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[F.isDrawerOpen?(s(),q(X,{key:0},{default:t(()=>[e(K,null,{default:t(()=>[e(je,{class:"mx-2 my-2"},{default:t(()=>[e(G,null,{default:t(()=>[e(v,{cols:"12",sm:"5"},{default:t(()=>[e(G,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[l("div",Zt,[o[8]||(o[8]=l("span",{style:{"font-size":"18px","font-weight":"500"}}," Actividad ",-1)),e(Z,{color:"warning",onClick:d},{default:t(()=>o[7]||(o[7]=[V(" historial ")])),_:1})])]),_:1}),e(v,{cols:"12"},{default:t(()=>[l("div",el,[l("span",tl,y(i.activitiesData.title)+" • "+y(C(i.activitiesData.scheduled_at)),1),o[9]||(o[9]=l("br",null,null,-1)),l("span",ll,y(i.activitiesData.description)+" "+y(a(m).customer_id),1)]),e(Je,{modelValue:a(h),"onUpdate:modelValue":o[0]||(o[0]=E=>L(h)?h.value=E:null),style:{"font-size":"14px"},inline:""},{default:t(()=>[o[10]||(o[10]=l("span",{class:"my-1"}," ¿Se realizó? ",-1)),e(ke,{label:"Si",value:"radio-1",density:"compact",class:"mx-2"}),e(ke,{label:"No",value:"radio-2",class:"mx-2",density:"compact"})]),_:1},8,["modelValue"]),e(Ye,{class:"mt-2"})]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(U,{modelValue:a(b).title,"onUpdate:modelValue":o[1]||(o[1]=E=>a(b).title=E),label:"Título de la actividad",placeholder:"..."},null,8,["modelValue"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(_e,{modelValue:a(b).type_activity_id,"onUpdate:modelValue":o[2]||(o[2]=E=>a(b).type_activity_id=E),label:"Tipo de actividad",placeholder:"Selecciona el tipo de actividad",items:a($).map(E=>({title:E.name,value:E.id}))},null,8,["modelValue","items"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(j,{modelValue:a(b).scheduled_at,"onUpdate:modelValue":o[3]||(o[3]=E=>a(b).scheduled_at=E),label:"Seleccione la fecha y hora",placeholder:"Seleccione la fecha y hora",config:{enableTime:!0,dateFormat:"Y-m-d H:i"},rules:["requiredValidator"in r?r.requiredValidator:a(Q)]},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(R,{modelValue:a(b).description,"onUpdate:modelValue":o[4]||(o[4]=E=>a(b).description=E),label:"Descripción",rows:"3",rules:["requiredValidator"in r?r.requiredValidator:a(Q)]},null,8,["modelValue","rules"])]),_:1}),e(v,null,{default:t(()=>[e(I,{color:"primary",class:"mx-auto",size:"small",loading:a(x),disabled:a(x),onClick:B},{default:t(()=>o[11]||(o[11]=[V(" Crear Actividad ")])),_:1},8,["loading","disabled"]),e(I,{color:"primary",class:"mx-1",variant:"tonal",size:"small",onClick:k},{default:t(()=>o[12]||(o[12]=[V(" Dar de Baja ")])),_:1})]),_:1})]),_:1})]),_:1}),e(v,{cols:"12",sm:"7",style:{"align-items":"center"}},{default:t(()=>[e(G,{class:"mb-2"},{default:t(()=>[e(v,{cols:"6"},{default:t(()=>o[13]||(o[13]=[l("span",{style:{"font-size":"18px","font-weight":"500"}}," Etapa ",-1)])),_:1}),e(v,{cols:"12",md:"6",class:"d-flex justify-end align-center"},{default:t(()=>[e(Z,{label:"",color:"primary"},{default:t(()=>[V(y(a(m).stage.title),1)]),_:1})]),_:1})]),_:1}),a(m).stage_id===2?(s(),q(Ut,{key:0,opportunity:a(m),onUpdateStageId:S,"onUpdate:newProperty":A},null,8,["opportunity"])):M("",!0),a(m).stage_id===3?(s(),q(bt,{key:1,opportunity:a(m),onUpdateStageId:S,"onUpdate:newProperty":A},null,8,["opportunity"])):M("",!0),a(m).stage_id===4?(s(),q(Kt,{key:2,opportunity:a(m),onRefreshActivities:n,onUpdateStageId:S},null,8,["opportunity"])):M("",!0),a(m).stage_id===5?(s(),q(st,{key:3,opportunity:a(m),onRefreshActivities:n,onUpdateStageId:S,onComplet:W},null,8,["opportunity"])):M("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):(s(),q(X,{key:1,title:"Reporte de Actividades"},{default:t(()=>[e(Yt)]),_:1}))]),_:1}),e(v,{cols:"12",md:"6"},{default:t(()=>[e(Xt,{"is-drawer-open":a(O),"onUpdate:isDrawerOpen":o[5]||(o[5]=E=>L(O)?O.value=E:null)},null,8,["is-drawer-open"])]),_:1})]),_:1}),e(Wt,{"is-drawer-open":a(P),"onUpdate:isDrawerOpen":o[6]||(o[6]=E=>L(P)?P.value=E:null),customer:a(m).customer_id},null,8,["is-drawer-open","customer"])],64)}}};const al={class:"mt-2 mx-3"},il={style:{"font-size":"14px"}},nl={key:0,class:"no-activities-message d-flex flex-column justify-center align-center",style:{"min-block-size":"200px","text-align":"center"}},sl=["onClick"],rl={class:"mx-2"},ul={class:"d-flex justify-content-between",style:{"font-size":"0.9em"}},dl={__name:"list",setup(F){const z=D(""),i=D("Anteriores");D(["Todos","PORA"]),D("Todos");const{getallActivitiesByAsesorFecha:g,getallActivitiesByFechaPast:O,getallActivitiesByFechaFuture:h,activities:P,activitiesPast:d,activitiesFuture:b}=Pe(),p=D(""),_=Re("userData").value,$=D(!0),x=D([]),w=D([]),m=D([]),u=async()=>{await g(_.id),x.value=P.value},S=async()=>{await O(_.id),w.value=d.value},N=async()=>{await h(_.id),m.value=b.value};Le(async()=>{await u(),await S(),await N(),$.value=!1});const n=D(!1),c=r=>{n.value=!0,p.value={...r}},B=async()=>{$.value=!0,await u(),await S(),await N(),$.value=!1},k=ee(()=>[{tabName:"Anteriores",icon:"tabler-calendar",actividades:w,badge:w.value.length},{tabName:"Hoy",icon:"tabler-edit",actividades:x,badge:x.value.length},{tabName:"Futuros",icon:"tabler-calendar",actividades:m,badge:m.value.length}]),W=[{type:"Visita",icon:"tabler-current-location"},{type:"Llamada",icon:"tabler-phone"},{type:"Cotizacion",icon:"tabler-cash"},{type:"Otro",icon:"tabler-table"}],A=r=>{const o=W.find(U=>U.type===r);return o?o.icon:"tabler-default"},C=r=>{const o=new Date(r),U=o.getDate(),R=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][o.getMonth()],E=o.getHours().toString().padStart(2,"0"),ye=o.getMinutes().toString().padStart(2,"0");return`${U} de ${R}, ${E}:${ye}`};return ne(z,r=>{const o=U=>U.filter(j=>{const R=j.name_opportunity.toLowerCase().includes(r.toLowerCase()),E=j.phone_opportunity.toLowerCase().includes(r.toLowerCase());return R||E});r.length>2?(x.value=o(P.value),w.value=o(d.value),m.value=o(b.value)):(x.value=P.value,w.value=d.value,m.value=b.value)}),(r,o)=>{const U=ue("VCircularProgress");return s(),q(G,{class:"match-height",style:{display:"flex","block-size":"100vh"}},{default:t(()=>[e(v,{cols:"12",md:"4",style:{display:"flex","flex-direction":"column"}},{default:t(()=>[e(X,{class:"flex-grow-1"},{default:t(()=>[e(me,{class:"d-flex justify-between align-center flex-wrap"},{default:t(()=>[o[5]||(o[5]=l("h4",{class:"mt-5"}," Mis Actividades ",-1)),l("div",al,[e(re,{modelValue:z.value,"onUpdate:modelValue":o[0]||(o[0]=j=>z.value=j),placeholder:"Buscar actividad...",class:"search-field",variant:"plain","hide-details":"",dense:"","prepend-inner-icon":"tabler-search"},null,8,["modelValue"])])]),_:1}),e(Xe,{modelValue:i.value,"onUpdate:modelValue":o[1]||(o[1]=j=>i.value=j),grow:""},{default:t(()=>[(s(!0),f(T,null,H(k.value,j=>(s(),q(Ze,{key:j.tabName},{default:t(()=>[l("span",il,y(j.tabName),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),o[11]||(o[11]=l("br",null,null,-1)),e(K,{style:{"flex-grow":"1","overflow-y":"auto"}},{default:t(()=>[$.value?(s(),q(et,{key:0,absolute:"",opacity:"0.7"},{default:t(()=>[e(U,{indeterminate:"",size:"70"})]),_:1})):M("",!0),e(je,{modelValue:i.value,"onUpdate:modelValue":o[2]||(o[2]=j=>i.value=j),class:"disable-tab-transition",style:{"max-block-size":"500px","overflow-y":"auto"}},{default:t(()=>[(s(!0),f(T,null,H(k.value,j=>(s(),q(We,{key:j.tabName,value:j.tabName},{default:t(()=>[j.actividades.value.length===0?(s(),f("div",nl,[e(J,{size:"64",color:"grey",icon:"tabler-calendar-off",class:"mb-4",style:{animation:"bounce 1s infinite"}}),o[6]||(o[6]=l("div",{style:{color:"#888","font-size":"1.2em"}}," ¡No tienes actividades pendientes! ",-1)),o[7]||(o[7]=l("div",{style:{color:"#aaa","font-size":"0.9em","margin-block-start":"8px"}}," ¡Relájate y disfruta tu día! ",-1))])):(s(!0),f(T,{key:1},H(j.actividades.value,R=>(s(),f("div",{key:R.id,"fill-dot":"",class:"border mb-2 rounded-sm py-2",style:{cursor:"pointer"},onClick:E=>c(R)},[e(ve,null,{default:t(()=>[e(G,null,{default:t(()=>[e(v,{cols:"12",md:"2",style:{"padding-inline-end":"0"}},{default:t(()=>[e(Z,{class:"d-flex justify-center align-center",style:{display:"inline-flex","border-radius":"4px","block-size":"36px","inline-size":"36px"}},{default:t(()=>[e(J,{size:"25",icon:"tabler-home"})]),_:1})]),_:1}),R.project_name?(s(),q(v,{key:0,cols:"12",md:"5",class:"d-flex flex-column align-start",style:{"padding-inline-start":"0"}},{default:t(()=>[e(ae,{class:"text-left"},{default:t(()=>[l("strong",null,y(R.property_title),1)]),_:2},1024),e(oe,{class:"font-weight-medium text-left"},{default:t(()=>[l("span",null,"$ "+y(R.price),1)]),_:2},1024)]),_:2},1024)):M("",!0),R.project_name?M("",!0):(s(),q(v,{key:1,cols:"12",md:"5"},{default:t(()=>[e(ae,{class:"text-left"},{default:t(()=>o[8]||(o[8]=[l("strong",{style:{"font-size":"12px"}}," Departamento ",-1)])),_:1}),e(oe,{class:"font-weight-medium text-left"},{default:t(()=>o[9]||(o[9]=[l("span",null,"Indefinido",-1)])),_:1})]),_:1})),e(v,{cols:"12",md:"5",class:"d-flex justify-end align-center"},{default:t(()=>[e(Z,{label:"",color:"primary",class:"ml-auto",style:{"font-size":"10px"}},{default:t(()=>[V(y(R.stage),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(ve,{class:""},{default:t(()=>[e(Z,{label:"",color:"secondary",class:"w-100 h-48"},{default:t(()=>[e(J,{size:"20",icon:A(R.type_activity)},null,8,["icon"]),l("div",rl,y(R.type_activity)+"   •   "+y(R.name_opportunity),1)]),_:2},1024)]),_:2},1024),e(ve,null,{default:t(()=>[l("div",ul,[o[10]||(o[10]=l("div",{style:{"flex-grow":"1"}}," Ver ",-1)),l("div",null,y(C(R.scheduled_at)),1)])]),_:2},1024)],8,sl))),128))]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(v,{cols:"12",md:"8",style:{display:"flex","flex-direction":"column"}},{default:t(()=>[e(ol,{"is-drawer-open":n.value,"onUpdate:isDrawerOpen":o[3]||(o[3]=j=>n.value=j),"activities-data":p.value,class:"flex-grow-1",onRefreshActivities:B,onLoaded:o[4]||(o[4]=j=>$.value=!1)},null,8,["is-drawer-open","activities-data"])]),_:1})]),_:1})}}},ko=Fe(dl,[["__scopeId","data-v-a55b93d4"]]);export{ko as default};
