import{u as se,p as Pe,S as Se,_ as $e,a as Ae,d as Me}from"./PreSaleForm-f3bf2751.js";import{r as H,e as We}from"./validators-dea6e3a5.js";import{_ as ze}from"./AppTextarea-cfb84859.js";import{_ as Ye}from"./AppDateTimePicker-ad98d1e4.js";import{_ as be}from"./AppTextField-963734da.js";import{_ as Ve}from"./AppSelect-5767fb17.js";import{f as oe}from"./currencyFormatter-92ad4b3c.js";import{u as ce}from"./useProcess-3da37060.js";import{V as Ue}from"./VAvatar-596ec46a.js";import{b as ae,c as ie,a as ve}from"./VList-b205d3fa.js";import{V as f}from"./VCol-6b79a532.js";import{o as r,c as v,d as l,F as T,i as Y,b as e,e as t,n as o,v as w,x as g,z as R,f as q,$ as K,a4 as I,w as ne,a3 as Oe,r as D,a as de,a0 as L,am as Z,a2 as X,ac as qe,H as Fe,ag as Ge,an as he}from"./index-eea64eab.js";import{V as ee}from"./VChip-d184a964.js";import{V as le}from"./VTooltip-60d6696f.js";import{V as G}from"./VCardText-74af991a.js";import{a as je}from"./formatters-58bf909e.js";import{u as He}from"./useQuote-7f3cc25e.js";import{_ as Qe}from"./AppAutocomplete-75c37996.js";import{_ as me}from"./DialogCloseBtn-dcf7845d.js";import{u as Ke}from"./useProperty-ef25dafe.js";import{V as te,b as fe,a as ge}from"./VCard-1446dd49.js";import{V as Ee}from"./VForm-0ba22995.js";import{V as M}from"./VRow-a5449575.js";import{V as ye}from"./VDialog-4585f90a.js";import{V as re}from"./VCheckbox-d0024d7a.js";import{V as pe}from"./VTable-1594d059.js";import{u as we,_ as Je}from"./BitacoraCustomer-c2974e1a.js";import{u as Xe}from"./useSales-8d5565b3.js";import{V as ue}from"./VTextField-fdaf4f5a.js";import{s as Ie,S as ke}from"./notifications-b6da0b75.js";import{P as Te}from"./vue3-perfect-scrollbar.esm-e9f09315.js";import{V as Ne}from"./VNavigationDrawer-72a955dd.js";import{m as Ze}from"./vue3-apexcharts-02e346db.js";import{_ as et}from"./AppCardActions-cb949be4.js";import{u as tt,f as _e}from"./dateFormatter-ae7e0a76.js";import{_ as Re}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as lt}from"./AppDrawerHeaderSection-05815902.js";import{V as Be,a as ot}from"./VWindowItem-122fe088.js";import{V as at,a as Ce}from"./VRadioGroup-8df10571.js";import{V as it}from"./VDivider-f3ea9039.js";import{V as st,a as nt}from"./VTabs-f417034b.js";import{V as rt}from"./VOverlay-9f45cad7.js";import"./api-40e7a553.js";import"./index-9c720871.js";import"./constants-71880aa6.js";import"./InvoiceAddMoney-666c377a.js";import"./VNodeRenderer-719bf025.js";import"./helpers-61e4df1a.js";import"./form-97d5e662.js";/* empty css                   */import"./VCounter-1694484c.js";import"./VImg-bf97f22a.js";import"./VField-cbcf2eef.js";import"./easing-9f15041e.js";import"./VInput-b54c7b33.js";import"./forwardRefs-8348545e.js";import"./VSelect-c4493e38.js";import"./dialog-transition-46c42648.js";import"./VMenu-054aa5e8.js";import"./scopeId-752bc43e.js";import"./VCheckboxBtn-11740b93.js";import"./VSelectionControl-1cd7c46d.js";import"./ssrBoot-d631879b.js";import"./filter-86a23bbd.js";import"./VTimelineItem-bc1b2333.js";import"./VSpacer-5e49947a.js";import"./lazy-8a330c44.js";import"./VSlideGroup-ef9af4c0.js";const ut={class:"my-5"},dt={key:0},pt=["src"],ct={class:"my-5"},mt={key:0,class:"d-flex flex-wrap gap-2 my-5"},ft={key:1},yt={__name:"EditDeliveryOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","complet"],setup(F,{emit:$}){const i=F,_=$,{changeStatusByOpportunity:U}=se(),{checkProcessForOpportunity:S}=ce(),x=async()=>{try{await U(i.opportunity.id,7,{}),_("complet")}catch(y){console.error("Error updating customer:",y)}},d=async(y,c)=>{console.log(`Procedimiento ${y} marcado como: ${c?"realizado":"no realizado"}`),await S(i.opportunity.id,y,{is_check:!c}),_("updateStageId",i.opportunity.id)};return(y,c)=>(r(),v(T,null,[l("div",ut,[c[0]||(c[0]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Propiedades ",-1)),i.opportunity.sales.length>0?(r(),v("div",dt,[(r(!0),v(T,null,Y(i.opportunity.sales,b=>(r(),v("div",{key:b.id},[(r(!0),v(T,null,Y(b.properties,A=>(r(),v("div",{key:A.id,class:"d-flex align-center justify-between"},[e(Ue,{size:"50",rounded:""},{default:t(()=>[l("img",{src:o(Pe),alt:"Logo pora",style:{"border-radius":"30%"}},null,8,pt)]),_:1}),e(f,{cols:"12",md:"7"},{default:t(()=>[e(ae,{class:"font-weight-medium"},{default:t(()=>[w(g(A.project_title)+" | "+g(A.title),1)]),_:2},1024),e(ie,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",null,g(("formatCurrency"in y?y.formatCurrency:o(oe))(A.pivot_price)),1)]),_:2},1024)]),_:2},1024)]))),128))]))),128))])):R("",!0)]),l("div",ct,[c[2]||(c[2]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),i.opportunity.procedure&&i.opportunity.procedure.length>0?(r(),v("div",mt,[(r(!0),v(T,null,Y(i.opportunity.procedure,b=>(r(),v("div",{key:b.id},[e(ee,{color:b.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:A=>d(b.id,b.pivot.is_check)},{default:t(()=>[b.pivot.is_check?(r(),q(K,{key:0,icon:"tabler-check",class:"mr-2"})):R("",!0),w(" "+g(b.title),1)]),_:2},1032,["color","onClick"]),e(le,{activator:"parent",location:"top"},{default:t(()=>[w(g(b.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(r(),v("div",ft,c[1]||(c[1]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(G,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(I,{color:"primary",size:"small",onClick:x},{default:t(()=>c[3]||(c[3]=[w(" Finalizar Oportunidad ")])),_:1})]),_:1})],64))}},Le={__name:"EditCustomerDialog",props:{isDialogVisible:{type:Boolean,required:!0},opportunityKanban:{type:Object,required:!0}},emits:["update:isDialogVisible","update:newProperty"],setup(F,{emit:$}){const i=F,_=$;Object.values(Se).map(m=>({title:m.label,value:m.value}));const{propertiesAvailbles:U,properties:S}=Ke(),{getOpportunitybyId:x,opportunity:d,changeOpportunity:y,loadingOpportunity:c}=se(),b=()=>{_("update:isDialogVisible",!1)},A=async()=>{console.log("antes del save:",d);const m={id:d.value.id,description:d.value.description,property_id:d.value.property_id,customer:{id:d.value.customer.id,name:d.value.customer.name,email:d.value.customer.email,ci:d.value.customer.ci,cod_phone:d.value.customer.cod_phone.replace(/\+/g,""),phone:d.value.customer.phone,type_customer:d.value.customer.type_customer}};console.log("data de editar",m),await y(d.value.id,m),d.value.property_id&&(console.log("Cambio y geenero el Emit Principal"),_("update:newProperty",d.value.property_id)),_("update:isDialogVisible",!1)},k=async()=>{var m;(m=i.opportunityKanban)!=null&&m.id&&await x(i.opportunityKanban.id)},V=async()=>{await U()};return ne(()=>i.isDialogVisible,async m=>{m===!0&&(k(),await V())}),(m,n)=>{const C=me,j=be,s=Ve,u=Qe,N=ze;return r(),q(ye,{"max-width":"800","model-value":i.isDialogVisible,persistent:"","close-on-esc":!1,"onUpdate:modelValue":b},{default:t(()=>[e(C,{onClick:b}),e(te,{title:"Información del Cliente y Oportunidad",class:"pa-sm-8 pa-5"},{default:t(()=>[e(G,null,{default:t(()=>[e(Ee,{onSubmit:Oe(A,["prevent"])},{default:t(()=>[e(M,{dense:""},{default:t(()=>[e(f,{cols:"12",md:"6"},{default:t(()=>[e(j,{modelValue:o(d).customer.name,"onUpdate:modelValue":n[0]||(n[0]=h=>o(d).customer.name=h),label:"Nombre del Cliente",placeholder:"Ingresa el nombre",outlined:""},null,8,["modelValue"])]),_:1}),e(f,{cols:"12",md:"6"},{default:t(()=>[e(j,{modelValue:o(d).customer.email,"onUpdate:modelValue":n[1]||(n[1]=h=>o(d).customer.email=h),label:"Email del Cliente",placeholder:"Ingresa el email",outlined:""},null,8,["modelValue"])]),_:1}),e(f,{cols:"12",md:"6"},{default:t(()=>[e(M,null,{default:t(()=>[e(f,{cols:"4"},{default:t(()=>[e(s,{modelValue:o(d).customer.cod_phone,"onUpdate:modelValue":n[2]||(n[2]=h=>o(d).customer.cod_phone=h),label:"Código",items:["+1","+52","+55","+54","+49","+33","+34","+39","+86","+81","+7","+591"],placeholder:"Cód.",outlined:""},null,8,["modelValue"])]),_:1}),e(f,{cols:"8"},{default:t(()=>[e(j,{modelValue:o(d).customer.phone,"onUpdate:modelValue":n[3]||(n[3]=h=>o(d).customer.phone=h),label:"Número de Teléfono",placeholder:"Ingresa el teléfono",outlined:"",dense:"",maxlength:"9"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(f,{cols:"12",md:"6"},{default:t(()=>[e(j,{modelValue:o(d).customer.ci,"onUpdate:modelValue":n[4]||(n[4]=h=>o(d).customer.ci=h),label:"CI del Cliente",placeholder:"Ingresa el CI",outlined:""},null,8,["modelValue"])]),_:1}),e(f,{cols:"6"},{default:t(()=>[e(u,{modelValue:o(d).property_id,"onUpdate:modelValue":n[5]||(n[5]=h=>o(d).property_id=h),label:"Departamento de Interés",placeholder:"Selecciona un Departamento",items:o(S).map(h=>({title:h.title,value:h.id})),outlined:""},null,8,["modelValue","items"])]),_:1}),e(f,{cols:"6"},{default:t(()=>[e(s,{modelValue:o(d).customer.type_customer,"onUpdate:modelValue":n[6]||(n[6]=h=>o(d).customer.type_customer=h),label:"Tipo de Cliente",items:["Olvidadizo","Familiar","Decidido","Indeciso","Exigente","Referido","Inversionista","Recuperado","Curioso"],placeholder:"Tipo de Cliente",outlined:""},null,8,["modelValue"])]),_:1}),e(f,{cols:"12"},{default:t(()=>[e(N,{modelValue:o(d).description,"onUpdate:modelValue":n[7]||(n[7]=h=>o(d).description=h),label:"Descripción de la Oportunidad",placeholder:"Ingresa una descripción",rows:"3","auto-grow":"",outlined:""},null,8,["modelValue"])]),_:1}),e(f,{cols:"12",class:"text-center"},{default:t(()=>[e(I,{type:"submit",color:"primary",class:"me-3",disabled:o(c),loading:o(c)},{default:t(()=>n[8]||(n[8]=[w(" Guardar ")])),_:1},8,["disabled","loading"]),e(I,{color:"secondary",variant:"tonal",onClick:b},{default:t(()=>n[9]||(n[9]=[w(" Cancelar ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},vt={class:"d-flex align-bottom flex-sm-row flex-column"},gt={class:"user-profile-info"},_t={class:"d-flex align-center justify-center justify-sm-space-between flex-wrap gap-4"},bt={class:"d-flex align-center gap-x-3"},Vt={class:"text-4xl font-weight-medium"},wt={class:"d-flex flex-column py-2",style:{"font-size":"14px"}},ht={class:"text-sm text-disabled"},kt={key:0,class:"d-flex flex-wrap gap-2 my-5"},Ct={key:1},Dt={key:0,class:"d-flex flex-wrap gap-2 my-5"},xt={key:1},Pt={__name:"EditPreSaleOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","update:newProperty"],setup(F,{emit:$}){const i=F,_=$,{checkProcessForOpportunity:U}=ce(),{changeStatusQuotesCustomer:S}=He(),x=D(!1),d=D(!1),y=()=>{x.value=!0},c=()=>{console.log("Se escucho el evento en EditProspectOpportunity"),_("update:newProperty")},b=()=>{d.value=!0},A=async m=>{_("updateStageId",m)},k=async(m,n)=>{console.log(`Procedimiento ${m} marcado como: ${n?"realizado":"no realizado"}`),await U(i.opportunity.id,m,{is_check:!n}),_("updateStageId",i.opportunity.id)},V=async(m,n)=>{const C=n==="APPROVED"?"NOT_APPROVED":"APPROVED";console.log(`Procedimiento ${m} marcado como: ${n}`),await S(m,{status:C}),_("updateStageId",i.opportunity.id)};return(m,n)=>{const C=de("RouterLink"),j=de("IconBtn");return r(),v(T,null,[l("div",vt,[l("div",gt,[n[3]||(n[3]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Perfil ",-1)),l("div",_t,[l("div",bt,[l("span",Vt,g(("avatarText"in m?m.avatarText:o(je))(i.opportunity.customer.name)),1),l("div",wt,[e(C,{to:{name:"customers-id",params:{id:i.opportunity.customer.id}},class:"font-weight-base"},{default:t(()=>[w(g(i.opportunity.customer.name),1)]),_:1},8,["to"]),l("span",ht,g(i.opportunity.customer.phone),1)]),e(I,{color:"secondary",variant:"tonal",size:"small",onClick:y},{default:t(()=>n[2]||(n[2]=[w(" Editar Perfil ")])),_:1})])])])]),l("div",null,[n[5]||(n[5]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),i.opportunity.procedure&&i.opportunity.procedure.length>0?(r(),v("div",kt,[(r(!0),v(T,null,Y(i.opportunity.procedure,s=>(r(),v("div",{key:s.id},[e(ee,{color:s.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:u=>k(s.id,s.pivot.is_check)},{default:t(()=>[s.pivot.is_check?(r(),q(K,{key:0,icon:"tabler-check",class:"mr-2"})):R("",!0),w(" "+g(s.title),1)]),_:2},1032,["color","onClick"]),e(le,{activator:"parent",location:"top"},{default:t(()=>[w(g(s.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(r(),v("div",Ct,n[4]||(n[4]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),l("div",null,[n[8]||(n[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Cotizaciones ",-1)),i.opportunity.quotes&&i.opportunity.quotes.length>0?(r(),v("div",Dt,[e(pe,{density:"compact",class:"text-no-wrap",style:{"font-size":"12px"}},{default:t(()=>[n[6]||(n[6]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th")])],-1)),l("tbody",null,[(r(!0),v(T,null,Y(i.opportunity.quotes,s=>(r(),v("tr",{key:s.id},[l("td",null,g(s.properties[0].title),1),l("td",null,g(s.created_at),1),l("td",null,g(("formatCurrency"in m?m.formatCurrency:o(oe))(s.amount)),1),l("td",null,[e(M,null,{default:t(()=>[e(re,{modelValue:s.status,"onUpdate:modelValue":u=>s.status=u,"true-value":"APPROVED","false-value":"NOT_APPROVED",disabled:""},null,8,["modelValue","onUpdate:modelValue"]),e(re,{modelValue:s.status_customer,"onUpdate:modelValue":u=>s.status_customer=u,"true-value":"APPROVED","false-value":"NOT_APPROVED",onClick:u=>V(s.id,s.status_customer)},{default:t(()=>[e(le,{activator:"parent",location:"top"},{default:t(()=>[w(g(s.status_customer=="NOT_APPROVED"?"No aprobado por cliente":"Aprobado por cliente"),1)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","onClick"]),e(C,{to:{name:"quote-id",params:{id:s.id}}},{default:t(()=>[e(j,null,{default:t(()=>[e(K,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])]),_:2},1024)])]))),128))])]),_:1})])):(r(),v("div",xt,n[7]||(n[7]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(G,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(C,{to:{name:"quote-add-quote"},class:"text-white"},{default:t(()=>[e(I,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>n[9]||(n[9]=[w(" Generar Cotización ")])),_:1})]),_:1}),e(I,{color:"primary",class:"mx-auto",size:"small",onClick:b},{default:t(()=>n[10]||(n[10]=[w(" Generar Venta ")])),_:1})]),_:1}),e(Le,{"is-dialog-visible":o(x),"onUpdate:isDialogVisible":n[0]||(n[0]=s=>L(x)?x.value=s:null),"opportunity-kanban":i.opportunity,"onUpdate:newProperty":c},null,8,["is-dialog-visible","opportunity-kanban"]),e($e,{"is-dialog-visible":o(d),"onUpdate:isDialogVisible":n[1]||(n[1]=s=>L(d)?d.value=s:null),opportunity:i.opportunity,stage:"PRESALE",onRegisterSale:A},null,8,["is-dialog-visible","opportunity"])],64)}}},St={class:"d-flex align-bottom flex-sm-row flex-column"},$t={class:"user-profile-info"},At={class:"d-flex align-center justify-center justify-sm-space-between flex-wrap gap-4"},zt={class:"d-flex align-center gap-x-3"},Ut={class:"text-4xl font-weight-medium"},Ot={class:"d-flex flex-column py-2",style:{"font-size":"14px"}},qt={class:"text-sm text-disabled"},Ft={key:0,class:"d-flex flex-wrap gap-2 my-5"},jt={key:1},Et={key:0,class:"d-flex flex-wrap gap-2 my-5"},It={key:1},Tt={__name:"EditProspectOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","update:newProperty"],setup(F,{emit:$}){const i=F,_=$,{checkProcessForOpportunity:U}=ce(),{changeStatusByOpportunity:S,loadingOpportunity:x}=se(),d=D(!1),y=()=>{d.value=!0},c=()=>{console.log("Se escucho el evento en EditProspectOpportunity"),_("update:newProperty")},b=async k=>{await S(k,Se.PRESALE.value,{}),_("updateStageId",k)},A=async k=>{console.log(`Procedimiento ${k.id} marcado como: ${k.pivot.is_check?"realizado":"no realizado"}`),await U(i.opportunity.id,k.id,{is_check:!k.pivot.is_check}),k.pivot.is_check=!k.pivot.is_check,_("updateStageId",i.opportunity.id)};return(k,V)=>{const m=de("RouterLink"),n=de("IconBtn");return r(),v(T,null,[l("div",St,[l("div",$t,[V[3]||(V[3]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Perfil ",-1)),l("div",At,[l("div",zt,[l("span",Ut,g(("avatarText"in k?k.avatarText:o(je))(i.opportunity.customer.name)),1),l("div",Ot,[e(m,{to:{name:"apps-ecommerce-customer-details-id",params:{id:1}},class:"font-weight-base"},{default:t(()=>[w(g(i.opportunity.customer.name),1)]),_:1}),l("span",qt,g(i.opportunity.customer.phone),1)]),l("div",null,[e(I,{color:"secondary",variant:"tonal",size:"small",onClick:y},{default:t(()=>V[2]||(V[2]=[w(" Editar Perfil ")])),_:1})])])])])]),l("div",null,[V[5]||(V[5]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),i.opportunity.procedure&&i.opportunity.procedure.length>0?(r(),v("div",Ft,[(r(!0),v(T,null,Y(i.opportunity.procedure,C=>(r(),v("div",{key:C.id},[e(ee,{color:C.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:j=>A(C)},{default:t(()=>[C.pivot.is_check?(r(),q(K,{key:0,icon:"tabler-check",class:"mr-2"})):R("",!0),w(" "+g(C.title),1)]),_:2},1032,["color","onClick"]),e(le,{activator:"parent",location:"top"},{default:t(()=>[w(g(C.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(r(),v("div",jt,V[4]||(V[4]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),l("div",null,[V[8]||(V[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Cotizaciones ",-1)),i.opportunity.quotes&&i.opportunity.quotes.length>0?(r(),v("div",Et,[e(pe,{density:"compact",class:"text-no-wrap",style:{"font-size":"12px"}},{default:t(()=>[V[6]||(V[6]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th")])],-1)),l("tbody",null,[(r(!0),v(T,null,Y(i.opportunity.quotes,C=>(r(),v("tr",{key:C.id},[l("td",null,g(C.properties[0].title),1),l("td",null,g(C.created_at),1),l("td",null,g(("formatCurrency"in k?k.formatCurrency:o(oe))(C.amount)),1),l("td",null,[e(m,{to:{name:"quote-id",params:{id:C.id}}},{default:t(()=>[e(n,null,{default:t(()=>[e(K,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])])]))),128))])]),_:1})])):(r(),v("div",It,V[7]||(V[7]=[l("span",null,"No hay cotizaciones disponibles.",-1)])))]),e(G,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(m,{to:{name:"quote-add-quote"},class:"text-white"},{default:t(()=>[e(I,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>V[9]||(V[9]=[w(" Generar Cotización ")])),_:1})]),_:1}),e(I,{color:"primary",class:"mx-auto",size:"small",disabled:o(x),loading:o(x),onClick:V[0]||(V[0]=C=>b(i.opportunity.id))},{default:t(()=>V[10]||(V[10]=[w(" Siguiente Etapa ")])),_:1},8,["disabled","loading"])]),_:1}),e(Le,{"is-dialog-visible":o(d),"onUpdate:isDialogVisible":V[1]||(V[1]=C=>L(d)?d.value=C:null),"opportunity-kanban":i.opportunity,"onUpdate:newProperty":c},null,8,["is-dialog-visible","opportunity-kanban"])],64)}}},Nt={__name:"DeliveryForm",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(F,{emit:$}){const i=F,_=$,{changeStatusByOpportunity:U}=se(),S=c=>{_("update:isDialogVisible",c)},x=D(structuredClone(Z(i.opportunity)));ne(i,()=>{x.value=structuredClone(Z(i.opportunity))});const d=async()=>{_("update:isDialogVisible",!1);try{await U(i.opportunity.id,5,{delivery_date:x.value.sales.delivery_date}),_("updateDeliveryDate",x.value.id)}catch(c){console.error("Error updating customer:",c)}},y=()=>{_("update:isDialogVisible",!1)};return(c,b)=>{const A=me;return r(),q(ye,{"model-value":i.isDialogVisible,"max-width":"800","onUpdate:modelValue":S},{default:t(()=>[e(A,{onClick:b[0]||(b[0]=k=>c.$emit("update:isDialogVisible",!1))}),e(te,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(fe,{class:"text-h3 text-center"},{default:t(()=>b[2]||(b[2]=[w(" Confirmar Fecha ")])),_:1}),e(G,null,{default:t(()=>[e(G,null,{default:t(()=>[e(M,null,{default:t(()=>[e(f,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(ue,{modelValue:o(x).sales.delivery_date,"onUpdate:modelValue":b[1]||(b[1]=k=>o(x).sales.delivery_date=k),label:"Fecha de Entrega",type:"date",rules:["requiredValidator"in c?c.requiredValidator:o(H)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),e(f,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(I,{onClick:d},{default:t(()=>b[3]||(b[3]=[w(" Pasar a Entrega ")])),_:1}),e(I,{color:"secondary",variant:"tonal",onClick:y},{default:t(()=>b[4]||(b[4]=[w(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Rt={key:0},Bt={__name:"PaymentPlanEdit",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},payment:{type:Object,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(F,{emit:$}){const i=F,_=$,{updatePaymentPlans:U}=we(),S=D(!1),x=s=>{_("update:isDialogVisible",s)},d=D(structuredClone(Z(i.payment))),y=D(structuredClone(Z(i.opportunity))),c=D([]);ne(i,()=>{d.value=structuredClone(Z(i.payment)),y.value=structuredClone(Z(i.opportunity))});const b=()=>{c.value.push({amount:"",date:"",type:d.value.type})},A=s=>{c.value.splice(s,1)},k=X(()=>c.value.reduce((s,u)=>{const N=parseFloat(u.amount)||0;return s+N},0)),V=X(()=>c.value.length>0&&c.value.every(s=>s.amount&&s.date&&s.type)),m=X(()=>{if(c.value.length===0)return!0;const s=c.value.reduce((h,Q)=>h+(parseFloat(Q.amount)||0),0),u=parseFloat(s),N=parseFloat(d.value.amount);return u===N}),n=X(()=>c.value.length===0?!0:V.value&&m.value),C=async()=>{if(!m.value){Ie("Validación fallida","La suma de las diferencias no es correcta");return}if(!n.value){alert("Por favor, completa todos los campos obligatorios.");return}S.value=!0;try{await U(d.value.id,{date:d.value.date,differData:c.value})}catch(s){console.error("Error updating customer:",s)}finally{_("updateDeliveryDate",y.value.id),_("update:isDialogVisible",!1),c.value=[],S.value=!1}},j=()=>{_("update:isDialogVisible",!1),c.value=[],errorMessage.value=""};return(s,u)=>{const N=me;return r(),q(ye,{"model-value":i.isDialogVisible,"max-width":"800","onUpdate:modelValue":x},{default:t(()=>[e(N,{onClick:u[0]||(u[0]=h=>s.$emit("update:isDialogVisible",!1))}),e(te,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(fe,{class:"text-h3 text-center"},{default:t(()=>u[2]||(u[2]=[w(" Editar Pago ")])),_:1}),e(G,null,{default:t(()=>[e(M,{class:"mx-5"},{default:t(()=>[e(f,{cols:"6"},{default:t(()=>[l("h3",null," Monto a Pagar : "+g(o(oe)(o(d).amount)),1)]),_:1}),e(f,{cols:"6"},{default:t(()=>[e(ue,{modelValue:o(d).date,"onUpdate:modelValue":u[1]||(u[1]=h=>o(d).date=h),label:"Cambiar Fecha",type:"date",rules:["requiredValidator"in s?s.requiredValidator:o(H)]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(te,{flat:"",class:"d-flex flex-column pa-5 px-5"},{default:t(()=>[(r(!0),v(T,null,Y(o(c),(h,Q)=>(r(),v("div",{key:h.id,class:"d-flex align-center my-4"},[e(ue,{modelValue:h.amount,"onUpdate:modelValue":z=>h.amount=z,label:"Monto *",type:"number",class:"mr-4",outlined:"",rules:["requiredValidator"in s?s.requiredValidator:o(H)]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(ue,{modelValue:h.date,"onUpdate:modelValue":z=>h.date=z,label:"Fecha de Pago *",type:"date",class:"mr-3",outlined:"",rules:["requiredValidator"in s?s.requiredValidator:o(H)]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(I,{color:"error",onClick:z=>A(Q)},{default:t(()=>[e(K,{icon:"tabler-square-x"})]),_:2},1032,["onClick"])]))),128)),o(c).length>0?(r(),v("div",Rt,[u[3]||(u[3]=l("strong",null,"Monto Restante:",-1)),w(" "+g(o(oe)(o(d).amount-o(k))),1)])):R("",!0),e(I,{color:"primary",variant:"tonal",class:"mt-4",size:"small",onClick:b},{default:t(()=>u[4]||(u[4]=[w(" Diferir Pago ")])),_:1})]),_:1}),e(f,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(I,{loading:o(S),disabled:!o(n)||o(S),onClick:C},{default:t(()=>u[5]||(u[5]=[w(" Guardar ")])),_:1},8,["loading","disabled"]),e(I,{color:"error",variant:"tonal",onClick:j},{default:t(()=>u[6]||(u[6]=[w(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Lt={__name:"SalePaymentPlan",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},salesPayment:{type:Array,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(F,{emit:$}){const i=F,_=$;we();const U=y=>{_("update:isDialogVisible",y)},S=D(structuredClone(Z(i.opportunity)));ne(i,()=>{S.value=structuredClone(Z(i.opportunity)),console.log("Sales Payment:",i.salesPayment)});const x=D([]),d=()=>{_("update:isDialogVisible",!1),x.value=[]};return(y,c)=>{const b=me;return r(),q(ye,{"model-value":i.isDialogVisible,"max-width":"800","onUpdate:modelValue":U},{default:t(()=>[e(b,{onClick:c[0]||(c[0]=A=>y.$emit("update:isDialogVisible",!1))}),e(te,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(fe,{class:"text-h3 text-center"},{default:t(()=>c[1]||(c[1]=[w(" Confirmar Fecha ")])),_:1}),e(G,null,{default:t(()=>[e(G,null,{default:t(()=>[e(M,null,{default:t(()=>[e(f,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l("span",null," Monto a Pagar : "+g(o(S)),1)]),_:1})]),_:1})]),_:1}),e(f,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(I,{onClick:y.onFormSubmit},{default:t(()=>c[2]||(c[2]=[w(" Guardar ")])),_:1},8,["onClick"]),e(I,{color:"error",variant:"tonal",onClick:d},{default:t(()=>c[3]||(c[3]=[w(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Mt={class:"text-h6"},Wt={class:"text-h6"},Yt={class:"text-h6"},Gt={class:"my-5"},Ht={key:0},Qt=["src"],Kt={class:"mb-4"},Jt=["onClick"],Xt=["onClick"],Zt={class:"my-5"},el={key:0,class:"d-flex flex-wrap gap-2 my-5"},tl={key:1},ll={__name:"EditSaleOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId"],setup(F,{emit:$}){const i=F,_=$,{checkProcessForOpportunity:U}=ce(),{confirmPaymentPlans:S}=we(),{changeStatusByOpportunity:x,loadingOpportunity:d}=se(),{SaleChangeSignature:y}=Xe(),c=D(!1),b=D(!1),A=D(!1),k=D(""),V=X(()=>i.opportunity.sales.reduce((P,p)=>P+p.amount,0)),m=X(()=>i.opportunity.sales.reduce((P,p)=>P+p.initial_fee,0)),n=X(()=>V.value-m.value),C=()=>{A.value=!0},j=P=>{if(P.is_paid===1){Ie("Advertencia","No se puede editar un pago ya realizado.");return}console.log("entro aqui"),b.value=!0,k.value={...P}},s=async P=>{_("updateStageId",P)},u=async P=>{console.log(`Procedimiento ${P.id} marcado como: ${P.pivot.is_check?"realizado":"no realizado"}`),await U(i.opportunity.id,P.id,{is_check:!P.pivot.is_check}),P.pivot.is_check=!P.pivot.is_check,_("updateStageId",i.opportunity.id)},N=async P=>{console.log(P),await S(P),_("updateStageId",i.opportunity.id)},h=async P=>{console.log("entra a firma"),await y(P),_("updateStageId",i.opportunity.id)},Q=async P=>{await x(P,5,{}),_("updateStageId",P)},z=async P=>{_("updateStageId",P)};return(P,p)=>(r(),v(T,null,[l("div",null,[e(te,null,{default:t(()=>[e(G,null,{default:t(()=>[e(M,null,{default:t(()=>[e(f,{cols:"4",class:"border rounded-sm mx-1"},{default:t(()=>[e(ae,{class:"font-weight-medium"},{default:t(()=>p[5]||(p[5]=[w(" Saldo ")])),_:1}),e(ie,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Mt,g(("formatCurrency"in P?P.formatCurrency:o(oe))(o(n))),1)]),_:1})]),_:1}),e(f,{cols:"3",class:"border rounded-sm mx-1"},{default:t(()=>[e(ae,{class:"font-weight-medium"},{default:t(()=>p[6]||(p[6]=[w(" Anticipo ")])),_:1}),e(ie,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Wt,g(("formatCurrency"in P?P.formatCurrency:o(oe))(o(m))),1)]),_:1})]),_:1}),e(f,{cols:"4",class:"border rounded-sm mx-1"},{default:t(()=>[e(ae,{class:"font-weight-medium"},{default:t(()=>p[7]||(p[7]=[w(" Precio Final ")])),_:1}),e(ie,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Yt,g(("formatCurrency"in P?P.formatCurrency:o(oe))(o(V))),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),l("div",Gt,[p[9]||(p[9]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Propiedades ",-1)),i.opportunity.sales.length>0?(r(),v("div",Ht,[(r(!0),v(T,null,Y(i.opportunity.sales,a=>(r(),v("div",{key:a.id},[e(M,null,{default:t(()=>[(r(!0),v(T,null,Y(a.properties,O=>(r(),q(f,{key:O.id,class:"d-flex align-center justify-between",cols:"12",md:"9"},{default:t(()=>[e(Ue,{size:"50",rounded:""},{default:t(()=>[l("img",{src:o(Pe),alt:"Logo pora",style:{"border-radius":"30%"}},null,8,Qt)]),_:1}),e(f,{cols:"12"},{default:t(()=>[e(ae,{class:"font-weight-medium"},{default:t(()=>[w(g(O.project_title)+" | "+g(O.title),1)]),_:2},1024),e(ie,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",null,"$ "+g(O.pivot_price),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),e(re,{modelValue:a.confirmation_signature,"onUpdate:modelValue":O=>a.confirmation_signature=O,"true-value":1,"false-value":0,onChange:O=>h(a.id)},{default:t(()=>[e(le,{activator:"parent",location:"top"},{default:t(()=>p[8]||(p[8]=[w(" Confirmar firma ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]))),128))])):R("",!0)]),l("div",Kt,[p[12]||(p[12]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Anticipo ",-1)),i.opportunity.initial_payments&&i.opportunity.initial_payments.length>0?(r(),q(pe,{key:0,density:"compact",class:"text-no-wrap my-2",style:{"font-size":"12px"}},{default:t(()=>[p[11]||(p[11]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th",null," Action ")])],-1)),l("tbody",null,[(r(!0),v(T,null,Y(i.opportunity.initial_payments,a=>(r(),v("tr",{key:a.id},[l("td",null,g(a.property_title),1),l("td",null,g(a.date),1),l("td",null,g(a.amount),1),l("td",null,[e(M,null,{default:t(()=>[e(re,{modelValue:a.is_paid,"onUpdate:modelValue":O=>a.is_paid=O,"true-value":1,"false-value":0,disabled:a.is_paid===1,onChange:O=>N(a.id)},{default:t(()=>[e(le,{activator:"parent",location:"top"},{default:t(()=>p[10]||(p[10]=[w(" Confirmar Pago ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"]),a.is_paid===0?(r(),v("div",{key:0,"fill-dot":"",style:{cursor:"pointer"},onClick:O=>j(a)},[e(o(K),{size:"25",icon:"tabler-edit"})],8,Jt)):R("",!0)]),_:2},1024)])]))),128))])]),_:1})):R("",!0)]),l("div",null,[p[15]||(p[15]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Saldos ",-1)),i.opportunity.balance_payments&&i.opportunity.balance_payments.length>0?(r(),q(pe,{key:0,density:"compact",class:"text-no-wrap my-2",style:{"font-size":"12px"}},{default:t(()=>[p[14]||(p[14]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th",null," Action ")])],-1)),l("tbody",null,[(r(!0),v(T,null,Y(i.opportunity.balance_payments,a=>(r(),v("tr",{key:a.id},[l("td",null,g(a.property_title),1),l("td",null,g(a.date),1),l("td",null,g(a.amount),1),l("td",null,[e(M,null,{default:t(()=>[e(re,{modelValue:a.is_paid,"onUpdate:modelValue":O=>a.is_paid=O,"true-value":1,"false-value":0,disabled:a.is_paid===1,onChange:O=>N(a.id)},{default:t(()=>[e(le,{activator:"parent",location:"top"},{default:t(()=>p[13]||(p[13]=[w(" Confirmar Pago ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"]),a.is_paid===0?(r(),v("div",{key:0,"fill-dot":"",style:{cursor:"pointer"},onClick:O=>j(a)},[e(o(K),{size:"25",icon:"tabler-edit"})],8,Xt)):R("",!0)]),_:2},1024)])]))),128))])]),_:1})):R("",!0)]),l("div",Zt,[p[17]||(p[17]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),i.opportunity.procedure&&i.opportunity.procedure.length>0?(r(),v("div",el,[(r(!0),v(T,null,Y(i.opportunity.procedure,a=>(r(),v("div",{key:a.id},[e(ee,{color:a.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:O=>u(a)},{default:t(()=>[a.pivot.is_check?(r(),q(o(K),{key:0,icon:"tabler-check",class:"mr-2"})):R("",!0),w(" "+g(a.title),1)]),_:2},1032,["color","onClick"]),e(le,{activator:"parent",location:"top"},{default:t(()=>[w(g(a.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(r(),v("div",tl,p[16]||(p[16]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(G,{class:"d-flex mt-4"},{default:t(()=>[e(I,{color:"primary",variant:"tonal",class:"mx-auto",size:"small",onClick:C},{default:t(()=>p[18]||(p[18]=[w(" Generar Venta ")])),_:1}),e(I,{color:"primary",class:"mx-auto",size:"small",onClick:p[0]||(p[0]=a=>Q(i.opportunity.id))},{default:t(()=>p[19]||(p[19]=[w(" Siguiente Etapa ")])),_:1})]),_:1}),e(Nt,{"is-dialog-visible":o(c),"onUpdate:isDialogVisible":p[1]||(p[1]=a=>L(c)?c.value=a:null),opportunity:i.opportunity,onUpdateDeliveryDate:z},null,8,["is-dialog-visible","opportunity"]),e(Bt,{"is-dialog-visible":o(b),"onUpdate:isDialogVisible":p[2]||(p[2]=a=>L(b)?b.value=a:null),payment:o(k),opportunity:i.opportunity,onUpdateDeliveryDate:z},null,8,["is-dialog-visible","payment","opportunity"]),e($e,{"is-dialog-visible":o(A),"onUpdate:isDialogVisible":p[3]||(p[3]=a=>L(A)?A.value=a:null),opportunity:i.opportunity,stage:"SALE",onRegisterSale:s},null,8,["is-dialog-visible","opportunity"]),e(Lt,{"is-dialog-visible":P.openSaleEditPaymentPlan,"onUpdate:isDialogVisible":p[4]||(p[4]=a=>P.openSaleEditPaymentPlan=a),opportunity:i.opportunity,"sales-payment":P.salePaymentPlan,onUpdateDeliveryDate:z},null,8,["is-dialog-visible","opportunity","sales-payment"])],64))}},ol={__name:"DrawerBitacora",props:{isDrawerOpen:{type:Boolean,required:!0},customer:{type:String,required:!0}},emits:["update:isDrawerOpen"],setup(F,{emit:$}){const i=F,_=$,U=S=>{_("update:isDrawerOpen",S)};return(S,x)=>(r(),q(Ne,{temporary:"",width:500,location:"end",class:"scrollable-content","model-value":i.isDrawerOpen,"onUpdate:modelValue":U},{default:t(()=>[e(o(Te),{options:{wheelPropagation:!1}},{default:t(()=>[e(Je,{customer:F.customer},null,8,["customer"])]),_:1})]),_:1},8,["model-value"]))}};const al={class:"d-flex align-center gap-1"},il={class:"text-body-1 text-high-emphasis font-weight-medium"},sl={class:"d-flex flex-column"},nl={class:"text-h6 font-weight-medium"},rl={class:"text-xs"},De="rgba(var(--v-theme-on-background), var(--v-high-emphasis-opacity))",xe="rgba(var(--v-theme-on-background), var(--v-medium-emphasis-opacity))",ul={__name:"SellerReport",setup(F){const{pastSellerActivityData:$,futureSellerActivityData:i,fetchPastSellerActivity:_,fetchFutureSellerActivity:U,isLoading:S,error:x}=tt(),d=qe("userData").value,y=(n,C)=>C>0?Math.round(n/C*100):0,c=X(()=>{const n=i.value.total_activity||0;return[{title:"Visita",tasks:i.value.total_activity_visit||0,progress:y(i.value.total_activity_visit,n),color:"primary"},{title:"Llamada",tasks:i.value.total_activity_call||0,progress:y(i.value.total_activity_call,n),color:"success"},{title:"Cotización",tasks:i.value.total_activity_quote||0,progress:y(i.value.total_activity_quote,n),color:"secondary"},{title:"Otros",tasks:i.value.total_activity_other||0,progress:y(i.value.total_activity_other,n),color:"warning"}]}),b=X(()=>[$.value.total_activity_pending||0,$.value.total_activity_complet||0,$.value.total_activity_cancell||0,$.value.total_activity_discard||0]),A=X(()=>[$.value.total_activity_visit||0,$.value.total_activity_call||0,$.value.total_activity_quote||0,$.value.total_activity_other||0]),k={chart:{height:300,type:"donut",toolbar:{show:!1}},plotOptions:{pie:{donut:{size:"70%",labels:{show:!0,value:{fontSize:"16px",color:De,fontWeight:500,offsetY:-15,formatter(n){return`${Number.parseInt(n)} Actividades`}},name:{offsetY:30},total:{show:!0,fontSize:"0.75rem",fontWeight:400,label:"Total",color:xe,formatter(){return`${$.value.total_activity||0} Actividades`}}}}}},labels:["Pendiente","Completado","Cancelado","Descartado"],colors:["rgb(168, 170, 174)","rgb(40, 199, 111)","rgb(255, 159, 67)","rgb(234, 84, 85)"],grid:{padding:{top:15}},stroke:{width:0},dataLabels:{enabled:!1},legend:{show:!0,position:"bottom",offsetY:10,markers:{width:8,height:8,offsetX:-3},itemMargin:{horizontal:15,vertical:5},fontSize:"13px",fontWeight:400},tooltip:{theme:"dark"},responsive:[{breakpoint:420,options:{chart:{height:200}}}]},V={chart:{height:300,type:"donut",toolbar:{show:!1}},plotOptions:{pie:{donut:{size:"70%",labels:{show:!0,value:{fontSize:"16px",color:De,fontWeight:500,offsetY:-15,formatter(n){return`${Number.parseInt(n)} Actividades`}},name:{offsetY:30},total:{show:!0,fontSize:"0.75rem",fontWeight:400,label:"Total",color:xe,formatter(){return`${$.value.total_activity||0} Actividades`}}}}}},labels:["Visita","Llamada","Cotización","Otros"],colors:["rgb(0, 207, 232)","rgb(40, 199, 111)","rgb(168, 170, 174)","rgb(255, 159, 67)"],grid:{padding:{top:15}},stroke:{width:0},dataLabels:{enabled:!1},legend:{show:!0,position:"bottom",offsetY:10,markers:{width:8,height:8,offsetX:-3},itemMargin:{horizontal:15,vertical:5},fontSize:"13px",fontWeight:400},tooltip:{theme:"dark"},responsive:[{breakpoint:420,options:{chart:{height:200}}}]},m=()=>{_("2024-01-01",_e(new Date),0,d.id),U(_e(new Date),_e(new Date(new Date().setFullYear(new Date().getFullYear()+1))),0,d.id)};return Fe(()=>{m()}),(n,C)=>{const j=et,s=Ze;return r(),q(M,null,{default:t(()=>[e(f,{cols:"12",md:"12"},{default:t(()=>[e(j,{noActions:""},{default:t(()=>[e(ge,{title:"Actividades futuras"}),e(G,null,{default:t(()=>[e(M,null,{default:t(()=>[(r(!0),v(T,null,Y(o(c),u=>(r(),q(f,{key:u.title,cols:"6",md:"3"},{default:t(()=>[l("div",al,[l("div",null,[e(Ge,{modelValue:u.progress,"onUpdate:modelValue":N=>u.progress=N,size:54,color:u.color},{default:t(()=>[l("span",il,g(u.progress)+"% ",1)]),_:2},1032,["modelValue","onUpdate:modelValue","color"])]),l("div",sl,[l("span",nl,g(u.title),1),l("span",rl,g(u.tasks)+" actividades ",1)])])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1}),e(f,{cols:"12",md:"6"},{default:t(()=>[e(j,{noActions:""},{default:t(()=>[e(ge,{title:"Reporte por estado"}),e(G,null,{default:t(()=>[e(s,{type:"donut",height:"300",series:o(b),options:k},null,8,["series"])]),_:1})]),_:1})]),_:1}),e(f,{cols:"12",md:"6"},{default:t(()=>[e(j,{noActions:""},{default:t(()=>[e(ge,{title:"Reporte por tipo"}),e(G,null,{default:t(()=>[e(s,{type:"donut",height:"300",series:o(A),options:V},null,8,["series"])]),_:1})]),_:1})]),_:1})]),_:1})}}},dl=Re(ul,[["__scopeId","data-v-6be65910"]]),pl={__name:"CustomerHistory",props:{isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","userData"],setup(F,{emit:$}){const i=F,_=$,U=D(!1),S=D(),x=D(""),d=D(""),y=D(""),c=D(""),b=D(),A=D(""),k=D(),V=D(),m=D(),n=()=>{_("update:isDrawerOpen",!1),he(()=>{var s,u;(s=S.value)==null||s.reset(),(u=S.value)==null||u.resetValidation()})},C=()=>{var s;(s=S.value)==null||s.validate().then(({valid:u})=>{u&&(_("userData",{id:0,fullName:x.value,company:c.value,role:k.value,country:b.value,contact:A.value,email:y.value,currentPlan:V.value,status:m.value,avatar:"",billing:"Auto Debit"}),_("update:isDrawerOpen",!1),he(()=>{var N,h;(N=S.value)==null||N.reset(),(h=S.value)==null||h.resetValidation()}))})},j=s=>{_("update:isDrawerOpen",s)};return(s,u)=>{const N=lt,h=be,Q=Ve;return r(),q(Ne,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":i.isDrawerOpen,"onUpdate:modelValue":j},{default:t(()=>[e(N,{title:"Historial del Cliente",onCancel:n}),e(o(Te),{options:{wheelPropagation:!1}},{default:t(()=>[e(te,{flat:""},{default:t(()=>[e(G,null,{default:t(()=>[e(Ee,{ref_key:"refForm",ref:S,modelValue:o(U),"onUpdate:modelValue":u[9]||(u[9]=z=>L(U)?U.value=z:null),onSubmit:Oe(C,["prevent"])},{default:t(()=>[e(M,null,{default:t(()=>[e(f,{cols:"12"},{default:t(()=>[e(h,{modelValue:o(x),"onUpdate:modelValue":u[0]||(u[0]=z=>L(x)?x.value=z:null),rules:["requiredValidator"in s?s.requiredValidator:o(H)],label:"Full Name",placeholder:"John Doe"},null,8,["modelValue","rules"])]),_:1}),e(f,{cols:"12"},{default:t(()=>[e(h,{modelValue:o(d),"onUpdate:modelValue":u[1]||(u[1]=z=>L(d)?d.value=z:null),rules:["requiredValidator"in s?s.requiredValidator:o(H)],label:"Username",placeholder:"Johndoe"},null,8,["modelValue","rules"])]),_:1}),e(f,{cols:"12"},{default:t(()=>[e(h,{modelValue:o(y),"onUpdate:modelValue":u[2]||(u[2]=z=>L(y)?y.value=z:null),rules:["requiredValidator"in s?s.requiredValidator:o(H),"emailValidator"in s?s.emailValidator:o(We)],label:"Email",placeholder:"johndoe@email.com"},null,8,["modelValue","rules"])]),_:1}),e(f,{cols:"12"},{default:t(()=>[e(h,{modelValue:o(c),"onUpdate:modelValue":u[3]||(u[3]=z=>L(c)?c.value=z:null),rules:["requiredValidator"in s?s.requiredValidator:o(H)],label:"Company",placeholder:"PixInvent"},null,8,["modelValue","rules"])]),_:1}),e(f,{cols:"12"},{default:t(()=>[e(Q,{modelValue:o(b),"onUpdate:modelValue":u[4]||(u[4]=z=>L(b)?b.value=z:null),label:"Select Country",placeholder:"Select Country",rules:["requiredValidator"in s?s.requiredValidator:o(H)],items:["USA","UK","India","Australia"]},null,8,["modelValue","rules"])]),_:1}),e(f,{cols:"12"},{default:t(()=>[e(h,{modelValue:o(A),"onUpdate:modelValue":u[5]||(u[5]=z=>L(A)?A.value=z:null),type:"number",rules:["requiredValidator"in s?s.requiredValidator:o(H)],label:"Contact",placeholder:"+1-541-754-3010"},null,8,["modelValue","rules"])]),_:1}),e(f,{cols:"12"},{default:t(()=>[e(Q,{modelValue:o(k),"onUpdate:modelValue":u[6]||(u[6]=z=>L(k)?k.value=z:null),label:"Select Role",placeholder:"Select Role",rules:["requiredValidator"in s?s.requiredValidator:o(H)],items:["Admin","Author","Editor","Maintainer","Subscriber"]},null,8,["modelValue","rules"])]),_:1}),e(f,{cols:"12"},{default:t(()=>[e(Q,{modelValue:o(V),"onUpdate:modelValue":u[7]||(u[7]=z=>L(V)?V.value=z:null),label:"Select Plan",placeholder:"Select Plan",rules:["requiredValidator"in s?s.requiredValidator:o(H)],items:["Basic","Company","Enterprise","Team"]},null,8,["modelValue","rules"])]),_:1}),e(f,{cols:"12"},{default:t(()=>[e(Q,{modelValue:o(m),"onUpdate:modelValue":u[8]||(u[8]=z=>L(m)?m.value=z:null),label:"Select Status",placeholder:"Select Status",rules:["requiredValidator"in s?s.requiredValidator:o(H)],items:[{title:"Active",value:"active"},{title:"Inactive",value:"inactive"},{title:"Pending",value:"pending"}]},null,8,["modelValue","rules"])]),_:1}),e(f,{cols:"12"},{default:t(()=>[e(I,{type:"submit",class:"me-3"},{default:t(()=>u[10]||(u[10]=[w(" Submit ")])),_:1}),e(I,{type:"reset",variant:"outlined",color:"secondary",onClick:n},{default:t(()=>u[11]||(u[11]=[w(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},cl={class:"d-flex justify-space-between align-center"},ml={class:"mb-2"},fl={style:{"font-size":"14px","font-weight":"500"}},yl={style:{"font-size":"12px","font-weight":"500"}},vl={__name:"AddActivity",props:{activitiesData:{type:Object,required:!0,default:()=>({title:"",description:"",schedule_at:""})},isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","refreshActivities"],setup(F,{emit:$}){const i=F,_=$,U=D(!1);D(!1);const S=D("radio-1"),x=D(!1),d=()=>{x.value=!0},y=D({title:"",description:"",type_activity_id:null,opportunity_id:null,assigned_to:null,scheduled_at:null,status:"COMPLETED"}),{completedActivityAndRegister:c,getallTypeActivities:b,typeActivities:A,loadingActivity:k}=Ae(),{getOpportunitybyId:V,opportunity:m}=se(),n=D(structuredClone(Z(i.activitiesData))),C=p=>{console.log("esta consultando de nuevo despues de cambiar etapa "),V(p)};ne(i,()=>{n.value=structuredClone(Z(i.activitiesData)),V(n.value.opportunity_id),j()});const j=async()=>{await b()},s=()=>{V(n.value.opportunity_id)},u=()=>{_("update:isDrawerOpen",!1),y.value={title:null,description:null,type_activity_id:null,scheduled_at:null,opportunity_id:null,assigned_to:null,status:"COMPLETED"},_("refreshActivities")},N=async()=>{let p="";S.value==="radio-1"?p="COMPLETED":S.value==="radio-2"&&(p="CANCELLED"),c(n.value.id,{title:y.value.title,description:y.value.description,type_activity_id:y.value.type_activity_id,scheduled_at:y.value.scheduled_at,assigned_to:m.value.user_id,property_id:m.value.property_id,opportunity_id:m.value.id,status:p}),u()},h=async()=>{ke.fire({title:"Quieres dar de baja al cliente ?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"confirmar"}).then(p=>{p.isConfirmed&&(Me(n.value.id),u(),ke.fire({text:"EL cliente fue dado de baja",icon:"success"}))})},Q=async()=>{_("update:isDrawerOpen",!1),_("refreshActivities")},z=()=>{console.log("Se escucho el evento en AddActivity"),_("refreshActivities")},P=p=>{const a=new Date(p),O=a.getDate(),B=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][a.getMonth()],J=a.getHours().toString().padStart(2,"0"),W=a.getMinutes().toString().padStart(2,"0");return`${O} de ${B}, ${J}:${W}`};return(p,a)=>{const O=be,E=Ye,B=ze;return r(),v(T,null,[e(M,{class:""},{default:t(()=>{var J;return[(J=o(n))!=null&&J.opportunity_id?(r(),q(f,{key:0,cols:"12"},{default:t(()=>[F.isDrawerOpen?(r(),q(te,{key:0},{default:t(()=>[e(G,null,{default:t(()=>[e(Be,{class:"mx-2 my-2"},{default:t(()=>[e(M,null,{default:t(()=>[e(f,{cols:"12",sm:"5"},{default:t(()=>[e(M,null,{default:t(()=>[e(f,{cols:"12"},{default:t(()=>[l("div",cl,[a[8]||(a[8]=l("span",{style:{"font-size":"18px","font-weight":"500"}}," Actividad ",-1)),e(ee,{color:"warning",onClick:d},{default:t(()=>a[7]||(a[7]=[w(" historial ")])),_:1})])]),_:1}),e(f,{cols:"12"},{default:t(()=>[l("div",ml,[l("span",fl,g(i.activitiesData.title)+" • "+g(P(i.activitiesData.scheduled_at)),1),a[9]||(a[9]=l("br",null,null,-1)),l("span",yl,g(i.activitiesData.description),1)]),e(at,{modelValue:o(S),"onUpdate:modelValue":a[0]||(a[0]=W=>L(S)?S.value=W:null),style:{"font-size":"14px"},inline:""},{default:t(()=>[a[10]||(a[10]=l("span",{class:"my-1"}," ¿Se realizó? ",-1)),e(Ce,{label:"Si",value:"radio-1",density:"compact",class:"mx-2"}),e(Ce,{label:"No",value:"radio-2",class:"mx-2",density:"compact"})]),_:1},8,["modelValue"]),e(it,{class:"mt-2"})]),_:1}),e(f,{cols:"12"},{default:t(()=>[e(O,{modelValue:o(y).title,"onUpdate:modelValue":a[1]||(a[1]=W=>o(y).title=W),label:"Título de la actividad",placeholder:"..."},null,8,["modelValue"])]),_:1}),e(f,{cols:"12"},{default:t(()=>[e(Ve,{modelValue:o(y).type_activity_id,"onUpdate:modelValue":a[2]||(a[2]=W=>o(y).type_activity_id=W),label:"Tipo de actividad",placeholder:"Selecciona el tipo de actividad",items:o(A).map(W=>({title:W.name,value:W.id}))},null,8,["modelValue","items"])]),_:1}),e(f,{cols:"12"},{default:t(()=>[e(E,{modelValue:o(y).scheduled_at,"onUpdate:modelValue":a[3]||(a[3]=W=>o(y).scheduled_at=W),label:"Seleccione la fecha y hora",placeholder:"Seleccione la fecha y hora",config:{enableTime:!0,dateFormat:"Y-m-d H:i"},rules:["requiredValidator"in p?p.requiredValidator:o(H)]},null,8,["modelValue","rules"])]),_:1}),e(f,{cols:"12"},{default:t(()=>[e(B,{modelValue:o(y).description,"onUpdate:modelValue":a[4]||(a[4]=W=>o(y).description=W),label:"Descripción",rows:"3",rules:["requiredValidator"in p?p.requiredValidator:o(H)]},null,8,["modelValue","rules"])]),_:1}),e(f,null,{default:t(()=>[e(I,{color:"primary",class:"mx-auto",size:"small",loading:o(k),disabled:o(k),onClick:N},{default:t(()=>a[11]||(a[11]=[w(" Crear Actividad ")])),_:1},8,["loading","disabled"]),e(I,{color:"primary",class:"mx-1",variant:"tonal",size:"small",onClick:h},{default:t(()=>a[12]||(a[12]=[w(" Dar de Baja ")])),_:1})]),_:1})]),_:1})]),_:1}),e(f,{cols:"12",sm:"7",style:{"align-items":"center"}},{default:t(()=>[e(M,{class:"mb-2"},{default:t(()=>[e(f,{cols:"6"},{default:t(()=>a[13]||(a[13]=[l("span",{style:{"font-size":"18px","font-weight":"500"}}," Etapa ",-1)])),_:1}),e(f,{cols:"12",md:"6",class:"d-flex justify-end align-center"},{default:t(()=>[e(ee,{label:"",color:"primary"},{default:t(()=>[w(g(o(m).stage.title),1)]),_:1})]),_:1})]),_:1}),o(m).stage_id===2?(r(),q(Tt,{key:0,opportunity:o(m),onUpdateStageId:C,"onUpdate:newProperty":z},null,8,["opportunity"])):R("",!0),o(m).stage_id===3?(r(),q(Pt,{key:1,opportunity:o(m),onUpdateStageId:C,"onUpdate:newProperty":z},null,8,["opportunity"])):R("",!0),o(m).stage_id===4?(r(),q(ll,{key:2,opportunity:o(m),onRefreshActivities:s,onUpdateStageId:C},null,8,["opportunity"])):R("",!0),o(m).stage_id===5?(r(),q(yt,{key:3,opportunity:o(m),onRefreshActivities:s,onUpdateStageId:C,onComplet:Q},null,8,["opportunity"])):R("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):R("",!0)]),_:1})):R("",!0),e(f,{cols:"12",md:"12"},{default:t(()=>[e(dl)]),_:1}),e(f,{cols:"12",md:"6"},{default:t(()=>[e(pl,{"is-drawer-open":o(U),"onUpdate:isDrawerOpen":a[5]||(a[5]=W=>L(U)?U.value=W:null)},null,8,["is-drawer-open"])]),_:1})]}),_:1}),e(ol,{"is-drawer-open":o(x),"onUpdate:isDrawerOpen":a[6]||(a[6]=J=>L(x)?x.value=J:null),customer:o(m).customer_id},null,8,["is-drawer-open","customer"])],64)}}};const gl={class:"mt-2 mx-3"},_l={style:{"font-size":"14px"}},bl={key:0,class:"no-activities-message d-flex flex-column justify-center align-center",style:{"min-block-size":"200px","text-align":"center"}},Vl=["onClick"],wl={class:"mx-2"},hl={class:"d-flex justify-content-between",style:{"font-size":"0.9em"}},kl={__name:"list",setup(F){const $=D(""),i=D("Anteriores");D(["Todos","PORA"]),D("Todos");const{getallActivitiesByAsesorFecha:_,getallActivitiesByFechaPast:U,getallActivitiesByFechaFuture:S,activities:x,activitiesPast:d,activitiesFuture:y}=Ae(),c=D(""),b=qe("userData").value,A=D(!0),k=D([]),V=D([]),m=D([]),n=async()=>{await _(b.id),k.value=x.value},C=async()=>{await U(b.id),V.value=d.value},j=async()=>{await S(b.id),m.value=y.value};Fe(async()=>{await n(),await C(),await j(),A.value=!1});const s=D(!1),u=p=>{s.value=!0,c.value={...p}},N=async()=>{A.value=!0,await n(),await C(),await j(),A.value=!1},h=X(()=>[{tabName:"Anteriores",icon:"tabler-calendar",actividades:V,badge:V.value.length},{tabName:"Hoy",icon:"tabler-edit",actividades:k,badge:k.value.length},{tabName:"Futuros",icon:"tabler-calendar",actividades:m,badge:m.value.length}]),Q=[{type:"Visita",icon:"tabler-current-location"},{type:"Llamada",icon:"tabler-phone"},{type:"Cotizacion",icon:"tabler-cash"},{type:"Otro",icon:"tabler-table"}],z=p=>{const a=Q.find(O=>O.type===p);return a?a.icon:"tabler-default"},P=p=>{const a=new Date(p),O=a.getDate(),B=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][a.getMonth()],J=a.getHours().toString().padStart(2,"0"),W=a.getMinutes().toString().padStart(2,"0");return`${O} de ${B}, ${J}:${W}`};return ne($,p=>{const a=O=>O.filter(E=>{const B=E.name_opportunity.toLowerCase().includes(p.toLowerCase()),J=E.phone_opportunity.toLowerCase().includes(p.toLowerCase());return B||J});p.length>2?(k.value=a(x.value),V.value=a(d.value),m.value=a(y.value)):(k.value=x.value,V.value=d.value,m.value=y.value)}),(p,a)=>{const O=de("VCircularProgress");return r(),q(M,{class:"match-height"},{default:t(()=>[e(f,{cols:"12",md:"4",style:{display:"flex","flex-direction":"column","block-size":"100vh"}},{default:t(()=>[e(te,{class:"flex-grow-1"},{default:t(()=>[e(fe,{class:"d-flex justify-between align-center flex-wrap"},{default:t(()=>[a[5]||(a[5]=l("h4",{class:"mt-5"}," Mis Actividades ",-1)),l("div",gl,[e(ue,{modelValue:$.value,"onUpdate:modelValue":a[0]||(a[0]=E=>$.value=E),placeholder:"Buscar actividad...",class:"search-field",variant:"plain","hide-details":"",dense:"","prepend-inner-icon":"tabler-search"},null,8,["modelValue"])])]),_:1}),e(st,{modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=E=>i.value=E),grow:""},{default:t(()=>[(r(!0),v(T,null,Y(h.value,E=>(r(),q(nt,{key:E.tabName},{default:t(()=>[l("span",_l,g(E.tabName),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),a[11]||(a[11]=l("br",null,null,-1)),e(G,{style:{"flex-grow":"1","overflow-y":"auto"}},{default:t(()=>[A.value?(r(),q(rt,{key:0,absolute:"",opacity:"0.7"},{default:t(()=>[e(O,{indeterminate:"",size:"70"})]),_:1})):R("",!0),e(Be,{modelValue:i.value,"onUpdate:modelValue":a[2]||(a[2]=E=>i.value=E),class:"disable-tab-transition",style:{"max-block-size":"500px","overflow-y":"auto"}},{default:t(()=>[(r(!0),v(T,null,Y(h.value,E=>(r(),q(ot,{key:E.tabName,value:E.tabName},{default:t(()=>[E.actividades.value.length===0?(r(),v("div",bl,[e(K,{size:"64",color:"grey",icon:"tabler-calendar-off",class:"mb-4",style:{animation:"bounce 1s infinite"}}),a[6]||(a[6]=l("div",{style:{color:"#888","font-size":"1.2em"}}," ¡No tienes actividades pendientes! ",-1)),a[7]||(a[7]=l("div",{style:{color:"#aaa","font-size":"0.9em","margin-block-start":"8px"}}," ¡Relájate y disfruta tu día! ",-1))])):(r(!0),v(T,{key:1},Y(E.actividades.value,B=>(r(),v("div",{key:B.id,"fill-dot":"",class:"border mb-2 rounded-sm py-2",style:{cursor:"pointer"},onClick:J=>u(B)},[e(ve,null,{default:t(()=>[e(M,null,{default:t(()=>[e(f,{cols:"12",md:"2",style:{"padding-inline-end":"0"}},{default:t(()=>[e(ee,{class:"d-flex justify-center align-center",style:{display:"inline-flex","border-radius":"4px","block-size":"36px","inline-size":"36px"}},{default:t(()=>[e(K,{size:"25",icon:"tabler-home"})]),_:1})]),_:1}),B.project_name?(r(),q(f,{key:0,cols:"12",md:"5",class:"d-flex flex-column align-start",style:{"padding-inline-start":"0"}},{default:t(()=>[e(ie,{class:"text-left"},{default:t(()=>[l("strong",null,g(B.property_title),1)]),_:2},1024),e(ae,{class:"font-weight-medium text-left"},{default:t(()=>[l("span",null,"$ "+g(B.price),1)]),_:2},1024)]),_:2},1024)):R("",!0),B.project_name?R("",!0):(r(),q(f,{key:1,cols:"12",md:"5"},{default:t(()=>[e(ie,{class:"text-left"},{default:t(()=>a[8]||(a[8]=[l("strong",{style:{"font-size":"12px"}}," Departamento ",-1)])),_:1}),e(ae,{class:"font-weight-medium text-left"},{default:t(()=>a[9]||(a[9]=[l("span",null,"Indefinido",-1)])),_:1})]),_:1})),e(f,{cols:"12",md:"5",class:"d-flex justify-end align-center"},{default:t(()=>[e(ee,{label:"",color:"primary",class:"ml-auto",style:{"font-size":"10px"}},{default:t(()=>[w(g(B.stage),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(ve,{class:""},{default:t(()=>[e(ee,{label:"",color:"secondary",class:"w-100 h-48"},{default:t(()=>[e(K,{size:"20",icon:z(B.type_activity)},null,8,["icon"]),l("div",wl,g(B.type_activity)+"   •   "+g(B.name_opportunity),1)]),_:2},1024)]),_:2},1024),e(ve,null,{default:t(()=>[l("div",hl,[a[10]||(a[10]=l("div",{style:{"flex-grow":"1"}}," Ver ",-1)),l("div",null,g(P(B.scheduled_at)),1)])]),_:2},1024)],8,Vl))),128))]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(f,{cols:"12",md:"8",style:{display:"flex","flex-direction":"column"}},{default:t(()=>[e(vl,{"is-drawer-open":s.value,"onUpdate:isDrawerOpen":a[3]||(a[3]=E=>s.value=E),"activities-data":c.value,class:"flex-grow-1",onRefreshActivities:N,onLoaded:a[4]||(a[4]=E=>A.value=!1)},null,8,["is-drawer-open","activities-data"])]),_:1})]),_:1})}}},To=Re(kl,[["__scopeId","data-v-9f55a2ef"]]);export{To as default};
