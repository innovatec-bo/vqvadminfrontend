import{$ as V}from"./api-82cd37b3.js";import{r as _,k as oe,a2 as T,ac as ie,H as se,o as B,f as I,e as d,d as R,c as ne,F as re,i as ue,b as o,n as t,w as W,I as J,a0 as de,a4 as ce,v as pe}from"./index-00f4ab0f.js";import{a as k,b as N}from"./notifications-e0287a8c.js";import{r as F}from"./validators-dea6e3a5.js";import{_ as me}from"./AppTextarea-b02db08f.js";import{_ as fe}from"./AppSelect-5d5f2cf3.js";import{_ as ee}from"./AppTextField-7485ea6b.js";import{_ as ae}from"./AppAutocomplete-ec3ffd0f.js";import{_ as ve}from"./DialogCloseBtn-48448631.js";import{u as ye}from"./useSales-b2893936.js";import{P as X,a as ge,_ as Z}from"./InvoiceAddMoney-c96f1ee5.js";import{V as Q}from"./VNodeRenderer-57d4ead4.js";import{u as _e}from"./useProperty-af4a2d57.js";import{V as q}from"./VRow-a69cdb9a.js";import{V as g}from"./VCol-dc58c310.js";import{V as te}from"./VCard-643c730e.js";import{V as $}from"./VCardText-f7de957d.js";import{V as Ve}from"./VTextField-fdc1613f.js";import{V as x}from"./VDivider-d67550db.js";import{V as be}from"./VDialog-02e14318.js";const Ae=async a=>await V("/activity",{method:"POST",body:a}),he=async a=>await V(`/activity/${a}`,{method:"GET"}),we=async()=>await V("/typeActivities",{method:"GET"}),Pe=async(a,i)=>await V(`/activity/${a}/status`,{method:"PATCH",body:i}),Se=async(a,i)=>await V(`/activity/${a}`,{method:"PATCH",body:i}),Te=async(a,i)=>await V(`/activity/asesor/${a}/fecha`,{method:"GET",params:i}),Fe=async a=>await V(`/activity/asesor/${a}/fecha-future`,{method:"GET"}),Ee=async a=>await V(`/activity/asesor/${a}/fecha-past`,{method:"GET"}),Oe=async(a,i)=>await V(`/activity/asesor/${a}/fecha-rango`,{method:"GET",params:i}),ke=async(a,i)=>await V(`/activity/${a}/change_status`,{method:"PATCH",body:i}),Ce=async a=>await V(`/activity/${a}/discard`,{method:"PATCH"});function ra(){const a=_(!1),i=_(null),p=_(null),m=_([]),P=_([]),y=_([]),O=_([]);return _(0),oe(),{loadingActivity:a,error:i,registerActivity:async c=>{a.value=!0,i.value=null;try{const n=await Ae(c);p.value=n.data,k("Cita agendada correctamente",n.data.message)}catch(n){console.log(n),n.response&&n.response.status==422&&N("Advertencia","Faltan Datos por Rellenar"),i.value=n.message}finally{a.value=!1}},getActivityId:async c=>{a.value=!0,i.value=null;try{const n=await he(c);p.value=n.data}catch(n){i.value=n.message}finally{a.value=!1}},getallTypeActivities:async()=>{try{const c=await we();console.log(c.data),O.value=c.data}catch(c){console.log(c)}},changeStatusActivity:async(c,n)=>{a.value=!0,i.value=null;try{const r=await Pe(c,n);console.log(r),p.value=r.data,k("Actividad Completada","")}catch(r){console.log(r),i.value=r.message}finally{a.value=!1}},getallActivitiesByOportunity:async(c,n)=>{a.value=!0,i.value=null;try{const r=await getByOportunity(c,n);m.value=r.data,console.log(m)}catch(r){i.value=r.message}finally{a.value=!1}},getallActivitiesByAsesorFecha:async c=>{a.value=!0,i.value=null;const n=new Date().toISOString().split("T")[0];try{const D=await Te(c,{fecha:n});m.value=D.data,console.log("Actividades de hoy:",m.value)}catch(r){i.value=r.message}finally{a.value=!1}},getallActivitiesByAsesorRangoFecha:async(c,n)=>{a.value=!0,i.value=null;try{const r=await Oe(c,n);m.value=r.data.data}catch(r){i.value=r.message}finally{a.value=!1}},getallActivitiesByFechaPast:async c=>{a.value=!0,i.value=null;try{const n=await Ee(c);P.value=n.data,console.log("Actividades pasadas:",P.value)}catch(n){i.value=n.message}finally{a.value=!1}},getallActivitiesByFechaFuture:async c=>{a.value=!0,i.value=null;try{const n=await Fe(c);y.value=n.data,console.log("Actividades futuras:",y.value)}catch(n){i.value=n.message}finally{a.value=!1}},updateActivity:async(c,n)=>{a.value=!0,i.value=null;try{const r=await Se(c,n);console.log(r),p.value=r.data,k("Actividad Actualizada correctamente","Se actualizo una actividad")}catch(r){console.log(r),r.response&&r.response.status==422&&N("Advertencia","Faltan Datos por Rellenar"),i.value=r.message}finally{a.value=!1}},completedActivityAndRegister:async(c,n)=>{a.value=!0;try{const r=await ke(c,n);k("Nueva actividad registrada","Se completó la actividad anterior y se agregó una nueva."),console.log(r)}catch(r){i.value=r.message}finally{a.value=!1}},discardActivityOpportunity:async c=>{a.value=!0;try{const n=await Ce(c);console.log(n)}catch(n){i.value=n.message}finally{a.value=!1}},activity:p,activities:T(()=>m.value),activitiesPast:T(()=>P.value),activitiesFuture:T(()=>y.value),typeActivities:T(()=>O.value)}}const qe=async a=>await V(`/opportunity/kanban/${a}`,{method:"GET"}),De=async a=>await V(`/opportunity/get-opportunity/${a}`,{method:"GET"}),$e=async(a,i)=>await V(`/opportunity/convert-prospect/${a}`,{method:"PATCH",body:i}),Be=async(a,i)=>await V(`/opportunity/update/${a}`,{method:"PATCH",body:i}),Re=async(a,i,p)=>await V(`/opportunity/${a}/stage/${i}`,{method:"PATCH",body:p});function ua(){const a=_(!1),i=_(null),p=ie("userData").value,m=_({description:"",customer:{name:"",email:"",phone:"",ci:""},stage:{id:"",name:"",description:""},property:{id:"",title:"",code:"",description:""}}),P=_(null);return{loadingOpportunity:a,error:i,opportunity:m,kanban:P,allOpportunityKanbanForUser:async()=>{try{const e=await qe(p.id);console.log(e.data),P.value=e.data,console.log(P)}catch(e){console.error(e)}},changeStatusByOpportunity:async(e,f,b)=>{a.value=!0;try{const E=await Re(e,f,b);console.log("Oportunidad actualizada: ",E),m.value=E.data,k("¡Oportunidad avanzó a una nueva etapa!","La oportunidad ha avanzado exitosamente a la siguiente fase.")}catch(E){console.log(E),E.response&&E.response.status==500&&N("Advertencia",E.response._data.message)}finally{a.value=!1}},getOpportunitybyId:async e=>{try{const f=await De(e);m.value=f.data,console.log("esta es la oportunidad: ",m.value)}catch(f){console.error(f)}},changeOpportunity:async(e,f)=>{a.value=!0;try{const b=await Be(e,f);m.value=b.data,console.log("Oportunidad actualizada: ",m.value),k("Oportunidad actualizada correctamente","Los detalles de la oportunidad han sido modificados.")}catch(b){i.value=b,console.error(b)}finally{a.value=!1}},generateProspect:async(e,f)=>{try{const b=await $e(e,f);console.log(b),m.value=b.data}catch(b){console.error(b)}finally{}}}}const Ue={LEAD:{value:1,label:"LEAD"},PROSPECT:{value:2,label:"PROSPECTO"},PRESALE:{value:3,label:"PRE-VENTA"},SALE:{value:4,label:"VENTA"},DELIVERY:{value:5,label:"ENTREGA"},LOSS:{value:6,label:"PERDIDA"}},xe={class:"pa-5 flex-grow-1"},Ie={__name:"InvoiceAddPropertySale",props:{propertiesform:{type:Array,required:!0}},emits:["totalAmount"],setup(a,{emit:i}){const p=a,{propertiesAvailbles:m,properties:P}=_e();return _(100),_(1),se(async()=>{try{m()}catch(y){console.error("Error al obtener las propiedades:",y)}}),(y,O)=>{const C=ae,h=ee;return B(),I(te,{flat:"",border:"",class:"d-flex flex-row"},{default:d(()=>[R("div",xe,[(B(!0),ne(re,null,ue(p.propertiesform,(A,e)=>(B(),I(q,{key:e},{default:d(()=>[o(g,{cols:"12",sm:"4",style:{"padding-block":"0","padding-inline":"8px"}},{default:d(()=>[o(C,{modelValue:A.property_id,"onUpdate:modelValue":f=>A.property_id=f,label:A.property_type_name,rules:["requiredValidator"in y?y.requiredValidator:t(F)],placeholder:"Selecciona una propiedad *",items:t(P),"item-title":"title","item-value":"id",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","label","rules","items"])]),_:2},1024),o(g,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:d(()=>[o(h,{modelValue:A.price,"onUpdate:modelValue":f=>A.price=f,rules:["requiredValidator"in y?y.requiredValidator:t(F)],label:"Precio *",placeholder:"$us",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),o(g,{cols:"12",sm:"2",style:{"padding-block":"0","padding-inline":"8px"}},{default:d(()=>[o(h,{modelValue:A.price_it,"onUpdate:modelValue":f=>A.price_it=f,rules:["requiredValidator"in y?y.requiredValidator:t(F)],label:"3% (IT) *",placeholder:"%",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),o(g,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:d(()=>[o(h,{modelValue:A.price_contrato,"onUpdate:modelValue":f=>A.price_contrato=f,rules:["requiredValidator"in y?y.requiredValidator:t(F)],label:"Precio Contrato *",placeholder:"Escribe el precio",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024)]),_:2},1024))),128))])]),_:1})}}};const Ne={class:"d-flex align-center justify-sm-end mx-5"},Le={style:{"inline-size":"9.5rem"}},da={__name:"PreSaleForm",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},stage:{type:String,required:!0}},emits:["update:isDialogVisible","registerSale","formCancelled"],setup(a,{emit:i}){var n,r,D,j,M;const p=a,m=i,{generateSale:P,generateSaleChangeStage:y}=ye(),O=_(!1),C=["20","30","40","50","70","80","100"],h=_("30"),A=s=>{m("formCancelled"),m("update:isDialogVisible",s)},e=_({social_reason:((n=p.opportunity)==null?void 0:n.customer.name)??"",creation_date:new Date().toISOString().split("T")[0],nit:"",address:"",email:((r=p.opportunity)==null?void 0:r.customer.email)??"",phone:((D=p.opportunity)==null?void 0:D.customer.phone)??"",workplace:((j=p.opportunity)==null?void 0:j.customer.workplace)??"",payment_method:null,contract_signing_date:null,amount:null,initial_fee:null,percentage_initial_fee:null,observations:"",opportunity_id:((M=p.opportunity)==null?void 0:M.id)??null,stage_id:Ue.SALE.value,balance:null,properties:[{property_id:null,price:null,price_it:null,price_contrato:null,property_type:X.DEPARTAMENT.value,property_type_name:X.DEPARTAMENT.label}],differs_initial_fee:[],differs_balance:[],quote_id:null}),f=s=>(e.value.initial_fee=s*h.value/100,e.value.balance=s-e.value.initial_fee,e.value.percentage_initial_fee=h.value,s*h.value/100),b=T(()=>e.value.social_reason&&e.value.nit&&e.value.phone&&e.value.amount&&e.value.creation_date&&e.value.payment_method&&e.value.quote_id),E=T(()=>e.value.properties.every(s=>s.property_id!==null&&s.price!==null&&s.price_it!==null&&s.price_contrato!==null)),L=T(()=>e.value.differs_initial_fee.length===0?!0:e.value.differs_initial_fee.every(s=>s.amount!==null)),z=T(()=>e.value.differs_balance.length===0?!0:e.value.differs_balance.every(s=>s.amount!==null)),G=T(()=>{if(e.value.differs_initial_fee.length===0)return!0;const s=e.value.differs_initial_fee.reduce((S,w)=>S+(parseFloat(w.amount)||0),0),l=parseFloat(s),v=parseFloat(e.value.initial_fee);return console.log(l),console.log(v),l===v}),H=T(()=>{if(e.value.differs_balance.length===0)return!0;const s=e.value.differs_balance.reduce((S,w)=>S+(parseFloat(w.amount)||0),0),l=parseFloat(s),v=parseFloat(e.value.balance);return console.log(l),console.log(v),l===v}),U=T(()=>b.value&&E.value&&L.value&&z.value),c=async()=>{if(!G.value){alert("Por favor, diferencias del anticipo ");return}if(!H.value){alert("Por favor, diferencias del balance ");return}if(!U.value){alert("Por favor, completa todos los campos obligatorios.");return}O.value=!0;try{e.value.differs_balance.length===0&&e.value.balance!=0&&e.value.differs_balance.push({date:new Date().toISOString().slice(0,19).replace("T"," "),amount:e.value.amount-e.value.initial_fee}),e.value.differs_initial_fee.length===0&&e.value.differs_initial_fee.push({date:new Date().toISOString().slice(0,19).replace("T"," "),amount:e.value.initial_fee}),console.log("data de la venta: ",e.value),p.stage==="SALE"?(await P(e.value),console.log("entro a venta")):p.stage==="PRESALE"&&await y(e.value),m("update:isDialogVisible",!1),m("registerSale",e.value.opportunity_id)}catch(s){console.error("Error generando la venta:",s)}finally{O.value=!1}};return W(()=>e.value.properties,s=>{let l=0;s.forEach(v=>{if(v.price){const S=parseFloat(v.price)||0;v.price_it=S*.03,v.price_contrato=S+v.price_it,l+=v.price_contrato}else v.price_it=null}),e.value.amount=l,e.value.initial_fee=l*.3},{deep:!0}),W(()=>e.value.quote_id,s=>{var v,S;const l=p.opportunity.quotes.find(w=>w.id==s);l&&(e.value.social_reason=l.social_reason,e.value.email=l.email,e.value.phone=l.phone,e.value.nit=l.nit,e.value.address=l.address,e.value.opportunity_id=l.opportunity_id,e.value.workplace=l.workplace,e.value.observations=l.observations,l.property_id!==null&&(e.value.properties[0].property_id=(v=l.properties[0])==null?void 0:v.id,e.value.properties[0].price=(S=l.properties[0])==null?void 0:S.pivot_price)),e.value.quote_id=s}),(s,l)=>{const v=ve,S=ae,w=ee,K=fe,le=me;return B(),I(be,{"model-value":p.isDialogVisible,"max-width":"1000","onUpdate:modelValue":A},{default:d(()=>[o(v,{onClick:l[0]||(l[0]=u=>s.$emit("update:isDialogVisible",!1))}),o(te,null,{default:d(()=>[o($,{class:"d-flex flex-wrap justify-space-between gap-y-5 flex-column flex-sm-row align-center"},{default:d(()=>[o(t(Q),{nodes:t(J).app.logo,class:"me-3",style:{"align-self":"center"}},null,8,["nodes"]),l[12]||(l[12]=R("h4",{class:"font-weight-bold text-h3 d-flex align-center"}," Formulario de Ventas ",-1)),o(t(Q),{nodes:t(J).app.logopora,class:"me-3",style:{"align-self":"center"}},null,8,["nodes"])]),_:1}),o(q,{class:"justify-end ma-sm-2"},{default:d(()=>[R("div",Ne,[R("span",Le,[o(Ve,{modelValue:t(e).creation_date,"onUpdate:modelValue":l[1]||(l[1]=u=>t(e).creation_date=u),label:"Emisión",type:"date",outlined:"",rules:["requiredValidator"in s?s.requiredValidator:t(F)]},null,8,["modelValue","rules"])])])]),_:1}),o(x,{thickness:"12"}),o($,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row gap-y-5 gap-4"},{default:d(()=>[o(q,null,{default:d(()=>[o(t(g),{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:d(()=>[o(S,{modelValue:t(e).quote_id,"onUpdate:modelValue":l[2]||(l[2]=u=>t(e).quote_id=u),rules:["requiredValidator"in s?s.requiredValidator:t(F)],label:"Cotizaciones Aprobadas *",placeholder:"Selecciona una",items:p.opportunity.quotes.filter(u=>u.status==="APPROVED").map(u=>{var Y;return{title:((Y=u.properties[0])==null?void 0:Y.code)+" | "+u.amount+"$ "||u.social_reason+" | "+u.amount+"$ ",value:u.id}}),outlined:""},null,8,["modelValue","rules","items"])]),_:1}),o(t(g),{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:d(()=>[o(w,{modelValue:t(e).social_reason,"onUpdate:modelValue":l[3]||(l[3]=u=>t(e).social_reason=u),rules:["requiredValidator"in s?s.requiredValidator:t(F)],label:"Cliente *",placeholder:"Canzza",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),o(t(g),{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:d(()=>[o(w,{modelValue:t(e).email,"onUpdate:modelValue":l[4]||(l[4]=u=>t(e).email=u),label:"Correo *",placeholder:"admin@gmail.com",type:"email",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1}),o(t(g),{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:d(()=>[o(w,{modelValue:t(e).phone,"onUpdate:modelValue":l[5]||(l[5]=u=>t(e).phone=u),rules:["requiredValidator"in s?s.requiredValidator:t(F)],label:"Celular *",placeholder:"77049267",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),o(t(g),{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:d(()=>[o(w,{modelValue:t(e).nit,"onUpdate:modelValue":l[6]||(l[6]=u=>t(e).nit=u),label:"C.I./NIT *",rules:["requiredValidator"in s?s.requiredValidator:t(F)],placeholder:"0000000",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),o(t(g),{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:d(()=>[o(w,{modelValue:t(e).workplace,"onUpdate:modelValue":l[7]||(l[7]=u=>t(e).workplace=u),label:"Lugar de Trabajo",placeholder:"Placeholder Text",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1}),o(t(g),{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:d(()=>[o(w,{modelValue:t(e).address,"onUpdate:modelValue":l[8]||(l[8]=u=>t(e).address=u),label:"Dirección",placeholder:"Av/ Equipetrol ....",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(x,{thickness:"12"}),o($,{class:"add-products-form"},{default:d(()=>[o(q,null,{default:d(()=>[o(t(g),{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:d(()=>[o(Ie,{propertiesform:t(e).properties},null,8,["propertiesform"])]),_:1}),o(t(g),{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:d(()=>[o(K,{modelValue:t(e).payment_method,"onUpdate:modelValue":l[9]||(l[9]=u=>t(e).payment_method=u),rules:["requiredValidator"in s?s.requiredValidator:t(F)],label:"Tipo de Pago *",placeholder:"Seleccione ",items:Object.values(t(ge)),class:"custom-salesforce-input"},null,8,["modelValue","rules","items"])]),_:1}),o(K,{modelValue:t(h),"onUpdate:modelValue":l[10]||(l[10]=u=>de(h)?h.value=u:null),rules:["requiredValidator"in s?s.requiredValidator:t(F)],label:"% Anticipo *",items:C,placeholder:"% Anticipo",class:"mb-2"},null,8,["modelValue","rules"])]),_:1})]),_:1}),o(x,{thickness:"12"}),o($,{class:"add-products-form"},{default:d(()=>[o(q,null,{default:d(()=>[o(t(g),{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:d(()=>[o(Z,{title:"Anticipo ",amount:f(t(e).amount),differs:t(e).differs_initial_fee,type:s.INITIAL_PAYMENT},null,8,["amount","differs","type"])]),_:1}),o(t(g),{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:d(()=>[o(Z,{title:"Saldo por Pagar",amount:t(e).amount-t(e).initial_fee,differs:t(e).differs_balance,type:s.BALANCE},null,8,["amount","differs","type"])]),_:1}),o(t(g),{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:d(()=>[o(le,{modelValue:t(e).observations,"onUpdate:modelValue":l[11]||(l[11]=u=>t(e).observations=u),"auto-grow":"",label:"Observaciones del Cliente",rows:"2",placeholder:"Descripción...","row-height":"20"},null,8,["modelValue"])]),_:1}),o(t(g),{cols:"12",class:"my-5",style:{"padding-block":"0","padding-inline":"8px"}},{default:d(()=>[o(ce,{color:"primary",loading:t(O),disabled:!t(U)||t(O),onClick:c},{default:d(()=>l[13]||(l[13]=[pe(" Registrar Venta ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}};export{Ue as S,da as _,ra as a,Ce as d,ua as u};
