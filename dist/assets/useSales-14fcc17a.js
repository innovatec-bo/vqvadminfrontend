import{$ as r}from"./api-7e421e3b.js";import{a as i,s as g,b as p,e as l,c as S}from"./notifications-cae4d01c.js";import{r as o,k as h}from"./index-e0f854fb.js";const m=async e=>await r("/sale",{method:"POST",body:e}),y=async e=>await r("/sale/changeStage",{method:"POST",body:e}),w=async e=>await r(`/sale/${e}`,{method:"GET"}),b=async e=>await r(`/sale/${e}/status/signature`,{method:"PATCH"}),E=async e=>await r(`/sale/${e}/discard`,{method:"PATCH"}),x=async()=>await r("/export/sale",{method:"GET"}),C=async e=>await r("sales/list-paginated",{method:"GET",params:e});function B(){const e=o(!1),c=o([]),u=o(0),v=o(null),f=h(),t=o(null);return{loadingSale:e,sales:c,error:v,sale:t,totalSales:u,generateSale:async s=>{e.value=!0;try{const a=await m(s);S("Venta generada con Exito","Se registro una nueva venta"),console.log("venta: ",a),t.value=a.data,f.push(`/sale/${t.value.id}`)}catch(a){return a.response&&a.response.status==422&&g("Validación fallida","Faltan datos por rellenar"),a.response&&a.response.status==409?p("Advertencia",a.response._data.error):l("Error al crear la venta","Hubo un problema al crear la venta."),{success:!1,message:"Error de actualización"}}finally{e.value=!1}},generateSaleChangeStage:async s=>{e.value=!0;try{const a=await y(s);i("Creacion Exitosa","La venta ha sido creada correctamente."),console.log("venta: ",a),t.value=a.data}catch(a){return console.log(a),a.response&&a.response.status==422?(g("Validación fallida","Faltan datos por rellenar"),{success:!1,message:"Validación fallida"}):(a.response&&a.response.status==409?p("Advertencia",a.response._data.message):l("Error al crear la venta","Hubo un problema al crear la venta."),{success:!1,message:"Error de actualización"})}finally{e.value=!1}},getSalebyId:async s=>{e.value=!0;try{const a=await w(s);console.log(a.data),t.value=a.data}catch(a){console.log(a)}finally{e.value=!1}},AllSalesPaginated:async s=>{e.value=!0;try{const a=await C(s);c.value=a.data.data,console.log(c),u.value=a.data.total}catch(a){console.log(a)}finally{e.value=!1}},SaleChangeStageDiscard:async s=>{e.value=!0;try{const a=await E(s);i("Actualizacion Exitosa","La venta fue descartada"),console.log("venta: ",a),t.value=a.data}catch(a){return console.log(a),a.response&&a.response.status==422,l("Error","Hubo un problema al actualizar la venta."),{success:!1,message:"Error de actualización"}}finally{e.value=!1}},SaleChangeSignature:async s=>{e.value=!0;try{const a=await b(s);i("Actualizacion Exitosa","La venta fue actualizada"),console.log("venta: ",a),t.value=a.data}catch(a){return console.log(a),a.response&&a.response.status==422,l("Error","Hubo un problema al actualizar la venta."),{success:!1,message:"Error de actualización"}}finally{e.value=!1}},exportSaleExcel:async()=>{try{const s=await x();if(!(s instanceof Blob))throw new Error("Respuesta inválida del servidor con el BLOB");const a=new Blob([s],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=window.URL.createObjectURL(a),n=document.createElement("a");n.href=d,n.setAttribute("download","ventas.xlsx"),document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(d),document.body.removeChild(n)}catch(s){console.error("Error en exportación:",s)}}}}export{B as u};
