import{u as le,p as xe,S as ke,_ as Pe,a as De,d as Ie}from"./PreSaleForm-df5e4059.js";import{r as G,e as Te}from"./validators-dea6e3a5.js";import{_ as Ce}from"./AppTextarea-a2b5384e.js";import{_ as Ne}from"./AppDateTimePicker-995d3c9b.js";import{_ as ve}from"./AppTextField-5b64ee5a.js";import{_ as ge}from"./AppSelect-9bf76bbd.js";import{$ as re}from"./api-11869bd0.js";import{s as he,a as Be,b as Re,c as $e,S as be}from"./notifications-81bc0416.js";import{r as b,o as s,c as f,d as l,F as I,i as M,b as e,e as t,n as a,v as C,x as D,z as R,f as j,$ as K,a4 as E,w as oe,a3 as Se,a as ie,a0 as B,am as J,a2 as X,an as Ve,ac as Le,H as Me}from"./index-68d8d6c3.js";import{V as Ae}from"./VAvatar-bf0453b9.js";import{b as ee,c as te,a as me}from"./VList-23d998aa.js";import{V as g}from"./VCol-52b12ffa.js";import{V as Z}from"./VChip-644a96c4.js";import{V as Q}from"./VCardText-bce4fe8f.js";import{a as ze}from"./formatters-b3558c7d.js";import{u as He}from"./useQuote-fc119381.js";import{_ as Ge}from"./AppAutocomplete-ba3c4704.js";import{_ as ue}from"./DialogCloseBtn-724db7cc.js";import{u as Qe}from"./useProperty-12b0e5fc.js";import{V as Y,b as de}from"./VCard-a1bc7cb9.js";import{V as Oe}from"./VForm-c6860d4b.js";import{V as H}from"./VRow-ffd302ce.js";import{V as pe}from"./VDialog-5eae9a7e.js";import{V as fe}from"./VCheckbox-f4a8c3c7.js";import{V as Ue}from"./VTooltip-f0284b56.js";import{V as se}from"./VTable-adad8f3f.js";import{f as ye}from"./currencyFormatter-96e3a729.js";import{V as ae}from"./VTextField-e3a6e442.js";import{_ as Fe}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as Ke}from"./AppDrawerHeaderSection-95eebd9c.js";import{P as We}from"./vue3-perfect-scrollbar.esm-dd306c5e.js";import{V as Je}from"./VNavigationDrawer-7768b42a.js";import{V as qe,a as Ye}from"./VWindowItem-3ea86a4b.js";import{V as Xe,a as we}from"./VRadioGroup-93516974.js";import{V as Ze}from"./VDivider-a021f82b.js";import{V as et,a as tt}from"./VTabs-d9b8ace9.js";import{V as lt}from"./VOverlay-17772896.js";import"./useSales-4aa650fc.js";import"./InvoiceAddMoney-58db6a58.js";import"./VNodeRenderer-37ca53c6.js";import"./helpers-61e4df1a.js";import"./form-0aa35c20.js";/* empty css                   */import"./VCounter-b7e92eed.js";import"./VImg-14a79051.js";import"./VField-238d3b3c.js";import"./easing-9f15041e.js";import"./VInput-0e0fa695.js";import"./forwardRefs-8348545e.js";import"./VSelect-1f8f848d.js";import"./dialog-transition-e3bf0d93.js";import"./VMenu-95995cde.js";import"./scopeId-cd403e1e.js";import"./VCheckboxBtn-2c22c5fa.js";import"./VSelectionControl-65cfe522.js";import"./index-9c720871.js";import"./constants-f3b5ca65.js";import"./ssrBoot-9a649dd5.js";import"./filter-173ebadb.js";import"./VSpacer-f44773cc.js";import"./lazy-c5009c08.js";import"./VSlideGroup-353ca6db.js";const ot=async(S,O)=>await re(`/opportunity/${S}/stage/${O}`,{method:"GET"}),at=async(S,O,o)=>await re(`/opportunity/${S}/procedure/${O}`,{method:"PATCH",body:o});function ce(){const S=b(null),O=b(!1),o=b(!1),y=b([]);return{process:S,loadingProcess:O,errorProcess:o,processes:y,allProcessesOpportunityForStage:async(m,r)=>{try{const v=await ot(m,r);y.value=v.data}catch(v){console.log(v)}},checkProcessForOpportunity:async(m,r,v)=>{try{console.log(v);const d=await at(m,r,v);he("¡Proceso completado exitosamente!","El proceso ha sido llevado a cabo sin inconvenientes. ")}catch(d){console.log(d)}}}}const it={class:"my-5"},nt={key:0},st=["src"],rt={class:"my-5"},ut={key:0,class:"d-flex flex-wrap gap-2 my-5"},dt={key:1},pt={__name:"EditDeliveryOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","complet"],setup(S,{emit:O}){const o=S,y=O,{changeStatusByOpportunity:q}=le(),{checkProcessForOpportunity:A}=ce(),m=async()=>{try{await q(o.opportunity.id,7,{}),y("complet")}catch(v){console.error("Error updating customer:",v)}},r=async(v,d)=>{console.log(`Procedimiento ${v} marcado como: ${d?"realizado":"no realizado"}`),await A(o.opportunity.id,v,{is_check:!d}),y("updateStageId",o.opportunity.id)};return(v,d)=>(s(),f(I,null,[l("div",it,[d[0]||(d[0]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Propiedades ",-1)),o.opportunity.sales.length>0?(s(),f("div",nt,[(s(!0),f(I,null,M(o.opportunity.sales,_=>(s(),f("div",{key:_.id},[(s(!0),f(I,null,M(_.properties,U=>(s(),f("div",{key:U.id,class:"d-flex align-center justify-between"},[e(Ae,{size:"50",rounded:""},{default:t(()=>[l("img",{src:a(xe),alt:"Logo pora",style:{"border-radius":"30%"}},null,8,st)]),_:1}),e(g,{cols:"12",md:"7"},{default:t(()=>[e(ee,{class:"font-weight-medium"},{default:t(()=>[C(D(U.project_title)+" | "+D(U.title),1)]),_:2},1024),e(te,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",null,"$ "+D(U.pivot_price),1)]),_:2},1024)]),_:2},1024)]))),128))]))),128))])):R("",!0)]),l("div",rt,[d[2]||(d[2]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(s(),f("div",ut,[(s(!0),f(I,null,M(o.opportunity.procedure,_=>(s(),f("div",{key:_.id},[e(Z,{color:_.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:U=>r(_.id,_.pivot.is_check)},{default:t(()=>[_.pivot.is_check?(s(),j(K,{key:0,icon:"tabler-check",class:"mr-2"})):R("",!0),C(" "+D(_.title),1)]),_:2},1032,["color","onClick"])]))),128))])):(s(),f("div",dt,d[1]||(d[1]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(Q,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(E,{color:"primary",size:"small",onClick:m},{default:t(()=>d[3]||(d[3]=[C(" Finalizar Oportunidad ")])),_:1})]),_:1})],64))}},je={__name:"EditCustomerDialog",props:{isDialogVisible:{type:Boolean,required:!0},opportunityKanban:{type:Object,required:!0}},emits:["update:isDialogVisible","update:newProperty"],setup(S,{emit:O}){const o=S,y=O;Object.values(ke).map(x=>({title:x.label,value:x.value}));const{propertiesAvailbles:q,properties:A}=Qe(),{getOpportunitybyId:m,opportunity:r,changeOpportunity:v,loadingOpportunity:d}=le(),_=()=>{y("update:isDialogVisible",!1)},U=async()=>{console.log("antes del save:",r);const x={id:r.value.id,description:r.value.description,property_id:r.value.property_id,customer:{id:r.value.customer.id,name:r.value.customer.name,email:r.value.customer.email,ci:r.value.customer.ci,cod_phone:r.value.cod_phone,phone:r.value.customer.phone}};await v(r.value.id,x),r.value.property_id&&(console.log("Cambio y geenero el Emit Principal"),y("update:newProperty",r.value.property_id)),y("update:isDialogVisible",!1)},V=async()=>{var x;(x=o.opportunityKanban)!=null&&x.id&&await m(o.opportunityKanban.id)},w=async()=>{await q()};return oe(()=>o.isDialogVisible,async x=>{x===!0&&(V(),await w())}),(x,p)=>{const z=ue,T=ve,n=ge,c=Ge,N=Ce;return s(),j(pe,{"max-width":"800","model-value":o.isDialogVisible,persistent:"","close-on-esc":!1,"onUpdate:modelValue":_},{default:t(()=>[e(z,{onClick:_}),e(Y,{title:"Información del Cliente y Oportunidad",class:"pa-sm-8 pa-5"},{default:t(()=>[e(Q,null,{default:t(()=>[e(Oe,{onSubmit:Se(U,["prevent"])},{default:t(()=>[e(H,{dense:""},{default:t(()=>[e(g,{cols:"12",md:"6"},{default:t(()=>[e(T,{modelValue:a(r).customer.name,"onUpdate:modelValue":p[0]||(p[0]=k=>a(r).customer.name=k),label:"Nombre del Cliente",placeholder:"Ingresa el nombre",outlined:""},null,8,["modelValue"])]),_:1}),e(g,{cols:"12",md:"6"},{default:t(()=>[e(T,{modelValue:a(r).customer.email,"onUpdate:modelValue":p[1]||(p[1]=k=>a(r).customer.email=k),label:"Email del Cliente",placeholder:"Ingresa el email",outlined:""},null,8,["modelValue"])]),_:1}),e(g,{cols:"12",md:"6"},{default:t(()=>[e(H,null,{default:t(()=>[e(g,{cols:"4"},{default:t(()=>[e(n,{modelValue:a(r).customer.cod_phone,"onUpdate:modelValue":p[2]||(p[2]=k=>a(r).customer.cod_phone=k),label:"Código",items:["+591","+1","+52"],placeholder:"Cód.",outlined:""},null,8,["modelValue"])]),_:1}),e(g,{cols:"8"},{default:t(()=>[e(T,{modelValue:a(r).customer.phone,"onUpdate:modelValue":p[3]||(p[3]=k=>a(r).customer.phone=k),label:"Número de Teléfono",placeholder:"Ingresa el teléfono",outlined:"",dense:"",maxlength:"9"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(g,{cols:"12",md:"6"},{default:t(()=>[e(T,{modelValue:a(r).customer.ci,"onUpdate:modelValue":p[4]||(p[4]=k=>a(r).customer.ci=k),label:"CI del Cliente",placeholder:"Ingresa el CI",outlined:""},null,8,["modelValue"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(c,{modelValue:a(r).property_id,"onUpdate:modelValue":p[5]||(p[5]=k=>a(r).property_id=k),label:"Departamento de Interés",placeholder:"Selecciona un Departamento",items:a(A).map(k=>({title:k.title,value:k.id})),outlined:""},null,8,["modelValue","items"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(N,{modelValue:a(r).description,"onUpdate:modelValue":p[6]||(p[6]=k=>a(r).description=k),label:"Descripción de la Oportunidad",placeholder:"Ingresa una descripción",rows:"3","auto-grow":"",outlined:""},null,8,["modelValue"])]),_:1}),e(g,{cols:"12",class:"text-center"},{default:t(()=>[e(E,{type:"submit",color:"primary",class:"me-3",disabled:a(d),loading:a(d)},{default:t(()=>p[7]||(p[7]=[C(" Guardar ")])),_:1},8,["disabled","loading"]),e(E,{color:"secondary",variant:"tonal",onClick:_},{default:t(()=>p[8]||(p[8]=[C(" Cancelar ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},ct={class:"d-flex align-bottom flex-sm-row flex-column"},mt={class:"user-profile-info"},yt={class:"d-flex align-center justify-center justify-sm-space-between flex-wrap gap-4"},ft={class:"d-flex align-center gap-x-3"},vt={class:"text-4xl font-weight-medium"},gt={class:"d-flex flex-column py-2",style:{"font-size":"14px"}},_t={class:"text-sm text-disabled"},bt={key:0,class:"d-flex flex-wrap gap-2 my-5"},Vt={key:1},wt={key:0,class:"d-flex flex-wrap gap-2 my-5"},xt={key:1},kt={__name:"EditPreSaleOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","update:newProperty"],setup(S,{emit:O}){const o=S,y=O,{checkProcessForOpportunity:q}=ce(),{changeStatusQuotes:A}=He(),m=b(!1),r=b(!1),v=()=>{m.value=!0},d=()=>{console.log("Se escucho el evento en EditProspectOpportunity"),y("update:newProperty")},_=()=>{r.value=!0},U=async x=>{y("updateStageId",x)},V=async(x,p)=>{console.log(`Procedimiento ${x} marcado como: ${p?"realizado":"no realizado"}`),await q(o.opportunity.id,x,{is_check:!p}),y("updateStageId",o.opportunity.id)},w=async(x,p)=>{const z=p==="APPROVED"?"NOT_APPROVED":"APPROVED";console.log(`Procedimiento ${x} marcado como: ${p}`),await A(x,{status:z}),y("updateStageId",o.opportunity.id)};return(x,p)=>{const z=ie("RouterLink"),T=ie("IconBtn");return s(),f(I,null,[l("div",ct,[l("div",mt,[p[3]||(p[3]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Perfil ",-1)),l("div",yt,[l("div",ft,[l("span",vt,D(("avatarText"in x?x.avatarText:a(ze))(o.opportunity.customer.name)),1),l("div",gt,[e(z,{to:{name:"apps-ecommerce-customer-details-id",params:{id:1}},class:"font-weight-base"},{default:t(()=>[C(D(o.opportunity.customer.name),1)]),_:1}),l("span",_t,D(o.opportunity.customer.phone),1)]),e(E,{color:"secondary",variant:"tonal",size:"small",onClick:v},{default:t(()=>p[2]||(p[2]=[C(" Editar Perfil ")])),_:1})])])])]),l("div",null,[p[5]||(p[5]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(s(),f("div",bt,[(s(!0),f(I,null,M(o.opportunity.procedure,n=>(s(),f("div",{key:n.id},[e(Z,{color:n.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:c=>V(n.id,n.pivot.is_check)},{default:t(()=>[n.pivot.is_check?(s(),j(K,{key:0,icon:"tabler-check",class:"mr-2"})):R("",!0),C(" "+D(n.title),1)]),_:2},1032,["color","onClick"])]))),128))])):(s(),f("div",Vt,p[4]||(p[4]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),l("div",null,[p[9]||(p[9]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Cotizaciones ",-1)),o.opportunity.quotes&&o.opportunity.quotes.length>0?(s(),f("div",wt,[e(se,{density:"compact",class:"text-no-wrap",style:{"font-size":"12px"}},{default:t(()=>[p[7]||(p[7]=l("thead",null,[l("tr",null,[l("th",null," Nombre "),l("th",null," Propiedad "),l("th",null," Fecha "),l("th")])],-1)),l("tbody",null,[(s(!0),f(I,null,M(o.opportunity.quotes,n=>(s(),f("tr",{key:n.id},[l("td",null,D(n.social_reason),1),l("td",null,D(n.properties[0].title),1),l("td",null,D(n.created_at),1),l("td",null,[e(H,null,{default:t(()=>[e(fe,{modelValue:n.status,"onUpdate:modelValue":c=>n.status=c,"true-value":"APPROVED","false-value":"NOT_APPROVED",onClick:c=>w(n.id,n.status)},{default:t(()=>[e(Ue,{activator:"parent",location:"top"},{default:t(()=>p[6]||(p[6]=[C(" Aprobar Cotización ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","onClick"]),e(z,{to:{name:"quote-id",params:{id:n.id}}},{default:t(()=>[e(T,null,{default:t(()=>[e(K,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])]),_:2},1024)])]))),128))])]),_:1})])):(s(),f("div",xt,p[8]||(p[8]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(Q,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(z,{to:{name:"quote-add-quote"},class:"text-white"},{default:t(()=>[e(E,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>p[10]||(p[10]=[C(" Generar Cotización ")])),_:1})]),_:1}),e(E,{color:"primary",class:"mx-auto",size:"small",onClick:_},{default:t(()=>p[11]||(p[11]=[C(" Generar Venta ")])),_:1})]),_:1}),e(je,{"is-dialog-visible":a(m),"onUpdate:isDialogVisible":p[0]||(p[0]=n=>B(m)?m.value=n:null),"opportunity-kanban":o.opportunity,"onUpdate:newProperty":d},null,8,["is-dialog-visible","opportunity-kanban"]),e(Pe,{"is-dialog-visible":a(r),"onUpdate:isDialogVisible":p[1]||(p[1]=n=>B(r)?r.value=n:null),opportunity:o.opportunity,stage:"PRESALE",onRegisterSale:U},null,8,["is-dialog-visible","opportunity"])],64)}}},Pt={class:"d-flex align-bottom flex-sm-row flex-column"},Dt={class:"user-profile-info"},Ct={class:"d-flex align-center justify-center justify-sm-space-between flex-wrap gap-4"},ht={class:"d-flex align-center gap-x-3"},$t={class:"text-4xl font-weight-medium"},St={class:"d-flex flex-column py-2",style:{"font-size":"14px"}},At={class:"text-sm text-disabled"},zt={key:0,class:"d-flex flex-wrap gap-2 my-5"},Ot={key:1},Ut={key:0,class:"d-flex flex-wrap gap-2 my-5"},Ft={key:1},qt={__name:"EditProspectOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","update:newProperty"],setup(S,{emit:O}){const o=S,y=O,{checkProcessForOpportunity:q}=ce(),{changeStatusByOpportunity:A,loadingOpportunity:m}=le(),r=b(!1),v=()=>{r.value=!0},d=()=>{console.log("Se escucho el evento en EditProspectOpportunity"),y("update:newProperty")},_=async V=>{await A(V,ke.PRESALE.value,{}),y("updateStageId",V)},U=async V=>{console.log(`Procedimiento ${V.id} marcado como: ${V.pivot.is_check?"realizado":"no realizado"}`),await q(o.opportunity.id,V.id,{is_check:!V.pivot.is_check}),V.pivot.is_check=!V.pivot.is_check,y("updateStageId",o.opportunity.id)};return(V,w)=>{const x=ie("RouterLink"),p=ie("IconBtn");return s(),f(I,null,[l("div",Pt,[l("div",Dt,[w[3]||(w[3]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Perfil ",-1)),l("div",Ct,[l("div",ht,[l("span",$t,D(("avatarText"in V?V.avatarText:a(ze))(o.opportunity.customer.name)),1),l("div",St,[e(x,{to:{name:"apps-ecommerce-customer-details-id",params:{id:1}},class:"font-weight-base"},{default:t(()=>[C(D(o.opportunity.customer.name),1)]),_:1}),l("span",At,D(o.opportunity.customer.phone),1)]),l("div",null,[e(E,{color:"secondary",variant:"tonal",size:"small",onClick:v},{default:t(()=>w[2]||(w[2]=[C(" Editar Perfil ")])),_:1})])])])])]),l("div",null,[w[5]||(w[5]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(s(),f("div",zt,[(s(!0),f(I,null,M(o.opportunity.procedure,z=>(s(),f("div",{key:z.id},[e(Z,{color:z.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:T=>U(z)},{default:t(()=>[z.pivot.is_check?(s(),j(K,{key:0,icon:"tabler-check",class:"mr-2"})):R("",!0),C(" "+D(z.title),1)]),_:2},1032,["color","onClick"])]))),128))])):(s(),f("div",Ot,w[4]||(w[4]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),l("div",null,[w[8]||(w[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Cotizaciones ",-1)),o.opportunity.quotes&&o.opportunity.quotes.length>0?(s(),f("div",Ut,[e(se,{density:"compact",class:"text-no-wrap",style:{"font-size":"12px"}},{default:t(()=>[w[6]||(w[6]=l("thead",null,[l("tr",null,[l("th",null," Nombre "),l("th",null," Propiedad "),l("th",null," Fecha "),l("th")])],-1)),l("tbody",null,[(s(!0),f(I,null,M(o.opportunity.quotes,z=>(s(),f("tr",{key:z.id},[l("td",null,D(z.social_reason),1),l("td",null,D(z.properties[0].title),1),l("td",null,D(z.created_at),1),l("td",null,[e(x,{to:{name:"quote-id",params:{id:z.id}}},{default:t(()=>[e(p,null,{default:t(()=>[e(K,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])])]))),128))])]),_:1})])):(s(),f("div",Ft,w[7]||(w[7]=[l("span",null,"No hay cotizaciones disponibles.",-1)])))]),e(Q,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(x,{to:{name:"quote-add-quote"},class:"text-white"},{default:t(()=>[e(E,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>w[9]||(w[9]=[C(" Generar Cotización ")])),_:1})]),_:1}),e(E,{color:"primary",class:"mx-auto",size:"small",disabled:a(m),loading:a(m),onClick:w[0]||(w[0]=z=>_(o.opportunity.id))},{default:t(()=>w[10]||(w[10]=[C(" Siguiente Etapa ")])),_:1},8,["disabled","loading"])]),_:1}),e(je,{"is-dialog-visible":a(r),"onUpdate:isDialogVisible":w[1]||(w[1]=z=>B(r)?r.value=z:null),"opportunity-kanban":o.opportunity,"onUpdate:newProperty":d},null,8,["is-dialog-visible","opportunity-kanban"])],64)}}},jt=async S=>await re(`/sale/paymentPlans/${S}/confirm`,{method:"PATCH"}),Et=async(S,O)=>await re(`/sale/paymentPlans/${S}`,{method:"PATCH",body:O});function _e(){const S=b(!1),O=b([]),o=b(null),y=b(null);return{loadingPaymentPlans:S,paymentPlan:y,error:o,paymentPlans:O,confirmPaymentPlans:async m=>{try{const r=await jt(m);he("Actualizacion Exitosa","Se confirmo el pago")}catch(r){console.log(r)}},updatePaymentPlans:async(m,r)=>{S.value=!0,o.value=null;try{console.log(r);const v=await Et(m,r);y.value=v.data,Be("¡Planes de pago actualizados exitosamente! ","Los planes de pago han sido modificados y guardados correctamente."),console.log(v)}catch(v){console.log(v),v.response&&v.response.status==422&&Re("Advertencia","Faltan datos por Completar"),o.value=v.message}finally{S.value=!1}}}}const It={__name:"DeliveryForm",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(S,{emit:O}){const o=S,y=O,{changeStatusByOpportunity:q}=le(),A=d=>{y("update:isDialogVisible",d)},m=b(structuredClone(J(o.opportunity)));oe(o,()=>{m.value=structuredClone(J(o.opportunity))});const r=async()=>{y("update:isDialogVisible",!1);try{await q(o.opportunity.id,5,{delivery_date:m.value.sales.delivery_date}),y("updateDeliveryDate",m.value.id)}catch(d){console.error("Error updating customer:",d)}},v=()=>{y("update:isDialogVisible",!1)};return(d,_)=>{const U=ue;return s(),j(pe,{"model-value":o.isDialogVisible,"max-width":"800","onUpdate:modelValue":A},{default:t(()=>[e(U,{onClick:_[0]||(_[0]=V=>d.$emit("update:isDialogVisible",!1))}),e(Y,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(de,{class:"text-h3 text-center"},{default:t(()=>_[2]||(_[2]=[C(" Confirmar Fecha ")])),_:1}),e(Q,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(H,null,{default:t(()=>[e(g,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(ae,{modelValue:a(m).sales.delivery_date,"onUpdate:modelValue":_[1]||(_[1]=V=>a(m).sales.delivery_date=V),label:"Fecha de Entrega",type:"date",rules:["requiredValidator"in d?d.requiredValidator:a(G)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),e(g,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(E,{onClick:r},{default:t(()=>_[3]||(_[3]=[C(" Pasar a Entrega ")])),_:1}),e(E,{color:"secondary",variant:"tonal",onClick:v},{default:t(()=>_[4]||(_[4]=[C(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Tt={key:0},Nt={__name:"PaymentPlanEdit",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},payment:{type:Object,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(S,{emit:O}){const o=S,y=O,{updatePaymentPlans:q}=_e(),A=b(!1),m=n=>{y("update:isDialogVisible",n)},r=b(structuredClone(J(o.payment))),v=b(structuredClone(J(o.opportunity))),d=b([]);oe(o,()=>{r.value=structuredClone(J(o.payment)),v.value=structuredClone(J(o.opportunity))});const _=()=>{d.value.push({amount:"",date:"",type:r.value.type})},U=n=>{d.value.splice(n,1)},V=X(()=>d.value.reduce((n,c)=>{const N=parseFloat(c.amount)||0;return n+N},0)),w=X(()=>d.value.length>0&&d.value.every(n=>n.amount&&n.date&&n.type)),x=X(()=>{if(d.value.length===0)return!0;const n=d.value.reduce((k,P)=>k+(parseFloat(P.amount)||0),0),c=parseFloat(n),N=parseFloat(r.value.amount);return c===N}),p=X(()=>d.value.length===0?!0:w.value&&x.value),z=async()=>{if(!x.value){$e("Validación fallida","La suma de las diferencias no es correcta");return}if(!p.value){alert("Por favor, completa todos los campos obligatorios.");return}A.value=!0;try{await q(r.value.id,{date:r.value.date,differData:d.value})}catch(n){console.error("Error updating customer:",n)}finally{y("updateDeliveryDate",v.value.id),y("update:isDialogVisible",!1),d.value=[],A.value=!1}},T=()=>{y("update:isDialogVisible",!1),d.value=[],errorMessage.value=""};return(n,c)=>{const N=ue;return s(),j(pe,{"model-value":o.isDialogVisible,"max-width":"800","onUpdate:modelValue":m},{default:t(()=>[e(N,{onClick:c[0]||(c[0]=k=>n.$emit("update:isDialogVisible",!1))}),e(Y,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(de,{class:"text-h3 text-center"},{default:t(()=>c[2]||(c[2]=[C(" Editar Pago ")])),_:1}),e(Q,null,{default:t(()=>[e(H,{class:"mx-5"},{default:t(()=>[e(g,{cols:"6"},{default:t(()=>[l("h3",null," Monto a Pagar : $ "+D(a(r).amount),1)]),_:1}),e(g,{cols:"6"},{default:t(()=>[e(ae,{modelValue:a(r).date,"onUpdate:modelValue":c[1]||(c[1]=k=>a(r).date=k),label:"Cambiar Fecha",type:"date",rules:["requiredValidator"in n?n.requiredValidator:a(G)]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(Y,{flat:"",class:"d-flex flex-column pa-5 px-5"},{default:t(()=>[(s(!0),f(I,null,M(a(d),(k,P)=>(s(),f("div",{key:k.id,class:"d-flex align-center my-4"},[e(ae,{modelValue:k.amount,"onUpdate:modelValue":i=>k.amount=i,label:"Monto *",type:"number",class:"mr-4",outlined:"",rules:["requiredValidator"in n?n.requiredValidator:a(G)]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(ae,{modelValue:k.date,"onUpdate:modelValue":i=>k.date=i,label:"Fecha de Pago *",type:"date",class:"mr-3",outlined:"",rules:["requiredValidator"in n?n.requiredValidator:a(G)]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(E,{color:"error",onClick:i=>U(P)},{default:t(()=>[e(K,{icon:"tabler-square-x"})]),_:2},1032,["onClick"])]))),128)),a(d).length>0?(s(),f("div",Tt,[c[3]||(c[3]=l("strong",null,"Monto Restante:",-1)),C(" $"+D((a(r).amount-a(V)).toFixed(2)),1)])):R("",!0),e(E,{color:"primary",variant:"tonal",class:"mt-4",size:"small",onClick:_},{default:t(()=>c[4]||(c[4]=[C(" Diferir Pago ")])),_:1})]),_:1}),e(g,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(E,{loading:a(A),disabled:!a(p)||a(A),onClick:z},{default:t(()=>c[5]||(c[5]=[C(" Guardar ")])),_:1},8,["loading","disabled"]),e(E,{color:"error",variant:"tonal",onClick:T},{default:t(()=>c[6]||(c[6]=[C(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Bt={__name:"SalePaymentPlan",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},salesPayment:{type:Array,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(S,{emit:O}){const o=S,y=O;_e();const q=v=>{y("update:isDialogVisible",v)},A=b(structuredClone(J(o.opportunity)));oe(o,()=>{A.value=structuredClone(J(o.opportunity)),console.log("Sales Payment:",o.salesPayment)});const m=b([]),r=()=>{y("update:isDialogVisible",!1),m.value=[]};return(v,d)=>{const _=ue;return s(),j(pe,{"model-value":o.isDialogVisible,"max-width":"800","onUpdate:modelValue":q},{default:t(()=>[e(_,{onClick:d[0]||(d[0]=U=>v.$emit("update:isDialogVisible",!1))}),e(Y,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(de,{class:"text-h3 text-center"},{default:t(()=>d[1]||(d[1]=[C(" Confirmar Fecha ")])),_:1}),e(Q,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(H,null,{default:t(()=>[e(g,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l("span",null," Monto a Pagar : "+D(a(A)),1)]),_:1})]),_:1})]),_:1}),e(g,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(E,{onClick:v.onFormSubmit},{default:t(()=>d[2]||(d[2]=[C(" Guardar ")])),_:1},8,["onClick"]),e(E,{color:"error",variant:"tonal",onClick:r},{default:t(()=>d[3]||(d[3]=[C(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Rt={class:"text-h6"},Lt={class:"text-h6"},Mt={class:"text-h6"},Ht={class:"my-5"},Gt={key:0},Qt=["src"],Kt={class:"mb-4"},Wt=["onClick"],Jt=["onClick"],Yt={class:"my-5"},Xt={key:0,class:"d-flex flex-wrap gap-2 my-5"},Zt={key:1},el={__name:"EditSaleOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId"],setup(S,{emit:O}){const o=S,y=O,{checkProcessForOpportunity:q}=ce(),{confirmPaymentPlans:A}=_e(),{changeStatusByOpportunity:m,loadingOpportunity:r}=le(),v=b(!1),d=b(!1),_=b(!1),U=b(""),V=X(()=>o.opportunity.sales.reduce((P,i)=>P+i.amount,0)),w=X(()=>o.opportunity.sales.reduce((P,i)=>P+i.initial_fee,0)),x=X(()=>V.value-w.value),p=()=>{_.value=!0},z=P=>{if(P.is_paid===1){$e("Advertencia","No se puede editar un pago ya realizado.");return}console.log("entro aqui"),d.value=!0,U.value={...P}},T=async P=>{y("updateStageId",P)},n=async P=>{console.log(`Procedimiento ${P.id} marcado como: ${P.pivot.is_check?"realizado":"no realizado"}`),await q(o.opportunity.id,P.id,{is_check:!P.pivot.is_check}),P.pivot.is_check=!P.pivot.is_check,y("updateStageId",o.opportunity.id)},c=async P=>{console.log(P),await A(P),y("updateStageId",o.opportunity.id)},N=async P=>{await m(P,5,{}),y("updateStageId",P)},k=async P=>{y("updateStageId",P)};return(P,i)=>(s(),f(I,null,[l("div",null,[e(Y,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(H,null,{default:t(()=>[e(g,{cols:"4",class:"border rounded-sm mx-1"},{default:t(()=>[e(ee,{class:"font-weight-medium"},{default:t(()=>i[5]||(i[5]=[C(" Saldo ")])),_:1}),e(te,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Rt,D(("formatCurrency"in P?P.formatCurrency:a(ye))(a(x))),1)]),_:1})]),_:1}),e(g,{cols:"3",class:"border rounded-sm mx-1"},{default:t(()=>[e(ee,{class:"font-weight-medium"},{default:t(()=>i[6]||(i[6]=[C(" Anticipo ")])),_:1}),e(te,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Lt,D(("formatCurrency"in P?P.formatCurrency:a(ye))(a(w))),1)]),_:1})]),_:1}),e(g,{cols:"4",class:"border rounded-sm mx-1"},{default:t(()=>[e(ee,{class:"font-weight-medium"},{default:t(()=>i[7]||(i[7]=[C(" Precio Final ")])),_:1}),e(te,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Mt,D(("formatCurrency"in P?P.formatCurrency:a(ye))(a(V))),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),l("div",Ht,[i[8]||(i[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Propiedades ",-1)),o.opportunity.sales.length>0?(s(),f("div",Gt,[(s(!0),f(I,null,M(o.opportunity.sales,u=>(s(),f("div",{key:u.id},[(s(!0),f(I,null,M(u.properties,F=>(s(),f("div",{key:F.id,class:"d-flex align-center justify-between"},[e(Ae,{size:"50",rounded:""},{default:t(()=>[l("img",{src:a(xe),alt:"Logo pora",style:{"border-radius":"30%"}},null,8,Qt)]),_:1}),e(g,{cols:"12",md:"7"},{default:t(()=>[e(ee,{class:"font-weight-medium"},{default:t(()=>[C(D(F.project_title)+" | "+D(F.title),1)]),_:2},1024),e(te,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",null,"$ "+D(F.pivot_price),1)]),_:2},1024)]),_:2},1024)]))),128))]))),128))])):R("",!0)]),l("div",Kt,[i[10]||(i[10]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Anticipo ",-1)),o.opportunity.initial_payments&&o.opportunity.initial_payments.length>0?(s(),j(se,{key:0,density:"compact",class:"text-no-wrap my-2",style:{"font-size":"12px"}},{default:t(()=>[i[9]||(i[9]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th",null," Action ")])],-1)),l("tbody",null,[(s(!0),f(I,null,M(o.opportunity.initial_payments,u=>(s(),f("tr",{key:u.id},[l("td",null,D(u.property_title),1),l("td",null,D(u.date),1),l("td",null,D(u.amount),1),l("td",null,[e(H,null,{default:t(()=>[e(fe,{modelValue:u.is_paid,"onUpdate:modelValue":F=>u.is_paid=F,"true-value":1,"false-value":0,disabled:u.is_paid===1,onChange:F=>c(u.id)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"]),u.is_paid===0?(s(),f("div",{key:0,"fill-dot":"",onClick:F=>z(u)},[e(K,{size:"25",icon:"tabler-edit"})],8,Wt)):R("",!0)]),_:2},1024)])]))),128))])]),_:1})):R("",!0)]),l("div",null,[i[13]||(i[13]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Saldos ",-1)),o.opportunity.balance_payments&&o.opportunity.balance_payments.length>0?(s(),j(se,{key:0,density:"compact",class:"text-no-wrap my-2",style:{"font-size":"12px"}},{default:t(()=>[i[12]||(i[12]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th",null," Action ")])],-1)),l("tbody",null,[(s(!0),f(I,null,M(o.opportunity.balance_payments,u=>(s(),f("tr",{key:u.id},[l("td",null,D(u.property_title),1),l("td",null,D(u.date),1),l("td",null,D(u.amount),1),l("td",null,[e(H,null,{default:t(()=>[e(fe,{modelValue:u.is_paid,"onUpdate:modelValue":F=>u.is_paid=F,"true-value":1,"false-value":0,disabled:u.is_paid===1,onChange:F=>c(u.id)},{default:t(()=>[e(Ue,{activator:"parent",location:"top"},{default:t(()=>i[11]||(i[11]=[C(" Confirmar Pago ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"]),u.is_paid===0?(s(),f("div",{key:0,"fill-dot":"",onClick:F=>z(u)},[e(K,{size:"25",icon:"tabler-edit"})],8,Jt)):R("",!0)]),_:2},1024)])]))),128))])]),_:1})):R("",!0)]),l("div",Yt,[i[15]||(i[15]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(s(),f("div",Xt,[(s(!0),f(I,null,M(o.opportunity.procedure,u=>(s(),f("div",{key:u.id},[e(Z,{color:u.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:F=>n(u)},{default:t(()=>[u.pivot.is_check?(s(),j(K,{key:0,icon:"tabler-check",class:"mr-2"})):R("",!0),C(" "+D(u.title),1)]),_:2},1032,["color","onClick"])]))),128))])):(s(),f("div",Zt,i[14]||(i[14]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(Q,{class:"d-flex mt-4"},{default:t(()=>[e(E,{color:"primary",variant:"tonal",class:"mx-auto",size:"small",onClick:p},{default:t(()=>i[16]||(i[16]=[C(" Generar Venta ")])),_:1}),e(E,{color:"primary",class:"mx-auto",size:"small",onClick:i[0]||(i[0]=u=>N(o.opportunity.id))},{default:t(()=>i[17]||(i[17]=[C(" Siguiente Etapa ")])),_:1})]),_:1}),e(It,{"is-dialog-visible":a(v),"onUpdate:isDialogVisible":i[1]||(i[1]=u=>B(v)?v.value=u:null),opportunity:o.opportunity,onUpdateDeliveryDate:k},null,8,["is-dialog-visible","opportunity"]),e(Nt,{"is-dialog-visible":a(d),"onUpdate:isDialogVisible":i[2]||(i[2]=u=>B(d)?d.value=u:null),payment:a(U),opportunity:o.opportunity,onUpdateDeliveryDate:k},null,8,["is-dialog-visible","payment","opportunity"]),e(Pe,{"is-dialog-visible":a(_),"onUpdate:isDialogVisible":i[3]||(i[3]=u=>B(_)?_.value=u:null),opportunity:o.opportunity,stage:"SALE",onRegisterSale:T},null,8,["is-dialog-visible","opportunity"]),e(Bt,{"is-dialog-visible":P.openSaleEditPaymentPlan,"onUpdate:isDialogVisible":i[4]||(i[4]=u=>P.openSaleEditPaymentPlan=u),opportunity:o.opportunity,"sales-payment":P.salePaymentPlan,onUpdateDeliveryDate:k},null,8,["is-dialog-visible","opportunity","sales-payment"])],64))}};const tl={__name:"SellerReport",setup(S){return b([{title:"Actividad 1",date:"2024-10-09",status:"Pendiente"},{title:"Actividad 2",date:"2024-10-10",status:"Completada"},{title:"Actividad 3",date:"2024-10-11",status:"En Progreso"}]),(O,o)=>(s(),j(Q,null,{default:t(()=>o[0]||(o[0]=[l("p",null,"No hay actividades seleccionadas. Aquí tienes un resumen de las actividades:",-1)])),_:1}))}},ll=Fe(tl,[["__scopeId","data-v-c9cbe3f1"]]),ol={__name:"CustomerHistory",props:{isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","userData"],setup(S,{emit:O}){const o=S,y=O,q=b(!1),A=b(),m=b(""),r=b(""),v=b(""),d=b(""),_=b(),U=b(""),V=b(),w=b(),x=b(),p=()=>{y("update:isDrawerOpen",!1),Ve(()=>{var n,c;(n=A.value)==null||n.reset(),(c=A.value)==null||c.resetValidation()})},z=()=>{var n;(n=A.value)==null||n.validate().then(({valid:c})=>{c&&(y("userData",{id:0,fullName:m.value,company:d.value,role:V.value,country:_.value,contact:U.value,email:v.value,currentPlan:w.value,status:x.value,avatar:"",billing:"Auto Debit"}),y("update:isDrawerOpen",!1),Ve(()=>{var N,k;(N=A.value)==null||N.reset(),(k=A.value)==null||k.resetValidation()}))})},T=n=>{y("update:isDrawerOpen",n)};return(n,c)=>{const N=Ke,k=ve,P=ge;return s(),j(Je,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":o.isDrawerOpen,"onUpdate:modelValue":T},{default:t(()=>[e(N,{title:"Historial del Cliente",onCancel:p}),e(a(We),{options:{wheelPropagation:!1}},{default:t(()=>[e(Y,{flat:""},{default:t(()=>[e(Q,null,{default:t(()=>[e(Oe,{ref_key:"refForm",ref:A,modelValue:a(q),"onUpdate:modelValue":c[9]||(c[9]=i=>B(q)?q.value=i:null),onSubmit:Se(z,["prevent"])},{default:t(()=>[e(H,null,{default:t(()=>[e(g,{cols:"12"},{default:t(()=>[e(k,{modelValue:a(m),"onUpdate:modelValue":c[0]||(c[0]=i=>B(m)?m.value=i:null),rules:["requiredValidator"in n?n.requiredValidator:a(G)],label:"Full Name",placeholder:"John Doe"},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(k,{modelValue:a(r),"onUpdate:modelValue":c[1]||(c[1]=i=>B(r)?r.value=i:null),rules:["requiredValidator"in n?n.requiredValidator:a(G)],label:"Username",placeholder:"Johndoe"},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(k,{modelValue:a(v),"onUpdate:modelValue":c[2]||(c[2]=i=>B(v)?v.value=i:null),rules:["requiredValidator"in n?n.requiredValidator:a(G),"emailValidator"in n?n.emailValidator:a(Te)],label:"Email",placeholder:"johndoe@email.com"},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(k,{modelValue:a(d),"onUpdate:modelValue":c[3]||(c[3]=i=>B(d)?d.value=i:null),rules:["requiredValidator"in n?n.requiredValidator:a(G)],label:"Company",placeholder:"PixInvent"},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(P,{modelValue:a(_),"onUpdate:modelValue":c[4]||(c[4]=i=>B(_)?_.value=i:null),label:"Select Country",placeholder:"Select Country",rules:["requiredValidator"in n?n.requiredValidator:a(G)],items:["USA","UK","India","Australia"]},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(k,{modelValue:a(U),"onUpdate:modelValue":c[5]||(c[5]=i=>B(U)?U.value=i:null),type:"number",rules:["requiredValidator"in n?n.requiredValidator:a(G)],label:"Contact",placeholder:"+1-541-754-3010"},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(P,{modelValue:a(V),"onUpdate:modelValue":c[6]||(c[6]=i=>B(V)?V.value=i:null),label:"Select Role",placeholder:"Select Role",rules:["requiredValidator"in n?n.requiredValidator:a(G)],items:["Admin","Author","Editor","Maintainer","Subscriber"]},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(P,{modelValue:a(w),"onUpdate:modelValue":c[7]||(c[7]=i=>B(w)?w.value=i:null),label:"Select Plan",placeholder:"Select Plan",rules:["requiredValidator"in n?n.requiredValidator:a(G)],items:["Basic","Company","Enterprise","Team"]},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(P,{modelValue:a(x),"onUpdate:modelValue":c[8]||(c[8]=i=>B(x)?x.value=i:null),label:"Select Status",placeholder:"Select Status",rules:["requiredValidator"in n?n.requiredValidator:a(G)],items:[{title:"Active",value:"active"},{title:"Inactive",value:"inactive"},{title:"Pending",value:"pending"}]},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(E,{type:"submit",class:"me-3"},{default:t(()=>c[10]||(c[10]=[C(" Submit ")])),_:1}),e(E,{type:"reset",variant:"outlined",color:"secondary",onClick:p},{default:t(()=>c[11]||(c[11]=[C(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},al={class:"mb-2"},il={style:{"font-size":"14px","font-weight":"500"}},nl={style:{"font-size":"12px","font-weight":"500"}},sl={__name:"AddActivity",props:{activitiesData:{type:Object,required:!0,default:()=>({title:"",description:"",schedule_at:""})},isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","refreshActivities"],setup(S,{emit:O}){const o=S,y=O,q=b(!1);b(!1);const A=b("radio-1"),m=b({title:"",description:"",type_activity_id:null,opportunity_id:null,assigned_to:null,scheduled_at:null,status:"COMPLETED"}),{completedActivityAndRegister:r,getallTypeActivities:v,typeActivities:d,loadingActivity:_}=De(),{getOpportunitybyId:U,opportunity:V}=le(),w=b(structuredClone(J(o.activitiesData))),x=i=>{console.log("esta consultando de nuevo despues de cambiar etapa "),U(i)};oe(o,()=>{w.value=structuredClone(J(o.activitiesData)),U(w.value.opportunity_id),p()});const p=async()=>{await v()},z=()=>{U(w.value.opportunity_id)},T=()=>{y("update:isDrawerOpen",!1),m.value={title:null,description:null,type_activity_id:null,scheduled_at:null,opportunity_id:null,assigned_to:null,status:"COMPLETED"},y("refreshActivities")},n=async()=>{let i="";A.value==="radio-1"?i="COMPLETED":A.value==="radio-2"&&(i="CANCELLED"),r(w.value.id,{title:m.value.title,description:m.value.description,type_activity_id:m.value.type_activity_id,scheduled_at:m.value.scheduled_at,assigned_to:V.value.user_id,property_id:V.value.property_id,opportunity_id:V.value.id,status:i}),T()},c=async()=>{be.fire({title:"Quieres dar de baja al cliente ?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"confirmar"}).then(i=>{i.isConfirmed&&(Ie(w.value.id),T(),be.fire({text:"EL cliente fue dado de baja",icon:"success"}))})},N=async()=>{y("update:isDrawerOpen",!1),y("refreshActivities")},k=()=>{console.log("Se escucho el evento en AddActivity"),y("refreshActivities")},P=i=>{const u=new Date(i),F=u.getDate(),W=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][u.getMonth()],$=u.getHours().toString().padStart(2,"0"),L=u.getMinutes().toString().padStart(2,"0");return`${F} de ${W}, ${$}:${L}`};return(i,u)=>{const F=ve,h=Ne,W=Ce;return s(),j(H,{class:"d-flex justify-space-between"},{default:t(()=>[e(g,{cols:"12"},{default:t(()=>[S.isDrawerOpen?(s(),j(Y,{key:0},{default:t(()=>[e(Q,null,{default:t(()=>[e(qe,{class:"mx-2 my-2"},{default:t(()=>[e(H,null,{default:t(()=>[e(g,{cols:"12",sm:"5"},{default:t(()=>[e(H,null,{default:t(()=>[e(g,{cols:"12"},{default:t(()=>u[6]||(u[6]=[l("span",{style:{"font-size":"18px","font-weight":"500"}}," Actividad ",-1)])),_:1}),e(g,{cols:"12"},{default:t(()=>[l("div",al,[l("span",il,D(o.activitiesData.title)+" • "+D(P(o.activitiesData.scheduled_at)),1),u[7]||(u[7]=l("br",null,null,-1)),l("span",nl,D(o.activitiesData.description),1)]),e(Xe,{modelValue:a(A),"onUpdate:modelValue":u[0]||(u[0]=$=>B(A)?A.value=$:null),style:{"font-size":"14px"},inline:""},{default:t(()=>[u[8]||(u[8]=l("span",{class:"my-1"}," ¿Se realizó? ",-1)),e(we,{label:"Si",value:"radio-1",density:"compact",class:"mx-2"}),e(we,{label:"No",value:"radio-2",class:"mx-2",density:"compact"})]),_:1},8,["modelValue"]),e(Ze,{class:"mt-2"})]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(F,{modelValue:a(m).title,"onUpdate:modelValue":u[1]||(u[1]=$=>a(m).title=$),label:"Título de la actividad",placeholder:"..."},null,8,["modelValue"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(ge,{modelValue:a(m).type_activity_id,"onUpdate:modelValue":u[2]||(u[2]=$=>a(m).type_activity_id=$),label:"Tipo de actividad",placeholder:"Selecciona el tipo de actividad",items:a(d).map($=>({title:$.name,value:$.id}))},null,8,["modelValue","items"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(h,{modelValue:a(m).scheduled_at,"onUpdate:modelValue":u[3]||(u[3]=$=>a(m).scheduled_at=$),label:"Seleccione la fecha y hora",placeholder:"Seleccione la fecha y hora",config:{enableTime:!0,dateFormat:"Y-m-d H:i"},rules:["requiredValidator"in i?i.requiredValidator:a(G)]},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(W,{modelValue:a(m).description,"onUpdate:modelValue":u[4]||(u[4]=$=>a(m).description=$),label:"Descripción",rows:"3",rules:["requiredValidator"in i?i.requiredValidator:a(G)]},null,8,["modelValue","rules"])]),_:1}),e(g,null,{default:t(()=>[e(E,{color:"primary",class:"mx-auto",size:"small",loading:a(_),disabled:a(_),onClick:n},{default:t(()=>u[9]||(u[9]=[C(" Crear Actividad ")])),_:1},8,["loading","disabled"]),e(E,{color:"primary",class:"mx-1",variant:"tonal",size:"small",onClick:c},{default:t(()=>u[10]||(u[10]=[C(" Dar de Baja ")])),_:1})]),_:1})]),_:1})]),_:1}),e(g,{cols:"12",sm:"7",style:{"align-items":"center"}},{default:t(()=>[e(H,{class:"mb-2"},{default:t(()=>[e(g,{cols:"6"},{default:t(()=>u[11]||(u[11]=[l("span",{style:{"font-size":"18px","font-weight":"500"}}," Etapa ",-1)])),_:1}),e(g,{cols:"12",md:"6",class:"d-flex justify-end align-center"},{default:t(()=>[e(Z,{label:"",color:"primary"},{default:t(()=>[C(D(a(V).stage.title),1)]),_:1})]),_:1})]),_:1}),a(V).stage_id===2?(s(),j(qt,{key:0,opportunity:a(V),onUpdateStageId:x,"onUpdate:newProperty":k},null,8,["opportunity"])):R("",!0),a(V).stage_id===3?(s(),j(kt,{key:1,opportunity:a(V),onUpdateStageId:x,"onUpdate:newProperty":k},null,8,["opportunity"])):R("",!0),a(V).stage_id===4?(s(),j(el,{key:2,opportunity:a(V),onRefreshActivities:z,onUpdateStageId:x},null,8,["opportunity"])):R("",!0),a(V).stage_id===5?(s(),j(pt,{key:3,opportunity:a(V),onRefreshActivities:z,onUpdateStageId:x,onComplet:N},null,8,["opportunity"])):R("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):(s(),j(Y,{key:1,title:"Reporte de Actividades"},{default:t(()=>[e(ll)]),_:1}))]),_:1}),e(g,{cols:"12",md:"6"},{default:t(()=>[e(ol,{"is-drawer-open":a(q),"onUpdate:isDrawerOpen":u[5]||(u[5]=$=>B(q)?q.value=$:null)},null,8,["is-drawer-open"])]),_:1})]),_:1})}}};const rl={class:"mt-2 mx-3"},ul={style:{"font-size":"14px"}},dl={key:0,class:"no-activities-message d-flex flex-column justify-center align-center",style:{"min-block-size":"200px","text-align":"center"}},pl=["onClick"],cl={class:"mx-2"},ml={class:"d-flex justify-content-between",style:{"font-size":"0.9em"}},yl={__name:"list",setup(S){const O=b(""),o=b("Anteriores");b(["Todos","PORA"]),b("Todos");const{getallActivitiesByAsesorFecha:y,getallActivitiesByFechaPast:q,getallActivitiesByFechaFuture:A,activities:m,activitiesPast:r,activitiesFuture:v}=De(),d=b(""),_=Le("userData").value,U=b(!0),V=b([]),w=b([]),x=b([]),p=async()=>{await y(_.id),V.value=m.value},z=async()=>{await q(_.id),w.value=r.value},T=async()=>{await A(_.id),x.value=v.value};Me(async()=>{await p(),await z(),await T(),U.value=!1});const n=b(!1),c=F=>{n.value=!0,d.value={...F}},N=async()=>{U.value=!0,await p(),await z(),await T(),U.value=!1},k=X(()=>[{tabName:"Anteriores",icon:"tabler-calendar",actividades:w,badge:w.value.length},{tabName:"Hoy",icon:"tabler-edit",actividades:V,badge:V.value.length},{tabName:"Futuros",icon:"tabler-calendar",actividades:x,badge:x.value.length}]),P=[{type:"Visita",icon:"tabler-current-location"},{type:"Llamada",icon:"tabler-phone"},{type:"Cotizacion",icon:"tabler-cash"},{type:"Otro",icon:"tabler-table"}],i=F=>{const h=P.find(W=>W.type===F);return h?h.icon:"tabler-default"},u=F=>{const h=new Date(F),W=h.getDate(),L=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][h.getMonth()],ne=h.getHours().toString().padStart(2,"0"),Ee=h.getMinutes().toString().padStart(2,"0");return`${W} de ${L}, ${ne}:${Ee}`};return oe(O,F=>{const h=W=>W.filter($=>{const L=$.name_opportunity.toLowerCase().includes(F.toLowerCase()),ne=$.phone_opportunity.toLowerCase().includes(F.toLowerCase());return L||ne});F.length>2?(V.value=h(m.value),w.value=h(r.value),x.value=h(v.value)):(V.value=m.value,w.value=r.value,x.value=v.value)}),(F,h)=>{const W=ie("VCircularProgress");return s(),j(H,{class:"match-height",style:{display:"flex","block-size":"100vh"}},{default:t(()=>[e(g,{cols:"12",md:"4",style:{display:"flex","flex-direction":"column"}},{default:t(()=>[e(Y,{class:"flex-grow-1"},{default:t(()=>[e(de,{class:"d-flex justify-between align-center flex-wrap"},{default:t(()=>[h[5]||(h[5]=l("h4",{class:"mt-5"}," Mis Actividades ",-1)),l("div",rl,[e(ae,{modelValue:O.value,"onUpdate:modelValue":h[0]||(h[0]=$=>O.value=$),placeholder:"Buscar actividad...",class:"search-field",variant:"plain","hide-details":"",dense:"","prepend-inner-icon":"tabler-search"},null,8,["modelValue"])])]),_:1}),e(et,{modelValue:o.value,"onUpdate:modelValue":h[1]||(h[1]=$=>o.value=$),grow:""},{default:t(()=>[(s(!0),f(I,null,M(k.value,$=>(s(),j(tt,{key:$.tabName},{default:t(()=>[l("span",ul,D($.tabName),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),h[11]||(h[11]=l("br",null,null,-1)),e(Q,{style:{"flex-grow":"1","overflow-y":"auto"}},{default:t(()=>[U.value?(s(),j(lt,{key:0,absolute:"",opacity:"0.7"},{default:t(()=>[e(W,{indeterminate:"",size:"70"})]),_:1})):R("",!0),e(qe,{modelValue:o.value,"onUpdate:modelValue":h[2]||(h[2]=$=>o.value=$),class:"disable-tab-transition",style:{"max-block-size":"500px","overflow-y":"auto"}},{default:t(()=>[(s(!0),f(I,null,M(k.value,$=>(s(),j(Ye,{key:$.tabName,value:$.tabName},{default:t(()=>[$.actividades.value.length===0?(s(),f("div",dl,[e(K,{size:"64",color:"grey",icon:"tabler-calendar-off",class:"mb-4",style:{animation:"bounce 1s infinite"}}),h[6]||(h[6]=l("div",{style:{color:"#888","font-size":"1.2em"}}," ¡No tienes actividades pendientes! ",-1)),h[7]||(h[7]=l("div",{style:{color:"#aaa","font-size":"0.9em","margin-block-start":"8px"}}," ¡Relájate y disfruta tu día! ",-1))])):(s(!0),f(I,{key:1},M($.actividades.value,L=>(s(),f("div",{key:L.id,"fill-dot":"",class:"border mb-2 rounded-sm py-2",onClick:ne=>c(L)},[e(me,null,{default:t(()=>[e(H,null,{default:t(()=>[e(g,{cols:"12",md:"2",style:{"padding-inline-end":"0"}},{default:t(()=>[e(Z,{class:"d-flex justify-center align-center",style:{display:"inline-flex","border-radius":"4px","block-size":"36px","inline-size":"36px"}},{default:t(()=>[e(K,{size:"25",icon:"tabler-home"})]),_:1})]),_:1}),L.project_name?(s(),j(g,{key:0,cols:"12",md:"5",class:"d-flex flex-column align-start",style:{"padding-inline-start":"0"}},{default:t(()=>[e(te,{class:"text-left"},{default:t(()=>[l("strong",null,D(L.property_title),1)]),_:2},1024),e(ee,{class:"font-weight-medium text-left"},{default:t(()=>[l("span",null,"$ "+D(L.price),1)]),_:2},1024)]),_:2},1024)):R("",!0),L.project_name?R("",!0):(s(),j(g,{key:1,cols:"12",md:"5"},{default:t(()=>[e(te,{class:"text-left"},{default:t(()=>h[8]||(h[8]=[l("strong",null," Departamento ",-1)])),_:1}),e(ee,{class:"font-weight-medium text-left"},{default:t(()=>h[9]||(h[9]=[l("span",null,"Indefinido",-1)])),_:1})]),_:1})),e(g,{cols:"12",md:"5",class:"d-flex justify-end align-center"},{default:t(()=>[e(Z,{label:"",color:"primary",class:"ml-auto",style:{"font-size":"10px"}},{default:t(()=>[C(D(L.stage),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(me,{class:""},{default:t(()=>[e(Z,{label:"",color:"secondary",class:"w-100 h-48"},{default:t(()=>[e(K,{size:"20",icon:i(L.type_activity)},null,8,["icon"]),l("div",cl,D(L.type_activity)+"   •   "+D(L.name_opportunity),1)]),_:2},1024)]),_:2},1024),e(me,null,{default:t(()=>[l("div",ml,[h[10]||(h[10]=l("div",{style:{"flex-grow":"1"}}," Ver ",-1)),l("div",null,D(u(L.scheduled_at)),1)])]),_:2},1024)],8,pl))),128))]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(g,{cols:"12",md:"8",style:{display:"flex","flex-direction":"column"}},{default:t(()=>[e(sl,{"is-drawer-open":n.value,"onUpdate:isDrawerOpen":h[3]||(h[3]=$=>n.value=$),"activities-data":d.value,class:"flex-grow-1",onRefreshActivities:N,onLoaded:h[4]||(h[4]=$=>U.value=!1)},null,8,["is-drawer-open","activities-data"])]),_:1})]),_:1})}}},Po=Fe(yl,[["__scopeId","data-v-9195a066"]]);export{Po as default};
