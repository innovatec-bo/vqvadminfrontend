import{$ as r}from"./api-40e7a553.js";import{a as i,s as g,e as l,c as v}from"./notifications-b6da0b75.js";import{r as o,k as S}from"./index-eea64eab.js";const h=async e=>await r("/sale",{method:"POST",body:e}),m=async e=>await r("/sale/changeStage",{method:"POST",body:e}),y=async e=>await r(`/sale/${e}`,{method:"GET"}),w=async e=>await r(`/sale/${e}/status/signature`,{method:"PATCH"}),b=async e=>await r(`/sale/${e}/discard`,{method:"PATCH"}),E=async()=>await r("/export/sale",{method:"GET"}),x=async e=>await r("sales/list-paginated",{method:"GET",params:e});function V(){const e=o(!1),c=o([]),u=o(0),p=o(null),f=S(),s=o(null);return{loadingSale:e,sales:c,error:p,sale:s,totalSales:u,generateSale:async t=>{e.value=!0;try{const a=await h(t);v("Venta generada con Exito","Se registro una nueva venta"),console.log("venta: ",a),s.value=a.data,f.push(`/sale/${s.value.id}`)}catch(a){return a.response&&a.response.status==422?(g("Validación fallida","Faltan datos por rellenar"),{success:!1,message:"Validación fallida"}):(l("Error al crear la venta","Hubo un problema al crear la venta."),{success:!1,message:"Error de actualización"})}finally{e.value=!1}},generateSaleChangeStage:async t=>{e.value=!0;try{const a=await m(t);i("Creacion Exitosa","La venta ha sido creada correctamente."),console.log("venta: ",a),s.value=a.data}catch(a){return console.log(a),a.response&&a.response.status==422?(g("Validación fallida","Faltan datos por rellenar"),{success:!1,message:"Validación fallida"}):(l("Error al crear la venta","Hubo un problema al crear la venta."),{success:!1,message:"Error de actualización"})}finally{e.value=!1}},getSalebyId:async t=>{e.value=!0;try{const a=await y(t);console.log(a.data),s.value=a.data}catch(a){console.log(a)}finally{e.value=!1}},AllSalesPaginated:async t=>{e.value=!0;try{const a=await x(t);c.value=a.data.data,console.log(c),u.value=a.data.total}catch(a){console.log(a)}finally{e.value=!1}},SaleChangeStageDiscard:async t=>{e.value=!0;try{const a=await b(t);i("Actualizacion Exitosa","La venta fue descartada"),console.log("venta: ",a),s.value=a.data}catch(a){return console.log(a),a.response&&a.response.status==422,l("Error","Hubo un problema al actualizar la venta."),{success:!1,message:"Error de actualización"}}finally{e.value=!1}},SaleChangeSignature:async t=>{e.value=!0;try{const a=await w(t);i("Actualizacion Exitosa","La venta fue actualizada"),console.log("venta: ",a),s.value=a.data}catch(a){return console.log(a),a.response&&a.response.status==422,l("Error","Hubo un problema al actualizar la venta."),{success:!1,message:"Error de actualización"}}finally{e.value=!1}},exportSaleExcel:async()=>{try{const t=await E();if(!(t instanceof Blob))throw new Error("Respuesta inválida del servidor con el BLOB");const a=new Blob([t],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=window.URL.createObjectURL(a),n=document.createElement("a");n.href=d,n.setAttribute("download","ventas.xlsx"),document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(d),document.body.removeChild(n)}catch(t){console.error("Error en exportación:",t)}}}}export{V as u};
