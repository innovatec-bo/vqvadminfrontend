import{r as S,e as D}from"./validators-dea6e3a5.js";import{r as d,k as N,ac as w,ab as O,o as $,f as z,e as u,b as l,d as p,n as t,J as F,I as x,v as U,x as q,a3 as M,a4 as E}from"./index-71bee35f.js";import{_ as J}from"./AppTextField-4420a89d.js";import{$ as k}from"./api-c3bdf505.js";import{b}from"./notifications-81bc0416.js";import{u as I}from"./useGenerateImageVariant-5bed320e.js";import{a as G,b as W,c as H,d as K}from"./auth-v2-login-illustration-light-19d5c0bb.js";import{a as Q,b as X}from"./misc-mask-light-1aeffaee.js";import{V as Y}from"./VNodeRenderer-b4233720.js";import{V as Z}from"./VImg-5084c32c.js";import{V}from"./VCol-853b67d0.js";import{V as ee}from"./VCard-b8681547.js";import{V as C}from"./VCardText-b305c2f2.js";import{V as ae}from"./VForm-05d304ed.js";import{V as B}from"./VRow-81e18c3c.js";import"./helpers-61e4df1a.js";import"./form-ba4edcb0.js";import"./VTextField-4c9fa01e.js";/* empty css                   */import"./VCounter-31e541ce.js";import"./VField-c32aa456.js";import"./easing-9f15041e.js";import"./VInput-fb179cc9.js";import"./forwardRefs-8348545e.js";import"./index-9c720871.js";import"./constants-ca8ca994.js";import"./VAvatar-5ed8382b.js";const se="/assets/postPora-d216cd12.png",te=async n=>await k("/authen/login",{method:"POST",body:n}),oe=async n=>k("/authen/forgot-password",{method:"POST",body:n}),re=async n=>k("/authen/reset-password",{method:"PUT",body:n}),le=async(n,c)=>k(`/authen/verify-token/${n}/${c}`,{method:"GET"});function ne(){const n=d(null),c=d(!1),o=d(!1),r=d(null),f=N(),h=w("accessToken");let g=O();return{user:n,isAuthenticated:c,loading:o,error:r,loginUser:async s=>{o.value=!0;try{const e=await te(s);if(console.log("Login successful:",e),e.status==403){b("",e._data.message);return}if(e.status==401){b("",e._data.message);return}const m=Object.fromEntries(Object.entries(e.data));let y=[{action:"manage",subject:"all"}];if(e.data.roles.forEach(j=>{y.push({action:"manage",subject:j})}),w("userAbilityRules").value=y,g.update(y),w("userData").value=m,w("accessToken").value=e.meta.accessToken,(m.roles||[]).includes("ADMINISTRADOR")){f.push("/dashboards/crm");return}f.push("/activity/list")}catch(e){console.log(e),e.response&&e.response._data?(console.log(e.response._data.message),b("Advertencia",e.response._data.message)):b("Advertencia","An error occurred while logging in")}finally{o.value=!1}},logoutUser:async()=>{o.value=!0,r.value=null;try{await logout(),n.value=null,c.value=!1,h.value=null,f.push("/login")}catch(s){r.value="Logout failed: "+s.message}finally{o.value=!1}},resetUserPassword:async s=>{o.value=!0,r.value=null;try{const e=await re(s);console.log(e),await f.push("/login")}catch(e){console.log(e),r.value="Password reset failed: "+e.message}finally{o.value=!1}},changeUserPassword:async s=>{o.value=!0,r.value=null;try{await changePassword(s)}catch(e){r.value="Password reset failed: "+e.message}finally{o.value=!1}},forgotUserPassword:async s=>{o.value=!0,r.value=null;try{await oe({email:s}),f.push({name:"auth-two-steps",params:{mail:s}})}catch(e){r.value="Password reset failed: "+e.message}finally{o.value=!1}},verifyCodResetPassword:async(s,e)=>{o.value=!0,r.value=null;try{const m=await le(s,e),y={id:m.data.id,username:m.data.username,email:m.data.email,token:s},L=JSON.stringify(y),R=encodeURIComponent(L);f.push({name:"auth-reset-password",params:{user:R}})}catch(m){r.value="Password reset failed: "+m.message,console.log(m)}finally{o.value=!1}},checkAuthenticationStatus:async()=>{o.value=!0,r.value=null;try{const s=await checkAuthStatus();n.value=s.data.user,c.value=!0}catch(s){r.value="Auth status check failed: "+s.message,c.value=!1}finally{o.value=!1}}}}const ie={class:"text-h4 mb-1"},ue={class:"text-capitalize"},Ne={__name:"login",setup(n){const c=d(!1);I(K,H,W,G,!0);const o=I(X,Q),r=i=>i.length>=8||"La contraseña debe tener al menos 8 caracteres",{loginUser:f,loading:h}=ne(),g=d(!1),P=d(),A=d({email:void 0,password:void 0}),v=d({email:"admin@canzza.com",password:"admin"});d(!1);const _=async()=>{c.value=!0,await f(v.value),c.value=!1},T=()=>{var i;(i=P.value)==null||i.validate().then(({valid:a})=>{a&&_()})};return(i,a)=>{const s=J;return $(),z(B,{"no-gutters":"",class:"auth-wrapper bg-surface"},{default:u(()=>[l(V,{lg:"8",class:"d-none d-lg-flex"},{default:u(()=>[p("div",{class:"position-relative bg-background rounded-lg w-100 ma-8 me-0",style:F({backgroundImage:`url(${t(se)})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",height:"100%",width:"100%"})},[a[3]||(a[3]=p("div",{class:"d-flex align-center justify-center",style:{position:"absolute","z-index":"1","inset-block":"0 0","inset-inline":"0 0"}},null,-1)),l(Z,{src:t(o),class:"auth-footer-mask"},null,8,["src"])],4)]),_:1}),l(V,{cols:"12",lg:"4",class:"auth-card-v2 d-flex align-center justify-center"},{default:u(()=>[l(ee,{flat:"","max-width":500,class:"mt-12 mt-sm-0 pa-4"},{default:u(()=>[l(C,null,{default:u(()=>[l(t(Y),{nodes:t(x).app.logo,class:"mb-6"},null,8,["nodes"]),p("h4",ie,[a[4]||(a[4]=U(" Bienvenido a ")),a[5]||(a[5]=p("br",null,null,-1)),a[6]||(a[6]=U()),p("span",ue,q(t(x).app.title),1)])]),_:1}),l(C,null,{default:u(()=>[l(t(ae),{ref_key:"refVForm",ref:P,onSubmit:M(T,["prevent"])},{default:u(()=>[l(B,null,{default:u(()=>[l(V,{cols:"12"},{default:u(()=>[l(s,{modelValue:t(v).email,"onUpdate:modelValue":a[0]||(a[0]=e=>t(v).email=e),label:"Email",placeholder:"johndoe@email.com",type:"email",autofocus:"",rules:["requiredValidator"in i?i.requiredValidator:t(S),"emailValidator"in i?i.emailValidator:t(D)],"error-messages":t(A).email},null,8,["modelValue","rules","error-messages"])]),_:1}),l(V,{cols:"12"},{default:u(()=>[l(s,{modelValue:t(v).password,"onUpdate:modelValue":a[1]||(a[1]=e=>t(v).password=e),label:"Password",placeholder:"············",rules:["requiredValidator"in i?i.requiredValidator:t(S),r],type:t(g)?"text":"password","error-messages":t(A).password,"append-inner-icon":t(g)?"tabler-eye-off":"tabler-eye","onClick:appendInner":a[2]||(a[2]=e=>g.value=!t(g))},null,8,["modelValue","rules","type","error-messages","append-inner-icon"]),a[8]||(a[8]=p("div",{class:"d-flex align-center flex-wrap justify-space-between mt-1 mb-4"},null,-1)),a[9]||(a[9]=p("br",null,null,-1)),l(E,{block:"",type:"submit",disabled:t(h),loading:t(h)},{default:u(()=>a[7]||(a[7]=[U(" Login ")])),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})}}};export{Ne as default};
