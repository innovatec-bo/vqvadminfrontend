import{r as y,ac as W,H as X,o as k,f as P,e as t,d as m,c as ee,F as ae,i as le,b as e,n as l,a2 as oe,w as te,a as se,I as z,x as ne,v as j,a4 as re,a0 as ie}from"./index-ab8b25a0.js";import{$ as w}from"./api-4b037e27.js";import{a as O,b as de,s as ue,c as H,d as Y}from"./notifications-9301c65a.js";import{r as A}from"./validators-dea6e3a5.js";import{_ as ce}from"./AppTextarea-02ab8922.js";import{_ as Q}from"./AppSelect-4c2b73bd.js";import{_ as J}from"./AppTextField-3485eb39.js";import{_ as pe}from"./DialogCloseBtn-89a3fefd.js";import{P as K,a as me,_ as M}from"./InvoiceAddMoney-47546044.js";import{V as fe}from"./VNodeRenderer-537147ed.js";import{u as ge}from"./useProperty-c47e1e0a.js";import{V as x,a as c}from"./VRow-b1465082.js";import{V as G}from"./VCard-833a177d.js";import{V as T}from"./VCardText-7fa4e63b.js";import{V as C}from"./VDivider-c8e4f766.js";import{V as ye}from"./VDialog-d2a51f25.js";const Ge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANCSURBVHgB7VZJT1NRFP5e+9pSCrSFUgUUlLGCCCIyBCISNcGFaEKICcaERBbyB3TjgpVLE2MiC4lRlyYaNSIhKooiKAqUQZAZUlpmKHOHV+q9FylUINGFsnlfmrzzes859zvfOTfvcoXXC93YRUiwyxAJiAREAiIBHv8QSoUSxXlFXv/VtTWgfbDz/xCgaO5p9Xq3TI95vXsI6DXBKL1QApfLhVX3KuaX5tHUY0TD90a2Hrs/GunxaYgJi4RDcKJrqBtVjdWI2BOOi7kFqKh8iIKcfOjUOrxr+YCa5lpkxKfiUIQB/eYBuMEhwNcf3aZeLwLShOyEMmqofFTISzuNW4/voHPoB8JJ4jOpudD4qTFKWBefLUL5swoYe1uZ78mj2Wyz8dkJZCVmEDsItcZP0Gt1SIo+ApvdhvPZ51D+/B46iOT9lgEYIuKIbyYau75tVWAdGn8tekf6cP/VI1zNv4LMhHTMETUEwQXXqgszC1Y8/fgCYcGhiCOqNPU0s7iX9VUYnjBhZMqMIP9A2Jw23H5yF0q5D9INqbALDlZM7L4oqFUBLCfFllOQdTjdY79pes+edocdoboQUlmiZ63WWAfBtQr3r4/5mHWCPWfmZ9Fr7odUwqM0vwQpscloG+yAsa8NS7alNdmlUk+eLQRowKmUHCbz3kA96+fX7hZYF2bJRF9CTnI2WfMlCoSgrr3eEycIgleezITjUCl98ZbMwgppxx6tHn5K1e/bec/AiaQsVH15jRgiU/wBA2G8jMrP1bA77Wgd6ICCVyAy9CAbSMvUKGpaalk1Mp5nR8vt3rjbWKZHERQQSIY2CjwvhVwmx/CYidnGvnai3hphbv1GpNcG48blayh7cJPJuB38yRTTQFqJw+mEr8IHApkLakskEtgcNo8vL+UZMVo97bmTnBx6unzkCjLU4xt+6wbtM+0TDdgJx0h7OI5jJKg6bpJwybYCQ3g0zJOjCAzQwjRhJv2XQO2nYS20Ls6RwVajx9TH1i3EbzO4v7kTBmt0WFxZhISTsEo8ZDn641iFfqSV88uLrG1ymYypo5Ap1twI+c0qeSnwJ5i0TnlsqsB22Kwg3ZyCktkJ4tdQJCASEAmIBH4Cka1P8RSIn3sAAAAASUVORK5CYII=",ve=async s=>await w(`/opportunity/kanban/${s}`,{method:"GET"}),Ve=async s=>await w(`/opportunity/get-opportunity/${s}`,{method:"GET"}),be=async(s,v)=>await w(`/opportunity/convert-prospect/${s}`,{method:"PATCH",body:v}),Ae=async(s,v)=>await w(`/opportunity/update/${s}`,{method:"PATCH",body:v}),_e=async(s,v,f)=>await w(`/opportunity/${s}/stage/${v}`,{method:"PATCH",body:f});function Ze(){const s=y(!1),v=y(null),f=W("userData").value,p=y({description:"",customer:{name:"",email:"",phone:"",ci:""},stage:{id:"",name:"",description:""},property:{id:"",title:"",code:"",description:""}}),h=y(null);return{loadingOpportunity:s,error:v,opportunity:p,kanban:h,allOpportunityKanbanForUser:async()=>{try{const r=await ve(f.id);h.value=r.data,console.log(h)}catch(r){console.error(r)}},changeStatusByOpportunity:async(r,g,d)=>{s.value=!0;try{const b=await _e(r,g,d);console.log("Oportunidad actualizada: ",b),p.value=b.data,O("¡Oportunidad avanzó a una nueva etapa!","La oportunidad ha avanzado exitosamente a la siguiente fase.")}catch(b){console.log(b),b.response&&b.response.status==500&&de("Advertencia",b.response._data.message)}finally{s.value=!1}},getOpportunitybyId:async r=>{try{const g=await Ve(r);p.value=g.data,console.log("esta es la oportunidad: ",p.value)}catch(g){console.error(g)}},changeOpportunity:async(r,g)=>{s.value=!0;try{const d=await Ae(r,g);p.value=d.data,console.log("Oportunidad actualizada: ",p.value),O("Oportunidad actualizada correctamente","Los detalles de la oportunidad han sido modificados.")}catch(d){v.value=d,console.error(d)}finally{s.value=!1}},generateProspect:async(r,g)=>{try{const d=await be(r,g);console.log(d),p.value=d.data}catch(d){console.error(d)}finally{}}}}const he={LEAD:{value:1,label:"LEAD"},PROSPECT:{value:2,label:"PROSPECTO"},PRESALE:{value:3,label:"PRE-VENTA"},SALE:{value:4,label:"VENTA"},DELIVERY:{value:5,label:"ENTREGA"},LOSS:{value:6,label:"PERDIDA"}},Se=async s=>await w("/sale",{method:"POST",body:s}),Ce=async s=>await w("/sale/changeStage",{method:"POST",body:s});function we(){const s=y(!1),v=y([]),f=y(null),p=y(null);return{loadingSale:s,sales:v,error:f,sale:p,generateSale:async _=>{s.value=!0;try{const n=await Se(_);O("Venta generada con Exito","Se registro una nueva venta"),console.log("venta: ",n),p.value=n.data}catch(n){return n.response&&n.response.status==422?(H("Validación fallida","Faltan datos por rellenar"),{success:!1,message:"Validación fallida"}):(Y("Error al crear la venta","Hubo un problema al crear la venta."),{success:!1,message:"Error de actualización"})}finally{s.value=!1}},generateSaleChangeStage:async _=>{s.value=!0;try{const n=await Ce(_);ue("Creacion Exitosa","La venta ha sido creada correctamente."),console.log("venta: ",n),p.value=n.data}catch(n){return console.log(n),n.response&&n.response.status==422?(H("Validación fallida","Faltan datos por rellenar"),{success:!1,message:"Validación fallida"}):(Y("Error al crear la venta","Hubo un problema al crear la venta."),{success:!1,message:"Error de actualización"})}finally{s.value=!1}}}}const Ee={class:"pa-5 flex-grow-1"},Te={__name:"InvoiceAddPropertySale",props:{propertiesform:{type:Array,required:!0}},emits:["totalAmount"],setup(s,{emit:v}){const f=s,{allProperty:p,properties:h}=ge(),I=y(100),_=y(1);return X(async()=>{try{p({itemsPerPage:I.value,page:_.value})}catch(n){console.error("Error al obtener las propiedades:",n)}}),(n,a)=>{const E=J;return k(),P(G,{flat:"",border:"",class:"d-flex flex-row"},{default:t(()=>[m("div",Ee,[(k(!0),ee(ae,null,le(f.propertiesform,(r,g)=>(k(),P(x,{key:g},{default:t(()=>[e(c,{cols:"12",sm:"4",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(Q,{modelValue:r.property_id,"onUpdate:modelValue":d=>r.property_id=d,label:r.property_type_name,rules:["requiredValidator"in n?n.requiredValidator:l(A)],placeholder:"Selecciona una propiedad",items:l(h),"item-title":"title","item-value":"id",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","label","rules","items"])]),_:2},1024),e(c,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(E,{modelValue:r.price,"onUpdate:modelValue":d=>r.price=d,rules:["requiredValidator"in n?n.requiredValidator:l(A)],label:"Precio",placeholder:"$",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(c,{cols:"12",sm:"2",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(E,{modelValue:r.price_it,"onUpdate:modelValue":d=>r.price_it=d,rules:["requiredValidator"in n?n.requiredValidator:l(A)],label:"3% (IT):",placeholder:"%",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(c,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(E,{modelValue:r.price_contrato,"onUpdate:modelValue":d=>r.price_contrato=d,rules:["requiredValidator"in n?n.requiredValidator:l(A)],label:"Precio Contrato:",placeholder:"Escribe el precio",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024)]),_:2},1024))),128))])]),_:1})}}};const Ie={class:"ma-sm-4"},Ue={class:"d-flex align-center mb-6"},ke={class:"font-weight-bold text-capitalize text-h4"},xe={class:"mt-4 ma-sm-4"},Pe={class:"d-flex align-center font-weight-medium justify-sm-end text-xl mb-3"},$e={__name:"PreSaleForm",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},typeStage:{type:String,required:!0}},emits:["update:isDialogVisible","registerSale"],setup(s,{emit:v}){var D,B,F,R,L;const f=s,p=v,{generateSale:h,generateSaleChangeStage:I}=we();y(!1);const _=i=>{p("update:isDialogVisible",i)},n=y(!1),a=y({social_reason:((D=f.opportunity)==null?void 0:D.customer.name)??"",nit:"",address:"",email:((B=f.opportunity)==null?void 0:B.customer.email)??"",phone:((F=f.opportunity)==null?void 0:F.customer.phone)??"",workplace:((R=f.opportunity)==null?void 0:R.customer.workplace)??"",payment_method:null,contract_signing_date:null,amount:null,initial_fee:null,observations:"",opportunity_id:((L=f.opportunity)==null?void 0:L.id)??null,stage_id:he.SALE.value,properties:[{property_id:null,price:null,price_it:null,price_contrato:null,property_type:K.DEPARTAMENT.value,property_type_name:K.DEPARTAMENT.label}],differs_initial_fee:[],differs_balance:[]}),E=["10","20","30"],r=y("10"),g=i=>(a.value.initial_fee=i*r.value/100,i*r.value/100),d=()=>{const i=a.value.differs_initial_fee.reduce((o,V)=>o+(V.amount||0),0);return a.value.initial_fee-i},b=()=>{const i=a.value.differs_balance.reduce((o,V)=>o+(V.amount||0),0);return a.value.amount-a.value.initial_fee-i},q=oe(()=>a.value.social_reason&&a.value.nit&&a.value.email&&a.value.phone&&a.value.amount&&a.value.initial_fee),Z=async()=>{if(!q.value){alert("Por favor, completa todos los campos obligatorios.");return}n.value=!0;try{const i=d(),o=b();a.value.differs_balance.length===0&&a.value.differs_balance.push({date:new Date().toISOString().slice(0,19).replace("T"," "),amount:a.value.amount-a.value.initial_fee}),console.log("data de la venta: ",a.value),await I(a.value),p("update:isDialogVisible",!1),p("registerSale",a.value.opportunity_id)}catch(i){console.error("Error generando la venta:",i)}finally{n.value=!1}};return te(()=>a.value.properties,i=>{let o=0;i.forEach(V=>{if(V.price){const U=parseFloat(V.price)||0;V.price_it=U*.03,V.price_contrato=U+V.price_it,o+=V.price_contrato}else V.price_it=null}),a.value.amount=o,a.value.initial_fee=o*.3},{deep:!0}),(i,o)=>{const V=pe,U=se("H3"),S=J,N=Q,$=ce;return k(),P(ye,{"model-value":f.isDialogVisible,"max-width":"800","onUpdate:modelValue":_},{default:t(()=>[e(V,{onClick:o[0]||(o[0]=u=>i.$emit("update:isDialogVisible",!1))}),e(G,null,{default:t(()=>[e(T,{class:"d-flex flex-wrap justify-space-between gap-y-5 flex-column flex-sm-row"},{default:t(()=>[m("div",Ie,[m("div",Ue,[e(l(fe),{nodes:l(z).app.logo,class:"me-3"},null,8,["nodes"]),m("h6",ke,ne(l(z).app.title),1)]),e(U,null,{default:t(()=>o[10]||(o[10]=[j("Formulario de Venta")])),_:1})]),m("div",xe,[m("h6",Pe,[e(re,{color:"primary",loading:l(n),disabled:!l(q)||l(n),onClick:Z},{default:t(()=>o[11]||(o[11]=[j(" Registrar Venta ")])),_:1},8,["loading","disabled"])])])]),_:1}),e(C,{thickness:"24"}),e(T,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row gap-y-5 gap-4"},{default:t(()=>[e(x,null,{default:t(()=>[e(c,{cols:"12",sm:"8",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(S,{modelValue:l(a).social_reason,"onUpdate:modelValue":o[1]||(o[1]=u=>l(a).social_reason=u),rules:["requiredValidator"in i?i.requiredValidator:l(A)],label:"Razon social:",placeholder:"Canzza",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",sm:"4",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(S,{modelValue:l(a).nit,"onUpdate:modelValue":o[2]||(o[2]=u=>l(a).nit=u),label:"C.I./NIT:",rules:["requiredValidator"in i?i.requiredValidator:l(A)],placeholder:"0000000",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(S,{modelValue:l(a).workplace,"onUpdate:modelValue":o[3]||(o[3]=u=>l(a).workplace=u),label:"Lugar de Trabajo:",placeholder:"Placeholder Text",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(S,{modelValue:l(a).address,"onUpdate:modelValue":o[4]||(o[4]=u=>l(a).address=u),label:"Direccion:",placeholder:"Av/ Equipetrol ....",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(S,{modelValue:l(a).email,"onUpdate:modelValue":o[5]||(o[5]=u=>l(a).email=u),label:"Correo:",rules:["requiredValidator"in i?i.requiredValidator:l(A)],placeholder:"admin@gmail.com",type:"email",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(S,{modelValue:l(a).phone,"onUpdate:modelValue":o[6]||(o[6]=u=>l(a).phone=u),rules:["requiredValidator"in i?i.requiredValidator:l(A)],label:"Celular:",placeholder:"77049267",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(S,{label:"Telefono Fijo:",placeholder:"33557292",outlined:"",dense:"",class:"custom-salesforce-input"})]),_:1})]),_:1})]),_:1}),e(C,{thickness:"24"}),e(T,{class:"add-products-form"},{default:t(()=>[e(x,null,{default:t(()=>[e(c,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(Te,{propertiesform:l(a).properties},null,8,["propertiesform"])]),_:1}),e(c,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(N,{modelValue:l(a).payment_method,"onUpdate:modelValue":o[7]||(o[7]=u=>l(a).payment_method=u),label:"Tipo de Pago :",placeholder:"Seleccione ",items:Object.values(l(me)),class:"custom-salesforce-input"},null,8,["modelValue","items"])]),_:1}),e(N,{modelValue:l(r),"onUpdate:modelValue":o[8]||(o[8]=u=>ie(r)?r.value=u:null),rules:["requiredValidator"in i?i.requiredValidator:l(A)],label:"% Cuota Inicial :",items:E,placeholder:"% Cuota inicial",class:"mb-2"},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(C,{thickness:"24"}),e(T,{class:"add-products-form"},{default:t(()=>[e(x,null,{default:t(()=>[e(c,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(M,{title:"Cuota Inicial: "+g(l(a).amount),amount:g(l(a).amount),differs:l(a).differs_initial_fee,type:i.INITIAL_PAYMENT},null,8,["title","amount","differs","type"])]),_:1}),e(c,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(M,{title:"Saldo: "+(l(a).amount-l(a).initial_fee),amount:l(a).amount-l(a).initial_fee,differs:l(a).differs_balance,type:i.BALANCE},null,8,["title","amount","differs","type"])]),_:1}),e(c,{cols:"12",sm:"6",class:"mt-12"},{default:t(()=>[e(C,{thickness:"4"}),o[12]||(o[12]=m("div",{class:"text-center my-1"},[m("span",null," Firma del Cliente ")],-1))]),_:1}),e(c,{cols:"12",sm:"6",class:"mt-12"},{default:t(()=>[e(C,{thickness:"4"}),o[13]||(o[13]=m("div",{class:"text-center my-1"},[m("span",null," Firma Gerente Administrativo ")],-1))]),_:1}),e(c,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e($,{modelValue:l(a).observations,"onUpdate:modelValue":o[9]||(o[9]=u=>l(a).observations=u),"auto-grow":"",label:"Observaciones del Cliente",rows:"2",placeholder:"Descripcion...","row-height":"20"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(C,{thickness:"24"}),e(T,null,{default:t(()=>o[14]||(o[14]=[m("div",{class:"d-flex mx-sm-4"},[m("span",null,[m("strong",null," El comprador deberá realizar todos los pagos acordados, en las cuentas indicadas de Canzza Desarrolladora Inmobiliaria Srl. y entregar el respectivo comprobante de depósito. ")])],-1)])),_:1}),e(C),e(T,null,{default:t(()=>o[15]||(o[15]=[m("div",{class:"d-flex mx-sm-4"},[m("span",null,[m("strong",null," Todos los gastos administrativos, inscripción en derechos reales y honorarios profesionales para consolidar el derecho de propiedad a favor del comprador deben ser asumidos por el comprador.")])],-1)])),_:1})]),_:1})]),_:1},8,["model-value"])}}};export{he as S,$e as _,we as a,Ge as p,Ze as u};
