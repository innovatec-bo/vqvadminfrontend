import{a as G}from"./formatters-58bf909e.js";import{_ as K,a as Q}from"./BitacoraCustomer-ead532cf.js";import{u as W}from"./useCustomer-3c46a419.js";import{V as I}from"./VCardText-520eb94b.js";import{V as A}from"./VRow-aab3da1d.js";import{V as S}from"./VCol-69c08ae0.js";import{o as n,f as D,e as o,c as r,b as e,v as y,F as k,i as $,d as t,x as l,$ as N,r as j,n as p,z as w,a4 as F,a0 as U,a as z,j as Y,H as J}from"./index-1b227831.js";import{V as E,b as X}from"./VCard-09efc574.js";import{f as H}from"./currencyFormatter-92ad4b3c.js";import{a as Z,u as tt,S as M,b as et}from"./usePaymentPlans-c7156831.js";import{S as ot}from"./notifications-b6da0b75.js";import{V as lt}from"./VChip-ecf02ebd.js";import{V as B}from"./VTooltip-999127b3.js";import{V as L}from"./VTable-34b44b52.js";import{u as st}from"./useSales-02195e43.js";import{V as q}from"./VCheckbox-7902ce07.js";import{V as nt}from"./VDivider-ed4e04b7.js";import{V as at,a as R,b as T}from"./VList-6d5356af.js";import{V as rt,a as it}from"./VTabs-7aad081d.js";import{V as ut,a as O}from"./VWindowItem-cd64fa67.js";import"./helpers-61e4df1a.js";import"./AppTextarea-eb830d45.js";import"./form-593ede5a.js";/* empty css                   */import"./VCounter-dcd827ab.js";import"./VImg-8d00fb1c.js";import"./VField-689ad7b3.js";import"./easing-9f15041e.js";import"./VInput-bbd3a5f5.js";import"./forwardRefs-8348545e.js";import"./AppAutocomplete-6bc2cbc4.js";import"./VSelect-68fca8ea.js";import"./VTextField-e8500e6f.js";import"./dialog-transition-a4b1c076.js";import"./VMenu-4335078d.js";import"./VOverlay-03ad66c9.js";import"./lazy-7bf81604.js";import"./scopeId-b3dc2386.js";import"./VCheckboxBtn-50b671c1.js";import"./VSelectionControl-3345e294.js";import"./filter-31e12615.js";import"./AppSelect-daf71013.js";import"./AppTextField-44fc1f10.js";import"./DialogCloseBtn-ba5be469.js";import"./useProperty-6af143e7.js";import"./api-33861f4a.js";import"./index-9c720871.js";import"./constants-f448659b.js";import"./VForm-7774cbfe.js";import"./VDialog-08e76cbf.js";import"./VTimelineItem-310dbb0f.js";import"./VAvatar-a01bde99.js";import"./ssrBoot-6076e3ab.js";import"./VSlideGroup-3c10e4d8.js";const dt={key:0},pt={key:1},ct={class:"d-flex justify-content-between"},mt={style:{"flex-grow":"1"}},ft={class:"d-flex align-center mt-2",style:{"font-size":"small"}},_t={class:"ms-2"},yt={class:"d-flex align-center",style:{"font-size":"small"}},Ct={class:"ms-2"},gt={class:"d-flex gap-x-4 justify-end mt-2",style:{"font-size":"small"}},ht={class:"d-flex align-center"},vt={class:"ms-2"},bt={class:"d-flex align-center"},Vt={class:"ms-2"},xt={__name:"customerActivity",props:{activities:{type:Object,required:!0}},setup(P){const C=P,x=a=>a==="PENDING"?"Pendiente":a==="COMPLETED"?"Completada":a==="DISCARD"?"Descartada":a==="CANCELLED"?"Cancelada":a,g=a=>{const f=new Date(a),_=f.getDate(),V=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][f.getMonth()],c=f.getHours().toString().padStart(2,"0"),i=f.getMinutes().toString().padStart(2,"0");return`${_} de ${V}, ${c}:${i}`};return(a,f)=>(n(),D(E,{title:"Actividades"},{default:o(()=>[C.activities.length===0?(n(),r("div",dt,[e(I,null,{default:o(()=>f[0]||(f[0]=[y(" Sin Actividades ")])),_:1})])):(n(),r("div",pt,[e(A,{class:"mx-5 my-2"},{default:o(()=>[(n(!0),r(k,null,$(C.activities,_=>(n(),D(S,{key:_.id,cols:"4.5",class:"border my-2 mx-2"},{default:o(()=>[t("div",ct,[t("div",mt,[t("strong",null,l(_.title),1)]),t("div",null,[t("strong",null," Asesor: "+l(_.name_assigned),1)])]),t("span",null,l(_.description),1),t("span",ft,[f[1]||(f[1]=t("span",null,"Creado:",-1)),t("span",_t,l(g(_.created_at)),1)]),t("span",yt,[f[2]||(f[2]=t("span",null,"Programado:",-1)),t("span",Ct,l(g(_.scheduled_at)),1)]),t("div",gt,[t("span",ht,[e(N,{color:"primary",icon:"tabler-capture",size:"18"}),t("strong",vt,l(_.type_activity),1)]),t("span",bt,[e(N,{color:"primary",icon:"tabler-circle-dotted",size:"18"}),t("strong",Vt,l(x(_.state_activity)),1)])])]),_:2},1024))),128))]),_:1})]))]),_:1}))}},kt={class:"d-flex justify-content-between"},$t={style:{"flex-grow":"1"}},Dt={key:0},Pt={key:1},St={key:2},Et={class:"mt-5"},At={key:0,class:"d-flex flex-wrap gap-2"},It={key:1},Rt={key:3,class:"d-flex justify-end"},Tt={__name:"customeropportunity",props:{opportunities:{type:Object,required:!0}},emits:["refreshCustomer"],setup(P,{emit:C}){const x=P,g=C,a=j(!1),f=j(),_=v=>{f.value=v,a.value=!0},{checkProcessForOpportunity:h}=Z(),{changeStatusByOpportunity:V}=tt(),c=async(v,u,s)=>{console.log(`Procedimiento ${v} marcado como: ${s?"realizado":"no realizado"}`),await h(u,v,{is_check:!s}),g("refreshCustomer")},i=(v,u)=>v===0?"Última oportunidad":v===u-1?"Primera oportunidad":`${u-v}ª oportunidad`,m=async v=>{ot.fire({title:"Quieres dar de baja la oportunidad ?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"confirmar"}).then(async u=>{u.isConfirmed&&(await V(v.id,M.LOSS.value,{}),g("refreshCustomer"))})};return(v,u)=>(n(),r(k,null,[e(A,null,{default:o(()=>[e(S,{cols:"12"},{default:o(()=>[(n(!0),r(k,null,$(x.opportunities,(s,d)=>(n(),D(E,{key:s.id,class:"mb-3"},{default:o(()=>[e(I,null,{default:o(()=>[t("div",kt,[t("div",$t,[t("h2",null,l(i(d,x.opportunities.length)),1)]),t("div",null,[t("strong",null," Fecha: "+l(s.start_date),1)])]),t("div",null,[t("span",null,[u[2]||(u[2]=t("strong",null," Estado: ",-1)),y(" "+l(s.stage.title),1)]),u[8]||(u[8]=t("br",null,null,-1)),u[9]||(u[9]=t("strong",null,"Propiedad de Interes: ",-1)),s.property?(n(),r("span",Dt,l(s.property.title)+" | "+l(("formatCurrency"in v?v.formatCurrency:p(H))(s.property.base_price))+" | "+l(s.property.surface)+" m2 ",1)):(n(),r("span",Pt," Indefinido ")),s.description?(n(),r("p",St,[u[3]||(u[3]=t("strong",null," Descripcion: ",-1)),y(" "+l(s.description),1)])):w("",!0),t("div",Et,[u[5]||(u[5]=t("h3",{class:"my-1"}," Procesos ",-1)),s.procedure&&s.procedure.length>0?(n(),r("div",At,[(n(!0),r(k,null,$(s.procedure,b=>(n(),r("div",{key:b.id},[e(lt,{color:b.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:se=>c(b.id,s.id,b.pivot.is_check)},{default:o(()=>[b.pivot.is_check?(n(),D(N,{key:0,icon:"tabler-check",class:"mr-2"})):w("",!0),y(" "+l(b.title),1)]),_:2},1032,["color","onClick"]),e(B,{activator:"parent",location:"top"},{default:o(()=>[y(l(b.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(n(),r("div",It,u[4]||(u[4]=[t("span",null,"No hay procedimientos disponibles.",-1)])))]),s.stage.id!=p(M).LOSS.value&&s.stage.id!=p(M).FINISHED.value?(n(),r("div",Rt,[e(F,{variant:"elevated",class:"me-4",onClick:b=>_(s)},{default:o(()=>u[6]||(u[6]=[y(" Editar ")])),_:2},1032,["onClick"]),e(F,{variant:"tonal",color:"error",onClick:b=>m(s)},{default:o(()=>u[7]||(u[7]=[y(" Dar de baja ")])),_:2},1032,["onClick"])])):w("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(K,{"is-dialog-visible":p(a),"onUpdate:isDialogVisible":u[0]||(u[0]=s=>U(a)?a.value=s:null),"opportunity-kanban":p(f),onRefreshCustomer:u[1]||(u[1]=s=>v.$emit("refreshCustomer"))},null,8,["is-dialog-visible","opportunity-kanban"])],64))}},wt={key:0},Nt={key:1},Ot={class:"my-2"},Bt={class:"my-2"},Lt={class:"d-flex items-center gap-x-2"},jt={__name:"customerQuote",props:{quotes:{type:Object,required:!0}},setup(P){const C=P,x=g=>g==="CASH"?"Al Contado":g==="DIRECTCREDIT"?"Crédito Directo":g==="BANKCREDIT"?"Crédito Bancario":g;return(g,a)=>{const f=z("IconBtn"),_=z("RouterLink");return n(),D(A,null,{default:o(()=>[e(S,{cols:"12"},{default:o(()=>[e(E,{title:"Cotizaciones"},{default:o(()=>[C.quotes.length===0?(n(),r("div",wt,[e(I,null,{default:o(()=>a[0]||(a[0]=[y(" No hay cotizaciones disponibles ")])),_:1})])):(n(),r("div",Nt,[e(L,{density:"compact",class:"text-no-wrap my-2"},{default:o(()=>[a[1]||(a[1]=t("thead",null,[t("tr",null,[t("th",null," Metodo de Pago "),t("th",null," Propiedades "),t("th",null," Total "),t("th",null," Gerencia "),t("th",null," Cliente "),t("th",null," Accion ")])],-1)),t("tbody",null,[(n(!0),r(k,null,$(C.quotes,h=>(n(),r("tr",{key:h.id},[t("td",null,l(x(h.payment_method)),1),t("td",null,[(n(!0),r(k,null,$(h.properties,V=>(n(),r("div",{key:V.id,class:"d-flex gap-x-2"},l(V.title)+" | "+l(V.code),1))),128))]),t("td",null,[t("span",Ot,l(h.status==="APPROVED"?"Aprobado":"No Aprobado"),1)]),t("td",null,[t("span",Bt,l(h.status_customer==="APPROVED"?"Aprobado":"No Aprobado"),1)]),t("td",null,l(h.creation_date),1),t("td",null,[t("div",Lt,[e(_,{to:{name:"quote-id",params:{id:h.id}}},{default:o(()=>[e(f,null,{default:o(()=>[e(N,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])])])]))),128))])]),_:1})]))]),_:1})]),_:1})]),_:1})}}},zt={key:0},Mt={key:1},qt={class:"d-flex items-center gap-x-2"},Ut={__name:"customerSale",props:{sales:{type:Object,required:!0}},emits:["refreshCustomer","updateStageId"],setup(P,{emit:C}){const x=P,g=C,{confirmPaymentPlans:a}=et(),{SaleChangeSignature:f}=st(),_=async i=>{console.log(i),await a(i),g("refreshCustomer"),g("updateStageId",x.opportunity.id)},h=async i=>{console.log("entra a firma"),await f(i)},V=i=>i==="CASH"?"Al Contado":i==="DIRECTCREDIT"?"Crédito Directo":i==="BANKCREDIT"?"Crédito Bancario":i,c=i=>i==="SALE"?"VENDIDO":i==="DISCARD"?"CANCELADO":i==="PRESALE"?"RESERVADO":i==="DELIVERY"?"ENTREGADO":i;return(i,m)=>{const v=z("IconBtn"),u=z("RouterLink");return x.sales.length===0?(n(),r("div",zt,[e(E,{title:"Ventas"},{default:o(()=>[e(I,null,{default:o(()=>m[0]||(m[0]=[y(" No hay ventas disponibles ")])),_:1})]),_:1})])):(n(),r("div",Mt,[e(A,null,{default:o(()=>[e(S,{cols:"12"},{default:o(()=>[e(E,{title:"Ventas"},{default:o(()=>[e(L,{density:"compact",class:"text-no-wrap my-2"},{default:o(()=>[m[2]||(m[2]=t("thead",null,[t("tr",null,[t("th",null," ID "),t("th",null," Metodo de Pago "),t("th",null," Propiedades "),t("th",null," Total "),t("th",null," Estado "),t("th",null," Fecha "),t("th",null," Accion ")])],-1)),t("tbody",null,[(n(!0),r(k,null,$(x.sales,s=>(n(),r("tr",{key:s.id},[t("td",null,l(s.id),1),t("td",null,l(V(s.payment_method)),1),t("td",null,[(n(!0),r(k,null,$(s.properties,d=>(n(),r("div",{key:d.id,class:"d-flex gap-x-2"},l(d.title)+" | "+l(d.code),1))),128))]),t("td",null,l(("formatCurrency"in i?i.formatCurrency:p(H))(s.amount)),1),t("td",null,l(c(s.status)),1),t("td",null,l(s.creation_date),1),t("td",null,[t("div",qt,[e(u,{to:{name:"sale-id",params:{id:s.id}}},{default:o(()=>[e(v,null,{default:o(()=>[e(N,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"]),e(q,{modelValue:s.confirmation_signature,"onUpdate:modelValue":d=>s.confirmation_signature=d,"true-value":1,"false-value":0,onChange:d=>h(s.id)},{default:o(()=>[e(B,{activator:"parent",location:"top"},{default:o(()=>m[1]||(m[1]=[y(" Confirmar firma ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1}),(n(!0),r(k,null,$(x.sales,s=>(n(),r("div",{key:s.id,class:"my-5"},[s.status!="DISCARD"?(n(),D(E,{key:0},{default:o(()=>[e(I,null,{default:o(()=>[t("h3",null," Venta: "+l(s.id),1),m[9]||(m[9]=t("br",null,null,-1)),e(A,null,{default:o(()=>[e(S,{col:"6",class:"border mx-2"},{default:o(()=>[m[5]||(m[5]=t("strong",null," Cuotas Iniciales ",-1)),s.initial_payments&&s.initial_payments.length>0?(n(),D(L,{key:0,density:"compact",class:"text-no-wrap my-2"},{default:o(()=>[m[4]||(m[4]=t("thead",null,[t("tr",null,[t("th",null," Fecha "),t("th",null," Monto "),t("th",null," Estado "),t("th",null," Action ")])],-1)),t("tbody",null,[(n(!0),r(k,null,$(s.initial_payments,d=>(n(),r("tr",{key:d.id},[t("td",null,l(d.date),1),t("td",null,l(d.amount),1),t("td",null,l(d.is_paid?"Pagado":"Pendiente"),1),t("td",null,[e(q,{modelValue:d.is_paid,"onUpdate:modelValue":b=>d.is_paid=b,"true-value":1,"false-value":0,disabled:d.is_paid===1,onChange:b=>_(d.id)},{default:o(()=>[e(B,{activator:"parent",location:"top"},{default:o(()=>m[3]||(m[3]=[y(" Confirmar Pago ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"])])]))),128))])]),_:2},1024)):w("",!0)]),_:2},1024),e(S,{col:"6",class:"border mx-2"},{default:o(()=>[m[8]||(m[8]=t("strong",null," Saldos ",-1)),s.balance_payments&&s.balance_payments.length>0?(n(),D(L,{key:0,density:"compact",class:"text-no-wrap my-2"},{default:o(()=>[m[7]||(m[7]=t("thead",null,[t("tr",null,[t("th",null," Fecha "),t("th",null," Monto "),t("th",null," Estado "),t("th",null," Action ")])],-1)),t("tbody",null,[(n(!0),r(k,null,$(s.balance_payments,d=>(n(),r("tr",{key:d.id},[t("td",null,l(d.date),1),t("td",null,l(d.amount),1),t("td",null,l(d.is_paid?"Pagado":"Pendiente"),1),t("td",null,[e(A,null,{default:o(()=>[e(q,{modelValue:d.is_paid,"onUpdate:modelValue":b=>d.is_paid=b,"true-value":1,"false-value":0,disabled:d.is_paid===1,onChange:b=>_(d.id)},{default:o(()=>[e(B,{activator:"parent",location:"top"},{default:o(()=>m[6]||(m[6]=[y(" Confirmar Pago ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:2},1024)])]))),128))])]),_:2},1024)):w("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):w("",!0)]))),128))]))}}},Ft={class:"text-5xl font-weight-medium"},Ht={class:"text-h4 mt-4"},Gt={class:"text-h6"},Kt={class:"text-body-1"},Qt={class:"text-h6"},Wt={class:"text-body-1"},Yt={class:"text-h6"},Jt={class:"text-body-1"},Xt={class:"text-h6"},Zt={class:"text-body-1"},te={class:"text-h6"},ee={class:"text-body-1"},oe={class:"text-h6"},le={class:"text-body-1"},no={__name:"[id]",setup(P){const C=j(null),x=Y();j(!1);const{getPerfilCutomerbyId:g,customer:a,loading:f}=W(),_=[{icon:"tabler-users",title:"Oportunidades"},{icon:"tabler-star",title:"Actividades"},{icon:"tabler-currency-dollar",title:"Cotizaciones"},{icon:"tabler-cash",title:"ventas"},{icon:"tabler-table",title:"Bitacora"}],h=async()=>{try{await g(x.params.id)}catch(V){console.error("Error al obtener al customer:",V)}};return J(()=>{h(),console.log(a)}),(V,c)=>p(a)?(n(),D(A,{key:0},{default:o(()=>[e(S,{cols:"12",md:"3"},{default:o(()=>[e(E,null,{default:o(()=>[e(I,{class:"text-center pt-15"},{default:o(()=>[t("span",Ft,l(("avatarText"in V?V.avatarText:p(G))(p(a).customer.name)),1),t("h6",Ht,l(p(a).customer.name),1)]),_:1}),e(nt),e(I,null,{default:o(()=>[c[8]||(c[8]=t("p",{class:"text-sm text-uppercase text-disabled"}," Detalles ",-1)),e(at,{class:"card-list mt-2"},{default:o(()=>[e(R,null,{default:o(()=>[e(T,null,{default:o(()=>[t("h6",Gt,[c[2]||(c[2]=y(" Nombre: ")),t("span",Kt,l(p(a).customer.name),1)])]),_:1})]),_:1}),e(R,null,{default:o(()=>[e(T,null,{default:o(()=>[t("h6",Qt,[c[3]||(c[3]=y(" Email: ")),t("span",Wt,l(p(a).customer.email),1)])]),_:1})]),_:1}),e(R,null,{default:o(()=>[e(T,null,{default:o(()=>[t("h6",Yt,[c[4]||(c[4]=y(" Numero: ")),t("span",Jt,l(p(a).customer.cod_phone)+l(p(a).customer.phone),1)])]),_:1})]),_:1}),e(R,null,{default:o(()=>[e(T,null,{default:o(()=>[t("h6",Xt,[c[5]||(c[5]=y(" Lugar de Trabajo: ")),t("span",Zt,l(p(a).customer.workplace),1)])]),_:1})]),_:1}),e(R,null,{default:o(()=>[e(T,null,{default:o(()=>[t("h6",te,[c[6]||(c[6]=y(" Carnet: ")),t("span",ee,l(p(a).customer.ci),1)])]),_:1})]),_:1}),e(R,null,{default:o(()=>[e(T,null,{default:o(()=>[t("h6",oe,[c[7]||(c[7]=y(" Tipo de Cliente: ")),t("span",le,l(p(a).customer.type_customer),1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(S,{cols:"12",md:"9"},{default:o(()=>[e(rt,{modelValue:p(C),"onUpdate:modelValue":c[0]||(c[0]=i=>U(C)?C.value=i:null),class:"v-tabs-pill"},{default:o(()=>[(n(),r(k,null,$(_,i=>e(it,{key:i.icon},{default:o(()=>[e(N,{size:18,icon:i.icon,class:"me-1"},null,8,["icon"]),t("span",null,l(i.title),1)]),_:2},1024)),64))]),_:1},8,["modelValue"]),e(ut,{modelValue:p(C),"onUpdate:modelValue":c[1]||(c[1]=i=>U(C)?C.value=i:null),class:"mt-6 disable-tab-transition",touch:!1},{default:o(()=>[e(O,null,{default:o(()=>[e(Tt,{opportunities:p(a).opportunities,onRefreshCustomer:h},null,8,["opportunities"])]),_:1}),e(O,null,{default:o(()=>[e(xt,{activities:p(a).activities},null,8,["activities"])]),_:1}),e(O,null,{default:o(()=>[e(jt,{quotes:p(a).quotes},null,8,["quotes"])]),_:1}),e(O,null,{default:o(()=>[e(Ut,{sales:p(a).sales,onRefreshCustomer:h},null,8,["sales"])]),_:1}),e(O,null,{default:o(()=>[e(Q,{customer:p(a).customer.id},null,8,["customer"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})):(n(),D(E,{key:1},{default:o(()=>[e(X,{class:"text-center"},{default:o(()=>[y(l(p(f)?"Cargando":"Cliente no encontrado"),1)]),_:1})]),_:1}))}};export{no as default};
