import{r as _}from"./validators-dea6e3a5.js";import{_ as Q}from"./AppAutocomplete-ba3c4704.js";import{f as K}from"./currencyFormatter-96e3a729.js";import{_ as L}from"./AppTextarea-a2b5384e.js";import{_ as S}from"./AppSelect-9bf76bbd.js";import{_ as Y}from"./AppTextField-5b64ee5a.js";import{_ as O}from"./AppDateTimePicker-995d3c9b.js";import{P as v,a as G,_ as H}from"./InvoiceAddMoney-58db6a58.js";import{V as W}from"./VNodeRenderer-37ca53c6.js";import{r as x,w as F,H as j,o as k,f as U,e as t,d as c,c as I,F as J,i as X,b as l,n as r,x as C,v as E,z as Z,a4 as R,$ as ee,I as N,a0 as le,a2 as T}from"./index-68d8d6c3.js";import{u as ae}from"./useProperty-12b0e5fc.js";import{V as w}from"./VRow-ffd302ce.js";import{V as u}from"./VCol-52b12ffa.js";import{V as z}from"./VCard-a1bc7cb9.js";import{V as h}from"./VCardText-bce4fe8f.js";import{V as $}from"./VDivider-a021f82b.js";import{u as oe}from"./useCustomer-a93c685b.js";import{u as te}from"./useQuote-fc119381.js";import{c as M}from"./notifications-81bc0416.js";import"./helpers-61e4df1a.js";import"./form-0aa35c20.js";import"./VSelect-1f8f848d.js";import"./VTextField-e3a6e442.js";/* empty css                   */import"./VCounter-b7e92eed.js";import"./VImg-14a79051.js";import"./VField-238d3b3c.js";import"./easing-9f15041e.js";import"./VInput-0e0fa695.js";import"./forwardRefs-8348545e.js";import"./VList-23d998aa.js";import"./ssrBoot-9a649dd5.js";import"./VAvatar-bf0453b9.js";import"./dialog-transition-e3bf0d93.js";import"./VMenu-95995cde.js";import"./VOverlay-17772896.js";import"./lazy-c5009c08.js";import"./scopeId-cd403e1e.js";import"./VCheckboxBtn-2c22c5fa.js";import"./VSelectionControl-65cfe522.js";import"./VChip-644a96c4.js";import"./filter-173ebadb.js";import"./api-11869bd0.js";import"./index-9c720871.js";import"./constants-f3b5ca65.js";const ie={class:"pa-5 flex-grow-1"},re={key:0,style:{"font-size":"small","padding-block":""}},se={class:"d-flex justify-end mt-3"},ne={__name:"InvoiceAddProperty",props:{properties:{type:Array,required:!0}},emits:["removeProduct","totalAmount","addProperty"],setup(D,{emit:A}){const i=D,P=A,{propertiesForType:g}=ae(),o=x([]),V=x([]),y=()=>{const e={property_id:null,price:null,property_type:v.PARK.value,property_type_name:v.PARK.label};P("addProperty",e)},q=e=>{P("removeProduct",e)},s=e=>{if(console.log("entra a update price"),e.property_type===v.DEPARTAMENT.value){const p=V.value.find(m=>m.id===e.property_id);p&&(e.price=p.base_price)}else if(e.property_type===v.PARK.value){const p=o.value.find(m=>m.id===e.property_id);p&&(e.price=p.base_price)}};return F(()=>i.properties.map(e=>e.property_id),(e,p)=>{e.forEach((m,d)=>{const n=i.properties[d];m!==p[d]&&s(n)})}),j(async()=>{try{const e=await g(v.DEPARTAMENT.value);V.value=e;const p=await g(v.PARK.value);o.value=p}catch(e){console.error("Error al obtener las propiedades:",e)}}),(e,p)=>{const m=Y;return k(),U(z,{flat:"",border:"",class:"d-flex flex-row"},{default:t(()=>[c("div",ie,[(k(!0),I(J,null,X(i.properties,(d,n)=>(k(),U(w,{key:n,class:"mb-4"},{default:t(()=>[l(u,{cols:"12",sm:"4",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(S,{modelValue:d.property_id,"onUpdate:modelValue":a=>d.property_id=a,rules:["requiredValidator"in e?e.requiredValidator:r(_)],label:d.property_type_name,placeholder:"Selecciona una propiedad",items:d.property_type===r(v).DEPARTAMENT.value?r(V):r(o),"item-title":"title","item-value":"id",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules","label","items"]),d.property_id&&d.property_type===r(v).DEPARTAMENT.value?(k(),I("span",re,[c("strong",null,C(r(V)[d.property_id-1].departament.isfacade===1?"En fachada":"Orientacion sur")+", ",1),E(" "+C(r(V)[d.property_id-1].surface)+" ",1),p[0]||(p[0]=c("strong",null," m2",-1)),p[1]||(p[1]=c("br",null,null,-1)),E(" "+C(r(V)[d.property_id-1].departament.number_bedrooms)+" Dormitorio(s), ",1)])):Z("",!0)]),_:2},1024),l(u,{cols:"12",sm:"2",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(m,{modelValue:d.price,"onUpdate:modelValue":a=>d.price=a,rules:["requiredValidator"in e?e.requiredValidator:r(_)],label:"Precio *",placeholder:"$",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),l(u,{cols:"12",sm:"2",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(m,{modelValue:d.price_it,"onUpdate:modelValue":a=>d.price_it=a,rules:["requiredValidator"in e?e.requiredValidator:r(_)],label:"3% (IT) *",placeholder:"%",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(m,{modelValue:d.price_contrato,"onUpdate:modelValue":a=>d.price_contrato=a,rules:["requiredValidator"in e?e.requiredValidator:r(_)],label:"Precio Contrato *",placeholder:"Escribe el precio",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),l(u,{cols:"12",sm:"1",class:"my-4"},{default:t(()=>[l(R,{color:"error",size:"small",onClick:a=>q(n)},{default:t(()=>[l(ee,{icon:"tabler-square-x"})]),_:2},1032,["onClick"])]),_:2},1024),l(u,{cols:"12",style:{"font-size":"small","padding-block":"0","padding-inline":"4px"}})]),_:2},1024))),128)),c("div",se,[l(R,{color:"secondary",onClick:y},{default:t(()=>p[2]||(p[2]=[E(" Agregar Parqueo ")])),_:1})])])]),_:1})}}},de={class:"ma-sm-4"},ue={class:"d-flex align-center mb-6"},pe={class:"font-weight-bold text-capitalize text-h3"},me={class:"mt-4 ma-sm-4"},ce={class:"d-flex align-center justify-sm-end mb-3"},fe={style:{"inline-size":"9.5rem"}},_e={class:"d-flex align-center justify-sm-end mb-3"},Ve={style:{"inline-size":"9.5rem"}},ve={class:"text-center my-4"},ge={__name:"AddQuoteInvoice",props:{data:{type:null,required:!0}},emits:["push","remove"],setup(D,{emit:A}){const i=D,P=A,g=s=>{P("push",s)},o=s=>{P("remove",s)},V=["30","50","80","100"],y=x("30"),q=s=>(i.data.initial_fee=s*y.value/100,i.data.balance=s-i.data.initial_fee,s*y.value/100);return(s,e)=>{const p=O,m=Y,d=S,n=L;return k(),U(z,null,{default:t(()=>[l(h,{class:"d-flex flex-wrap justify-space-between gap-y-5 flex-column flex-sm-row"},{default:t(()=>[c("div",de,[c("div",ue,[l(r(W),{nodes:r(N).app.logo,class:"me-3"},null,8,["nodes"]),c("h4",pe,C(r(N).app.title),1)]),e[12]||(e[12]=c("p",{class:"mb-0"}," Formulario de Cotización ",-1))]),c("div",me,[c("div",ce,[e[13]||(e[13]=c("span",{class:"me-3",style:{"inline-size":"6rem"}},"Emisión",-1)),c("span",fe,[l(p,{modelValue:i.data.creation_date,"onUpdate:modelValue":e[0]||(e[0]=a=>i.data.creation_date=a),rules:["requiredValidator"in s?s.requiredValidator:r(_)],density:"compact",placeholder:"YYYY-MM-DD",config:{position:"auto right"}},null,8,["modelValue","rules"])])]),c("div",_e,[e[14]||(e[14]=c("span",{class:"me-3",style:{"inline-size":"6rem"}},"Vigente hasta",-1)),c("span",Ve,[l(p,{modelValue:i.data.expiration_date,"onUpdate:modelValue":e[1]||(e[1]=a=>i.data.expiration_date=a),rules:["requiredValidator"in s?s.requiredValidator:r(_)],density:"compact",placeholder:"YYYY-MM-DD",config:{position:"auto right"}},null,8,["modelValue","rules"])])])])]),_:1}),l($,{thickness:"12"}),l(h,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row gap-y-5 gap-4"},{default:t(()=>[l(w,null,{default:t(()=>[l(u,{cols:"12",sm:"8",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(m,{modelValue:i.data.social_reason,"onUpdate:modelValue":e[2]||(e[2]=a=>i.data.social_reason=a),rules:["requiredValidator"in s?s.requiredValidator:r(_)],label:"Razón Social *",placeholder:"Canzza",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",sm:"4",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(m,{modelValue:i.data.nit,"onUpdate:modelValue":e[3]||(e[3]=a=>i.data.nit=a),rules:["requiredValidator"in s?s.requiredValidator:r(_)],label:"C.I./NIT *",placeholder:"0000000",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(m,{modelValue:i.data.workplace,"onUpdate:modelValue":e[4]||(e[4]=a=>i.data.workplace=a),label:"Lugar de Trabajo",placeholder:"Placeholder Text",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(m,{modelValue:i.data.email,"onUpdate:modelValue":e[5]||(e[5]=a=>i.data.email=a),rules:["requiredValidator"in s?s.requiredValidator:r(_)],label:"Correo *",placeholder:"email@gmail.com",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(m,{modelValue:i.data.address,"onUpdate:modelValue":e[6]||(e[6]=a=>i.data.address=a),label:"Dirección",placeholder:"Av/ Equipetrol ....",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(m,{modelValue:i.data.phone,"onUpdate:modelValue":e[7]||(e[7]=a=>i.data.phone=a),rules:["requiredValidator"in s?s.requiredValidator:r(_)],label:"Celular *",placeholder:"77049267",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(m,{label:"Teléfono Fijo",placeholder:"33557292",outlined:"",dense:"",class:"custom-salesforce-input"})]),_:1})]),_:1})]),_:1}),l($,{thickness:"12"}),l(h,{class:"add-products-form"},{default:t(()=>[l(w,null,{default:t(()=>[l(u,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"},class:"mb-2"},{default:t(()=>[l(ne,{properties:i.data.properties,onAddProperty:g,onRemoveProduct:o},null,8,["properties"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(d,{modelValue:i.data.payment_method,"onUpdate:modelValue":e[8]||(e[8]=a=>i.data.payment_method=a),rules:["requiredValidator"in s?s.requiredValidator:r(_)],label:"Tipo de Pago *",placeholder:"Seleccione ",items:Object.values(r(G)),class:"custom-salesforce-input"},null,8,["modelValue","rules","items"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(m,{modelValue:i.data.amount,"onUpdate:modelValue":e[9]||(e[9]=a=>i.data.amount=a),rules:["requiredValidator"in s?s.requiredValidator:r(_)],label:"Total *",placeholder:"Placeholder Text",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(d,{modelValue:r(y),"onUpdate:modelValue":e[10]||(e[10]=a=>le(y)?y.value=a:null),items:V,label:"Anticipo: %",placeholder:"% Anticipo",class:"mb-2"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[c("div",ve,[e[15]||(e[15]=c("h4",null," Saldo por pagar: ",-1)),c("span",null,C(("formatCurrency"in s?s.formatCurrency:r(K))(i.data.amount-i.data.initial_fee)),1)])]),_:1})]),_:1})]),_:1}),l(h,{class:"add-products-form"},{default:t(()=>[l(w,null,{default:t(()=>[l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(H,{title:" Anticipo ",amount:q(i.data.amount),differs:i.data.differs_initial_fee,type:s.INITIAL_PAYMENT},null,8,["amount","differs","type"])]),_:1}),l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(n,{modelValue:i.data.observations,"onUpdate:modelValue":e[11]||(e[11]=a=>i.data.observations=a),"auto-grow":"",label:"Observaciones del Cliente",rows:"3",placeholder:"Descripción...","row-height":"20"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}}},ul={__name:"addQuote",setup(D){const{generateQuote:A}=te(),{allCustomerPaginate:i,customers:P}=oe(),g=x(!1),o=x({social_reason:"",nit:"",address:"",email:"",phone:"",workplace:"",expiration_date:null,creation_date:new Date().toISOString().split("T")[0],observations:"",payment_method:null,amount:null,initial_fee:null,balance:null,opportunity_id:null,customer_id:null,properties:[{property_id:null,price:null,price_it:null,price_contrato:null,property_type:v.DEPARTAMENT.value,property_type_name:v.DEPARTAMENT.label}],differs_initial_fee:[],differs_balance:[]}),V=T(()=>o.value.social_reason&&o.value.nit&&o.value.email&&o.value.phone&&o.value.amount&&o.value.creation_date&&o.value.expiration_date&&o.value.payment_method&&o.value.balance&&o.value.customer_id),y=T(()=>o.value.properties.every(n=>n.property_id!==null&&n.price!==null&&n.price_it!==null&&n.price_contrato!==null)),q=T(()=>o.value.differs_initial_fee.length===0?!0:o.value.differs_initial_fee.every(n=>n.amount!==null)),s=T(()=>{if(o.value.differs_initial_fee.length===0)return!0;const n=o.value.differs_initial_fee.reduce((b,B)=>b+(B.amount||0),0),a=parseFloat(n),f=parseFloat(o.value.initial_fee);return a===f}),e=T(()=>V.value&&y.value&&q.value),p=n=>{o.value.properties.push(n)},m=n=>{o.value.properties.splice(n,1)},d=async()=>{if(!e.value){M("Validación fallida","Completa todos los campos obligatorios.");return}if(!s.value){M("Validación fallida","La suma de las diferencias del anticipo no son correctas");return}g.value=!0;try{console.log(o),await A(o.value)}catch(n){console.error("Error generando la venta:",n)}finally{g.value=!1}};return j(async()=>{await i({page:1,itemsPerPage:100})}),F(()=>o.value.properties,n=>{let a=0;n.forEach(f=>{if(f.price){const b=parseFloat(f.price)||0;f.price_it=b*.03,f.price_contrato=b+f.price_it,a+=f.price_contrato}else f.price_it=null}),o.value.amount=a},{deep:!0}),F(()=>o.value.customer_id,n=>{const a=P.value.find(f=>f.id==n);a&&(o.value.social_reason=a.name,o.value.email=a.email,o.value.phone=a.phone,o.value.nit=a.ci,o.value.opportunity_id=a.opportunity_id,a.property_id!==null&&(o.value.properties[0].property_id=a.property_id)),o.value.customer_id=n}),(n,a)=>{const f=Q;return k(),U(w,null,{default:t(()=>[l(u,{cols:"12",md:"9"},{default:t(()=>[l(ge,{data:r(o),onPush:p,onRemove:m},null,8,["data"])]),_:1}),l(u,{cols:"12",md:"3"},{default:t(()=>[l(z,{class:"mb-8"},{default:t(()=>[l(u,{cols:"12"},{default:t(()=>[l(f,{modelValue:r(o).customer_id,"onUpdate:modelValue":a[0]||(a[0]=b=>r(o).customer_id=b),rules:["requiredValidator"in n?n.requiredValidator:r(_)],label:"Clientes",placeholder:"Selecciona un Cliente",items:r(P).map(b=>({title:b.name,value:b.id})),outlined:""},null,8,["modelValue","rules","items"])]),_:1}),l(h,null,{default:t(()=>[l(R,{loading:r(g),disabled:!r(e)||r(g),class:"mb-2",onClick:d},{default:t(()=>a[1]||(a[1]=[E(" Guardar Cotización ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})}}};export{ul as default};
