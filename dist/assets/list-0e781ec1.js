import{u as ie,S as ke,_ as xe,a as De,d as je}from"./PreSaleForm-d6c8940e.js";import{r as K,e as Be}from"./validators-dea6e3a5.js";import{_ as Ae}from"./AppTextarea-e252ea68.js";import{_ as Te}from"./AppDateTimePicker-b2e6fccf.js";import{_ as ge}from"./AppTextField-78a0b1fb.js";import{_ as _e}from"./AppSelect-e5180335.js";import{f as le}from"./currencyFormatter-92ad4b3c.js";import{u as pe,a as be,_ as Re}from"./BitacoraCustomer-4c833ec7.js";import{V as Pe}from"./VAvatar-dd6c98ea.js";import{b as oe,c as ae,a as ve}from"./VList-3cee522e.js";import{V as v}from"./VCol-50fe708a.js";import{o as s,c as f,d as l,F as B,i as H,b as e,e as t,n as a,v as V,x as y,z as M,f as q,$ as J,a4 as j,w as ne,a3 as Se,r as k,a as ue,a0 as L,am as Z,a2 as ee,an as Ve,ac as Ne,H as Le}from"./index-b1b2d363.js";import{V as X}from"./VChip-2a3ded92.js";import{V as te}from"./VTooltip-aa03fbf4.js";import{V as Y}from"./VCardText-77656418.js";import{a as he}from"./formatters-b3558c7d.js";import{u as Me}from"./useQuote-0a5d4ba8.js";import{_ as Qe}from"./AppAutocomplete-9fabf67e.js";import{_ as ce}from"./DialogCloseBtn-bd85ed89.js";import{u as He}from"./useProperty-d8ca8d4f.js";import{V as W,b as me}from"./VCard-283a0def.js";import{V as Ue}from"./VForm-f26ca194.js";import{V as Q}from"./VRow-54bb12d3.js";import{V as fe}from"./VDialog-fc141fdd.js";import{V as se}from"./VCheckbox-7505aead.js";import{V as de}from"./VTable-2a9c08c7.js";import{u as Ke}from"./useSales-ed32f628.js";import{V as re}from"./VTextField-89675d1c.js";import{s as $e,S as we}from"./notifications-e0287a8c.js";import{P as Oe}from"./vue3-perfect-scrollbar.esm-01d2bb17.js";import{V as ze}from"./VNavigationDrawer-8b5189db.js";import{_ as qe}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as Ye}from"./AppDrawerHeaderSection-49731d29.js";import{V as Ie,a as Ge}from"./VWindowItem-0e92330a.js";import{V as Je,a as Ce}from"./VRadioGroup-6d06333b.js";import{V as Ze}from"./VDivider-2c27cc49.js";import{V as We,a as Xe}from"./VTabs-0dd0a1c6.js";import{V as et}from"./VOverlay-779c2b03.js";import"./api-ae9818f7.js";import"./index-9c720871.js";import"./constants-af5bcc15.js";import"./InvoiceAddMoney-fa3f7cc4.js";import"./VNodeRenderer-66b4f22f.js";import"./helpers-61e4df1a.js";import"./form-bf0e32f3.js";/* empty css                   */import"./VCounter-cedcee79.js";import"./VImg-fa7cb884.js";import"./VField-5257c57b.js";import"./easing-9f15041e.js";import"./VInput-3175499e.js";import"./forwardRefs-8348545e.js";import"./VSelect-a21291db.js";import"./dialog-transition-a947f220.js";import"./VMenu-143a1084.js";import"./scopeId-83dee9b3.js";import"./VCheckboxBtn-0f5a74b5.js";import"./VSelectionControl-6ee622cb.js";import"./VTimelineItem-06f65046.js";import"./ssrBoot-a7950aa6.js";import"./filter-3549c233.js";import"./VSpacer-25818845.js";import"./lazy-97f1c45b.js";import"./VSlideGroup-708c0905.js";const Fe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANCSURBVHgB7VZJT1NRFP5e+9pSCrSFUgUUlLGCCCIyBCISNcGFaEKICcaERBbyB3TjgpVLE2MiC4lRlyYaNSIhKooiKAqUQZAZUlpmKHOHV+q9FylUINGFsnlfmrzzes859zvfOTfvcoXXC93YRUiwyxAJiAREAiIBHv8QSoUSxXlFXv/VtTWgfbDz/xCgaO5p9Xq3TI95vXsI6DXBKL1QApfLhVX3KuaX5tHUY0TD90a2Hrs/GunxaYgJi4RDcKJrqBtVjdWI2BOOi7kFqKh8iIKcfOjUOrxr+YCa5lpkxKfiUIQB/eYBuMEhwNcf3aZeLwLShOyEMmqofFTISzuNW4/voHPoB8JJ4jOpudD4qTFKWBefLUL5swoYe1uZ78mj2Wyz8dkJZCVmEDsItcZP0Gt1SIo+ApvdhvPZ51D+/B46iOT9lgEYIuKIbyYau75tVWAdGn8tekf6cP/VI1zNv4LMhHTMETUEwQXXqgszC1Y8/fgCYcGhiCOqNPU0s7iX9VUYnjBhZMqMIP9A2Jw23H5yF0q5D9INqbALDlZM7L4oqFUBLCfFllOQdTjdY79pes+edocdoboQUlmiZ63WWAfBtQr3r4/5mHWCPWfmZ9Fr7odUwqM0vwQpscloG+yAsa8NS7alNdmlUk+eLQRowKmUHCbz3kA96+fX7hZYF2bJRF9CTnI2WfMlCoSgrr3eEycIgleezITjUCl98ZbMwgppxx6tHn5K1e/bec/AiaQsVH15jRgiU/wBA2G8jMrP1bA77Wgd6ICCVyAy9CAbSMvUKGpaalk1Mp5nR8vt3rjbWKZHERQQSIY2CjwvhVwmx/CYidnGvnai3hphbv1GpNcG48blayh7cJPJuB38yRTTQFqJw+mEr8IHApkLakskEtgcNo8vL+UZMVo97bmTnBx6unzkCjLU4xt+6wbtM+0TDdgJx0h7OI5jJKg6bpJwybYCQ3g0zJOjCAzQwjRhJv2XQO2nYS20Ls6RwVajx9TH1i3EbzO4v7kTBmt0WFxZhISTsEo8ZDn641iFfqSV88uLrG1ymYypo5Ap1twI+c0qeSnwJ5i0TnlsqsB22Kwg3ZyCktkJ4tdQJCASEAmIBH4Cka1P8RSIn3sAAAAASUVORK5CYII=",tt={class:"my-5"},lt={key:0},ot=["src"],at={class:"my-5"},it={key:0,class:"d-flex flex-wrap gap-2 my-5"},nt={key:1},st={__name:"EditDeliveryOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","complet"],setup(I,{emit:z}){const i=I,g=z,{changeStatusByOpportunity:O}=ie(),{checkProcessForOpportunity:P}=pe(),A=async()=>{try{await O(i.opportunity.id,7,{}),g("complet")}catch(b){console.error("Error updating customer:",b)}},d=async(b,p)=>{console.log(`Procedimiento ${b} marcado como: ${p?"realizado":"no realizado"}`),await P(i.opportunity.id,b,{is_check:!p}),g("updateStageId",i.opportunity.id)};return(b,p)=>(s(),f(B,null,[l("div",tt,[p[0]||(p[0]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Propiedades ",-1)),i.opportunity.sales.length>0?(s(),f("div",lt,[(s(!0),f(B,null,H(i.opportunity.sales,_=>(s(),f("div",{key:_.id},[(s(!0),f(B,null,H(_.properties,h=>(s(),f("div",{key:h.id,class:"d-flex align-center justify-between"},[e(Pe,{size:"50",rounded:""},{default:t(()=>[l("img",{src:a(Fe),alt:"Logo pora",style:{"border-radius":"30%"}},null,8,ot)]),_:1}),e(v,{cols:"12",md:"7"},{default:t(()=>[e(oe,{class:"font-weight-medium"},{default:t(()=>[V(y(h.project_title)+" | "+y(h.title),1)]),_:2},1024),e(ae,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",null,y(("formatCurrency"in b?b.formatCurrency:a(le))(h.pivot_price)),1)]),_:2},1024)]),_:2},1024)]))),128))]))),128))])):M("",!0)]),l("div",at,[p[2]||(p[2]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),i.opportunity.procedure&&i.opportunity.procedure.length>0?(s(),f("div",it,[(s(!0),f(B,null,H(i.opportunity.procedure,_=>(s(),f("div",{key:_.id},[e(X,{color:_.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:h=>d(_.id,_.pivot.is_check)},{default:t(()=>[_.pivot.is_check?(s(),q(J,{key:0,icon:"tabler-check",class:"mr-2"})):M("",!0),V(" "+y(_.title),1)]),_:2},1032,["color","onClick"]),e(te,{activator:"parent",location:"top"},{default:t(()=>[V(y(_.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(s(),f("div",nt,p[1]||(p[1]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(Y,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(j,{color:"primary",size:"small",onClick:A},{default:t(()=>p[3]||(p[3]=[V(" Finalizar Oportunidad ")])),_:1})]),_:1})],64))}},Ee={__name:"EditCustomerDialog",props:{isDialogVisible:{type:Boolean,required:!0},opportunityKanban:{type:Object,required:!0}},emits:["update:isDialogVisible","update:newProperty"],setup(I,{emit:z}){const i=I,g=z;Object.values(ke).map(m=>({title:m.label,value:m.value}));const{propertiesAvailbles:O,properties:P}=He(),{getOpportunitybyId:A,opportunity:d,changeOpportunity:b,loadingOpportunity:p}=ie(),_=()=>{g("update:isDialogVisible",!1)},h=async()=>{console.log("antes del save:",d);const m={id:d.value.id,description:d.value.description,property_id:d.value.property_id,customer:{id:d.value.customer.id,name:d.value.customer.name,email:d.value.customer.email,ci:d.value.customer.ci,cod_phone:d.value.customer.cod_phone.replace(/\+/g,""),phone:d.value.customer.phone}};console.log("data de editar",m),await b(d.value.id,m),d.value.property_id&&(console.log("Cambio y geenero el Emit Principal"),g("update:newProperty",d.value.property_id)),g("update:isDialogVisible",!1)},x=async()=>{var m;(m=i.opportunityKanban)!=null&&m.id&&await A(i.opportunityKanban.id)},w=async()=>{await O()};return ne(()=>i.isDialogVisible,async m=>{m===!0&&(x(),await w())}),(m,u)=>{const S=ce,T=ge,n=_e,c=Qe,R=Ae;return s(),q(fe,{"max-width":"800","model-value":i.isDialogVisible,persistent:"","close-on-esc":!1,"onUpdate:modelValue":_},{default:t(()=>[e(S,{onClick:_}),e(W,{title:"Información del Cliente y Oportunidad",class:"pa-sm-8 pa-5"},{default:t(()=>[e(Y,null,{default:t(()=>[e(Ue,{onSubmit:Se(h,["prevent"])},{default:t(()=>[e(Q,{dense:""},{default:t(()=>[e(v,{cols:"12",md:"6"},{default:t(()=>[e(T,{modelValue:a(d).customer.name,"onUpdate:modelValue":u[0]||(u[0]=C=>a(d).customer.name=C),label:"Nombre del Cliente",placeholder:"Ingresa el nombre",outlined:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:t(()=>[e(T,{modelValue:a(d).customer.email,"onUpdate:modelValue":u[1]||(u[1]=C=>a(d).customer.email=C),label:"Email del Cliente",placeholder:"Ingresa el email",outlined:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:t(()=>[e(Q,null,{default:t(()=>[e(v,{cols:"4"},{default:t(()=>[e(n,{modelValue:a(d).customer.cod_phone,"onUpdate:modelValue":u[2]||(u[2]=C=>a(d).customer.cod_phone=C),label:"Código",items:["+1","+52","+55","+54","+49","+33","+34","+39","+86","+81","+7","+591"],placeholder:"Cód.",outlined:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"8"},{default:t(()=>[e(T,{modelValue:a(d).customer.phone,"onUpdate:modelValue":u[3]||(u[3]=C=>a(d).customer.phone=C),label:"Número de Teléfono",placeholder:"Ingresa el teléfono",outlined:"",dense:"",maxlength:"9"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(v,{cols:"12",md:"6"},{default:t(()=>[e(T,{modelValue:a(d).customer.ci,"onUpdate:modelValue":u[4]||(u[4]=C=>a(d).customer.ci=C),label:"CI del Cliente",placeholder:"Ingresa el CI",outlined:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(c,{modelValue:a(d).property_id,"onUpdate:modelValue":u[5]||(u[5]=C=>a(d).property_id=C),label:"Departamento de Interés",placeholder:"Selecciona un Departamento",items:a(P).map(C=>({title:C.title,value:C.id})),outlined:""},null,8,["modelValue","items"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(R,{modelValue:a(d).description,"onUpdate:modelValue":u[6]||(u[6]=C=>a(d).description=C),label:"Descripción de la Oportunidad",placeholder:"Ingresa una descripción",rows:"3","auto-grow":"",outlined:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",class:"text-center"},{default:t(()=>[e(j,{type:"submit",color:"primary",class:"me-3",disabled:a(p),loading:a(p)},{default:t(()=>u[7]||(u[7]=[V(" Guardar ")])),_:1},8,["disabled","loading"]),e(j,{color:"secondary",variant:"tonal",onClick:_},{default:t(()=>u[8]||(u[8]=[V(" Cancelar ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},rt={class:"d-flex align-bottom flex-sm-row flex-column"},ut={class:"user-profile-info"},dt={class:"d-flex align-center justify-center justify-sm-space-between flex-wrap gap-4"},pt={class:"d-flex align-center gap-x-3"},ct={class:"text-4xl font-weight-medium"},mt={class:"d-flex flex-column py-2",style:{"font-size":"14px"}},ft={class:"text-sm text-disabled"},yt={key:0,class:"d-flex flex-wrap gap-2 my-5"},vt={key:1},gt={key:0,class:"d-flex flex-wrap gap-2 my-5"},_t={key:1},bt={__name:"EditPreSaleOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","update:newProperty"],setup(I,{emit:z}){const i=I,g=z,{checkProcessForOpportunity:O}=pe(),{changeStatusQuotesCustomer:P}=Me(),A=k(!1),d=k(!1),b=()=>{A.value=!0},p=()=>{console.log("Se escucho el evento en EditProspectOpportunity"),g("update:newProperty")},_=()=>{d.value=!0},h=async m=>{g("updateStageId",m)},x=async(m,u)=>{console.log(`Procedimiento ${m} marcado como: ${u?"realizado":"no realizado"}`),await O(i.opportunity.id,m,{is_check:!u}),g("updateStageId",i.opportunity.id)},w=async(m,u)=>{const S=u==="APPROVED"?"NOT_APPROVED":"APPROVED";console.log(`Procedimiento ${m} marcado como: ${u}`),await P(m,{status:S}),g("updateStageId",i.opportunity.id)};return(m,u)=>{const S=ue("RouterLink"),T=ue("IconBtn");return s(),f(B,null,[l("div",rt,[l("div",ut,[u[3]||(u[3]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Perfil ",-1)),l("div",dt,[l("div",pt,[l("span",ct,y(("avatarText"in m?m.avatarText:a(he))(i.opportunity.customer.name)),1),l("div",mt,[e(S,{to:{name:"apps-ecommerce-customer-details-id",params:{id:1}},class:"font-weight-base"},{default:t(()=>[V(y(i.opportunity.customer.name),1)]),_:1}),l("span",ft,y(i.opportunity.customer.phone),1)]),e(j,{color:"secondary",variant:"tonal",size:"small",onClick:b},{default:t(()=>u[2]||(u[2]=[V(" Editar Perfil ")])),_:1})])])])]),l("div",null,[u[5]||(u[5]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),i.opportunity.procedure&&i.opportunity.procedure.length>0?(s(),f("div",yt,[(s(!0),f(B,null,H(i.opportunity.procedure,n=>(s(),f("div",{key:n.id},[e(X,{color:n.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:c=>x(n.id,n.pivot.is_check)},{default:t(()=>[n.pivot.is_check?(s(),q(J,{key:0,icon:"tabler-check",class:"mr-2"})):M("",!0),V(" "+y(n.title),1)]),_:2},1032,["color","onClick"]),e(te,{activator:"parent",location:"top"},{default:t(()=>[V(y(n.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(s(),f("div",vt,u[4]||(u[4]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),l("div",null,[u[8]||(u[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Cotizaciones ",-1)),i.opportunity.quotes&&i.opportunity.quotes.length>0?(s(),f("div",gt,[e(de,{density:"compact",class:"text-no-wrap",style:{"font-size":"12px"}},{default:t(()=>[u[6]||(u[6]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th")])],-1)),l("tbody",null,[(s(!0),f(B,null,H(i.opportunity.quotes,n=>(s(),f("tr",{key:n.id},[l("td",null,y(n.properties[0].title),1),l("td",null,y(n.created_at),1),l("td",null,y(("formatCurrency"in m?m.formatCurrency:a(le))(n.amount)),1),l("td",null,[e(Q,null,{default:t(()=>[e(se,{modelValue:n.status,"onUpdate:modelValue":c=>n.status=c,"true-value":"APPROVED","false-value":"NOT_APPROVED",disabled:""},null,8,["modelValue","onUpdate:modelValue"]),e(se,{modelValue:n.status_customer,"onUpdate:modelValue":c=>n.status_customer=c,"true-value":"APPROVED","false-value":"NOT_APPROVED",onClick:c=>w(n.id,n.status_customer)},{default:t(()=>[e(te,{activator:"parent",location:"top"},{default:t(()=>[V(y(n.status_customer=="NOT_APPROVED"?"No aprobado por cliente":"Aprobado por cliente"),1)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","onClick"]),e(S,{to:{name:"quote-id",params:{id:n.id}}},{default:t(()=>[e(T,null,{default:t(()=>[e(J,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])]),_:2},1024)])]))),128))])]),_:1})])):(s(),f("div",_t,u[7]||(u[7]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(Y,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(S,{to:{name:"quote-add-quote"},class:"text-white"},{default:t(()=>[e(j,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>u[9]||(u[9]=[V(" Generar Cotización ")])),_:1})]),_:1}),e(j,{color:"primary",class:"mx-auto",size:"small",onClick:_},{default:t(()=>u[10]||(u[10]=[V(" Generar Venta ")])),_:1})]),_:1}),e(Ee,{"is-dialog-visible":a(A),"onUpdate:isDialogVisible":u[0]||(u[0]=n=>L(A)?A.value=n:null),"opportunity-kanban":i.opportunity,"onUpdate:newProperty":p},null,8,["is-dialog-visible","opportunity-kanban"]),e(xe,{"is-dialog-visible":a(d),"onUpdate:isDialogVisible":u[1]||(u[1]=n=>L(d)?d.value=n:null),opportunity:i.opportunity,stage:"PRESALE",onRegisterSale:h},null,8,["is-dialog-visible","opportunity"])],64)}}},Vt={class:"d-flex align-bottom flex-sm-row flex-column"},wt={class:"user-profile-info"},Ct={class:"d-flex align-center justify-center justify-sm-space-between flex-wrap gap-4"},kt={class:"d-flex align-center gap-x-3"},xt={class:"text-4xl font-weight-medium"},Dt={class:"d-flex flex-column py-2",style:{"font-size":"14px"}},At={class:"text-sm text-disabled"},Pt={key:0,class:"d-flex flex-wrap gap-2 my-5"},St={key:1},ht={key:0,class:"d-flex flex-wrap gap-2 my-5"},Ut={key:1},$t={__name:"EditProspectOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","update:newProperty"],setup(I,{emit:z}){const i=I,g=z,{checkProcessForOpportunity:O}=pe(),{changeStatusByOpportunity:P,loadingOpportunity:A}=ie(),d=k(!1),b=()=>{d.value=!0},p=()=>{console.log("Se escucho el evento en EditProspectOpportunity"),g("update:newProperty")},_=async x=>{await P(x,ke.PRESALE.value,{}),g("updateStageId",x)},h=async x=>{console.log(`Procedimiento ${x.id} marcado como: ${x.pivot.is_check?"realizado":"no realizado"}`),await O(i.opportunity.id,x.id,{is_check:!x.pivot.is_check}),x.pivot.is_check=!x.pivot.is_check,g("updateStageId",i.opportunity.id)};return(x,w)=>{const m=ue("RouterLink"),u=ue("IconBtn");return s(),f(B,null,[l("div",Vt,[l("div",wt,[w[3]||(w[3]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Perfil ",-1)),l("div",Ct,[l("div",kt,[l("span",xt,y(("avatarText"in x?x.avatarText:a(he))(i.opportunity.customer.name)),1),l("div",Dt,[e(m,{to:{name:"apps-ecommerce-customer-details-id",params:{id:1}},class:"font-weight-base"},{default:t(()=>[V(y(i.opportunity.customer.name),1)]),_:1}),l("span",At,y(i.opportunity.customer.phone),1)]),l("div",null,[e(j,{color:"secondary",variant:"tonal",size:"small",onClick:b},{default:t(()=>w[2]||(w[2]=[V(" Editar Perfil ")])),_:1})])])])])]),l("div",null,[w[5]||(w[5]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),i.opportunity.procedure&&i.opportunity.procedure.length>0?(s(),f("div",Pt,[(s(!0),f(B,null,H(i.opportunity.procedure,S=>(s(),f("div",{key:S.id},[e(X,{color:S.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:T=>h(S)},{default:t(()=>[S.pivot.is_check?(s(),q(J,{key:0,icon:"tabler-check",class:"mr-2"})):M("",!0),V(" "+y(S.title),1)]),_:2},1032,["color","onClick"]),e(te,{activator:"parent",location:"top"},{default:t(()=>[V(y(S.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(s(),f("div",St,w[4]||(w[4]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),l("div",null,[w[8]||(w[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Cotizaciones ",-1)),i.opportunity.quotes&&i.opportunity.quotes.length>0?(s(),f("div",ht,[e(de,{density:"compact",class:"text-no-wrap",style:{"font-size":"12px"}},{default:t(()=>[w[6]||(w[6]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th")])],-1)),l("tbody",null,[(s(!0),f(B,null,H(i.opportunity.quotes,S=>(s(),f("tr",{key:S.id},[l("td",null,y(S.properties[0].title),1),l("td",null,y(S.created_at),1),l("td",null,y(("formatCurrency"in x?x.formatCurrency:a(le))(S.amount)),1),l("td",null,[e(m,{to:{name:"quote-id",params:{id:S.id}}},{default:t(()=>[e(u,null,{default:t(()=>[e(J,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])])]))),128))])]),_:1})])):(s(),f("div",Ut,w[7]||(w[7]=[l("span",null,"No hay cotizaciones disponibles.",-1)])))]),e(Y,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(m,{to:{name:"quote-add-quote"},class:"text-white"},{default:t(()=>[e(j,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>w[9]||(w[9]=[V(" Generar Cotización ")])),_:1})]),_:1}),e(j,{color:"primary",class:"mx-auto",size:"small",disabled:a(A),loading:a(A),onClick:w[0]||(w[0]=S=>_(i.opportunity.id))},{default:t(()=>w[10]||(w[10]=[V(" Siguiente Etapa ")])),_:1},8,["disabled","loading"])]),_:1}),e(Ee,{"is-dialog-visible":a(d),"onUpdate:isDialogVisible":w[1]||(w[1]=S=>L(d)?d.value=S:null),"opportunity-kanban":i.opportunity,"onUpdate:newProperty":p},null,8,["is-dialog-visible","opportunity-kanban"])],64)}}},Ot={__name:"DeliveryForm",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(I,{emit:z}){const i=I,g=z,{changeStatusByOpportunity:O}=ie(),P=p=>{g("update:isDialogVisible",p)},A=k(structuredClone(Z(i.opportunity)));ne(i,()=>{A.value=structuredClone(Z(i.opportunity))});const d=async()=>{g("update:isDialogVisible",!1);try{await O(i.opportunity.id,5,{delivery_date:A.value.sales.delivery_date}),g("updateDeliveryDate",A.value.id)}catch(p){console.error("Error updating customer:",p)}},b=()=>{g("update:isDialogVisible",!1)};return(p,_)=>{const h=ce;return s(),q(fe,{"model-value":i.isDialogVisible,"max-width":"800","onUpdate:modelValue":P},{default:t(()=>[e(h,{onClick:_[0]||(_[0]=x=>p.$emit("update:isDialogVisible",!1))}),e(W,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(me,{class:"text-h3 text-center"},{default:t(()=>_[2]||(_[2]=[V(" Confirmar Fecha ")])),_:1}),e(Y,null,{default:t(()=>[e(Y,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(v,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(re,{modelValue:a(A).sales.delivery_date,"onUpdate:modelValue":_[1]||(_[1]=x=>a(A).sales.delivery_date=x),label:"Fecha de Entrega",type:"date",rules:["requiredValidator"in p?p.requiredValidator:a(K)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),e(v,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(j,{onClick:d},{default:t(()=>_[3]||(_[3]=[V(" Pasar a Entrega ")])),_:1}),e(j,{color:"secondary",variant:"tonal",onClick:b},{default:t(()=>_[4]||(_[4]=[V(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},zt={key:0},qt={__name:"PaymentPlanEdit",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},payment:{type:Object,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(I,{emit:z}){const i=I,g=z,{updatePaymentPlans:O}=be(),P=k(!1),A=n=>{g("update:isDialogVisible",n)},d=k(structuredClone(Z(i.payment))),b=k(structuredClone(Z(i.opportunity))),p=k([]);ne(i,()=>{d.value=structuredClone(Z(i.payment)),b.value=structuredClone(Z(i.opportunity))});const _=()=>{p.value.push({amount:"",date:"",type:d.value.type})},h=n=>{p.value.splice(n,1)},x=ee(()=>p.value.reduce((n,c)=>{const R=parseFloat(c.amount)||0;return n+R},0)),w=ee(()=>p.value.length>0&&p.value.every(n=>n.amount&&n.date&&n.type)),m=ee(()=>{if(p.value.length===0)return!0;const n=p.value.reduce((C,G)=>C+(parseFloat(G.amount)||0),0),c=parseFloat(n),R=parseFloat(d.value.amount);return c===R}),u=ee(()=>p.value.length===0?!0:w.value&&m.value),S=async()=>{if(!m.value){$e("Validación fallida","La suma de las diferencias no es correcta");return}if(!u.value){alert("Por favor, completa todos los campos obligatorios.");return}P.value=!0;try{await O(d.value.id,{date:d.value.date,differData:p.value})}catch(n){console.error("Error updating customer:",n)}finally{g("updateDeliveryDate",b.value.id),g("update:isDialogVisible",!1),p.value=[],P.value=!1}},T=()=>{g("update:isDialogVisible",!1),p.value=[],errorMessage.value=""};return(n,c)=>{const R=ce;return s(),q(fe,{"model-value":i.isDialogVisible,"max-width":"800","onUpdate:modelValue":A},{default:t(()=>[e(R,{onClick:c[0]||(c[0]=C=>n.$emit("update:isDialogVisible",!1))}),e(W,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(me,{class:"text-h3 text-center"},{default:t(()=>c[2]||(c[2]=[V(" Editar Pago ")])),_:1}),e(Y,null,{default:t(()=>[e(Q,{class:"mx-5"},{default:t(()=>[e(v,{cols:"6"},{default:t(()=>[l("h3",null," Monto a Pagar : "+y(a(le)(a(d).amount)),1)]),_:1}),e(v,{cols:"6"},{default:t(()=>[e(re,{modelValue:a(d).date,"onUpdate:modelValue":c[1]||(c[1]=C=>a(d).date=C),label:"Cambiar Fecha",type:"date",rules:["requiredValidator"in n?n.requiredValidator:a(K)]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(W,{flat:"",class:"d-flex flex-column pa-5 px-5"},{default:t(()=>[(s(!0),f(B,null,H(a(p),(C,G)=>(s(),f("div",{key:C.id,class:"d-flex align-center my-4"},[e(re,{modelValue:C.amount,"onUpdate:modelValue":U=>C.amount=U,label:"Monto *",type:"number",class:"mr-4",outlined:"",rules:["requiredValidator"in n?n.requiredValidator:a(K)]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(re,{modelValue:C.date,"onUpdate:modelValue":U=>C.date=U,label:"Fecha de Pago *",type:"date",class:"mr-3",outlined:"",rules:["requiredValidator"in n?n.requiredValidator:a(K)]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(j,{color:"error",onClick:U=>h(G)},{default:t(()=>[e(J,{icon:"tabler-square-x"})]),_:2},1032,["onClick"])]))),128)),a(p).length>0?(s(),f("div",zt,[c[3]||(c[3]=l("strong",null,"Monto Restante:",-1)),V(" "+y(a(le)(a(d).amount-a(x))),1)])):M("",!0),e(j,{color:"primary",variant:"tonal",class:"mt-4",size:"small",onClick:_},{default:t(()=>c[4]||(c[4]=[V(" Diferir Pago ")])),_:1})]),_:1}),e(v,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(j,{loading:a(P),disabled:!a(u)||a(P),onClick:S},{default:t(()=>c[5]||(c[5]=[V(" Guardar ")])),_:1},8,["loading","disabled"]),e(j,{color:"error",variant:"tonal",onClick:T},{default:t(()=>c[6]||(c[6]=[V(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},It={__name:"SalePaymentPlan",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},salesPayment:{type:Array,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(I,{emit:z}){const i=I,g=z;be();const O=b=>{g("update:isDialogVisible",b)},P=k(structuredClone(Z(i.opportunity)));ne(i,()=>{P.value=structuredClone(Z(i.opportunity)),console.log("Sales Payment:",i.salesPayment)});const A=k([]),d=()=>{g("update:isDialogVisible",!1),A.value=[]};return(b,p)=>{const _=ce;return s(),q(fe,{"model-value":i.isDialogVisible,"max-width":"800","onUpdate:modelValue":O},{default:t(()=>[e(_,{onClick:p[0]||(p[0]=h=>b.$emit("update:isDialogVisible",!1))}),e(W,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(me,{class:"text-h3 text-center"},{default:t(()=>p[1]||(p[1]=[V(" Confirmar Fecha ")])),_:1}),e(Y,null,{default:t(()=>[e(Y,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(v,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l("span",null," Monto a Pagar : "+y(a(P)),1)]),_:1})]),_:1})]),_:1}),e(v,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(j,{onClick:b.onFormSubmit},{default:t(()=>p[2]||(p[2]=[V(" Guardar ")])),_:1},8,["onClick"]),e(j,{color:"error",variant:"tonal",onClick:d},{default:t(()=>p[3]||(p[3]=[V(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Ft={class:"text-h6"},Et={class:"text-h6"},jt={class:"text-h6"},Bt={class:"my-5"},Tt={key:0},Rt=["src"],Nt={class:"mb-4"},Lt=["onClick"],Mt=["onClick"],Qt={class:"my-5"},Ht={key:0,class:"d-flex flex-wrap gap-2 my-5"},Kt={key:1},Yt={__name:"EditSaleOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId"],setup(I,{emit:z}){const i=I,g=z,{checkProcessForOpportunity:O}=pe(),{confirmPaymentPlans:P}=be(),{changeStatusByOpportunity:A,loadingOpportunity:d}=ie(),{SaleChangeSignature:b}=Ke(),p=k(!1),_=k(!1),h=k(!1),x=k(""),w=ee(()=>i.opportunity.sales.reduce((D,r)=>D+r.amount,0)),m=ee(()=>i.opportunity.sales.reduce((D,r)=>D+r.initial_fee,0)),u=ee(()=>w.value-m.value),S=()=>{h.value=!0},T=D=>{if(D.is_paid===1){$e("Advertencia","No se puede editar un pago ya realizado.");return}console.log("entro aqui"),_.value=!0,x.value={...D}},n=async D=>{g("updateStageId",D)},c=async D=>{console.log(`Procedimiento ${D.id} marcado como: ${D.pivot.is_check?"realizado":"no realizado"}`),await O(i.opportunity.id,D.id,{is_check:!D.pivot.is_check}),D.pivot.is_check=!D.pivot.is_check,g("updateStageId",i.opportunity.id)},R=async D=>{console.log(D),await P(D),g("updateStageId",i.opportunity.id)},C=async D=>{console.log("entra a firma"),await b(D),g("updateStageId",i.opportunity.id)},G=async D=>{await A(D,5,{}),g("updateStageId",D)},U=async D=>{g("updateStageId",D)};return(D,r)=>(s(),f(B,null,[l("div",null,[e(W,null,{default:t(()=>[e(Y,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(v,{cols:"4",class:"border rounded-sm mx-1"},{default:t(()=>[e(oe,{class:"font-weight-medium"},{default:t(()=>r[5]||(r[5]=[V(" Saldo ")])),_:1}),e(ae,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Ft,y(("formatCurrency"in D?D.formatCurrency:a(le))(a(u))),1)]),_:1})]),_:1}),e(v,{cols:"3",class:"border rounded-sm mx-1"},{default:t(()=>[e(oe,{class:"font-weight-medium"},{default:t(()=>r[6]||(r[6]=[V(" Anticipo ")])),_:1}),e(ae,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Et,y(("formatCurrency"in D?D.formatCurrency:a(le))(a(m))),1)]),_:1})]),_:1}),e(v,{cols:"4",class:"border rounded-sm mx-1"},{default:t(()=>[e(oe,{class:"font-weight-medium"},{default:t(()=>r[7]||(r[7]=[V(" Precio Final ")])),_:1}),e(ae,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",jt,y(("formatCurrency"in D?D.formatCurrency:a(le))(a(w))),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),l("div",Bt,[r[9]||(r[9]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Propiedades ",-1)),i.opportunity.sales.length>0?(s(),f("div",Tt,[(s(!0),f(B,null,H(i.opportunity.sales,o=>(s(),f("div",{key:o.id},[e(Q,null,{default:t(()=>[(s(!0),f(B,null,H(o.properties,$=>(s(),q(v,{key:$.id,class:"d-flex align-center justify-between",cols:"12",md:"9"},{default:t(()=>[e(Pe,{size:"50",rounded:""},{default:t(()=>[l("img",{src:a(Fe),alt:"Logo pora",style:{"border-radius":"30%"}},null,8,Rt)]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(oe,{class:"font-weight-medium"},{default:t(()=>[V(y($.project_title)+" | "+y($.title),1)]),_:2},1024),e(ae,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",null,"$ "+y($.pivot_price),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),e(se,{modelValue:o.confirmation_signature,"onUpdate:modelValue":$=>o.confirmation_signature=$,"true-value":1,"false-value":0,onChange:$=>C(o.id)},{default:t(()=>[e(te,{activator:"parent",location:"top"},{default:t(()=>r[8]||(r[8]=[V(" Confirmar firma ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]))),128))])):M("",!0)]),l("div",Nt,[r[12]||(r[12]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Anticipo ",-1)),i.opportunity.initial_payments&&i.opportunity.initial_payments.length>0?(s(),q(de,{key:0,density:"compact",class:"text-no-wrap my-2",style:{"font-size":"12px"}},{default:t(()=>[r[11]||(r[11]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th",null," Action ")])],-1)),l("tbody",null,[(s(!0),f(B,null,H(i.opportunity.initial_payments,o=>(s(),f("tr",{key:o.id},[l("td",null,y(o.property_title),1),l("td",null,y(o.date),1),l("td",null,y(o.amount),1),l("td",null,[e(Q,null,{default:t(()=>[e(se,{modelValue:o.is_paid,"onUpdate:modelValue":$=>o.is_paid=$,"true-value":1,"false-value":0,disabled:o.is_paid===1,onChange:$=>R(o.id)},{default:t(()=>[e(te,{activator:"parent",location:"top"},{default:t(()=>r[10]||(r[10]=[V(" Confirmar Pago ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"]),o.is_paid===0?(s(),f("div",{key:0,"fill-dot":"",style:{cursor:"pointer"},onClick:$=>T(o)},[e(a(J),{size:"25",icon:"tabler-edit"})],8,Lt)):M("",!0)]),_:2},1024)])]))),128))])]),_:1})):M("",!0)]),l("div",null,[r[15]||(r[15]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Saldos ",-1)),i.opportunity.balance_payments&&i.opportunity.balance_payments.length>0?(s(),q(de,{key:0,density:"compact",class:"text-no-wrap my-2",style:{"font-size":"12px"}},{default:t(()=>[r[14]||(r[14]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th",null," Action ")])],-1)),l("tbody",null,[(s(!0),f(B,null,H(i.opportunity.balance_payments,o=>(s(),f("tr",{key:o.id},[l("td",null,y(o.property_title),1),l("td",null,y(o.date),1),l("td",null,y(o.amount),1),l("td",null,[e(Q,null,{default:t(()=>[e(se,{modelValue:o.is_paid,"onUpdate:modelValue":$=>o.is_paid=$,"true-value":1,"false-value":0,disabled:o.is_paid===1,onChange:$=>R(o.id)},{default:t(()=>[e(te,{activator:"parent",location:"top"},{default:t(()=>r[13]||(r[13]=[V(" Confirmar Pago ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"]),o.is_paid===0?(s(),f("div",{key:0,"fill-dot":"",style:{cursor:"pointer"},onClick:$=>T(o)},[e(a(J),{size:"25",icon:"tabler-edit"})],8,Mt)):M("",!0)]),_:2},1024)])]))),128))])]),_:1})):M("",!0)]),l("div",Qt,[r[17]||(r[17]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),i.opportunity.procedure&&i.opportunity.procedure.length>0?(s(),f("div",Ht,[(s(!0),f(B,null,H(i.opportunity.procedure,o=>(s(),f("div",{key:o.id},[e(X,{color:o.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:$=>c(o)},{default:t(()=>[o.pivot.is_check?(s(),q(a(J),{key:0,icon:"tabler-check",class:"mr-2"})):M("",!0),V(" "+y(o.title),1)]),_:2},1032,["color","onClick"]),e(te,{activator:"parent",location:"top"},{default:t(()=>[V(y(o.pivot.is_check?"Deshacer Proceso":"Confirmar Proceso"),1)]),_:2},1024)]))),128))])):(s(),f("div",Kt,r[16]||(r[16]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(Y,{class:"d-flex mt-4"},{default:t(()=>[e(j,{color:"primary",variant:"tonal",class:"mx-auto",size:"small",onClick:S},{default:t(()=>r[18]||(r[18]=[V(" Generar Venta ")])),_:1}),e(j,{color:"primary",class:"mx-auto",size:"small",onClick:r[0]||(r[0]=o=>G(i.opportunity.id))},{default:t(()=>r[19]||(r[19]=[V(" Siguiente Etapa ")])),_:1})]),_:1}),e(Ot,{"is-dialog-visible":a(p),"onUpdate:isDialogVisible":r[1]||(r[1]=o=>L(p)?p.value=o:null),opportunity:i.opportunity,onUpdateDeliveryDate:U},null,8,["is-dialog-visible","opportunity"]),e(qt,{"is-dialog-visible":a(_),"onUpdate:isDialogVisible":r[2]||(r[2]=o=>L(_)?_.value=o:null),payment:a(x),opportunity:i.opportunity,onUpdateDeliveryDate:U},null,8,["is-dialog-visible","payment","opportunity"]),e(xe,{"is-dialog-visible":a(h),"onUpdate:isDialogVisible":r[3]||(r[3]=o=>L(h)?h.value=o:null),opportunity:i.opportunity,stage:"SALE",onRegisterSale:n},null,8,["is-dialog-visible","opportunity"]),e(It,{"is-dialog-visible":D.openSaleEditPaymentPlan,"onUpdate:isDialogVisible":r[4]||(r[4]=o=>D.openSaleEditPaymentPlan=o),opportunity:i.opportunity,"sales-payment":D.salePaymentPlan,onUpdateDeliveryDate:U},null,8,["is-dialog-visible","opportunity","sales-payment"])],64))}},Gt={__name:"DrawerBitacora",props:{isDrawerOpen:{type:Boolean,required:!0},customer:{type:String,required:!0}},emits:["update:isDrawerOpen"],setup(I,{emit:z}){const i=I,g=z,O=P=>{g("update:isDrawerOpen",P)};return(P,A)=>(s(),q(ze,{temporary:"",width:500,location:"end",class:"scrollable-content","model-value":i.isDrawerOpen,"onUpdate:modelValue":O},{default:t(()=>[e(a(Oe),{options:{wheelPropagation:!1}},{default:t(()=>[e(Re,{customer:I.customer},null,8,["customer"])]),_:1})]),_:1},8,["model-value"]))}};const Jt={__name:"SellerReport",setup(I){return k([{title:"Actividad 1",date:"2024-10-09",status:"Pendiente"},{title:"Actividad 2",date:"2024-10-10",status:"Completada"},{title:"Actividad 3",date:"2024-10-11",status:"En Progreso"}]),(z,i)=>(s(),q(Y,null,{default:t(()=>i[0]||(i[0]=[l("p",null,"No hay actividades seleccionadas. Aquí tienes un resumen de las actividades:",-1)])),_:1}))}},Zt=qe(Jt,[["__scopeId","data-v-c9cbe3f1"]]),Wt={__name:"CustomerHistory",props:{isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","userData"],setup(I,{emit:z}){const i=I,g=z,O=k(!1),P=k(),A=k(""),d=k(""),b=k(""),p=k(""),_=k(),h=k(""),x=k(),w=k(),m=k(),u=()=>{g("update:isDrawerOpen",!1),Ve(()=>{var n,c;(n=P.value)==null||n.reset(),(c=P.value)==null||c.resetValidation()})},S=()=>{var n;(n=P.value)==null||n.validate().then(({valid:c})=>{c&&(g("userData",{id:0,fullName:A.value,company:p.value,role:x.value,country:_.value,contact:h.value,email:b.value,currentPlan:w.value,status:m.value,avatar:"",billing:"Auto Debit"}),g("update:isDrawerOpen",!1),Ve(()=>{var R,C;(R=P.value)==null||R.reset(),(C=P.value)==null||C.resetValidation()}))})},T=n=>{g("update:isDrawerOpen",n)};return(n,c)=>{const R=Ye,C=ge,G=_e;return s(),q(ze,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":i.isDrawerOpen,"onUpdate:modelValue":T},{default:t(()=>[e(R,{title:"Historial del Cliente",onCancel:u}),e(a(Oe),{options:{wheelPropagation:!1}},{default:t(()=>[e(W,{flat:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(Ue,{ref_key:"refForm",ref:P,modelValue:a(O),"onUpdate:modelValue":c[9]||(c[9]=U=>L(O)?O.value=U:null),onSubmit:Se(S,["prevent"])},{default:t(()=>[e(Q,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[e(C,{modelValue:a(A),"onUpdate:modelValue":c[0]||(c[0]=U=>L(A)?A.value=U:null),rules:["requiredValidator"in n?n.requiredValidator:a(K)],label:"Full Name",placeholder:"John Doe"},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(C,{modelValue:a(d),"onUpdate:modelValue":c[1]||(c[1]=U=>L(d)?d.value=U:null),rules:["requiredValidator"in n?n.requiredValidator:a(K)],label:"Username",placeholder:"Johndoe"},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(C,{modelValue:a(b),"onUpdate:modelValue":c[2]||(c[2]=U=>L(b)?b.value=U:null),rules:["requiredValidator"in n?n.requiredValidator:a(K),"emailValidator"in n?n.emailValidator:a(Be)],label:"Email",placeholder:"johndoe@email.com"},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(C,{modelValue:a(p),"onUpdate:modelValue":c[3]||(c[3]=U=>L(p)?p.value=U:null),rules:["requiredValidator"in n?n.requiredValidator:a(K)],label:"Company",placeholder:"PixInvent"},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(G,{modelValue:a(_),"onUpdate:modelValue":c[4]||(c[4]=U=>L(_)?_.value=U:null),label:"Select Country",placeholder:"Select Country",rules:["requiredValidator"in n?n.requiredValidator:a(K)],items:["USA","UK","India","Australia"]},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(C,{modelValue:a(h),"onUpdate:modelValue":c[5]||(c[5]=U=>L(h)?h.value=U:null),type:"number",rules:["requiredValidator"in n?n.requiredValidator:a(K)],label:"Contact",placeholder:"+1-541-754-3010"},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(G,{modelValue:a(x),"onUpdate:modelValue":c[6]||(c[6]=U=>L(x)?x.value=U:null),label:"Select Role",placeholder:"Select Role",rules:["requiredValidator"in n?n.requiredValidator:a(K)],items:["Admin","Author","Editor","Maintainer","Subscriber"]},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(G,{modelValue:a(w),"onUpdate:modelValue":c[7]||(c[7]=U=>L(w)?w.value=U:null),label:"Select Plan",placeholder:"Select Plan",rules:["requiredValidator"in n?n.requiredValidator:a(K)],items:["Basic","Company","Enterprise","Team"]},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(G,{modelValue:a(m),"onUpdate:modelValue":c[8]||(c[8]=U=>L(m)?m.value=U:null),label:"Select Status",placeholder:"Select Status",rules:["requiredValidator"in n?n.requiredValidator:a(K)],items:[{title:"Active",value:"active"},{title:"Inactive",value:"inactive"},{title:"Pending",value:"pending"}]},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(j,{type:"submit",class:"me-3"},{default:t(()=>c[10]||(c[10]=[V(" Submit ")])),_:1}),e(j,{type:"reset",variant:"outlined",color:"secondary",onClick:u},{default:t(()=>c[11]||(c[11]=[V(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Xt={class:"d-flex justify-space-between align-center"},el={class:"mb-2"},tl={style:{"font-size":"14px","font-weight":"500"}},ll={style:{"font-size":"12px","font-weight":"500"}},ol={__name:"AddActivity",props:{activitiesData:{type:Object,required:!0,default:()=>({title:"",description:"",schedule_at:""})},isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","refreshActivities"],setup(I,{emit:z}){const i=I,g=z,O=k(!1);k(!1);const P=k("radio-1"),A=k(!1),d=()=>{A.value=!0},b=k({title:"",description:"",type_activity_id:null,opportunity_id:null,assigned_to:null,scheduled_at:null,status:"COMPLETED"}),{completedActivityAndRegister:p,getallTypeActivities:_,typeActivities:h,loadingActivity:x}=De(),{getOpportunitybyId:w,opportunity:m}=ie(),u=k(structuredClone(Z(i.activitiesData))),S=r=>{console.log("esta consultando de nuevo despues de cambiar etapa "),w(r)};ne(i,()=>{u.value=structuredClone(Z(i.activitiesData)),w(u.value.opportunity_id),T()});const T=async()=>{await _()},n=()=>{w(u.value.opportunity_id)},c=()=>{g("update:isDrawerOpen",!1),b.value={title:null,description:null,type_activity_id:null,scheduled_at:null,opportunity_id:null,assigned_to:null,status:"COMPLETED"},g("refreshActivities")},R=async()=>{let r="";P.value==="radio-1"?r="COMPLETED":P.value==="radio-2"&&(r="CANCELLED"),p(u.value.id,{title:b.value.title,description:b.value.description,type_activity_id:b.value.type_activity_id,scheduled_at:b.value.scheduled_at,assigned_to:m.value.user_id,property_id:m.value.property_id,opportunity_id:m.value.id,status:r}),c()},C=async()=>{we.fire({title:"Quieres dar de baja al cliente ?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"confirmar"}).then(r=>{r.isConfirmed&&(je(u.value.id),c(),we.fire({text:"EL cliente fue dado de baja",icon:"success"}))})},G=async()=>{g("update:isDrawerOpen",!1),g("refreshActivities")},U=()=>{console.log("Se escucho el evento en AddActivity"),g("refreshActivities")},D=r=>{const o=new Date(r),$=o.getDate(),N=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][o.getMonth()],E=o.getHours().toString().padStart(2,"0"),ye=o.getMinutes().toString().padStart(2,"0");return`${$} de ${N}, ${E}:${ye}`};return(r,o)=>{const $=ge,F=Te,N=Ae;return s(),f(B,null,[e(Q,{class:"d-flex justify-space-between"},{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[I.isDrawerOpen?(s(),q(W,{key:0},{default:t(()=>[e(Y,null,{default:t(()=>[e(Ie,{class:"mx-2 my-2"},{default:t(()=>[e(Q,null,{default:t(()=>[e(v,{cols:"12",sm:"5"},{default:t(()=>[e(Q,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[l("div",Xt,[o[8]||(o[8]=l("span",{style:{"font-size":"18px","font-weight":"500"}}," Actividad ",-1)),e(X,{color:"warning",onClick:d},{default:t(()=>o[7]||(o[7]=[V(" historial ")])),_:1})])]),_:1}),e(v,{cols:"12"},{default:t(()=>[l("div",el,[l("span",tl,y(i.activitiesData.title)+" • "+y(D(i.activitiesData.scheduled_at)),1),o[9]||(o[9]=l("br",null,null,-1)),l("span",ll,y(i.activitiesData.description)+" "+y(a(m).customer_id),1)]),e(Je,{modelValue:a(P),"onUpdate:modelValue":o[0]||(o[0]=E=>L(P)?P.value=E:null),style:{"font-size":"14px"},inline:""},{default:t(()=>[o[10]||(o[10]=l("span",{class:"my-1"}," ¿Se realizó? ",-1)),e(Ce,{label:"Si",value:"radio-1",density:"compact",class:"mx-2"}),e(Ce,{label:"No",value:"radio-2",class:"mx-2",density:"compact"})]),_:1},8,["modelValue"]),e(Ze,{class:"mt-2"})]),_:1}),e(v,{cols:"12"},{default:t(()=>[e($,{modelValue:a(b).title,"onUpdate:modelValue":o[1]||(o[1]=E=>a(b).title=E),label:"Título de la actividad",placeholder:"..."},null,8,["modelValue"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(_e,{modelValue:a(b).type_activity_id,"onUpdate:modelValue":o[2]||(o[2]=E=>a(b).type_activity_id=E),label:"Tipo de actividad",placeholder:"Selecciona el tipo de actividad",items:a(h).map(E=>({title:E.name,value:E.id}))},null,8,["modelValue","items"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(F,{modelValue:a(b).scheduled_at,"onUpdate:modelValue":o[3]||(o[3]=E=>a(b).scheduled_at=E),label:"Seleccione la fecha y hora",placeholder:"Seleccione la fecha y hora",config:{enableTime:!0,dateFormat:"Y-m-d H:i"},rules:["requiredValidator"in r?r.requiredValidator:a(K)]},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(N,{modelValue:a(b).description,"onUpdate:modelValue":o[4]||(o[4]=E=>a(b).description=E),label:"Descripción",rows:"3",rules:["requiredValidator"in r?r.requiredValidator:a(K)]},null,8,["modelValue","rules"])]),_:1}),e(v,null,{default:t(()=>[e(j,{color:"primary",class:"mx-auto",size:"small",loading:a(x),disabled:a(x),onClick:R},{default:t(()=>o[11]||(o[11]=[V(" Crear Actividad ")])),_:1},8,["loading","disabled"]),e(j,{color:"primary",class:"mx-1",variant:"tonal",size:"small",onClick:C},{default:t(()=>o[12]||(o[12]=[V(" Dar de Baja ")])),_:1})]),_:1})]),_:1})]),_:1}),e(v,{cols:"12",sm:"7",style:{"align-items":"center"}},{default:t(()=>[e(Q,{class:"mb-2"},{default:t(()=>[e(v,{cols:"6"},{default:t(()=>o[13]||(o[13]=[l("span",{style:{"font-size":"18px","font-weight":"500"}}," Etapa ",-1)])),_:1}),e(v,{cols:"12",md:"6",class:"d-flex justify-end align-center"},{default:t(()=>[e(X,{label:"",color:"primary"},{default:t(()=>[V(y(a(m).stage.title),1)]),_:1})]),_:1})]),_:1}),a(m).stage_id===2?(s(),q($t,{key:0,opportunity:a(m),onUpdateStageId:S,"onUpdate:newProperty":U},null,8,["opportunity"])):M("",!0),a(m).stage_id===3?(s(),q(bt,{key:1,opportunity:a(m),onUpdateStageId:S,"onUpdate:newProperty":U},null,8,["opportunity"])):M("",!0),a(m).stage_id===4?(s(),q(Yt,{key:2,opportunity:a(m),onRefreshActivities:n,onUpdateStageId:S},null,8,["opportunity"])):M("",!0),a(m).stage_id===5?(s(),q(st,{key:3,opportunity:a(m),onRefreshActivities:n,onUpdateStageId:S,onComplet:G},null,8,["opportunity"])):M("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):(s(),q(W,{key:1,title:"Reporte de Actividades"},{default:t(()=>[e(Zt)]),_:1}))]),_:1}),e(v,{cols:"12",md:"6"},{default:t(()=>[e(Wt,{"is-drawer-open":a(O),"onUpdate:isDrawerOpen":o[5]||(o[5]=E=>L(O)?O.value=E:null)},null,8,["is-drawer-open"])]),_:1})]),_:1}),e(Gt,{"is-drawer-open":a(A),"onUpdate:isDrawerOpen":o[6]||(o[6]=E=>L(A)?A.value=E:null),customer:a(m).customer_id},null,8,["is-drawer-open","customer"])],64)}}};const al={class:"mt-2 mx-3"},il={style:{"font-size":"14px"}},nl={key:0,class:"no-activities-message d-flex flex-column justify-center align-center",style:{"min-block-size":"200px","text-align":"center"}},sl=["onClick"],rl={class:"mx-2"},ul={class:"d-flex justify-content-between",style:{"font-size":"0.9em"}},dl={__name:"list",setup(I){const z=k(""),i=k("Anteriores");k(["Todos","PORA"]),k("Todos");const{getallActivitiesByAsesorFecha:g,getallActivitiesByFechaPast:O,getallActivitiesByFechaFuture:P,activities:A,activitiesPast:d,activitiesFuture:b}=De(),p=k(""),_=Ne("userData").value,h=k(!0),x=k([]),w=k([]),m=k([]),u=async()=>{await g(_.id),x.value=A.value},S=async()=>{await O(_.id),w.value=d.value},T=async()=>{await P(_.id),m.value=b.value};Le(async()=>{await u(),await S(),await T(),h.value=!1});const n=k(!1),c=r=>{n.value=!0,p.value={...r}},R=async()=>{h.value=!0,await u(),await S(),await T(),h.value=!1},C=ee(()=>[{tabName:"Anteriores",icon:"tabler-calendar",actividades:w,badge:w.value.length},{tabName:"Hoy",icon:"tabler-edit",actividades:x,badge:x.value.length},{tabName:"Futuros",icon:"tabler-calendar",actividades:m,badge:m.value.length}]),G=[{type:"Visita",icon:"tabler-current-location"},{type:"Llamada",icon:"tabler-phone"},{type:"Cotizacion",icon:"tabler-cash"},{type:"Otro",icon:"tabler-table"}],U=r=>{const o=G.find($=>$.type===r);return o?o.icon:"tabler-default"},D=r=>{const o=new Date(r),$=o.getDate(),N=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][o.getMonth()],E=o.getHours().toString().padStart(2,"0"),ye=o.getMinutes().toString().padStart(2,"0");return`${$} de ${N}, ${E}:${ye}`};return ne(z,r=>{const o=$=>$.filter(F=>{const N=F.name_opportunity.toLowerCase().includes(r.toLowerCase()),E=F.phone_opportunity.toLowerCase().includes(r.toLowerCase());return N||E});r.length>2?(x.value=o(A.value),w.value=o(d.value),m.value=o(b.value)):(x.value=A.value,w.value=d.value,m.value=b.value)}),(r,o)=>{const $=ue("VCircularProgress");return s(),q(Q,{class:"match-height",style:{display:"flex","block-size":"100vh"}},{default:t(()=>[e(v,{cols:"12",md:"4",style:{display:"flex","flex-direction":"column"}},{default:t(()=>[e(W,{class:"flex-grow-1"},{default:t(()=>[e(me,{class:"d-flex justify-between align-center flex-wrap"},{default:t(()=>[o[5]||(o[5]=l("h4",{class:"mt-5"}," Mis Actividades ",-1)),l("div",al,[e(re,{modelValue:z.value,"onUpdate:modelValue":o[0]||(o[0]=F=>z.value=F),placeholder:"Buscar actividad...",class:"search-field",variant:"plain","hide-details":"",dense:"","prepend-inner-icon":"tabler-search"},null,8,["modelValue"])])]),_:1}),e(We,{modelValue:i.value,"onUpdate:modelValue":o[1]||(o[1]=F=>i.value=F),grow:""},{default:t(()=>[(s(!0),f(B,null,H(C.value,F=>(s(),q(Xe,{key:F.tabName},{default:t(()=>[l("span",il,y(F.tabName),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),o[11]||(o[11]=l("br",null,null,-1)),e(Y,{style:{"flex-grow":"1","overflow-y":"auto"}},{default:t(()=>[h.value?(s(),q(et,{key:0,absolute:"",opacity:"0.7"},{default:t(()=>[e($,{indeterminate:"",size:"70"})]),_:1})):M("",!0),e(Ie,{modelValue:i.value,"onUpdate:modelValue":o[2]||(o[2]=F=>i.value=F),class:"disable-tab-transition",style:{"max-block-size":"500px","overflow-y":"auto"}},{default:t(()=>[(s(!0),f(B,null,H(C.value,F=>(s(),q(Ge,{key:F.tabName,value:F.tabName},{default:t(()=>[F.actividades.value.length===0?(s(),f("div",nl,[e(J,{size:"64",color:"grey",icon:"tabler-calendar-off",class:"mb-4",style:{animation:"bounce 1s infinite"}}),o[6]||(o[6]=l("div",{style:{color:"#888","font-size":"1.2em"}}," ¡No tienes actividades pendientes! ",-1)),o[7]||(o[7]=l("div",{style:{color:"#aaa","font-size":"0.9em","margin-block-start":"8px"}}," ¡Relájate y disfruta tu día! ",-1))])):(s(!0),f(B,{key:1},H(F.actividades.value,N=>(s(),f("div",{key:N.id,"fill-dot":"",class:"border mb-2 rounded-sm py-2",style:{cursor:"pointer"},onClick:E=>c(N)},[e(ve,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(v,{cols:"12",md:"2",style:{"padding-inline-end":"0"}},{default:t(()=>[e(X,{class:"d-flex justify-center align-center",style:{display:"inline-flex","border-radius":"4px","block-size":"36px","inline-size":"36px"}},{default:t(()=>[e(J,{size:"25",icon:"tabler-home"})]),_:1})]),_:1}),N.project_name?(s(),q(v,{key:0,cols:"12",md:"5",class:"d-flex flex-column align-start",style:{"padding-inline-start":"0"}},{default:t(()=>[e(ae,{class:"text-left"},{default:t(()=>[l("strong",null,y(N.property_title),1)]),_:2},1024),e(oe,{class:"font-weight-medium text-left"},{default:t(()=>[l("span",null,"$ "+y(N.price),1)]),_:2},1024)]),_:2},1024)):M("",!0),N.project_name?M("",!0):(s(),q(v,{key:1,cols:"12",md:"5"},{default:t(()=>[e(ae,{class:"text-left"},{default:t(()=>o[8]||(o[8]=[l("strong",{style:{"font-size":"12px"}}," Departamento ",-1)])),_:1}),e(oe,{class:"font-weight-medium text-left"},{default:t(()=>o[9]||(o[9]=[l("span",null,"Indefinido",-1)])),_:1})]),_:1})),e(v,{cols:"12",md:"5",class:"d-flex justify-end align-center"},{default:t(()=>[e(X,{label:"",color:"primary",class:"ml-auto",style:{"font-size":"10px"}},{default:t(()=>[V(y(N.stage),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(ve,{class:""},{default:t(()=>[e(X,{label:"",color:"secondary",class:"w-100 h-48"},{default:t(()=>[e(J,{size:"20",icon:U(N.type_activity)},null,8,["icon"]),l("div",rl,y(N.type_activity)+"   •   "+y(N.name_opportunity),1)]),_:2},1024)]),_:2},1024),e(ve,null,{default:t(()=>[l("div",ul,[o[10]||(o[10]=l("div",{style:{"flex-grow":"1"}}," Ver ",-1)),l("div",null,y(D(N.scheduled_at)),1)])]),_:2},1024)],8,sl))),128))]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(v,{cols:"12",md:"8",style:{display:"flex","flex-direction":"column"}},{default:t(()=>[e(ol,{"is-drawer-open":n.value,"onUpdate:isDrawerOpen":o[3]||(o[3]=F=>n.value=F),"activities-data":p.value,class:"flex-grow-1",onRefreshActivities:R,onLoaded:o[4]||(o[4]=F=>h.value=!1)},null,8,["is-drawer-open","activities-data"])]),_:1})]),_:1})}}},Co=qe(dl,[["__scopeId","data-v-a55b93d4"]]);export{Co as default};
