import{$ as C}from"./api-f4900d91.js";import{r as A,k as ie,a2 as h,H as oe,o as P,f as O,e as u,d as E,c as se,F as ne,i as re,b as t,n as a,w as x,I as K,a0 as ue,a4 as de,v as ce}from"./index-a54c57b2.js";import{c as q,b as Q}from"./notifications-cae4d01c.js";import{r as w}from"./validators-dea6e3a5.js";import{_ as pe}from"./AppTextarea-9318e309.js";import{_ as me}from"./AppSelect-ccf756d5.js";import{_ as ee}from"./AppTextField-6f740df4.js";import{_ as ae}from"./AppAutocomplete-9ad86c49.js";import{_ as fe}from"./DialogCloseBtn-795d7e2c.js";import{u as ve}from"./useSales-5f8e57d5.js";import{P as Z,a as ge,_ as X}from"./InvoiceAddMoney-aa159e1d.js";import{S as ye}from"./usePaymentPlans-1962d9fe.js";import{V as W}from"./VNodeRenderer-a6e0d834.js";import{u as Ae}from"./useProperty-822d3234.js";import{V as B}from"./VRow-db7839b8.js";import{V as f}from"./VCol-e110b22d.js";import{V as le}from"./VCard-b8ab7ef2.js";import{V as k}from"./VCardText-974f1364.js";import{V as _e}from"./VTextField-4d59e4f8.js";import{V as D}from"./VDivider-18f44d6d.js";import{V as Ve}from"./VDialog-b5a48363.js";const be=async i=>await C("/activity",{method:"POST",body:i}),he=async i=>await C(`/activity/${i}`,{method:"GET"}),we=async()=>await C("/typeActivities",{method:"GET"}),Ce=async(i,n)=>await C(`/activity/${i}/change_status_activity`,{method:"PATCH",body:n}),Fe=async(i,n)=>await C(`/activity/${i}`,{method:"PATCH",body:n}),Se=async(i,n)=>await C(`/activity/asesor/${i}/fecha`,{method:"GET",params:n}),Te=async i=>await C(`/activity/asesor/${i}/fecha-future`,{method:"GET"}),Be=async i=>await C(`/activity/asesor/${i}/fecha-past`,{method:"GET"}),Ue=async(i,n)=>await C(`/activity/asesor/${i}/fecha-rango`,{method:"GET",params:n}),Ie=async(i,n)=>await C(`/activity/${i}/change_status`,{method:"PATCH",body:n}),qe=async i=>await C(`/activity/${i}/discard`,{method:"PATCH"});function ta(){const i=A(!1),n=A(null),p=A(null),g=A([]),T=A([]),v=A([]),S=A([]);return A(0),ie(),{loadingActivity:i,error:n,registerActivity:async c=>{i.value=!0,n.value=null;try{const s=await be(c);p.value=s.data,q("Actividad agendada correctamente",s.data.message)}catch(s){console.log(s),s.response&&s.response.status==422&&Q("Advertencia","Faltan Datos por Rellenar"),n.value=s.message}finally{i.value=!1}},getActivityId:async c=>{i.value=!0,n.value=null;try{const s=await he(c);p.value=s.data}catch(s){n.value=s.message}finally{i.value=!1}},getallTypeActivities:async()=>{try{const c=await we();console.log(c.data),S.value=c.data}catch(c){console.log(c)}},changeStatusActivity:async(c,s)=>{i.value=!0,n.value=null;try{const r=await Ce(c,s);console.log(r),p.value=r.data,q("Actividad Completada","")}catch(r){console.log(r),n.value=r.message}finally{i.value=!1}},getallActivitiesByOportunity:async(c,s)=>{i.value=!0,n.value=null;try{const r=await getByOportunity(c,s);g.value=r.data,console.log(g)}catch(r){n.value=r.message}finally{i.value=!1}},getallActivitiesByAsesorFecha:async c=>{i.value=!0,n.value=null;const s=new Date().toISOString().split("T")[0];try{const I=await Se(c,{fecha:s});g.value=I.data,console.log("Actividades de hoy:",g.value)}catch(r){n.value=r.message}finally{i.value=!1}},getallActivitiesByAsesorRangoFecha:async(c,s)=>{i.value=!0,n.value=null;try{const r=await Ue(c,s);g.value=r.data.data}catch(r){n.value=r.message}finally{i.value=!1}},getallActivitiesByFechaPast:async c=>{i.value=!0,n.value=null;try{const s=await Be(c);T.value=s.data,console.log("Actividades pasadas:",T.value)}catch(s){n.value=s.message}finally{i.value=!1}},getallActivitiesByFechaFuture:async c=>{i.value=!0,n.value=null;try{const s=await Te(c);v.value=s.data,console.log("Actividades futuras:",v.value)}catch(s){n.value=s.message}finally{i.value=!1}},updateActivity:async(c,s)=>{i.value=!0,n.value=null;try{const r=await Fe(c,s);console.log(r),p.value=r.data,q("Actividad Actualizada correctamente","Se actualizo una actividad")}catch(r){console.log(r),r.response&&r.response.status==422&&Q("Advertencia","Faltan Datos por Rellenar"),n.value=r.message}finally{i.value=!1}},completedActivityAndRegister:async(c,s)=>{i.value=!0;try{const r=await Ie(c,s);q("Nueva actividad registrada","Se completó la actividad anterior y se agregó una nueva."),console.log(r)}catch(r){n.value=r.message}finally{i.value=!1}},discardActivityOpportunity:async c=>{i.value=!0;try{const s=await qe(c);console.log(s)}catch(s){n.value=s.message}finally{i.value=!1}},activity:p,activities:h(()=>g.value),activitiesPast:h(()=>T.value),activitiesFuture:h(()=>v.value),typeActivities:h(()=>S.value)}}const ia="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANCSURBVHgB7VZJT1NRFP5e+9pSCrSFUgUUlLGCCCIyBCISNcGFaEKICcaERBbyB3TjgpVLE2MiC4lRlyYaNSIhKooiKAqUQZAZUlpmKHOHV+q9FylUINGFsnlfmrzzes859zvfOTfvcoXXC93YRUiwyxAJiAREAiIBHv8QSoUSxXlFXv/VtTWgfbDz/xCgaO5p9Xq3TI95vXsI6DXBKL1QApfLhVX3KuaX5tHUY0TD90a2Hrs/GunxaYgJi4RDcKJrqBtVjdWI2BOOi7kFqKh8iIKcfOjUOrxr+YCa5lpkxKfiUIQB/eYBuMEhwNcf3aZeLwLShOyEMmqofFTISzuNW4/voHPoB8JJ4jOpudD4qTFKWBefLUL5swoYe1uZ78mj2Wyz8dkJZCVmEDsItcZP0Gt1SIo+ApvdhvPZ51D+/B46iOT9lgEYIuKIbyYau75tVWAdGn8tekf6cP/VI1zNv4LMhHTMETUEwQXXqgszC1Y8/fgCYcGhiCOqNPU0s7iX9VUYnjBhZMqMIP9A2Jw23H5yF0q5D9INqbALDlZM7L4oqFUBLCfFllOQdTjdY79pes+edocdoboQUlmiZ63WWAfBtQr3r4/5mHWCPWfmZ9Fr7odUwqM0vwQpscloG+yAsa8NS7alNdmlUk+eLQRowKmUHCbz3kA96+fX7hZYF2bJRF9CTnI2WfMlCoSgrr3eEycIgleezITjUCl98ZbMwgppxx6tHn5K1e/bec/AiaQsVH15jRgiU/wBA2G8jMrP1bA77Wgd6ICCVyAy9CAbSMvUKGpaalk1Mp5nR8vt3rjbWKZHERQQSIY2CjwvhVwmx/CYidnGvnai3hphbv1GpNcG48blayh7cJPJuB38yRTTQFqJw+mEr8IHApkLakskEtgcNo8vL+UZMVo97bmTnBx6unzkCjLU4xt+6wbtM+0TDdgJx0h7OI5jJKg6bpJwybYCQ3g0zJOjCAzQwjRhJv2XQO2nYS20Ls6RwVajx9TH1i3EbzO4v7kTBmt0WFxZhISTsEo8ZDn641iFfqSV88uLrG1ymYypo5Ap1twI+c0qeSnwJ5i0TnlsqsB22Kwg3ZyCktkJ4tdQJCASEAmIBH4Cka1P8RSIn3sAAAAASUVORK5CYII=",ke={class:"pa-5 flex-grow-1"},Pe={__name:"InvoiceAddPropertySale",props:{propertiesform:{type:Array,required:!0}},emits:["totalAmount"],setup(i,{emit:n}){const p=i,{propertiesAvailbles:g,properties:T}=Ae();return A(100),A(1),oe(async()=>{try{g()}catch(v){console.error("Error al obtener las propiedades:",v)}}),(v,S)=>{const U=ae,_=ee;return P(),O(le,{flat:"",border:"",class:"d-flex flex-row"},{default:u(()=>[E("div",ke,[(P(!0),se(ne,null,re(p.propertiesform,(y,e)=>(P(),O(B,{key:e},{default:u(()=>[t(f,{cols:"12",sm:"4",style:{"padding-block":"0","padding-inline":"8px"}},{default:u(()=>[t(U,{modelValue:y.property_id,"onUpdate:modelValue":F=>y.property_id=F,label:y.property_type_name,rules:["requiredValidator"in v?v.requiredValidator:a(w)],placeholder:"Selecciona una propiedad *",items:a(T),"item-title":"title","item-value":"id",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","label","rules","items"])]),_:2},1024),t(f,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:u(()=>[t(_,{modelValue:y.price,"onUpdate:modelValue":F=>y.price=F,rules:["requiredValidator"in v?v.requiredValidator:a(w)],label:"Precio *",placeholder:"$us",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),t(f,{cols:"12",sm:"2",style:{"padding-block":"0","padding-inline":"8px"}},{default:u(()=>[t(_,{modelValue:y.price_it,"onUpdate:modelValue":F=>y.price_it=F,rules:["requiredValidator"in v?v.requiredValidator:a(w)],label:"3% (IT) *",placeholder:"%",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),t(f,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:u(()=>[t(_,{modelValue:y.price_contrato,"onUpdate:modelValue":F=>y.price_contrato=F,rules:["requiredValidator"in v?v.requiredValidator:a(w)],label:"Precio Contrato *",placeholder:"Escribe el precio",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024)]),_:2},1024))),128))])]),_:1})}}};const Ee={class:"d-flex align-center justify-sm-end mx-5"},Re={style:{"inline-size":"9.5rem"}},oa={__name:"PreSaleForm",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},stage:{type:String,required:!0}},emits:["update:isDialogVisible","registerSale","formCancelled","formRefresh"],setup(i,{emit:n}){var s,r,I,M,$;const p=i,g=n,{generateSale:T,generateSaleChangeStage:v}=ve(),S=A(!1),U=["20","30","40","50","70","80","100"],_=A("30"),y=()=>{g("formCancelled"),g("update:isDialogVisible",!1)},e=A({social_reason:((s=p.opportunity)==null?void 0:s.customer.name)??"",creation_date:new Date().toISOString().split("T")[0],nit:"",address:"",email:((r=p.opportunity)==null?void 0:r.customer.email)??"",phone:((I=p.opportunity)==null?void 0:I.customer.phone)??"",workplace:((M=p.opportunity)==null?void 0:M.customer.workplace)??"",payment_method:null,contract_signing_date:null,amount:null,initial_fee:null,percentage_initial_fee:null,observations:"",opportunity_id:(($=p.opportunity)==null?void 0:$.id)??null,stage_id:ye.SALE.value,balance:null,properties:[{property_id:null,price:null,price_it:null,price_contrato:null,property_type:Z.DEPARTAMENT.value,property_type_name:Z.DEPARTAMENT.label}],differs_initial_fee:[],differs_balance:[],quote_id:null}),F=o=>(e.value.initial_fee=o*_.value/100,e.value.balance=o-e.value.initial_fee,e.value.percentage_initial_fee=_.value,o*_.value/100),N=h(()=>e.value.social_reason&&e.value.nit&&e.value.phone&&e.value.amount&&e.value.creation_date&&e.value.payment_method&&e.value.quote_id),L=h(()=>e.value.properties.every(o=>o.property_id!==null&&o.price!==null&&o.price_it!==null&&o.price_contrato!==null)),j=h(()=>e.value.differs_initial_fee.length===0?!0:e.value.differs_initial_fee.every(o=>o.amount!==null)),Y=h(()=>e.value.differs_balance.length===0?!0:e.value.differs_balance.every(o=>o.amount!==null)),G=h(()=>{if(e.value.differs_initial_fee.length===0)return!0;const o=e.value.differs_initial_fee.reduce((b,V)=>b+(parseFloat(V.amount)||0),0),l=parseFloat(o),m=parseFloat(e.value.initial_fee);return console.log(l),console.log(m),l===m}),H=h(()=>{if(e.value.differs_balance.length===0)return!0;const o=e.value.differs_balance.reduce((b,V)=>b+(parseFloat(V.amount)||0),0),l=parseFloat(o),m=parseFloat(e.value.balance);return console.log(l),console.log(m),l===m}),R=h(()=>N.value&&L.value&&j.value&&Y.value),c=async()=>{if(!G.value){alert("Por favor, diferencias del anticipo ");return}if(!H.value){alert("La suma de las diferencias del balance no son correctas");return}if(!R.value){alert("Por favor, completa todos los campos obligatorios.");return}S.value=!0;try{e.value.differs_balance.length===0&&e.value.balance!=0&&e.value.differs_balance.push({date:new Date().toISOString().slice(0,19).replace("T"," "),amount:e.value.amount-e.value.initial_fee}),e.value.differs_initial_fee.length===0&&e.value.differs_initial_fee.push({date:new Date().toISOString().slice(0,19).replace("T"," "),amount:e.value.initial_fee}),p.stage==="SALE"?(await T(e.value),console.log("entro a venta")):p.stage==="PRESALE"&&await v(e.value),g("registerSale",e.value.opportunity_id),g("formRefresh")}catch(o){console.error("Error generando la venta:",o)}finally{S.value=!1,g("update:isDialogVisible",!1)}};return x(()=>p.isDialogVisible),x(()=>e.value.properties,o=>{let l=0;o.forEach(m=>{if(m.price){const b=parseFloat(m.price)||0;m.price_it=b*.03,m.price_contrato=b+m.price_it,l+=m.price_contrato}else m.price_it=null}),e.value.amount=l,e.value.initial_fee=l*.3},{deep:!0}),x(()=>e.value.quote_id,o=>{var m,b;const l=p.opportunity.quotes.find(V=>V.id==o);l&&(e.value.social_reason=l.social_reason,e.value.email=l.email,e.value.phone=l.phone,e.value.nit=l.nit,e.value.address=l.address,e.value.opportunity_id=l.opportunity_id,e.value.workplace=l.workplace,e.value.observations=l.observations,e.value.payment_method=l.payment_method,_.value=l.percentage_initial_fee,l.property_id!==null&&(e.value.properties[0].property_id=(m=l.properties[0])==null?void 0:m.id,e.value.properties[0].price=(b=l.properties[0])==null?void 0:b.pivot_price)),e.value.quote_id=o}),(o,l)=>{const m=fe,b=ae,V=ee,z=me,te=pe;return P(),O(Ve,{"model-value":p.isDialogVisible,"max-width":"1000","onUpdate:modelValue":y},{default:u(()=>[t(m,{onClick:y}),t(le,null,{default:u(()=>[t(k,{class:"d-flex flex-wrap justify-space-between gap-y-5 flex-column flex-sm-row align-center"},{default:u(()=>[t(a(W),{nodes:a(K).app.logo,class:"me-3",style:{"align-self":"center"}},null,8,["nodes"]),l[11]||(l[11]=E("h4",{class:"font-weight-bold text-h3 d-flex align-center"}," Formulario de Ventas ",-1)),t(a(W),{nodes:a(K).app.logopora,class:"me-3",style:{"align-self":"center"}},null,8,["nodes"])]),_:1}),t(B,{class:"justify-end ma-sm-2"},{default:u(()=>[E("div",Ee,[E("span",Re,[t(_e,{modelValue:a(e).creation_date,"onUpdate:modelValue":l[0]||(l[0]=d=>a(e).creation_date=d),label:"Emisión",type:"date",outlined:"",rules:["requiredValidator"in o?o.requiredValidator:a(w)]},null,8,["modelValue","rules"])])])]),_:1}),t(D,{thickness:"12"}),t(k,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row gap-y-5 gap-4"},{default:u(()=>[t(B,null,{default:u(()=>[t(a(f),{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:u(()=>[t(b,{modelValue:a(e).quote_id,"onUpdate:modelValue":l[1]||(l[1]=d=>a(e).quote_id=d),rules:["requiredValidator"in o?o.requiredValidator:a(w)],label:"Cotizaciones Aprobadas *",placeholder:"Selecciona una",items:p.opportunity.quotes.filter(d=>d.status==="APPROVED").map(d=>{var J;return{title:((J=d.properties[0])==null?void 0:J.code)+" | "+d.amount+"$ "||d.social_reason+" | "+d.amount+"$ ",value:d.id}}),outlined:""},null,8,["modelValue","rules","items"])]),_:1}),t(a(f),{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:u(()=>[t(V,{modelValue:a(e).social_reason,"onUpdate:modelValue":l[2]||(l[2]=d=>a(e).social_reason=d),rules:["requiredValidator"in o?o.requiredValidator:a(w)],label:"Cliente *",placeholder:"Canzza",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),t(a(f),{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:u(()=>[t(V,{modelValue:a(e).email,"onUpdate:modelValue":l[3]||(l[3]=d=>a(e).email=d),label:"Correo *",placeholder:"admin@gmail.com",type:"email",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1}),t(a(f),{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:u(()=>[t(V,{modelValue:a(e).phone,"onUpdate:modelValue":l[4]||(l[4]=d=>a(e).phone=d),rules:["requiredValidator"in o?o.requiredValidator:a(w)],label:"Celular *",placeholder:"77049267",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),t(a(f),{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:u(()=>[t(V,{modelValue:a(e).nit,"onUpdate:modelValue":l[5]||(l[5]=d=>a(e).nit=d),label:"C.I./NIT *",rules:["requiredValidator"in o?o.requiredValidator:a(w)],placeholder:"0000000",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),t(a(f),{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:u(()=>[t(V,{modelValue:a(e).workplace,"onUpdate:modelValue":l[6]||(l[6]=d=>a(e).workplace=d),label:"Lugar de Trabajo",placeholder:"Placeholder Text",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1}),t(a(f),{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:u(()=>[t(V,{modelValue:a(e).address,"onUpdate:modelValue":l[7]||(l[7]=d=>a(e).address=d),label:"Dirección",placeholder:"Av/ Equipetrol ....",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(D,{thickness:"12"}),t(k,{class:"add-products-form"},{default:u(()=>[t(B,null,{default:u(()=>[t(a(f),{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:u(()=>[t(Pe,{propertiesform:a(e).properties},null,8,["propertiesform"])]),_:1}),t(a(f),{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:u(()=>[t(z,{modelValue:a(e).payment_method,"onUpdate:modelValue":l[8]||(l[8]=d=>a(e).payment_method=d),rules:["requiredValidator"in o?o.requiredValidator:a(w)],label:"Tipo de Pago *",placeholder:"Seleccione ",items:Object.values(a(ge)),class:"custom-salesforce-input"},null,8,["modelValue","rules","items"])]),_:1}),t(z,{modelValue:a(_),"onUpdate:modelValue":l[9]||(l[9]=d=>ue(_)?_.value=d:null),rules:["requiredValidator"in o?o.requiredValidator:a(w)],label:"% Anticipo *",items:U,placeholder:"% Anticipo",class:"mb-2"},null,8,["modelValue","rules"])]),_:1})]),_:1}),t(D,{thickness:"12"}),t(k,{class:"add-products-form"},{default:u(()=>[t(B,null,{default:u(()=>[t(a(f),{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:u(()=>[t(X,{title:"Anticipo ",amount:F(a(e).amount),differs:a(e).differs_initial_fee,type:o.INITIAL_PAYMENT},null,8,["amount","differs","type"])]),_:1}),t(a(f),{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:u(()=>[t(X,{title:"Saldo por Pagar",amount:a(e).amount-a(e).initial_fee,differs:a(e).differs_balance,type:o.BALANCE},null,8,["amount","differs","type"])]),_:1}),t(a(f),{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:u(()=>[t(te,{modelValue:a(e).observations,"onUpdate:modelValue":l[10]||(l[10]=d=>a(e).observations=d),"auto-grow":"",label:"Observaciones del Cliente",rows:"2",placeholder:"Descripción...","row-height":"20"},null,8,["modelValue"])]),_:1}),t(a(f),{cols:"12",class:"my-5",style:{"padding-block":"0","padding-inline":"8px"}},{default:u(()=>[t(de,{color:"primary",loading:a(S),disabled:!a(R)||a(S),onClick:c},{default:u(()=>l[12]||(l[12]=[ce(" Registrar Venta ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}};export{oa as _,qe as d,ia as p,ta as u};
