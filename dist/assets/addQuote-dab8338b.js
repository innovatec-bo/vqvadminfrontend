import{r as f}from"./validators-dea6e3a5.js";import{_ as j}from"./AppAutocomplete-ddacf1f6.js";import{f as Q}from"./currencyFormatter-92ad4b3c.js";import{_ as L}from"./AppTextarea-b9296497.js";import{_ as O}from"./AppSelect-153ad761.js";import{_ as S}from"./AppTextField-5062369f.js";import{_ as G}from"./AppDateTimePicker-f5eec909.js";import{P as _,a as H,_ as W}from"./InvoiceAddMoney-59c6aca3.js";import{V as I}from"./VNodeRenderer-7edf5c3b.js";import{r as E,w as R,H as K,o as A,f as U,e as r,d as c,c as M,F as J,i as X,b as l,n,x,v as D,z as Z,a4 as F,$ as ee,I as $,a0 as le,a2 as C}from"./index-2eb1505d.js";import{u as ae}from"./useProperty-ab9addaa.js";import{V as k}from"./VRow-dfd8f421.js";import{V as u}from"./VCol-820c097e.js";import{V as N}from"./VCard-24ba86df.js";import{V as w}from"./VCardText-3bd26a97.js";import{V as z}from"./VDivider-24e0a4b7.js";import{u as oe}from"./useCustomer-ea8a3b09.js";import{u as te}from"./useQuote-1078a395.js";import{c as Y}from"./notifications-81bc0416.js";import"./helpers-61e4df1a.js";import"./form-7dc945ea.js";import"./VSelect-1575d9ab.js";import"./VTextField-1bb0ee16.js";/* empty css                   */import"./VCounter-c127849b.js";import"./VImg-be87a0e7.js";import"./VField-8f5debd9.js";import"./easing-9f15041e.js";import"./VInput-ab6bf326.js";import"./forwardRefs-8348545e.js";import"./VList-eeea6141.js";import"./ssrBoot-e465d36c.js";import"./VAvatar-f7cdf41f.js";import"./dialog-transition-2deecb94.js";import"./VMenu-cca3cf0d.js";import"./VOverlay-2610f1b2.js";import"./lazy-3f7bf9c0.js";import"./scopeId-22ff2182.js";import"./VCheckboxBtn-3e694008.js";import"./VSelectionControl-25ca5494.js";import"./VChip-1979189a.js";import"./filter-837eaa06.js";import"./api-dda96ee4.js";import"./index-9c720871.js";import"./constants-ca8ca994.js";const ie={class:"pa-5 flex-grow-1"},re={key:0,style:{"font-size":"small","padding-block":""}},ne={class:"d-flex justify-end mt-3"},de={__name:"InvoiceAddProperty",props:{properties:{type:Array,required:!0}},emits:["removeProduct","totalAmount","addProperty"],setup(h,{emit:q}){const i=h,P=q,{propertiesForType:g}=ae(),a=E([]),v=E([]),y=()=>{const e={property_id:null,price:null,property_type:_.PARK.value,property_type_name:_.PARK.label};P("addProperty",e)},T=e=>{P("removeProduct",e)},d=e=>{if(console.log("entra a update price"),e.property_type===_.DEPARTAMENT.value){const p=v.value.find(m=>m.id===e.property_id);p&&(e.price=p.base_price)}else if(e.property_type===_.PARK.value){const p=a.value.find(m=>m.id===e.property_id);p&&(e.price=p.base_price)}};return R(()=>i.properties.map(e=>e.property_id),(e,p)=>{e.forEach((m,V)=>{const t=i.properties[V];m!==p[V]&&d(t)})}),K(async()=>{try{const e=await g(_.DEPARTAMENT.value);v.value=e;const p=await g(_.PARK.value);a.value=p}catch(e){console.error("Error al obtener las propiedades:",e)}}),(e,p)=>{const m=j,V=S;return A(),U(N,{flat:"",border:"",class:"d-flex flex-row"},{default:r(()=>[c("div",ie,[(A(!0),M(J,null,X(i.properties,(t,o)=>(A(),U(k,{key:o,class:"mb-4"},{default:r(()=>[l(u,{cols:"12",sm:"4",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(m,{modelValue:t.property_id,"onUpdate:modelValue":s=>t.property_id=s,rules:["requiredValidator"in e?e.requiredValidator:n(f)],label:t.property_type_name,placeholder:"Selecciona una propiedad",items:t.property_type===n(_).DEPARTAMENT.value?n(v):n(a),"item-title":"title","item-value":"id",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules","label","items"]),t.property_id&&t.property_type===n(_).DEPARTAMENT.value?(A(),M("span",re,[c("strong",null,x(n(v).find(s=>s.id===t.property_id).departament.isfacade===1?"En fachada":"Orientacion sur")+", ",1),D(" "+x(n(v).find(s=>s.id===t.property_id).surface),1),p[0]||(p[0]=c("strong",null," m2",-1)),p[1]||(p[1]=c("br",null,null,-1)),D(" "+x(n(v).find(s=>s.id===t.property_id).departament.number_bedrooms)+" Dormitorio(s) ",1)])):Z("",!0)]),_:2},1024),l(u,{cols:"12",sm:"2",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(V,{modelValue:t.price,"onUpdate:modelValue":s=>t.price=s,rules:["requiredValidator"in e?e.requiredValidator:n(f)],label:"Precio *",placeholder:"$us",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),l(u,{cols:"12",sm:"2",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(V,{modelValue:t.price_it,"onUpdate:modelValue":s=>t.price_it=s,rules:["requiredValidator"in e?e.requiredValidator:n(f)],label:"3% (IT) *",placeholder:"%",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(V,{modelValue:t.price_contrato,"onUpdate:modelValue":s=>t.price_contrato=s,rules:["requiredValidator"in e?e.requiredValidator:n(f)],label:"Precio Contrato *",placeholder:"Escribe el precio",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),l(u,{cols:"12",sm:"1",class:"my-4"},{default:r(()=>[l(F,{color:"error",size:"small",onClick:s=>T(o)},{default:r(()=>[l(ee,{icon:"tabler-square-x"})]),_:2},1032,["onClick"])]),_:2},1024),l(u,{cols:"12",style:{"font-size":"small","padding-block":"0","padding-inline":"4px"}})]),_:2},1024))),128)),c("div",ne,[l(F,{color:"secondary",onClick:y},{default:r(()=>p[2]||(p[2]=[D(" Agregar Parqueo ")])),_:1})])])]),_:1})}}},se={class:"d-flex align-center justify-sm-end mx-2"},ue={style:{"inline-size":"9.5rem"}},pe={class:"d-flex align-center justify-sm-end"},me={style:{"inline-size":"9.5rem"}},ce={class:"text-center my-4"},fe={__name:"AddQuoteInvoice",props:{data:{type:null,required:!0}},emits:["push","remove"],setup(h,{emit:q}){const i=h,P=q,g=d=>{P("push",d)},a=d=>{P("remove",d)},v=["20","30","40","50","80","100"],y=E("30"),T=d=>(i.data.initial_fee=d*y.value/100,i.data.percentage_initial_fee=y.value,i.data.balance=d-i.data.initial_fee,d*y.value/100);return(d,e)=>{const p=G,m=S,V=O,t=L;return A(),U(N,null,{default:r(()=>[l(w,{class:"d-flex flex-wrap justify-space-between gap-y-5 flex-column flex-sm-row align-center"},{default:r(()=>[l(n(I),{nodes:n($).app.logo,class:"me-3",style:{"align-self":"center"}},null,8,["nodes"]),e[12]||(e[12]=c("h4",{class:"font-weight-bold text-h3 d-flex align-center"}," Formulario de Cotizacion ",-1)),l(n(I),{nodes:n($).app.logopora,class:"me-3",style:{"align-self":"center"}},null,8,["nodes"])]),_:1}),l(n(k),{class:"justify-end ma-sm-2"},{default:r(()=>[c("div",se,[e[13]||(e[13]=c("span",{style:{"inline-size":"6rem"}},"Emisión ",-1)),c("span",ue,[l(p,{modelValue:i.data.creation_date,"onUpdate:modelValue":e[0]||(e[0]=o=>i.data.creation_date=o),rules:["requiredValidator"in d?d.requiredValidator:n(f)],density:"compact",placeholder:"YYYY-MM-DD",config:{position:"auto right"}},null,8,["modelValue","rules"])])]),c("div",pe,[e[14]||(e[14]=c("span",{class:"mx-2"},"Válido ",-1)),c("span",me,[l(p,{modelValue:i.data.expiration_date,"onUpdate:modelValue":e[1]||(e[1]=o=>i.data.expiration_date=o),rules:["requiredValidator"in d?d.requiredValidator:n(f)],density:"compact",placeholder:"YYYY-MM-DD",config:{position:"auto right"}},null,8,["modelValue","rules"])])])]),_:1}),l(z,{thickness:"12"}),l(w,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row gap-y-5 gap-4"},{default:r(()=>[l(n(k),null,{default:r(()=>[l(u,{cols:"12",sm:"8",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(m,{modelValue:i.data.social_reason,"onUpdate:modelValue":e[2]||(e[2]=o=>i.data.social_reason=o),rules:["requiredValidator"in d?d.requiredValidator:n(f)],label:"Cliente *",placeholder:"Canzza",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",sm:"4",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(m,{modelValue:i.data.nit,"onUpdate:modelValue":e[3]||(e[3]=o=>i.data.nit=o),rules:["requiredValidator"in d?d.requiredValidator:n(f)],label:"C.I./NIT *",placeholder:"0000000",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(m,{modelValue:i.data.workplace,"onUpdate:modelValue":e[4]||(e[4]=o=>i.data.workplace=o),label:"Lugar de Trabajo",placeholder:"Placeholder Text",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(m,{modelValue:i.data.email,"onUpdate:modelValue":e[5]||(e[5]=o=>i.data.email=o),rules:["requiredValidator"in d?d.requiredValidator:n(f)],label:"Correo *",placeholder:"email@gmail.com",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(m,{modelValue:i.data.address,"onUpdate:modelValue":e[6]||(e[6]=o=>i.data.address=o),label:"Dirección",placeholder:"Av/ Equipetrol ....",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(m,{modelValue:i.data.phone,"onUpdate:modelValue":e[7]||(e[7]=o=>i.data.phone=o),rules:["requiredValidator"in d?d.requiredValidator:n(f)],label:"Celular *",placeholder:"77049267",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),l(z,{thickness:"12"}),l(w,{class:"add-products-form"},{default:r(()=>[l(n(k),null,{default:r(()=>[l(u,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"},class:"mb-2"},{default:r(()=>[l(de,{properties:i.data.properties,onAddProperty:g,onRemoveProduct:a},null,8,["properties"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(V,{modelValue:i.data.payment_method,"onUpdate:modelValue":e[8]||(e[8]=o=>i.data.payment_method=o),rules:["requiredValidator"in d?d.requiredValidator:n(f)],label:"Tipo de Pago *",placeholder:"Seleccione ",items:Object.values(n(H)),class:"custom-salesforce-input"},null,8,["modelValue","rules","items"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(m,{modelValue:i.data.amount,"onUpdate:modelValue":e[9]||(e[9]=o=>i.data.amount=o),value:i.data.amount,rules:["requiredValidator"in d?d.requiredValidator:n(f)],label:"Total *",placeholder:"1000.000,00",outlined:"",dense:""},null,8,["modelValue","value","rules"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(V,{modelValue:n(y),"onUpdate:modelValue":e[10]||(e[10]=o=>le(y)?y.value=o:null),items:v,label:"Anticipo: %",placeholder:"% Anticipo",class:"mb-2"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[c("div",ce,[e[15]||(e[15]=c("h4",null," Saldo por pagar: ",-1)),c("span",null,x(("formatCurrency"in d?d.formatCurrency:n(Q))(i.data.amount-i.data.initial_fee)),1)])]),_:1})]),_:1})]),_:1}),l(w,{class:"add-products-form"},{default:r(()=>[l(n(k),null,{default:r(()=>[l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(W,{title:" Anticipo ",amount:T(i.data.amount),differs:i.data.differs_initial_fee,type:d.INITIAL_PAYMENT},null,8,["amount","differs","type"])]),_:1}),l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:r(()=>[l(t,{modelValue:i.data.observations,"onUpdate:modelValue":e[11]||(e[11]=o=>i.data.observations=o),"auto-grow":"",label:"Observaciones del Cliente",rows:"3",placeholder:"Descripción...","row-height":"20"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}}},rl={__name:"addQuote",setup(h){const{generateQuote:q}=te(),{allCustomerPaginate:i,customers:P}=oe(),g=E(!1),a=E({social_reason:"",nit:"",address:"",email:"",phone:"",landline:"",workplace:"",expiration_date:null,creation_date:new Date().toISOString().split("T")[0],observations:"",payment_method:null,amount:null,initial_fee:null,percentage_initial_fee:null,balance:null,opportunity_id:null,customer_id:null,properties:[{property_id:null,price:null,price_it:null,price_contrato:null,property_type:_.DEPARTAMENT.value,property_type_name:_.DEPARTAMENT.label},{property_id:null,price:null,price_it:null,price_contrato:null,property_type:_.PARK.value,property_type_name:_.PARK.label}],differs_initial_fee:[],differs_balance:[]}),v=C(()=>a.value.social_reason&&a.value.nit&&a.value.email&&a.value.phone&&a.value.amount&&a.value.creation_date&&a.value.expiration_date&&a.value.payment_method&&a.value.customer_id),y=C(()=>a.value.properties.every(t=>t.property_id!==null&&t.price!==null&&t.price_it!==null&&t.price_contrato!==null)),T=C(()=>a.value.differs_initial_fee.length===0?!0:a.value.differs_initial_fee.every(t=>t.amount!==null)),d=C(()=>{if(a.value.differs_initial_fee.length===0)return!0;const t=a.value.differs_initial_fee.reduce((b,B)=>b+(B.amount||0),0),o=parseFloat(t),s=parseFloat(a.value.initial_fee);return o===s}),e=C(()=>v.value&&y.value&&T.value),p=t=>{a.value.properties.push(t)},m=t=>{a.value.properties.splice(t,1)},V=async()=>{if(!e.value){Y("Validación fallida","Completa todos los campos obligatorios.");return}if(!d.value){Y("Validación fallida","La suma de las diferencias del anticipo no son correctas");return}g.value=!0;try{console.log(a),await q(a.value)}catch(t){console.error("Error generando la venta:",t)}finally{g.value=!1}};return K(async()=>{await i({page:1,itemsPerPage:100})}),R(()=>a.value.properties,t=>{let o=0;t.forEach(s=>{if(s.price){const b=parseFloat(s.price)||0;s.price_it=b*.03,s.price_contrato=b+s.price_it,o+=s.price_contrato}else s.price_it=null}),a.value.amount=o},{deep:!0}),R(()=>a.value.customer_id,t=>{const o=P.value.find(s=>s.id==t);console.log(o),o&&(a.value.social_reason=o.name,a.value.email=o.email,a.value.phone=o.phone,a.value.nit=o.ci,a.value.opportunity_id=o.opportunity_id,o.property_id!==null?(o.property.property_type=="PARK"&&(a.value.properties[1].property_id=o.property_id,a.value.properties[0].property_id=null,a.value.properties[0].price=null,a.value.properties[0].price_it=null,a.value.properties[0].price_contrato=null),o.property.property_type=="DEPARTAMENT"&&(a.value.properties[0].property_id=o.property_id,a.value.properties[1].property_id=null,a.value.properties[1].price=null,a.value.properties[1].price_it=null,a.value.properties[1].price_contrato=null)):(a.value.properties[1].property_id=null,a.value.properties[1].price=null,a.value.properties[1].price_it=null,a.value.properties[1].price_contrato=null,a.value.properties[0].property_id=null,a.value.properties[0].price=null,a.value.properties[0].price_it=null,a.value.properties[0].price_contrato=null)),a.value.customer_id=t}),(t,o)=>{const s=j;return A(),U(k,null,{default:r(()=>[l(u,{cols:"12",md:"9"},{default:r(()=>[l(fe,{data:n(a),onPush:p,onRemove:m},null,8,["data"])]),_:1}),l(u,{cols:"12",md:"3"},{default:r(()=>[l(N,{class:"mb-8"},{default:r(()=>[l(u,{cols:"12"},{default:r(()=>[l(s,{modelValue:n(a).customer_id,"onUpdate:modelValue":o[0]||(o[0]=b=>n(a).customer_id=b),rules:["requiredValidator"in t?t.requiredValidator:n(f)],label:"Clientes",placeholder:"Selecciona un Cliente",items:n(P).map(b=>({title:b.name,value:b.id})),outlined:""},null,8,["modelValue","rules","items"])]),_:1}),l(w,null,{default:r(()=>[l(F,{loading:n(g),disabled:!n(e)||n(g),class:"mb-2",onClick:V},{default:r(()=>o[1]||(o[1]=[D(" Guardar Cotización ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})}}};export{rl as default};
