import{$ as n}from"./api-aa8c13ee.js";import{c as b,b as j,a as C,s as $,e as B}from"./notifications-cae4d01c.js";import{ac as G,r as c,k,a2 as v}from"./index-c2e96262.js";import{D as p,L as y}from"./constants-b7e4fea4.js";const O=async t=>await n("/property",{method:"POST",body:t}),S=async t=>await n(`/property/${t}`,{method:"GET"}),U=async t=>await n("/properties",{method:"GET",params:t}),z=async(t,l)=>await n(`/project/${l}/properties`,{method:"GET",params:t}),I=async(t,l)=>await n(`/property/${t}`,{method:"PATCH",body:l}),W=async t=>await n(`/property${t}`,{method:"DELETE"}),H=async t=>await n(`/properties/${t}`,{method:"GET"}),K=async()=>await n("/available/properties",{method:"GET"}),M=async()=>await n("/export/property",{method:"GET"});function X(){G("userData").value;const t=c(!1),l=c(null),m=k(),f=c(null),i=c([]),h=c([]),u=c(0),w=async e=>{t.value=!0,l.value=null;try{console.log("este es el formulario:",e);const s={1:"DEPARTAMENT",2:"PARK"}[e.propertyDetails.propertyType.value]||"UNKNOWN";console.log(s);const r={code:e.propertyDetails.code,surface:e.propertyFeatures.surface,description:e.propertyDetails.description,delivery_date:e.propertyDetails.deliveryDate,base_price:e.propertyDetails.price,percentage_initial_fee:e.propertyDetails.percentageinitialfee,property_type:s,property_type_id:e.propertyDetails.propertyType.value,project_id:e.propertyDetails.projectType.value,benefits:e.propertyFeatures.benefitsDetails.map(a=>a.value),features:e.propertyFeatures.featureDetails.map(a=>a.value),type_department_id:s===p?e.propertyFeatures.typeDepartmentsDetails.value:null,number_bathrooms:s!==y?e.propertyFeatures.bathroomCount:"",number_bedrooms:s!==y?e.propertyFeatures.bedroomCount:"",number_floors:s!==y&&s!==p?e.propertyFeatures.floorNo:"",floors:s===p?e.propertyFeatures.floor:"",number_rooms:""};console.log(r);const d=await O(r);console.log("Respuesta del servidor:",d),b("Se Agrego una nueva Propiedad","La propiedad fue registrada exitosamente en el sistema de inventario."),m.push("/realty/property/list")}catch(o){console.log(o),o.response&&o.response.status==422&&j("Advertencia","Faltan Datos por Rellenar")}finally{t.value=!1}},P=async e=>{var o,s,r,d;t.value=!0,l.value=null;try{const a={title:e.title,code:e.code,surface:e.surface,base_price:e.base_price,percentage_initial_fee:e.percentage_initial_fee,property_type:e.property_type,number_bathrooms:((o=e==null?void 0:e.departament)==null?void 0:o.number_bathrooms)??"",number_bedrooms:((s=e==null?void 0:e.departament)==null?void 0:s.number_bedrooms)??"",surface_balcony:((r=e==null?void 0:e.departament)==null?void 0:r.surface_balcony)??"",is_balcony:(d=e==null?void 0:e.departament)==null?void 0:d.is_balcony,covered:!!(e!=null&&e.covered)},N=await I(e.id,a);return console.log(N),C("¡Propiedad actualizada exitosamente!","Los detalles de la propiedad han sido editados y guardados correctamente."),{success:!0,message:"Actualización Exitosa"}}catch(a){return console.log(a),a.response&&a.response.status==422?($("Validación fallida","Faltan datos por rellenar"),{success:!1,message:"Validación fallida"}):(B("Advertencia","Hubo un problema al actualizar la propiedad."),{success:!1,message:"Error de actualización"})}finally{t.value=!1}},_=async e=>{try{const o=await U(e);console.log("respuesta",o),i.value=o.data.data,u.value=o.data.total}catch(o){console.log(o)}},T=async(e,o)=>{try{const s=await z(e,o);console.log("respuesta",s),i.value=s.data.data,u.value=s.data.total}catch(s){console.log(s)}},g=async e=>{try{const o=await W(e);console.log(o),b("Elimino una Propidad Correctamente","Se Acaba de eliminar una propiedad con exito del sistema de inventario.")}catch(o){console.log(o)}},E=async e=>{try{const o=await S(e);f.value=o.data}catch(o){console.log(o)}},A=async e=>{try{const o=await H(e);return h.value=o.data,console.log("propertyfortype ",o.data),o.data}catch(o){console.log(o)}},x=async()=>{try{const e=await K();return i.value=e.data,console.log("properties: ",e.data),e.data}catch(e){console.log(e)}},R=async()=>{try{const e=await M();if(!(e instanceof Blob))throw new Error("Respuesta inválida del servidor con el BLOB");const o=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),s=window.URL.createObjectURL(o),r=document.createElement("a");r.href=s,r.setAttribute("download","propiedades.xlsx"),document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(s),document.body.removeChild(r)}catch(e){console.error("Error en exportación:",e)}};return{loadingProperty:t,error:l,addProperty:w,editProperty:P,getPropertyId:E,allProperty:_,allPropertybyProject:T,propertiesForType:A,removeProperty:g,propertiesAvailbles:x,properties:v(()=>i.value),property:f,totalProperties:v(()=>u.value),exportPropertyExcel:R}}export{X as u};
