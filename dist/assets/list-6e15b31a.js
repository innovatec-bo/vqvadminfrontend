import{u as te,p as Ve,S as we,_ as xe,a as ke}from"./PreSaleForm-a18d3ba2.js";import{r as G,e as qe}from"./validators-dea6e3a5.js";import{_ as Pe}from"./AppTextarea-ba09fc4d.js";import{_ as Ee}from"./AppDateTimePicker-a6cc6305.js";import{_ as fe}from"./AppTextField-d917fad4.js";import{_ as ve}from"./AppSelect-e2933069.js";import{$ as re}from"./api-4d610517.js";import{s as De,a as je,b as Ie}from"./notifications-e531aef3.js";import{r as b,o as n,c as f,d as l,F as N,i as B,b as e,e as t,n as a,v as D,x as k,z as L,f as E,$ as W,a4 as I,w as le,a3 as Ce,a as ie,a0 as R,am as J,a2 as oe,an as _e,ac as Te,H as Ne}from"./index-867472cb.js";import{V as $e}from"./VAvatar-3f0e771e.js";import{b as Z,c as ee,a as me}from"./VList-c71c7ea0.js";import{a as v,V as M}from"./VRow-09934e5a.js";import{V as X}from"./VChip-22ddf76f.js";import{V as K}from"./VCardText-ce313ab2.js";import{a as Se}from"./formatters-b3558c7d.js";import{u as Re}from"./useQuote-f4bb15bd.js";import{_ as Be}from"./AppAutocomplete-36e1752f.js";import{_ as ue}from"./DialogCloseBtn-7cb7d94b.js";import{u as Le}from"./useProperty-80d4c86e.js";import{V as Y,b as de}from"./VCard-ff5f3fa8.js";import{V as he}from"./VForm-37b7dc5b.js";import{V as pe}from"./VDialog-786235c2.js";import{V as ye}from"./VCheckbox-e22c7487.js";import{V as Ae}from"./VTooltip-41aab141.js";import{V as ne}from"./VTable-ec2881be.js";import{V as ae}from"./VTextField-65628ede.js";import{_ as ze}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as Me}from"./AppDrawerHeaderSection-4f14fd63.js";import{P as He}from"./vue3-perfect-scrollbar.esm-5954e94f.js";import{V as Ge}from"./VNavigationDrawer-a9eb16ed.js";import{V as Oe,a as Ke}from"./VWindowItem-b7ac04d0.js";import{V as Qe,a as be}from"./VRadioGroup-f4ef27cd.js";import{V as We}from"./VDivider-ca26a171.js";import{V as Je,a as Ye}from"./VTabs-054425e2.js";import{V as Xe}from"./VOverlay-0953ed77.js";import"./useSales-c8778bcb.js";import"./InvoiceAddMoney-f98a2c6d.js";import"./VNodeRenderer-3f05adfe.js";import"./helpers-61e4df1a.js";import"./form-fa82eff0.js";/* empty css                   */import"./VCounter-7558d937.js";import"./VImg-7bd01e65.js";import"./VField-e71443ee.js";import"./easing-9f15041e.js";import"./VInput-7a7b8855.js";import"./forwardRefs-8348545e.js";import"./VSelect-7fbcd8a9.js";import"./dialog-transition-d9930f64.js";import"./VMenu-8a2e7a0d.js";import"./scopeId-a8f9fb54.js";import"./VCheckboxBtn-cb1ed921.js";import"./VSelectionControl-a40b6363.js";import"./index-9c720871.js";import"./constants-8e30317b.js";import"./ssrBoot-41b23f6d.js";import"./filter-307f7bc4.js";import"./VSpacer-4d2658af.js";import"./lazy-79bd0c11.js";import"./VSlideGroup-53807eaf.js";const Ze=async(S,h)=>await re(`/opportunity/${S}/stage/${h}`,{method:"GET"}),et=async(S,h,o)=>await re(`/opportunity/${S}/procedure/${h}`,{method:"PATCH",body:o});function ce(){const S=b(null),h=b(!1),o=b(!1),y=b([]);return{process:S,loadingProcess:h,errorProcess:o,processes:y,allProcessesOpportunityForStage:async(u,r)=>{try{const c=await Ze(u,r);y.value=c.data}catch(c){console.log(c)}},checkProcessForOpportunity:async(u,r,c)=>{try{console.log(c);const m=await et(u,r,c);De("¡Proceso completado exitosamente!","El proceso ha sido llevado a cabo sin inconvenientes. ")}catch(m){console.log(m)}}}}const tt={class:"my-5"},lt={key:0},ot=["src"],at={class:"my-5"},it={key:0,class:"d-flex flex-wrap gap-2 my-5"},st={key:1},nt={__name:"EditDeliveryOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","complet"],setup(S,{emit:h}){const o=S,y=h,{changeStatusByOpportunity:U}=te(),{checkProcessForOpportunity:O}=ce(),u=async()=>{try{await U(o.opportunity.id,7,{}),y("complet")}catch(c){console.error("Error updating customer:",c)}},r=async(c,m)=>{console.log(`Procedimiento ${c} marcado como: ${m?"realizado":"no realizado"}`),await O(o.opportunity.id,c,{is_check:!m}),y("updateStageId",o.opportunity.id)};return(c,m)=>(n(),f(N,null,[l("div",tt,[m[0]||(m[0]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Propiedades ",-1)),o.opportunity.sales.length>0?(n(),f("div",lt,[(n(!0),f(N,null,B(o.opportunity.sales,g=>(n(),f("div",{key:g.id},[(n(!0),f(N,null,B(g.properties,A=>(n(),f("div",{key:A.id,class:"d-flex align-center justify-between"},[e($e,{size:"50",rounded:""},{default:t(()=>[l("img",{src:a(Ve),alt:"Logo pora",style:{"border-radius":"30%"}},null,8,ot)]),_:1}),e(v,{cols:"12",md:"7"},{default:t(()=>[e(Z,{class:"font-weight-medium"},{default:t(()=>[D(k(A.project_title)+" | "+k(A.title),1)]),_:2},1024),e(ee,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",null,"$ "+k(A.pivot_price),1)]),_:2},1024)]),_:2},1024)]))),128))]))),128))])):L("",!0)]),l("div",at,[m[2]||(m[2]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(n(),f("div",it,[(n(!0),f(N,null,B(o.opportunity.procedure,g=>(n(),f("div",{key:g.id},[e(X,{color:g.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:A=>r(g.id,g.pivot.is_check)},{default:t(()=>[g.pivot.is_check?(n(),E(W,{key:0,icon:"tabler-check",class:"mr-2"})):L("",!0),D(" "+k(g.title),1)]),_:2},1032,["color","onClick"])]))),128))])):(n(),f("div",st,m[1]||(m[1]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(K,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(I,{color:"primary",size:"small",onClick:u},{default:t(()=>m[3]||(m[3]=[D(" Finalizar Oportunidad ")])),_:1})]),_:1})],64))}},Ue={__name:"EditCustomerDialog",props:{isDialogVisible:{type:Boolean,required:!0},opportunityKanban:{type:Object,required:!0}},emits:["update:isDialogVisible","update:newProperty"],setup(S,{emit:h}){const o=S,y=h;Object.values(we).map(p=>({title:p.label,value:p.value}));const{propertiesAvailbles:U,properties:O}=Le(),{getOpportunitybyId:u,opportunity:r,changeOpportunity:c,loadingOpportunity:m}=te(),g=()=>{y("update:isDialogVisible",!1)},A=async()=>{console.log("antes del save:",r);const p={id:r.value.id,description:r.value.description,property_id:r.value.property_id,customer:{id:r.value.customer.id,name:r.value.customer.name,email:r.value.customer.email,ci:r.value.customer.ci,cod_phone:r.value.cod_phone,phone:r.value.customer.phone}};await c(r.value.id,p),r.value.property_id&&(console.log("Cambio y geenero el Emit Principal"),y("update:newProperty",r.value.property_id)),y("update:isDialogVisible",!1)},_=async()=>{var p;(p=o.opportunityKanban)!=null&&p.id&&await u(o.opportunityKanban.id)},V=async()=>{await U()};return le(()=>o.isDialogVisible,async p=>{p===!0&&(_(),await V())}),(p,s)=>{const $=ue,q=fe,d=ve,w=Be,Q=Pe;return n(),E(pe,{"max-width":"800","model-value":o.isDialogVisible,persistent:"","close-on-esc":!1,"onUpdate:modelValue":g},{default:t(()=>[e($,{onClick:g}),e(Y,{title:"Información del Cliente y Oportunidad",class:"pa-sm-8 pa-5"},{default:t(()=>[e(K,null,{default:t(()=>[e(he,{onSubmit:Ce(A,["prevent"])},{default:t(()=>[e(M,{dense:""},{default:t(()=>[e(v,{cols:"12",md:"6"},{default:t(()=>[e(q,{modelValue:a(r).customer.name,"onUpdate:modelValue":s[0]||(s[0]=z=>a(r).customer.name=z),label:"Nombre del Cliente",placeholder:"Ingresa el nombre",outlined:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:t(()=>[e(q,{modelValue:a(r).customer.email,"onUpdate:modelValue":s[1]||(s[1]=z=>a(r).customer.email=z),label:"Email del Cliente",placeholder:"Ingresa el email",outlined:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:t(()=>[e(M,null,{default:t(()=>[e(v,{cols:"4"},{default:t(()=>[e(d,{modelValue:a(r).customer.cod_phone,"onUpdate:modelValue":s[2]||(s[2]=z=>a(r).customer.cod_phone=z),label:"Código",items:["+591","+1","+52"],placeholder:"Cód.",outlined:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"8"},{default:t(()=>[e(q,{modelValue:a(r).customer.phone,"onUpdate:modelValue":s[3]||(s[3]=z=>a(r).customer.phone=z),label:"Número de Teléfono",placeholder:"Ingresa el teléfono",outlined:"",dense:"",maxlength:"9"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(v,{cols:"12",md:"6"},{default:t(()=>[e(q,{modelValue:a(r).customer.ci,"onUpdate:modelValue":s[4]||(s[4]=z=>a(r).customer.ci=z),label:"CI del Cliente",placeholder:"Ingresa el CI",outlined:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(w,{modelValue:a(r).property_id,"onUpdate:modelValue":s[5]||(s[5]=z=>a(r).property_id=z),label:"Departamento de Interés",placeholder:"Selecciona un Departamento",items:a(O).map(z=>({title:z.title,value:z.id})),outlined:""},null,8,["modelValue","items"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(Q,{modelValue:a(r).description,"onUpdate:modelValue":s[6]||(s[6]=z=>a(r).description=z),label:"Descripción de la Oportunidad",placeholder:"Ingresa una descripción",rows:"3","auto-grow":"",outlined:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",class:"text-center"},{default:t(()=>[e(I,{type:"submit",color:"primary",class:"me-3",disabled:a(m),loading:a(m)},{default:t(()=>s[7]||(s[7]=[D(" Guardar ")])),_:1},8,["disabled","loading"]),e(I,{color:"secondary",variant:"tonal",onClick:g},{default:t(()=>s[8]||(s[8]=[D(" Cancelar ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},rt={class:"d-flex align-bottom flex-sm-row flex-column"},ut={class:"user-profile-info"},dt={class:"d-flex align-center justify-center justify-sm-space-between flex-wrap gap-4"},pt={class:"d-flex align-center gap-x-3"},ct={class:"text-4xl font-weight-medium"},mt={class:"d-flex flex-column py-2",style:{"font-size":"14px"}},yt={class:"text-sm text-disabled"},ft={key:0,class:"d-flex flex-wrap gap-2 my-5"},vt={key:1},gt={key:0,class:"d-flex flex-wrap gap-2 my-5"},_t={key:1},bt={__name:"EditPreSaleOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","update:newProperty"],setup(S,{emit:h}){const o=S,y=h,{checkProcessForOpportunity:U}=ce(),{changeStatusQuotes:O}=Re(),u=b(!1),r=b(!1),c=()=>{u.value=!0},m=()=>{console.log("Se escucho el evento en EditProspectOpportunity"),y("update:newProperty")},g=()=>{r.value=!0},A=async p=>{y("updateStageId",p)},_=async(p,s)=>{console.log(`Procedimiento ${p} marcado como: ${s?"realizado":"no realizado"}`),await U(o.opportunity.id,p,{is_check:!s}),y("updateStageId",o.opportunity.id)},V=async(p,s)=>{const $=s==="APPROVED"?"NOT_APPROVED":"APPROVED";console.log(`Procedimiento ${p} marcado como: ${s}`),await O(p,{status:$}),y("updateStageId",o.opportunity.id)};return(p,s)=>{const $=ie("RouterLink"),q=ie("IconBtn");return n(),f(N,null,[l("div",rt,[l("div",ut,[s[3]||(s[3]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Perfil ",-1)),l("div",dt,[l("div",pt,[l("span",ct,k(("avatarText"in p?p.avatarText:a(Se))(o.opportunity.customer.name)),1),l("div",mt,[e($,{to:{name:"apps-ecommerce-customer-details-id",params:{id:1}},class:"font-weight-base"},{default:t(()=>[D(k(o.opportunity.customer.name),1)]),_:1}),l("span",yt,k(o.opportunity.customer.phone),1)]),e(I,{color:"secondary",variant:"tonal",size:"small",onClick:c},{default:t(()=>s[2]||(s[2]=[D(" Editar Perfil ")])),_:1})])])])]),l("div",null,[s[5]||(s[5]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(n(),f("div",ft,[(n(!0),f(N,null,B(o.opportunity.procedure,d=>(n(),f("div",{key:d.id},[e(X,{color:d.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:w=>_(d.id,d.pivot.is_check)},{default:t(()=>[d.pivot.is_check?(n(),E(W,{key:0,icon:"tabler-check",class:"mr-2"})):L("",!0),D(" "+k(d.title),1)]),_:2},1032,["color","onClick"])]))),128))])):(n(),f("div",vt,s[4]||(s[4]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),l("div",null,[s[9]||(s[9]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Cotizaciones ",-1)),o.opportunity.quotes&&o.opportunity.quotes.length>0?(n(),f("div",gt,[e(ne,{density:"compact",class:"text-no-wrap",style:{"font-size":"12px"}},{default:t(()=>[s[7]||(s[7]=l("thead",null,[l("tr",null,[l("th",null," Nombre "),l("th",null," Propiedad "),l("th",null," Fecha "),l("th")])],-1)),l("tbody",null,[(n(!0),f(N,null,B(o.opportunity.quotes,d=>(n(),f("tr",{key:d.id},[l("td",null,k(d.social_reason),1),l("td",null,k(d.properties[0].title),1),l("td",null,k(new Date(d.creation_date).toLocaleDateString()),1),l("td",null,[e(M,null,{default:t(()=>[e(ye,{modelValue:d.status,"onUpdate:modelValue":w=>d.status=w,"true-value":"APPROVED","false-value":"NOT_APPROVED",onClick:w=>V(d.id,d.status)},{default:t(()=>[e(Ae,{activator:"parent",location:"top"},{default:t(()=>s[6]||(s[6]=[D(" Aprobar Cotizacion ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","onClick"]),e($,{to:{name:"quote-id",params:{id:d.id}}},{default:t(()=>[e(q,null,{default:t(()=>[e(W,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])]),_:2},1024)])]))),128))])]),_:1})])):(n(),f("div",_t,s[8]||(s[8]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(K,{class:"d-flex justify-center mt-4"},{default:t(()=>[e($,{to:{name:"quote-add-quote"},class:"text-white"},{default:t(()=>[e(I,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>s[10]||(s[10]=[D(" Generar Cotización ")])),_:1})]),_:1}),e(I,{color:"primary",class:"mx-auto",size:"small",onClick:g},{default:t(()=>s[11]||(s[11]=[D(" Generar Venta ")])),_:1})]),_:1}),e(Ue,{"is-dialog-visible":a(u),"onUpdate:isDialogVisible":s[0]||(s[0]=d=>R(u)?u.value=d:null),"opportunity-kanban":o.opportunity,"onUpdate:newProperty":m},null,8,["is-dialog-visible","opportunity-kanban"]),e(xe,{"is-dialog-visible":a(r),"onUpdate:isDialogVisible":s[1]||(s[1]=d=>R(r)?r.value=d:null),opportunity:o.opportunity,stage:"PRESALE",onRegisterSale:A},null,8,["is-dialog-visible","opportunity"])],64)}}},Vt={class:"d-flex align-bottom flex-sm-row flex-column"},wt={class:"user-profile-info"},xt={class:"d-flex align-center justify-center justify-sm-space-between flex-wrap gap-4"},kt={class:"d-flex align-center gap-x-3"},Pt={class:"text-4xl font-weight-medium"},Dt={class:"d-flex flex-column py-2",style:{"font-size":"14px"}},Ct={class:"text-sm text-disabled"},$t={key:0,class:"d-flex flex-wrap gap-2 my-5"},St={key:1},ht={key:0,class:"d-flex flex-wrap gap-2 my-5"},At={key:1},zt={__name:"EditProspectOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","update:newProperty"],setup(S,{emit:h}){const o=S,y=h,{checkProcessForOpportunity:U}=ce(),{changeStatusByOpportunity:O,loadingOpportunity:u}=te(),r=b(!1),c=()=>{r.value=!0},m=()=>{console.log("Se escucho el evento en EditProspectOpportunity"),y("update:newProperty")},g=async _=>{await O(_,we.PRESALE.value,{}),y("updateStageId",_)},A=async _=>{console.log(`Procedimiento ${_.id} marcado como: ${_.pivot.is_check?"realizado":"no realizado"}`),await U(o.opportunity.id,_.id,{is_check:!_.pivot.is_check}),_.pivot.is_check=!_.pivot.is_check,y("updateStageId",o.opportunity.id)};return(_,V)=>{const p=ie("RouterLink"),s=ie("IconBtn");return n(),f(N,null,[l("div",Vt,[l("div",wt,[V[3]||(V[3]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Perfil ",-1)),l("div",xt,[l("div",kt,[l("span",Pt,k(("avatarText"in _?_.avatarText:a(Se))(o.opportunity.customer.name)),1),l("div",Dt,[e(p,{to:{name:"apps-ecommerce-customer-details-id",params:{id:1}},class:"font-weight-base"},{default:t(()=>[D(k(o.opportunity.customer.name),1)]),_:1}),l("span",Ct,k(o.opportunity.customer.phone),1)]),l("div",null,[e(I,{color:"secondary",variant:"tonal",size:"small",onClick:c},{default:t(()=>V[2]||(V[2]=[D(" Editar Perfil ")])),_:1})])])])])]),l("div",null,[V[5]||(V[5]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(n(),f("div",$t,[(n(!0),f(N,null,B(o.opportunity.procedure,$=>(n(),f("div",{key:$.id},[e(X,{color:$.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:q=>A($)},{default:t(()=>[$.pivot.is_check?(n(),E(W,{key:0,icon:"tabler-check",class:"mr-2"})):L("",!0),D(" "+k($.title),1)]),_:2},1032,["color","onClick"])]))),128))])):(n(),f("div",St,V[4]||(V[4]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),l("div",null,[V[8]||(V[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Cotizaciones ",-1)),o.opportunity.quotes&&o.opportunity.quotes.length>0?(n(),f("div",ht,[e(ne,{density:"compact",class:"text-no-wrap",style:{"font-size":"12px"}},{default:t(()=>[V[6]||(V[6]=l("thead",null,[l("tr",null,[l("th",null," Nombre "),l("th",null," Propiedad "),l("th",null," Fecha "),l("th")])],-1)),l("tbody",null,[(n(!0),f(N,null,B(o.opportunity.quotes,$=>(n(),f("tr",{key:$.id},[l("td",null,k($.social_reason),1),l("td",null,k($.properties[0].title),1),l("td",null,k(new Date($.created_at).toLocaleDateString()),1),l("td",null,[e(p,{to:{name:"quote-id",params:{id:$.id}}},{default:t(()=>[e(s,null,{default:t(()=>[e(W,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])])]))),128))])]),_:1})])):(n(),f("div",At,V[7]||(V[7]=[l("span",null,"No hay cotizaciones disponibles.",-1)])))]),e(K,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(p,{to:{name:"quote-add-quote"},class:"text-white"},{default:t(()=>[e(I,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>V[9]||(V[9]=[D(" Generar Cotización ")])),_:1})]),_:1}),e(I,{color:"primary",class:"mx-auto",size:"small",disabled:a(u),loading:a(u),onClick:V[0]||(V[0]=$=>g(o.opportunity.id))},{default:t(()=>V[10]||(V[10]=[D(" Siguiente Etapa ")])),_:1},8,["disabled","loading"])]),_:1}),e(Ue,{"is-dialog-visible":a(r),"onUpdate:isDialogVisible":V[1]||(V[1]=$=>R(r)?r.value=$:null),"opportunity-kanban":o.opportunity,"onUpdate:newProperty":m},null,8,["is-dialog-visible","opportunity-kanban"])],64)}}},Ot=async S=>await re(`/sale/paymentPlans/${S}/confirm`,{method:"PATCH"}),Ut=async(S,h)=>await re(`/sale/paymentPlans/${S}`,{method:"PATCH",body:h});function ge(){const S=b(!1),h=b([]),o=b(null),y=b(null);return{loadingPaymentPlans:S,paymentPlan:y,error:o,paymentPlans:h,confirmPaymentPlans:async u=>{try{const r=await Ot(u);De("Actualizacion Exitosa","Se confirmo el pago")}catch(r){console.log(r)}},updatePaymentPlans:async(u,r)=>{S.value=!0,o.value=null;try{console.log(r);const c=await Ut(u,r);y.value=c.data,je("¡Planes de pago actualizados exitosamente! ","Los planes de pago han sido modificados y guardados correctamente."),console.log(c)}catch(c){console.log(c),c.response&&c.response.status==422&&Ie("Advertencia","Faltan datos por Completar"),o.value=c.message}finally{S.value=!1}}}}const Ft={__name:"DeliveryForm",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(S,{emit:h}){const o=S,y=h,{changeStatusByOpportunity:U}=te(),O=m=>{y("update:isDialogVisible",m)},u=b(structuredClone(J(o.opportunity)));le(o,()=>{u.value=structuredClone(J(o.opportunity))});const r=async()=>{y("update:isDialogVisible",!1);try{await U(o.opportunity.id,5,{delivery_date:u.value.sales.delivery_date}),y("updateDeliveryDate",u.value.id)}catch(m){console.error("Error updating customer:",m)}},c=()=>{y("update:isDialogVisible",!1)};return(m,g)=>{const A=ue;return n(),E(pe,{"model-value":o.isDialogVisible,"max-width":"800","onUpdate:modelValue":O},{default:t(()=>[e(A,{onClick:g[0]||(g[0]=_=>m.$emit("update:isDialogVisible",!1))}),e(Y,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(de,{class:"text-h3 text-center"},{default:t(()=>g[2]||(g[2]=[D(" Confirmar Fecha ")])),_:1}),e(K,null,{default:t(()=>[e(K,null,{default:t(()=>[e(M,null,{default:t(()=>[e(v,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(ae,{modelValue:a(u).sales.delivery_date,"onUpdate:modelValue":g[1]||(g[1]=_=>a(u).sales.delivery_date=_),label:"Fecha de Entrega",type:"date",rules:["requiredValidator"in m?m.requiredValidator:a(G)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),e(v,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(I,{onClick:r},{default:t(()=>g[3]||(g[3]=[D(" Pasar a Entrega ")])),_:1}),e(I,{color:"secondary",variant:"tonal",onClick:c},{default:t(()=>g[4]||(g[4]=[D(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},qt={key:0},Et={__name:"PaymentPlanEdit",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},payment:{type:Object,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(S,{emit:h}){const o=S,y=h,{updatePaymentPlans:U}=ge(),O=p=>{y("update:isDialogVisible",p)},u=b(structuredClone(J(o.payment))),r=b(structuredClone(J(o.opportunity)));le(o,()=>{u.value=structuredClone(J(o.payment)),r.value=structuredClone(J(o.opportunity))});const c=b([]),m=()=>{c.value.push({amount:"",date:"",type:u.value.type})},g=p=>{c.value.splice(p,1)},A=oe(()=>c.value.reduce((p,s)=>{const $=parseFloat(s.amount)||0;return p+$},0)),_=async()=>{try{await U(u.value.id,{date:u.value.date,differData:c.value})}catch(p){console.error("Error updating customer:",p)}finally{y("updateDeliveryDate",r.value.id),y("update:isDialogVisible",!1),c.value=[]}},V=()=>{y("update:isDialogVisible",!1),c.value=[],errorMessage.value=""};return(p,s)=>{const $=ue;return n(),E(pe,{"model-value":o.isDialogVisible,"max-width":"800","onUpdate:modelValue":O},{default:t(()=>[e($,{onClick:s[0]||(s[0]=q=>p.$emit("update:isDialogVisible",!1))}),e(Y,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(de,{class:"text-h3 text-center"},{default:t(()=>s[2]||(s[2]=[D(" Editar Pago ")])),_:1}),e(K,null,{default:t(()=>[e(M,{class:"mx-5"},{default:t(()=>[e(v,{cols:"6"},{default:t(()=>[l("h3",null," Monto a Pagar : $ "+k(a(u).amount),1)]),_:1}),e(v,{cols:"6"},{default:t(()=>[e(ae,{modelValue:a(u).date,"onUpdate:modelValue":s[1]||(s[1]=q=>a(u).date=q),label:"Cambiar Fecha",type:"date",rules:["requiredValidator"in p?p.requiredValidator:a(G)]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(Y,{flat:"",class:"d-flex flex-column pa-5 px-5"},{default:t(()=>[(n(!0),f(N,null,B(a(c),(q,d)=>(n(),f("div",{key:q.id,class:"d-flex align-center my-4"},[e(ae,{modelValue:q.amount,"onUpdate:modelValue":w=>q.amount=w,label:"Monto",type:"number",class:"mr-4",outlined:"",rules:["requiredValidator"in p?p.requiredValidator:a(G)]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(ae,{modelValue:q.date,"onUpdate:modelValue":w=>q.date=w,label:"Fecha de Pago",type:"date",class:"mr-3",outlined:"",rules:["requiredValidator"in p?p.requiredValidator:a(G)]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(I,{color:"error",onClick:w=>g(d)},{default:t(()=>[e(W,{icon:"tabler-square-x"})]),_:2},1032,["onClick"])]))),128)),a(c).length>0?(n(),f("div",qt,[s[3]||(s[3]=l("strong",null,"Monto Restante:",-1)),D(" $"+k((a(u).amount-a(A)).toFixed(2)),1)])):L("",!0),e(I,{color:"primary",variant:"tonal",class:"mt-4",size:"small",onClick:m},{default:t(()=>s[4]||(s[4]=[D(" Diferir Pago ")])),_:1})]),_:1}),e(v,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(I,{onClick:_},{default:t(()=>s[5]||(s[5]=[D(" Guardar ")])),_:1}),e(I,{color:"error",variant:"tonal",onClick:V},{default:t(()=>s[6]||(s[6]=[D(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},jt={__name:"SalePaymentPlan",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},salesPayment:{type:Array,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(S,{emit:h}){const o=S,y=h;ge();const U=c=>{y("update:isDialogVisible",c)},O=b(structuredClone(J(o.opportunity)));le(o,()=>{O.value=structuredClone(J(o.opportunity)),console.log("Sales Payment:",o.salesPayment)});const u=b([]),r=()=>{y("update:isDialogVisible",!1),u.value=[]};return(c,m)=>{const g=ue;return n(),E(pe,{"model-value":o.isDialogVisible,"max-width":"800","onUpdate:modelValue":U},{default:t(()=>[e(g,{onClick:m[0]||(m[0]=A=>c.$emit("update:isDialogVisible",!1))}),e(Y,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(de,{class:"text-h3 text-center"},{default:t(()=>m[1]||(m[1]=[D(" Confirmar Fecha ")])),_:1}),e(K,null,{default:t(()=>[e(K,null,{default:t(()=>[e(M,null,{default:t(()=>[e(v,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l("span",null," Monto a Pagar : "+k(a(O)),1)]),_:1})]),_:1})]),_:1}),e(v,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(I,{onClick:c.onFormSubmit},{default:t(()=>m[2]||(m[2]=[D(" Guardar ")])),_:1},8,["onClick"]),e(I,{color:"error",variant:"tonal",onClick:r},{default:t(()=>m[3]||(m[3]=[D(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},It={class:"text-h6"},Tt={class:"text-h6"},Nt={class:"text-h6"},Rt={class:"my-5"},Bt={key:0},Lt=["src"],Mt={class:"mb-4"},Ht=["onClick"],Gt=["onClick"],Kt={class:"my-5"},Qt={key:0,class:"d-flex flex-wrap gap-2 my-5"},Wt={key:1},Jt={__name:"EditSaleOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId"],setup(S,{emit:h}){const o=S,y=h,{checkProcessForOpportunity:U}=ce(),{confirmPaymentPlans:O}=ge(),{changeStatusByOpportunity:u,loadingOpportunity:r}=te(),c=b(!1),m=b(!1),g=b(!1),A=b(""),_=oe(()=>o.opportunity.sales.reduce((x,i)=>x+i.amount,0)),V=oe(()=>o.opportunity.sales.reduce((x,i)=>x+i.initial_fee,0)),p=oe(()=>_.value-V.value),s=()=>{g.value=!0},$=x=>{console.log("entro aqui"),m.value=!0,A.value={...x}},q=async x=>{y("updateStageId",x)},d=async x=>{console.log(`Procedimiento ${x.id} marcado como: ${x.pivot.is_check?"realizado":"no realizado"}`),await U(o.opportunity.id,x.id,{is_check:!x.pivot.is_check}),x.pivot.is_check=!x.pivot.is_check,y("updateStageId",o.opportunity.id)},w=async x=>{console.log(x),await O(x),y("updateStageId",o.opportunity.id)},Q=async x=>{await u(x,5,{}),y("updateStageId",x)},z=async x=>{y("updateStageId",x)};return(x,i)=>(n(),f(N,null,[l("div",null,[e(Y,null,{default:t(()=>[e(K,null,{default:t(()=>[e(M,null,{default:t(()=>[e(v,{cols:"4",class:"border rounded-sm mx-1"},{default:t(()=>[e(Z,{class:"font-weight-medium"},{default:t(()=>i[5]||(i[5]=[D(" Saldo ")])),_:1}),e(ee,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",It,"$ "+k(a(p).toFixed(2)),1)]),_:1})]),_:1}),e(v,{cols:"3",class:"border rounded-sm mx-1"},{default:t(()=>[e(Z,{class:"font-weight-medium"},{default:t(()=>i[6]||(i[6]=[D(" Anticipo ")])),_:1}),e(ee,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Tt,"$ "+k(a(V).toFixed(2)),1)]),_:1})]),_:1}),e(v,{cols:"4",class:"border rounded-sm mx-1"},{default:t(()=>[e(Z,{class:"font-weight-medium"},{default:t(()=>i[7]||(i[7]=[D(" Precio Final ")])),_:1}),e(ee,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Nt,"$ "+k(a(_).toFixed(2)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),l("div",Rt,[i[8]||(i[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Propiedades ",-1)),o.opportunity.sales.length>0?(n(),f("div",Bt,[(n(!0),f(N,null,B(o.opportunity.sales,P=>(n(),f("div",{key:P.id},[(n(!0),f(N,null,B(P.properties,F=>(n(),f("div",{key:F.id,class:"d-flex align-center justify-between"},[e($e,{size:"50",rounded:""},{default:t(()=>[l("img",{src:a(Ve),alt:"Logo pora",style:{"border-radius":"30%"}},null,8,Lt)]),_:1}),e(v,{cols:"12",md:"7"},{default:t(()=>[e(Z,{class:"font-weight-medium"},{default:t(()=>[D(k(F.project_title)+" | "+k(F.title),1)]),_:2},1024),e(ee,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",null,"$ "+k(F.pivot_price),1)]),_:2},1024)]),_:2},1024)]))),128))]))),128))])):L("",!0)]),l("div",Mt,[i[10]||(i[10]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Anticipo ",-1)),o.opportunity.initial_payments&&o.opportunity.initial_payments.length>0?(n(),E(ne,{key:0,density:"compact",class:"text-no-wrap my-2",style:{"font-size":"12px"}},{default:t(()=>[i[9]||(i[9]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th",null," Action ")])],-1)),l("tbody",null,[(n(!0),f(N,null,B(o.opportunity.initial_payments,P=>(n(),f("tr",{key:P.id},[l("td",null,k(P.property_title),1),l("td",null,k(P.date),1),l("td",null,k(P.amount),1),l("td",null,[e(M,null,{default:t(()=>[e(ye,{modelValue:P.is_paid,"onUpdate:modelValue":F=>P.is_paid=F,"true-value":1,"false-value":0,disabled:P.is_paid===1,onChange:F=>w(P.id)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"]),l("div",{"fill-dot":"",onClick:F=>$(P)},[e(W,{size:"25",icon:"tabler-edit"})],8,Ht)]),_:2},1024)])]))),128))])]),_:1})):L("",!0)]),l("div",null,[i[13]||(i[13]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Saldos ",-1)),o.opportunity.balance_payments&&o.opportunity.balance_payments.length>0?(n(),E(ne,{key:0,density:"compact",class:"text-no-wrap my-2",style:{"font-size":"12px"}},{default:t(()=>[i[12]||(i[12]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th",null," Action ")])],-1)),l("tbody",null,[(n(!0),f(N,null,B(o.opportunity.balance_payments,P=>(n(),f("tr",{key:P.id},[l("td",null,k(P.property_title),1),l("td",null,k(P.date),1),l("td",null,k(P.amount),1),l("td",null,[e(M,null,{default:t(()=>[e(ye,{modelValue:P.is_paid,"onUpdate:modelValue":F=>P.is_paid=F,"true-value":1,"false-value":0,disabled:P.is_paid===1,onChange:F=>w(P.id)},{default:t(()=>[e(Ae,{activator:"parent",location:"top"},{default:t(()=>i[11]||(i[11]=[D(" Confirmar Pago ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"]),l("div",{"fill-dot":"",onClick:F=>$(P)},[e(W,{size:"25",icon:"tabler-edit"})],8,Gt)]),_:2},1024)])]))),128))])]),_:1})):L("",!0)]),l("div",Kt,[i[15]||(i[15]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(n(),f("div",Qt,[(n(!0),f(N,null,B(o.opportunity.procedure,P=>(n(),f("div",{key:P.id},[e(X,{color:P.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:F=>d(P)},{default:t(()=>[P.pivot.is_check?(n(),E(W,{key:0,icon:"tabler-check",class:"mr-2"})):L("",!0),D(" "+k(P.title),1)]),_:2},1032,["color","onClick"])]))),128))])):(n(),f("div",Wt,i[14]||(i[14]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(K,{class:"d-flex mt-4"},{default:t(()=>[e(I,{color:"primary",variant:"tonal",class:"mx-auto",size:"small",onClick:s},{default:t(()=>i[16]||(i[16]=[D(" Generar Venta ")])),_:1}),e(I,{color:"primary",class:"mx-auto",size:"small",onClick:i[0]||(i[0]=P=>Q(o.opportunity.id))},{default:t(()=>i[17]||(i[17]=[D(" Siguiente Etapa ")])),_:1})]),_:1}),e(Ft,{"is-dialog-visible":a(c),"onUpdate:isDialogVisible":i[1]||(i[1]=P=>R(c)?c.value=P:null),opportunity:o.opportunity,onUpdateDeliveryDate:z},null,8,["is-dialog-visible","opportunity"]),e(Et,{"is-dialog-visible":a(m),"onUpdate:isDialogVisible":i[2]||(i[2]=P=>R(m)?m.value=P:null),payment:a(A),opportunity:o.opportunity,onUpdateDeliveryDate:z},null,8,["is-dialog-visible","payment","opportunity"]),e(xe,{"is-dialog-visible":a(g),"onUpdate:isDialogVisible":i[3]||(i[3]=P=>R(g)?g.value=P:null),opportunity:o.opportunity,stage:"SALE",onRegisterSale:q},null,8,["is-dialog-visible","opportunity"]),e(jt,{"is-dialog-visible":x.openSaleEditPaymentPlan,"onUpdate:isDialogVisible":i[4]||(i[4]=P=>x.openSaleEditPaymentPlan=P),opportunity:o.opportunity,"sales-payment":x.salePaymentPlan,onUpdateDeliveryDate:z},null,8,["is-dialog-visible","opportunity","sales-payment"])],64))}};const Yt={__name:"SellerReport",setup(S){return b([{title:"Actividad 1",date:"2024-10-09",status:"Pendiente"},{title:"Actividad 2",date:"2024-10-10",status:"Completada"},{title:"Actividad 3",date:"2024-10-11",status:"En Progreso"}]),(h,o)=>(n(),E(K,null,{default:t(()=>o[0]||(o[0]=[l("p",null,"No hay actividades seleccionadas. Aquí tienes un resumen de las actividades:",-1)])),_:1}))}},Xt=ze(Yt,[["__scopeId","data-v-c9cbe3f1"]]),Zt={__name:"CustomerHistory",props:{isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","userData"],setup(S,{emit:h}){const o=S,y=h,U=b(!1),O=b(),u=b(""),r=b(""),c=b(""),m=b(""),g=b(),A=b(""),_=b(),V=b(),p=b(),s=()=>{y("update:isDrawerOpen",!1),_e(()=>{var d,w;(d=O.value)==null||d.reset(),(w=O.value)==null||w.resetValidation()})},$=()=>{var d;(d=O.value)==null||d.validate().then(({valid:w})=>{w&&(y("userData",{id:0,fullName:u.value,company:m.value,role:_.value,country:g.value,contact:A.value,email:c.value,currentPlan:V.value,status:p.value,avatar:"",billing:"Auto Debit"}),y("update:isDrawerOpen",!1),_e(()=>{var Q,z;(Q=O.value)==null||Q.reset(),(z=O.value)==null||z.resetValidation()}))})},q=d=>{y("update:isDrawerOpen",d)};return(d,w)=>{const Q=Me,z=fe,x=ve;return n(),E(Ge,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":o.isDrawerOpen,"onUpdate:modelValue":q},{default:t(()=>[e(Q,{title:"Historial del Cliente",onCancel:s}),e(a(He),{options:{wheelPropagation:!1}},{default:t(()=>[e(Y,{flat:""},{default:t(()=>[e(K,null,{default:t(()=>[e(he,{ref_key:"refForm",ref:O,modelValue:a(U),"onUpdate:modelValue":w[9]||(w[9]=i=>R(U)?U.value=i:null),onSubmit:Ce($,["prevent"])},{default:t(()=>[e(M,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[e(z,{modelValue:a(u),"onUpdate:modelValue":w[0]||(w[0]=i=>R(u)?u.value=i:null),rules:["requiredValidator"in d?d.requiredValidator:a(G)],label:"Full Name",placeholder:"John Doe"},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(z,{modelValue:a(r),"onUpdate:modelValue":w[1]||(w[1]=i=>R(r)?r.value=i:null),rules:["requiredValidator"in d?d.requiredValidator:a(G)],label:"Username",placeholder:"Johndoe"},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(z,{modelValue:a(c),"onUpdate:modelValue":w[2]||(w[2]=i=>R(c)?c.value=i:null),rules:["requiredValidator"in d?d.requiredValidator:a(G),"emailValidator"in d?d.emailValidator:a(qe)],label:"Email",placeholder:"johndoe@email.com"},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(z,{modelValue:a(m),"onUpdate:modelValue":w[3]||(w[3]=i=>R(m)?m.value=i:null),rules:["requiredValidator"in d?d.requiredValidator:a(G)],label:"Company",placeholder:"PixInvent"},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(x,{modelValue:a(g),"onUpdate:modelValue":w[4]||(w[4]=i=>R(g)?g.value=i:null),label:"Select Country",placeholder:"Select Country",rules:["requiredValidator"in d?d.requiredValidator:a(G)],items:["USA","UK","India","Australia"]},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(z,{modelValue:a(A),"onUpdate:modelValue":w[5]||(w[5]=i=>R(A)?A.value=i:null),type:"number",rules:["requiredValidator"in d?d.requiredValidator:a(G)],label:"Contact",placeholder:"+1-541-754-3010"},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(x,{modelValue:a(_),"onUpdate:modelValue":w[6]||(w[6]=i=>R(_)?_.value=i:null),label:"Select Role",placeholder:"Select Role",rules:["requiredValidator"in d?d.requiredValidator:a(G)],items:["Admin","Author","Editor","Maintainer","Subscriber"]},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(x,{modelValue:a(V),"onUpdate:modelValue":w[7]||(w[7]=i=>R(V)?V.value=i:null),label:"Select Plan",placeholder:"Select Plan",rules:["requiredValidator"in d?d.requiredValidator:a(G)],items:["Basic","Company","Enterprise","Team"]},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(x,{modelValue:a(p),"onUpdate:modelValue":w[8]||(w[8]=i=>R(p)?p.value=i:null),label:"Select Status",placeholder:"Select Status",rules:["requiredValidator"in d?d.requiredValidator:a(G)],items:[{title:"Active",value:"active"},{title:"Inactive",value:"inactive"},{title:"Pending",value:"pending"}]},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(I,{type:"submit",class:"me-3"},{default:t(()=>w[10]||(w[10]=[D(" Submit ")])),_:1}),e(I,{type:"reset",variant:"outlined",color:"secondary",onClick:s},{default:t(()=>w[11]||(w[11]=[D(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},el={class:"mb-2"},tl={__name:"AddActivity",props:{activitiesData:{type:Object,required:!0,default:()=>({title:"",description:"",schedule_at:""})},isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","refreshActivities"],setup(S,{emit:h}){const o=S,y=h,U=b(!1);b(!1);const O=b("radio-1"),u=b({title:"",description:"",type_activity_id:null,opportunity_id:null,assigned_to:null,scheduled_at:null,status:"COMPLETED"}),{completedActivityAndRegister:r,getallTypeActivities:c,typeActivities:m,loadingActivity:g}=ke(),{getOpportunitybyId:A,opportunity:_}=te(),V=b(structuredClone(J(o.activitiesData))),p=x=>{console.log("esta consultando de nuevo despues de cambiar etapa "),A(x)};le(o,()=>{V.value=structuredClone(J(o.activitiesData)),A(V.value.opportunity_id),s()});const s=async()=>{await c()},$=()=>{A(V.value.opportunity_id)},q=()=>{y("update:isDrawerOpen",!1),u.value={title:null,description:null,type_activity_id:null,scheduled_at:null,opportunity_id:null,assigned_to:null,status:"COMPLETED"},y("refreshActivities")},d=async()=>{let x="";O.value==="radio-1"?x="COMPLETED":O.value==="radio-2"&&(x="CANCELLED"),r(V.value.id,{title:u.value.title,description:u.value.description,type_activity_id:u.value.type_activity_id,scheduled_at:u.value.scheduled_at,assigned_to:_.value.user_id,property_id:_.value.property_id,opportunity_id:_.value.id,status:x}),q()},w=async()=>{y("update:isDrawerOpen",!1),y("refreshActivities")},Q=()=>{console.log("Se escucho el evento en AddActivity"),y("refreshActivities")},z=x=>{const i=new Date(x),P=i.getDate(),C=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][i.getMonth()],j=i.getHours().toString().padStart(2,"0"),T=i.getMinutes().toString().padStart(2,"0");return`${P} de ${C}, ${j}:${T}`};return(x,i)=>{const P=fe,F=Ee,C=Pe;return n(),E(M,{class:"d-flex justify-space-between"},{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[S.isDrawerOpen?(n(),E(Y,{key:0},{default:t(()=>[e(K,null,{default:t(()=>[e(Oe,{class:"mx-2 my-2"},{default:t(()=>[e(M,null,{default:t(()=>[e(v,{cols:"12",sm:"5"},{default:t(()=>[e(M,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>i[6]||(i[6]=[l("span",{style:{"font-size":"18px","font-weight":"500"}}," Actividad ",-1)])),_:1}),e(v,{cols:"12"},{default:t(()=>[l("div",el,[l("span",null,k(o.activitiesData.title)+" • "+k(z(o.activitiesData.scheduled_at)),1)]),e(Qe,{modelValue:a(O),"onUpdate:modelValue":i[0]||(i[0]=j=>R(O)?O.value=j:null),style:{"font-size":"14px"},inline:""},{default:t(()=>[i[7]||(i[7]=l("span",null," ¿ Se Realizo ? ",-1)),e(be,{label:"Si",value:"radio-1",density:"compact"}),e(be,{label:"No",value:"radio-2",density:"compact"})]),_:1},8,["modelValue"]),e(We,{class:"mt-2"})]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(P,{modelValue:a(u).title,"onUpdate:modelValue":i[1]||(i[1]=j=>a(u).title=j),label:"Titulo de la actividad",placeholder:"..."},null,8,["modelValue"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(ve,{modelValue:a(u).type_activity_id,"onUpdate:modelValue":i[2]||(i[2]=j=>a(u).type_activity_id=j),label:"Tipo de Actividad",placeholder:"Selecciona el Tipo de Actividad",items:a(m).map(j=>({title:j.name,value:j.id}))},null,8,["modelValue","items"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(F,{modelValue:a(u).scheduled_at,"onUpdate:modelValue":i[3]||(i[3]=j=>a(u).scheduled_at=j),label:"Seleccione la Fecha y Hora",placeholder:"Select date and time",config:{enableTime:!0,dateFormat:"Y-m-d H:i"},rules:["requiredValidator"in x?x.requiredValidator:a(G)]},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(C,{modelValue:a(u).description,"onUpdate:modelValue":i[4]||(i[4]=j=>a(u).description=j),label:"Descripcion",rows:"3",rules:["requiredValidator"in x?x.requiredValidator:a(G)]},null,8,["modelValue","rules"])]),_:1}),e(v,null,{default:t(()=>[e(I,{color:"primary",class:"mx-auto",size:"small",loading:a(g),disabled:a(g),onClick:d},{default:t(()=>i[8]||(i[8]=[D(" Crear Actividad ")])),_:1},8,["loading","disabled"]),e(I,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>i[9]||(i[9]=[D(" Dar de Baja ")])),_:1})]),_:1})]),_:1})]),_:1}),e(v,{cols:"12",sm:"7",style:{"align-items":"center"}},{default:t(()=>[e(M,{class:"mb-2"},{default:t(()=>[e(v,{cols:"6"},{default:t(()=>i[10]||(i[10]=[l("span",{style:{"font-size":"18px","font-weight":"500"}}," Etapa ",-1)])),_:1}),e(v,{cols:"12",md:"6",class:"d-flex justify-end align-center"},{default:t(()=>[e(X,{label:"",color:"primary"},{default:t(()=>[D(k(a(_).stage.title),1)]),_:1})]),_:1})]),_:1}),a(_).stage_id===2?(n(),E(zt,{key:0,opportunity:a(_),onUpdateStageId:p,"onUpdate:newProperty":Q},null,8,["opportunity"])):L("",!0),a(_).stage_id===3?(n(),E(bt,{key:1,opportunity:a(_),onUpdateStageId:p,"onUpdate:newProperty":Q},null,8,["opportunity"])):L("",!0),a(_).stage_id===4?(n(),E(Jt,{key:2,opportunity:a(_),onRefreshActivities:$,onUpdateStageId:p},null,8,["opportunity"])):L("",!0),a(_).stage_id===5?(n(),E(nt,{key:3,opportunity:a(_),onRefreshActivities:$,onUpdateStageId:p,onComplet:w},null,8,["opportunity"])):L("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):(n(),E(Y,{key:1,title:"Reporte de Actividades"},{default:t(()=>[e(Xt)]),_:1}))]),_:1}),e(v,{cols:"12",md:"6"},{default:t(()=>[e(Zt,{"is-drawer-open":a(U),"onUpdate:isDrawerOpen":i[5]||(i[5]=j=>R(U)?U.value=j:null)},null,8,["is-drawer-open"])]),_:1})]),_:1})}}};const ll={class:"title-search-container"},ol={style:{"font-size":"14px"}},al={key:0,class:"no-activities-message d-flex flex-column justify-center align-center",style:{"min-block-size":"200px","text-align":"center"}},il=["onClick"],sl={class:"mx-2"},nl={class:"d-flex justify-content-between",style:{"font-size":"0.9em"}},rl={__name:"list",setup(S){const h=b(""),o=b("Anteriores");b(["Todos","PORA"]),b("Todos");const{getallActivitiesByAsesorFecha:y,getallActivitiesByFechaPast:U,getallActivitiesByFechaFuture:O,activities:u,activitiesPast:r,activitiesFuture:c}=ke(),m=b(""),g=Te("userData").value,A=b(!0),_=b([]),V=b([]),p=b([]),s=async()=>{await y(g.id),_.value=u.value},$=async()=>{await U(g.id),V.value=r.value},q=async()=>{await O(g.id),p.value=c.value};Ne(async()=>{await s(),await $(),await q(),A.value=!1});const d=b(!1),w=F=>{d.value=!0,m.value={...F}},Q=async()=>{A.value=!0,await s(),await $(),await q(),A.value=!1,o.value="Anteriores"},z=oe(()=>[{tabName:"Anteriores",icon:"tabler-calendar",actividades:V,badge:V.value.length},{tabName:"Hoy",icon:"tabler-edit",actividades:_,badge:_.value.length},{tabName:"Futuros",icon:"tabler-calendar",actividades:p,badge:p.value.length}]),x=[{type:"Visita",icon:"tabler-current-location"},{type:"Llamada",icon:"tabler-phone"},{type:"Cotizacion",icon:"tabler-cash"},{type:"Otro",icon:"tabler-table"}],i=F=>{const C=x.find(j=>j.type===F);return C?C.icon:"tabler-default"},P=F=>{const C=new Date(F),j=C.getDate(),H=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][C.getMonth()],se=C.getHours().toString().padStart(2,"0"),Fe=C.getMinutes().toString().padStart(2,"0");return`${j} de ${H}, ${se}:${Fe}`};return le(h,F=>{const C=j=>j.filter(T=>{const H=T.name_opportunity.toLowerCase().includes(F.toLowerCase()),se=T.phone_opportunity.toLowerCase().includes(F.toLowerCase());return H||se});F.length>2?(_.value=C(u.value),V.value=C(r.value),p.value=C(c.value)):(_.value=u.value,V.value=r.value,p.value=c.value)}),(F,C)=>{const j=ie("VCircularProgress");return n(),E(M,{class:"match-height",style:{display:"flex","block-size":"100vh"}},{default:t(()=>[e(v,{cols:"12",md:"4",style:{display:"flex","flex-direction":"column"}},{default:t(()=>[e(Y,{class:"flex-grow-1"},{default:t(()=>[e(de,{class:"d-flex justify-between align-center flex-wrap"},{default:t(()=>[l("div",ll,[C[5]||(C[5]=l("h4",{class:"title-responsive"}," Mis Actividades ",-1)),e(ae,{modelValue:h.value,"onUpdate:modelValue":C[0]||(C[0]=T=>h.value=T),placeholder:"Buscar actividad...",class:"search-field","hide-details":"",dense:"","solo-inverted":"","prepend-inner-icon":"tabler-search"},null,8,["modelValue"])])]),_:1}),e(Je,{modelValue:o.value,"onUpdate:modelValue":C[1]||(C[1]=T=>o.value=T),grow:""},{default:t(()=>[(n(!0),f(N,null,B(z.value,T=>(n(),E(Ye,{key:T.tabName},{default:t(()=>[l("span",ol,k(T.tabName),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),C[11]||(C[11]=l("br",null,null,-1)),e(K,{style:{"flex-grow":"1","overflow-y":"auto"}},{default:t(()=>[A.value?(n(),E(Xe,{key:0,absolute:"",opacity:"0.7"},{default:t(()=>[e(j,{indeterminate:"",size:"70"})]),_:1})):L("",!0),e(Oe,{modelValue:o.value,"onUpdate:modelValue":C[2]||(C[2]=T=>o.value=T),class:"disable-tab-transition",style:{"max-block-size":"500px","overflow-y":"auto"}},{default:t(()=>[(n(!0),f(N,null,B(z.value,T=>(n(),E(Ke,{key:T.tabName,value:T.tabName},{default:t(()=>[T.actividades.value.length===0?(n(),f("div",al,[e(W,{size:"64",color:"grey",icon:"tabler-calendar-off",class:"mb-4",style:{animation:"bounce 1s infinite"}}),C[6]||(C[6]=l("div",{style:{color:"#888","font-size":"1.2em"}}," ¡No tienes actividades pendientes! ",-1)),C[7]||(C[7]=l("div",{style:{color:"#aaa","font-size":"0.9em","margin-block-start":"8px"}}," ¡Relájate y disfruta tu día! ",-1))])):(n(!0),f(N,{key:1},B(T.actividades.value,H=>(n(),f("div",{key:H.id,"fill-dot":"",class:"border mb-2 rounded-sm py-2",onClick:se=>w(H)},[e(me,null,{default:t(()=>[e(M,null,{default:t(()=>[e(v,{cols:"12",md:"2",style:{"padding-inline-end":"0"}},{default:t(()=>[e(X,{class:"d-flex justify-center align-center",style:{display:"inline-flex","border-radius":"4px","block-size":"36px","inline-size":"36px"}},{default:t(()=>[e(W,{size:"25",icon:"tabler-home"})]),_:1})]),_:1}),H.project_name?(n(),E(v,{key:0,cols:"12",md:"5",class:"d-flex flex-column align-start",style:{"padding-inline-start":"0"}},{default:t(()=>[e(ee,{class:"text-left"},{default:t(()=>[l("strong",null,k(H.property_title),1)]),_:2},1024),e(Z,{class:"font-weight-medium text-left"},{default:t(()=>[l("span",null,"$ "+k(H.price),1)]),_:2},1024)]),_:2},1024)):L("",!0),H.project_name?L("",!0):(n(),E(v,{key:1,cols:"12",md:"5"},{default:t(()=>[e(ee,{class:"text-left"},{default:t(()=>C[8]||(C[8]=[l("strong",null," Departamento ",-1)])),_:1}),e(Z,{class:"font-weight-medium text-left"},{default:t(()=>C[9]||(C[9]=[l("span",null,"Indefinido",-1)])),_:1})]),_:1})),e(v,{cols:"12",md:"5",class:"d-flex justify-end align-center"},{default:t(()=>[e(X,{label:"",color:"primary",class:"ml-auto",style:{"font-size":"10px"}},{default:t(()=>[D(k(H.stage),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(me,{class:""},{default:t(()=>[e(X,{label:"",color:"secondary",class:"w-100 h-48"},{default:t(()=>[e(W,{size:"20",icon:i(H.type_activity)},null,8,["icon"]),l("div",sl,k(H.type_activity)+"   •   "+k(H.name_opportunity),1)]),_:2},1024)]),_:2},1024),e(me,null,{default:t(()=>[l("div",nl,[C[10]||(C[10]=l("div",{style:{"flex-grow":"1"}}," Ver ",-1)),l("div",null,k(P(H.scheduled_at)),1)])]),_:2},1024)],8,il))),128))]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(v,{cols:"12",md:"8",style:{display:"flex","flex-direction":"column"}},{default:t(()=>[e(tl,{"is-drawer-open":d.value,"onUpdate:isDrawerOpen":C[3]||(C[3]=T=>d.value=T),"activities-data":m.value,class:"flex-grow-1",onRefreshActivities:Q,onLoaded:C[4]||(C[4]=T=>A.value=!1)},null,8,["is-drawer-open","activities-data"])]),_:1})]),_:1})}}},vo=ze(rl,[["__scopeId","data-v-9e58f0ea"]]);export{vo as default};
