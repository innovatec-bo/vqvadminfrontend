import{f as v}from"./currencyFormatter-92ad4b3c.js";import{_ as Q}from"./AppSelect-5767fb17.js";import{_ as G}from"./AppTextField-963734da.js";import{u as H}from"./useSales-8d5565b3.js";import{p as K}from"./paginationMeta-4ad053a4.js";import{l as Y}from"./lodash-7c7ee518.js";import{S as b}from"./notifications-b6da0b75.js";import{r as f,ac as q,w as J,a as P,o as d,c as p,b as i,e as n,d as r,a4 as y,v as c,n as s,F as C,i as V,x as l,s as D,$ as W,f as X,z as Z}from"./index-eea64eab.js";import{_ as ee}from"./_plugin-vue_export-helper-c27b6911.js";import{V as te}from"./VCard-1446dd49.js";import{V as ae}from"./VCardText-74af991a.js";import{V as A}from"./VDivider-f3ea9039.js";import{V as oe}from"./VDataTableServer-66f38133.js";import{V as ne}from"./VPagination-ac3661cc.js";import{V as ie}from"./VCheckbox-d0024d7a.js";import{V as re}from"./VTooltip-60d6696f.js";import"./form-97d5e662.js";import"./VSelect-c4493e38.js";import"./VTextField-fdaf4f5a.js";/* empty css                   */import"./VCounter-1694484c.js";import"./VImg-bf97f22a.js";import"./VField-cbcf2eef.js";import"./easing-9f15041e.js";import"./VInput-b54c7b33.js";import"./forwardRefs-8348545e.js";import"./VList-b205d3fa.js";import"./ssrBoot-d631879b.js";import"./VAvatar-596ec46a.js";import"./dialog-transition-46c42648.js";import"./VMenu-054aa5e8.js";import"./VOverlay-9f45cad7.js";import"./lazy-8a330c44.js";import"./scopeId-752bc43e.js";import"./VCheckboxBtn-11740b93.js";import"./VSelectionControl-1cd7c46d.js";import"./VChip-d184a964.js";import"./api-40e7a553.js";import"./index-9c720871.js";import"./constants-71880aa6.js";import"./VDataTable-1a09f839.js";import"./VTable-1594d059.js";import"./filter-86a23bbd.js";const le={class:"d-flex justify-space-between flex-wrap gap-y-4"},se={class:"d-flex flex-row gap-4 align-center flex-wrap"},me={class:"v-data-table__tr"},ue=["colspan"],de={class:"mb-2 mx-10"},pe={class:"mb-2 mx-10"},ce={class:"mb-2 mx-10"},fe={class:"d-flex align-center justify-sm-space-between justify-center flex-wrap gap-3 pa-5 pt-3"},ge={class:"text-sm text-disabled mb-0"},_e={class:"d-flex items-center gap-x-2"},ve={__name:"listSales",setup(ye){const{AllSalesPaginated:E,exportSaleExcel:h,SaleChangeStageDiscard:w,SaleChangeSignature:B,sales:I,totalSales:g}=H(),_=f(""),m=f(10),u=f(1);f(),f();const N=q("userAbilityRules").value,x=[{title:"",key:"data-table-expand"},{title:"Nit/CI",key:"nit"},{title:"Cliente",key:"social_reason"},{title:"Método de Pago",key:"payment_method"},{title:"Total Contrato",key:"amount"},{title:"Estado",key:"status"},{title:"Firma",key:"confirmation_signature"},{title:"Acción",key:"action"}],T=a=>a==="CASH"?"Al Contado":a==="DIRECTCREDIT"?"Crédito Directo":a==="BANKCREDIT"?"Crédito Bancario":a,R=a=>a==="SALE"?"VENDIDO":a==="DISCARD"?"CANCELADO":a==="DELIVERY"?"ENTREGADO":a,M=a=>{u.value=a.page,m.value=a.itemsPerPage},L=a=>{b.fire({title:"Quieres dar de baja la venta?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"confirmar"}).then(t=>{t.isConfirmed&&(w(a),S(),b.fire({text:"La Venta fue dado de baja",icon:"success"}))})},S=()=>{E({page:u.value,itemsPerPage:m.value,search:_.value})},U=async a=>{console.log("entra a firma"),await B(a)},F=async()=>{await h()},j=Y.debounce(S,300);return J([_,m,u],j,{immediate:!0}),(a,t)=>{const $=G,O=Q,k=P("IconBtn"),z=P("RouterLink");return d(),p("div",null,[i(te,{title:"Lista de Ventas"},{default:n(()=>[i(ae,null,{default:n(()=>[r("div",le,[i($,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=e=>_.value=e),style:{"max-inline-size":"200px","min-inline-size":"200px"},placeholder:"Buscar...",density:"compact"},null,8,["modelValue"]),i(y,{"prepend-icon":"tabler-screen-share",variant:"tonal",color:"secondary",class:"mx-3",onClick:F},{default:n(()=>t[5]||(t[5]=[c(" Export ")])),_:1}),r("div",se,[i(O,{modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=e=>m.value=e),density:"compact",items:[5,10,20,50,100]},null,8,["modelValue"])])])]),_:1}),i(A),i(s(oe),{"items-per-page":m.value,"onUpdate:itemsPerPage":t[3]||(t[3]=e=>m.value=e),page:u.value,"onUpdate:page":t[4]||(t[4]=e=>u.value=e),items:s(I),headers:x,"items-length":s(g),class:"text-no-wrap","expand-on-click":"","onUpdate:options":M},{"expanded-row":n(({item:e})=>[r("tr",me,[r("td",{colspan:x.length},[r("div",de,[t[6]||(t[6]=r("strong",null,"Propiedades:",-1)),r("ul",null,[(d(!0),p(C,null,V(e.properties,o=>(d(),p("li",{key:o.id},l(o.title)+" | "+l(o.code)+" | ("+l(o.surface)+" m²) ",1))),128))])]),r("div",pe,[t[7]||(t[7]=r("strong",null,"Pagos Iniciales:",-1)),r("ul",null,[(d(!0),p(C,null,V(e.initial_payments,o=>(d(),p("li",{key:o.id}," Fecha: "+l(o.date)+" | Monto: "+l(("formatCurrency"in a?a.formatCurrency:s(v))(o.amount))+" | Pagado: "+l(o.is_paid?"Sí":"No"),1))),128))])]),r("div",ce,[t[8]||(t[8]=r("strong",null,"Pagos de Saldo:",-1)),r("ul",null,[(d(!0),p(C,null,V(e.balance_payments,o=>(d(),p("li",{key:o.id}," Fecha: "+l(o.date)+" | Monto: "+l(("formatCurrency"in a?a.formatCurrency:s(v))(o.amount))+" | Pagado: "+l(o.is_paid?"Sí":"No"),1))),128))])])],8,ue)])]),bottom:n(()=>[i(A),r("div",fe,[r("p",ge,l(s(K)({page:u.value,itemsPerPage:m.value},s(g))),1),i(ne,{modelValue:u.value,"onUpdate:modelValue":t[2]||(t[2]=e=>u.value=e),length:Math.ceil(s(g)/m.value),"total-visible":a.$vuetify.display.xs?1:Math.min(Math.ceil(s(g)/m.value),5)},{prev:n(e=>[i(y,D({variant:"tonal",color:"default"},e,{icon:!1}),{default:n(()=>t[9]||(t[9]=[c(" Anterior ")])),_:2},1040)]),next:n(e=>[i(y,D({variant:"tonal",color:"default"},e,{icon:!1}),{default:n(()=>t[10]||(t[10]=[c(" Siguiente ")])),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),"item.payment_method":n(({item:e})=>[c(l(T(e.payment_method)),1)]),"item.amount":n(({item:e})=>[c(l(("formatCurrency"in a?a.formatCurrency:s(v))(e.amount)),1)]),"item.status":n(({item:e})=>[c(l(R(e.status)),1)]),"item.confirmation_signature":n(({item:e})=>[i(ie,{modelValue:e.confirmation_signature,"onUpdate:modelValue":o=>e.confirmation_signature=o,"true-value":1,"false-value":0,onChange:o=>U(e.id)},{default:n(()=>[i(re,{activator:"parent",location:"top"},{default:n(()=>t[11]||(t[11]=[c(" Confirmar firma ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),"item.action":n(({item:e})=>[r("div",_e,[i(z,{to:{name:"sale-id",params:{id:e.id}}},{default:n(()=>[i(k,null,{default:n(()=>[i(W,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"]),s(N).some(o=>o.action==="manage"&&o.subject==="ADMINISTRADOR")?(d(),X(k,{key:0,icon:"tabler-trash",onClick:o=>L(e.id)},null,8,["onClick"])):Z("",!0)])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1})])}}},st=ee(ve,[["__scopeId","data-v-181aec2f"]]);export{st as default};
