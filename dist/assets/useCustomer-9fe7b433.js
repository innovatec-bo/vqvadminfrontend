import{$ as c}from"./api-00241657.js";import{b as n,c as w}from"./notifications-cae4d01c.js";import{r as a,k as C,a2 as p}from"./index-1f8ac145.js";const E=async t=>await c("/customer/register/prospect",{method:"POST",body:t}),x=async t=>await c(`/customer/perfil/${t}`,{method:"GET"}),d=async t=>await c("customer/list-paginated",{method:"GET",params:t}),P=async()=>await c("/export/customer",{method:"GET",responseType:"blob"});function k(){const t=a(!1),l=a(null),i=a(null),u=a([]),m=a(0),f=C(),h=async o=>{if(!o.name||!o.phone){n("Falta Informacion","El nombre y el celular son obligatorios");return}t.value=!0,l.value=null;try{const e=await createThread(),r={name:o.name,phone:o.phone,thread:e.id,email:o.email,ci:o.ci,type_customer:o.type_customer,cod_phone:o.countryCode.replace(/\+/g,""),description:o.description};console.log(r);const s=await E(r);console.log("Respuesta del servidor:",s),w("Cliente agregado exitosamente","El cliente ha sido registrado en el sistema correctamente."),i.value=s.data,f.push("/customers/listCustomers")}catch(e){console.log(e),e.response&&e.response.status==422&&n("Falta Informacion","El nombre y el celular son obligatorios"),e.response&&e.response.status==409?n("Advertencia",e.response._data.message):n("Advertencia","Hubo un problema al registar al cliente"),l.value=e.message}finally{t.value=!1}},y=async o=>{try{const e=await d(o);console.log(e),u.value=e.data.data,m.value=e.data.total}catch(e){console.log(e)}},g=async o=>{try{t.value=!0;const e=await x(o);i.value=e.data}catch(e){console.error(e)}finally{t.value=!1}},v=async()=>{try{const o=await P();if(!(o instanceof Blob))throw new Error("Respuesta inválida del servidor con el BLOB");const e=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),r=window.URL.createObjectURL(e),s=document.createElement("a");s.href=r,s.setAttribute("download","clientes.xlsx"),document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(r),document.body.removeChild(s)}catch(o){console.error("Error en exportación:",o)}},b=async o=>{t.value=!0;try{const e=await d({search:o,page:1,itemsPerPage:10});u.value=e.data.data,m.value=e.data.total}catch(e){console.error("Error en búsqueda de clientes:",e)}finally{t.value=!1}};return{loading:t,error:l,customer:i,customers:p(()=>u.value),totalCustomers:p(()=>m.value),addCustomer:h,allCustomerPaginate:y,getPerfilCutomerbyId:g,exportCustomerExcel:v,searchCustomers:b}}export{k as u};
