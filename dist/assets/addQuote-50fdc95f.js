import{r as _}from"./validators-dea6e3a5.js";import{_ as K}from"./AppAutocomplete-8af0ab4c.js";import{f as L}from"./currencyFormatter-92ad4b3c.js";import{_ as O}from"./AppTextarea-86ba4446.js";import{_ as Y}from"./AppSelect-a94bb4b5.js";import{_ as S}from"./AppTextField-dbd2079f.js";import{_ as G}from"./AppDateTimePicker-e639a769.js";import{P as g,a as H,_ as W}from"./InvoiceAddMoney-8b0647ac.js";import{V as $}from"./VNodeRenderer-df1a41c3.js";import{r as x,w as F,H as B,o as q,f as U,e as t,d as c,c as I,F as J,i as X,b as l,n as i,x as D,v as E,z as Z,a4 as N,$ as ee,I as M,a0 as le,a2 as w}from"./index-be4ef96b.js";import{u as ae}from"./useProperty-40a7fa59.js";import{V as T}from"./VRow-e0a154bf.js";import{V as u}from"./VCol-b818271e.js";import{V as R}from"./VCard-5b4e5a51.js";import{V as h}from"./VCardText-c51015c4.js";import{V as z}from"./VDivider-d18e43da.js";import{u as oe}from"./useCustomer-957c52d2.js";import{u as te}from"./useQuote-898cc75d.js";import{c as j}from"./notifications-81bc0416.js";import"./helpers-61e4df1a.js";import"./form-259f0f3b.js";import"./VSelect-39c2ce18.js";import"./VTextField-152c63fb.js";/* empty css                   */import"./VCounter-26f47836.js";import"./VImg-4cedaecd.js";import"./VField-4ba7ed5e.js";import"./easing-9f15041e.js";import"./VInput-a9d1509c.js";import"./forwardRefs-8348545e.js";import"./VList-ee3afd9f.js";import"./ssrBoot-02bb78be.js";import"./VAvatar-60b5deb6.js";import"./dialog-transition-21636c9d.js";import"./VMenu-7b085012.js";import"./VOverlay-11c6a7bf.js";import"./lazy-b70ade91.js";import"./scopeId-34b54ef9.js";import"./VCheckboxBtn-92efd5c6.js";import"./VSelectionControl-34d0cbee.js";import"./VChip-f1e27fa9.js";import"./filter-6c69dfc1.js";import"./api-7086014d.js";import"./index-9c720871.js";import"./constants-f3b5ca65.js";function ie(P){return typeof P!="number"?P:`${P.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")}`}const re={class:"pa-5 flex-grow-1"},ne={key:0,style:{"font-size":"small","padding-block":""}},de={class:"d-flex justify-end mt-3"},se={__name:"InvoiceAddProperty",props:{properties:{type:Array,required:!0}},emits:["removeProduct","totalAmount","addProperty"],setup(P,{emit:A}){const r=P,k=A,{propertiesForType:v}=ae(),o=x([]),V=x([]),y=()=>{const e={property_id:null,price:null,property_type:g.PARK.value,property_type_name:g.PARK.label};k("addProperty",e)},C=e=>{k("removeProduct",e)},n=e=>{if(console.log("entra a update price"),e.property_type===g.DEPARTAMENT.value){const p=V.value.find(m=>m.id===e.property_id);p&&(e.price=p.base_price)}else if(e.property_type===g.PARK.value){const p=o.value.find(m=>m.id===e.property_id);p&&(e.price=p.base_price)}};return F(()=>r.properties.map(e=>e.property_id),(e,p)=>{e.forEach((m,s)=>{const d=r.properties[s];m!==p[s]&&n(d)})}),B(async()=>{try{const e=await v(g.DEPARTAMENT.value);V.value=e;const p=await v(g.PARK.value);o.value=p}catch(e){console.error("Error al obtener las propiedades:",e)}}),(e,p)=>{const m=S;return q(),U(R,{flat:"",border:"",class:"d-flex flex-row"},{default:t(()=>[c("div",re,[(q(!0),I(J,null,X(r.properties,(s,d)=>(q(),U(T,{key:d,class:"mb-4"},{default:t(()=>[l(u,{cols:"12",sm:"4",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(Y,{modelValue:s.property_id,"onUpdate:modelValue":a=>s.property_id=a,rules:["requiredValidator"in e?e.requiredValidator:i(_)],label:s.property_type_name,placeholder:"Selecciona una propiedad",items:s.property_type===i(g).DEPARTAMENT.value?i(V):i(o),"item-title":"title","item-value":"id",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules","label","items"]),s.property_id&&s.property_type===i(g).DEPARTAMENT.value?(q(),I("span",ne,[c("strong",null,D(i(V)[s.property_id-1].departament.isfacade===1?"En fachada":"Orientacion sur")+", ",1),E(" "+D(i(V)[s.property_id-1].surface)+" ",1),p[0]||(p[0]=c("strong",null," m2",-1)),p[1]||(p[1]=c("br",null,null,-1)),E(" "+D(i(V)[s.property_id-1].departament.number_bedrooms)+" Dormitorio(s), ",1)])):Z("",!0)]),_:2},1024),l(u,{cols:"12",sm:"2",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(m,{modelValue:s.price,"onUpdate:modelValue":a=>s.price=a,rules:["requiredValidator"in e?e.requiredValidator:i(_)],label:"Precio *",placeholder:"$us",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),l(u,{cols:"12",sm:"2",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(m,{modelValue:s.price_it,"onUpdate:modelValue":a=>s.price_it=a,rules:["requiredValidator"in e?e.requiredValidator:i(_)],label:"3% (IT) *",placeholder:"%",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(m,{modelValue:s.price_contrato,"onUpdate:modelValue":a=>s.price_contrato=a,rules:["requiredValidator"in e?e.requiredValidator:i(_)],label:"Precio Contrato *",placeholder:"Escribe el precio",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),l(u,{cols:"12",sm:"1",class:"my-4"},{default:t(()=>[l(N,{color:"error",size:"small",onClick:a=>C(d)},{default:t(()=>[l(ee,{icon:"tabler-square-x"})]),_:2},1032,["onClick"])]),_:2},1024),l(u,{cols:"12",style:{"font-size":"small","padding-block":"0","padding-inline":"4px"}})]),_:2},1024))),128)),c("div",de,[l(N,{color:"secondary",onClick:y},{default:t(()=>p[2]||(p[2]=[E(" Agregar Parqueo ")])),_:1})])])]),_:1})}}},ue={class:"d-flex align-center justify-sm-end mx-2"},pe={style:{"inline-size":"9.5rem"}},me={class:"d-flex align-center justify-sm-end"},ce={style:{"inline-size":"9.5rem"}},fe={class:"text-center my-4"},_e={__name:"AddQuoteInvoice",props:{data:{type:null,required:!0}},emits:["push","remove"],setup(P,{emit:A}){const r=P,k=A,v=n=>{k("push",n)},o=n=>{k("remove",n)},V=["30","50","80","100"],y=x("30"),C=n=>(r.data.initial_fee=n*y.value/100,r.data.balance=n-r.data.initial_fee,n*y.value/100);return(n,e)=>{const p=G,m=S,s=Y,d=O;return q(),U(R,null,{default:t(()=>[l(h,{class:"d-flex flex-wrap justify-space-between gap-y-5 flex-column flex-sm-row"},{default:t(()=>[l(i($),{nodes:i(M).app.logo,class:"me-3"},null,8,["nodes"]),e[12]||(e[12]=c("h4",{class:"font-weight-bold text-h3 d-flex align-center"}," Formulario de Cotizacion ",-1)),l(i($),{nodes:i(M).app.logopora,class:"me-3"},null,8,["nodes"])]),_:1}),l(i(T),{class:"justify-end ma-sm-2"},{default:t(()=>[c("div",ue,[e[13]||(e[13]=c("span",{style:{"inline-size":"6rem"}},"Emisión ",-1)),c("span",pe,[l(p,{modelValue:r.data.creation_date,"onUpdate:modelValue":e[0]||(e[0]=a=>r.data.creation_date=a),rules:["requiredValidator"in n?n.requiredValidator:i(_)],density:"compact",placeholder:"YYYY-MM-DD",config:{position:"auto right"}},null,8,["modelValue","rules"])])]),c("div",me,[e[14]||(e[14]=c("span",{class:"mx-2"},"Válido ",-1)),c("span",ce,[l(p,{modelValue:r.data.expiration_date,"onUpdate:modelValue":e[1]||(e[1]=a=>r.data.expiration_date=a),rules:["requiredValidator"in n?n.requiredValidator:i(_)],density:"compact",placeholder:"YYYY-MM-DD",config:{position:"auto right"}},null,8,["modelValue","rules"])])])]),_:1}),l(z,{thickness:"12"}),l(h,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row gap-y-5 gap-4"},{default:t(()=>[l(i(T),null,{default:t(()=>[l(u,{cols:"12",sm:"8",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(m,{modelValue:r.data.social_reason,"onUpdate:modelValue":e[2]||(e[2]=a=>r.data.social_reason=a),rules:["requiredValidator"in n?n.requiredValidator:i(_)],label:"Cliente *",placeholder:"Canzza",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",sm:"4",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(m,{modelValue:r.data.nit,"onUpdate:modelValue":e[3]||(e[3]=a=>r.data.nit=a),rules:["requiredValidator"in n?n.requiredValidator:i(_)],label:"C.I./NIT *",placeholder:"0000000",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(m,{modelValue:r.data.workplace,"onUpdate:modelValue":e[4]||(e[4]=a=>r.data.workplace=a),label:"Lugar de Trabajo",placeholder:"Placeholder Text",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(m,{modelValue:r.data.email,"onUpdate:modelValue":e[5]||(e[5]=a=>r.data.email=a),rules:["requiredValidator"in n?n.requiredValidator:i(_)],label:"Correo *",placeholder:"email@gmail.com",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(m,{modelValue:r.data.address,"onUpdate:modelValue":e[6]||(e[6]=a=>r.data.address=a),label:"Dirección",placeholder:"Av/ Equipetrol ....",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(m,{modelValue:r.data.phone,"onUpdate:modelValue":e[7]||(e[7]=a=>r.data.phone=a),rules:["requiredValidator"in n?n.requiredValidator:i(_)],label:"Celular *",placeholder:"77049267",outlined:"",dense:"",class:"custom-salesforce-input"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(m,{label:"Teléfono Fijo",placeholder:"33557292",outlined:"",dense:"",class:"custom-salesforce-input"})]),_:1})]),_:1})]),_:1}),l(z,{thickness:"12"}),l(h,{class:"add-products-form"},{default:t(()=>[l(i(T),null,{default:t(()=>[l(u,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"},class:"mb-2"},{default:t(()=>[l(se,{properties:r.data.properties,onAddProperty:v,onRemoveProduct:o},null,8,["properties"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(s,{modelValue:r.data.payment_method,"onUpdate:modelValue":e[8]||(e[8]=a=>r.data.payment_method=a),rules:["requiredValidator"in n?n.requiredValidator:i(_)],label:"Tipo de Pago *",placeholder:"Seleccione ",items:Object.values(i(H)),class:"custom-salesforce-input"},null,8,["modelValue","rules","items"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(m,{modelValue:r.data.amount,"onUpdate:modelValue":e[9]||(e[9]=a=>r.data.amount=a),value:("formatNumber"in n?n.formatNumber:i(ie))(r.data.amount),rules:["requiredValidator"in n?n.requiredValidator:i(_)],label:"Total *",placeholder:"1000.000,00",outlined:"",dense:"",disabled:""},null,8,["modelValue","value","rules"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(s,{modelValue:i(y),"onUpdate:modelValue":e[10]||(e[10]=a=>le(y)?y.value=a:null),items:V,label:"Anticipo: %",placeholder:"% Anticipo",class:"mb-2"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",sm:"3",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[c("div",fe,[e[15]||(e[15]=c("h4",null," Saldo por pagar: ",-1)),c("span",null,D(("formatCurrency"in n?n.formatCurrency:i(L))(r.data.amount-r.data.initial_fee)),1)])]),_:1})]),_:1})]),_:1}),l(h,{class:"add-products-form"},{default:t(()=>[l(i(T),null,{default:t(()=>[l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(W,{title:" Anticipo ",amount:C(r.data.amount),differs:r.data.differs_initial_fee,type:n.INITIAL_PAYMENT},null,8,["amount","differs","type"])]),_:1}),l(u,{cols:"12",sm:"6",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l(d,{modelValue:r.data.observations,"onUpdate:modelValue":e[11]||(e[11]=a=>r.data.observations=a),"auto-grow":"",label:"Observaciones del Cliente",rows:"3",placeholder:"Descripción...","row-height":"20"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}}},nl={__name:"addQuote",setup(P){const{generateQuote:A}=te(),{allCustomerPaginate:r,customers:k}=oe(),v=x(!1),o=x({social_reason:"",nit:"",address:"",email:"",phone:"",workplace:"",expiration_date:null,creation_date:new Date().toISOString().split("T")[0],observations:"",payment_method:null,amount:null,initial_fee:null,balance:null,opportunity_id:null,customer_id:null,properties:[{property_id:null,price:null,price_it:null,price_contrato:null,property_type:g.DEPARTAMENT.value,property_type_name:g.DEPARTAMENT.label}],differs_initial_fee:[],differs_balance:[]}),V=w(()=>o.value.social_reason&&o.value.nit&&o.value.email&&o.value.phone&&o.value.amount&&o.value.creation_date&&o.value.expiration_date&&o.value.payment_method&&o.value.balance&&o.value.customer_id),y=w(()=>o.value.properties.every(d=>d.property_id!==null&&d.price!==null&&d.price_it!==null&&d.price_contrato!==null)),C=w(()=>o.value.differs_initial_fee.length===0?!0:o.value.differs_initial_fee.every(d=>d.amount!==null)),n=w(()=>{if(o.value.differs_initial_fee.length===0)return!0;const d=o.value.differs_initial_fee.reduce((b,Q)=>b+(Q.amount||0),0),a=parseFloat(d),f=parseFloat(o.value.initial_fee);return a===f}),e=w(()=>V.value&&y.value&&C.value),p=d=>{o.value.properties.push(d)},m=d=>{o.value.properties.splice(d,1)},s=async()=>{if(!e.value){j("Validación fallida","Completa todos los campos obligatorios.");return}if(!n.value){j("Validación fallida","La suma de las diferencias del anticipo no son correctas");return}v.value=!0;try{console.log(o),await A(o.value)}catch(d){console.error("Error generando la venta:",d)}finally{v.value=!1}};return B(async()=>{await r({page:1,itemsPerPage:100})}),F(()=>o.value.properties,d=>{let a=0;d.forEach(f=>{if(f.price){const b=parseFloat(f.price)||0;f.price_it=b*.03,f.price_contrato=b+f.price_it,a+=f.price_contrato}else f.price_it=null}),o.value.amount=a},{deep:!0}),F(()=>o.value.customer_id,d=>{const a=k.value.find(f=>f.id==d);a&&(o.value.social_reason=a.name,o.value.email=a.email,o.value.phone=a.phone,o.value.nit=a.ci,o.value.opportunity_id=a.opportunity_id,a.property_id!==null&&(o.value.properties[0].property_id=a.property_id)),o.value.customer_id=d}),(d,a)=>{const f=K;return q(),U(T,null,{default:t(()=>[l(u,{cols:"12",md:"9"},{default:t(()=>[l(_e,{data:i(o),onPush:p,onRemove:m},null,8,["data"])]),_:1}),l(u,{cols:"12",md:"3"},{default:t(()=>[l(R,{class:"mb-8"},{default:t(()=>[l(u,{cols:"12"},{default:t(()=>[l(f,{modelValue:i(o).customer_id,"onUpdate:modelValue":a[0]||(a[0]=b=>i(o).customer_id=b),rules:["requiredValidator"in d?d.requiredValidator:i(_)],label:"Clientes",placeholder:"Selecciona un Cliente",items:i(k).map(b=>({title:b.name,value:b.id})),outlined:""},null,8,["modelValue","rules","items"])]),_:1}),l(h,null,{default:t(()=>[l(N,{loading:i(v),disabled:!i(e)||i(v),class:"mb-2",onClick:s},{default:t(()=>a[1]||(a[1]=[E(" Guardar Cotización ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})}}};export{nl as default};
