import{u as le,p as we,S as xe,_ as ke,a as Pe}from"./PreSaleForm-b1a50765.js";import{r as K,e as je}from"./validators-dea6e3a5.js";import{_ as De}from"./AppTextarea-c00fbf57.js";import{_ as Ie}from"./AppDateTimePicker-19147de1.js";import{_ as ve}from"./AppTextField-af3c0d06.js";import{_ as ge}from"./AppSelect-fcb713a0.js";import{$ as re}from"./api-840e85ec.js";import{s as Ce,a as Te,b as Ne,c as $e}from"./notifications-ada6c777.js";import{r as b,o as n,c as f,d as l,F as T,i as M,b as e,e as t,n as a,v as C,x as D,z as L,f as q,$ as W,a4 as j,w as oe,a3 as he,a as ie,a0 as B,am as J,a2 as X,an as be,ac as Re,H as Be}from"./index-1a177fac.js";import{V as Se}from"./VAvatar-746409dc.js";import{b as ee,c as te,a as me}from"./VList-27644df4.js";import{a as g,V as H}from"./VRow-9605074f.js";import{V as Z}from"./VChip-dad1b381.js";import{V as Q}from"./VCardText-3e832476.js";import{a as Ae}from"./formatters-b3558c7d.js";import{u as Le}from"./useQuote-e24e5432.js";import{_ as Me}from"./AppAutocomplete-5dcd44c2.js";import{_ as ue}from"./DialogCloseBtn-a85c3472.js";import{u as He}from"./useProperty-4ac1edf6.js";import{V as Y,b as de}from"./VCard-6aed7640.js";import{V as ze}from"./VForm-0f28ddf3.js";import{V as pe}from"./VDialog-3c80ddb2.js";import{V as fe}from"./VCheckbox-0708fe3c.js";import{V as Oe}from"./VTooltip-889164d8.js";import{V as ne}from"./VTable-43dd5d4c.js";import{f as ye}from"./currencyFormatter-96e3a729.js";import{V as ae}from"./VTextField-233a1e67.js";import{_ as Ue}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as Ge}from"./AppDrawerHeaderSection-d6f6e6c3.js";import{P as Ke}from"./vue3-perfect-scrollbar.esm-7d283f37.js";import{V as Qe}from"./VNavigationDrawer-693b40fa.js";import{V as Fe,a as We}from"./VWindowItem-e833325e.js";import{V as Je,a as Ve}from"./VRadioGroup-998c5abb.js";import{V as Ye}from"./VDivider-89fc25cf.js";import{V as Xe,a as Ze}from"./VTabs-53165df4.js";import{V as et}from"./VOverlay-cd68e9cf.js";import"./useSales-7931e9f6.js";import"./InvoiceAddMoney-6470391f.js";import"./VNodeRenderer-5e4b7e2d.js";import"./helpers-61e4df1a.js";import"./form-76bf3a5a.js";/* empty css                   */import"./VCounter-201466f2.js";import"./VImg-02f2991a.js";import"./VField-291837b3.js";import"./easing-9f15041e.js";import"./VInput-6ac061e2.js";import"./forwardRefs-8348545e.js";import"./VSelect-dbb32e64.js";import"./dialog-transition-db31fc5d.js";import"./VMenu-e6998fe0.js";import"./scopeId-3835d7b8.js";import"./VCheckboxBtn-edbf9ddf.js";import"./VSelectionControl-62690a25.js";import"./index-9c720871.js";import"./constants-8e30317b.js";import"./ssrBoot-88d6bba5.js";import"./filter-095c9cb7.js";import"./VSpacer-75b6c56e.js";import"./lazy-a5622444.js";import"./VSlideGroup-3b57fbac.js";const tt=async(h,z)=>await re(`/opportunity/${h}/stage/${z}`,{method:"GET"}),lt=async(h,z,o)=>await re(`/opportunity/${h}/procedure/${z}`,{method:"PATCH",body:o});function ce(){const h=b(null),z=b(!1),o=b(!1),y=b([]);return{process:h,loadingProcess:z,errorProcess:o,processes:y,allProcessesOpportunityForStage:async(m,r)=>{try{const v=await tt(m,r);y.value=v.data}catch(v){console.log(v)}},checkProcessForOpportunity:async(m,r,v)=>{try{console.log(v);const u=await lt(m,r,v);Ce("¡Proceso completado exitosamente!","El proceso ha sido llevado a cabo sin inconvenientes. ")}catch(u){console.log(u)}}}}const ot={class:"my-5"},at={key:0},it=["src"],st={class:"my-5"},nt={key:0,class:"d-flex flex-wrap gap-2 my-5"},rt={key:1},ut={__name:"EditDeliveryOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","complet"],setup(h,{emit:z}){const o=h,y=z,{changeStatusByOpportunity:U}=le(),{checkProcessForOpportunity:S}=ce(),m=async()=>{try{await U(o.opportunity.id,7,{}),y("complet")}catch(v){console.error("Error updating customer:",v)}},r=async(v,u)=>{console.log(`Procedimiento ${v} marcado como: ${u?"realizado":"no realizado"}`),await S(o.opportunity.id,v,{is_check:!u}),y("updateStageId",o.opportunity.id)};return(v,u)=>(n(),f(T,null,[l("div",ot,[u[0]||(u[0]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Propiedades ",-1)),o.opportunity.sales.length>0?(n(),f("div",at,[(n(!0),f(T,null,M(o.opportunity.sales,_=>(n(),f("div",{key:_.id},[(n(!0),f(T,null,M(_.properties,O=>(n(),f("div",{key:O.id,class:"d-flex align-center justify-between"},[e(Se,{size:"50",rounded:""},{default:t(()=>[l("img",{src:a(we),alt:"Logo pora",style:{"border-radius":"30%"}},null,8,it)]),_:1}),e(g,{cols:"12",md:"7"},{default:t(()=>[e(ee,{class:"font-weight-medium"},{default:t(()=>[C(D(O.project_title)+" | "+D(O.title),1)]),_:2},1024),e(te,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",null,"$ "+D(O.pivot_price),1)]),_:2},1024)]),_:2},1024)]))),128))]))),128))])):L("",!0)]),l("div",st,[u[2]||(u[2]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(n(),f("div",nt,[(n(!0),f(T,null,M(o.opportunity.procedure,_=>(n(),f("div",{key:_.id},[e(Z,{color:_.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:O=>r(_.id,_.pivot.is_check)},{default:t(()=>[_.pivot.is_check?(n(),q(W,{key:0,icon:"tabler-check",class:"mr-2"})):L("",!0),C(" "+D(_.title),1)]),_:2},1032,["color","onClick"])]))),128))])):(n(),f("div",rt,u[1]||(u[1]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(Q,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(j,{color:"primary",size:"small",onClick:m},{default:t(()=>u[3]||(u[3]=[C(" Finalizar Oportunidad ")])),_:1})]),_:1})],64))}},qe={__name:"EditCustomerDialog",props:{isDialogVisible:{type:Boolean,required:!0},opportunityKanban:{type:Object,required:!0}},emits:["update:isDialogVisible","update:newProperty"],setup(h,{emit:z}){const o=h,y=z;Object.values(xe).map(x=>({title:x.label,value:x.value}));const{propertiesAvailbles:U,properties:S}=He(),{getOpportunitybyId:m,opportunity:r,changeOpportunity:v,loadingOpportunity:u}=le(),_=()=>{y("update:isDialogVisible",!1)},O=async()=>{console.log("antes del save:",r);const x={id:r.value.id,description:r.value.description,property_id:r.value.property_id,customer:{id:r.value.customer.id,name:r.value.customer.name,email:r.value.customer.email,ci:r.value.customer.ci,cod_phone:r.value.cod_phone,phone:r.value.customer.phone}};await v(r.value.id,x),r.value.property_id&&(console.log("Cambio y geenero el Emit Principal"),y("update:newProperty",r.value.property_id)),y("update:isDialogVisible",!1)},V=async()=>{var x;(x=o.opportunityKanban)!=null&&x.id&&await m(o.opportunityKanban.id)},w=async()=>{await U()};return oe(()=>o.isDialogVisible,async x=>{x===!0&&(V(),await w())}),(x,d)=>{const A=ue,R=ve,s=ge,p=Me,N=De;return n(),q(pe,{"max-width":"800","model-value":o.isDialogVisible,persistent:"","close-on-esc":!1,"onUpdate:modelValue":_},{default:t(()=>[e(A,{onClick:_}),e(Y,{title:"Información del Cliente y Oportunidad",class:"pa-sm-8 pa-5"},{default:t(()=>[e(Q,null,{default:t(()=>[e(ze,{onSubmit:he(O,["prevent"])},{default:t(()=>[e(H,{dense:""},{default:t(()=>[e(g,{cols:"12",md:"6"},{default:t(()=>[e(R,{modelValue:a(r).customer.name,"onUpdate:modelValue":d[0]||(d[0]=k=>a(r).customer.name=k),label:"Nombre del Cliente",placeholder:"Ingresa el nombre",outlined:""},null,8,["modelValue"])]),_:1}),e(g,{cols:"12",md:"6"},{default:t(()=>[e(R,{modelValue:a(r).customer.email,"onUpdate:modelValue":d[1]||(d[1]=k=>a(r).customer.email=k),label:"Email del Cliente",placeholder:"Ingresa el email",outlined:""},null,8,["modelValue"])]),_:1}),e(g,{cols:"12",md:"6"},{default:t(()=>[e(H,null,{default:t(()=>[e(g,{cols:"4"},{default:t(()=>[e(s,{modelValue:a(r).customer.cod_phone,"onUpdate:modelValue":d[2]||(d[2]=k=>a(r).customer.cod_phone=k),label:"Código",items:["+591","+1","+52"],placeholder:"Cód.",outlined:""},null,8,["modelValue"])]),_:1}),e(g,{cols:"8"},{default:t(()=>[e(R,{modelValue:a(r).customer.phone,"onUpdate:modelValue":d[3]||(d[3]=k=>a(r).customer.phone=k),label:"Número de Teléfono",placeholder:"Ingresa el teléfono",outlined:"",dense:"",maxlength:"9"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(g,{cols:"12",md:"6"},{default:t(()=>[e(R,{modelValue:a(r).customer.ci,"onUpdate:modelValue":d[4]||(d[4]=k=>a(r).customer.ci=k),label:"CI del Cliente",placeholder:"Ingresa el CI",outlined:""},null,8,["modelValue"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(p,{modelValue:a(r).property_id,"onUpdate:modelValue":d[5]||(d[5]=k=>a(r).property_id=k),label:"Departamento de Interés",placeholder:"Selecciona un Departamento",items:a(S).map(k=>({title:k.title,value:k.id})),outlined:""},null,8,["modelValue","items"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(N,{modelValue:a(r).description,"onUpdate:modelValue":d[6]||(d[6]=k=>a(r).description=k),label:"Descripción de la Oportunidad",placeholder:"Ingresa una descripción",rows:"3","auto-grow":"",outlined:""},null,8,["modelValue"])]),_:1}),e(g,{cols:"12",class:"text-center"},{default:t(()=>[e(j,{type:"submit",color:"primary",class:"me-3",disabled:a(u),loading:a(u)},{default:t(()=>d[7]||(d[7]=[C(" Guardar ")])),_:1},8,["disabled","loading"]),e(j,{color:"secondary",variant:"tonal",onClick:_},{default:t(()=>d[8]||(d[8]=[C(" Cancelar ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},dt={class:"d-flex align-bottom flex-sm-row flex-column"},pt={class:"user-profile-info"},ct={class:"d-flex align-center justify-center justify-sm-space-between flex-wrap gap-4"},mt={class:"d-flex align-center gap-x-3"},yt={class:"text-4xl font-weight-medium"},ft={class:"d-flex flex-column py-2",style:{"font-size":"14px"}},vt={class:"text-sm text-disabled"},gt={key:0,class:"d-flex flex-wrap gap-2 my-5"},_t={key:1},bt={key:0,class:"d-flex flex-wrap gap-2 my-5"},Vt={key:1},wt={__name:"EditPreSaleOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","update:newProperty"],setup(h,{emit:z}){const o=h,y=z,{checkProcessForOpportunity:U}=ce(),{changeStatusQuotes:S}=Le(),m=b(!1),r=b(!1),v=()=>{m.value=!0},u=()=>{console.log("Se escucho el evento en EditProspectOpportunity"),y("update:newProperty")},_=()=>{r.value=!0},O=async x=>{y("updateStageId",x)},V=async(x,d)=>{console.log(`Procedimiento ${x} marcado como: ${d?"realizado":"no realizado"}`),await U(o.opportunity.id,x,{is_check:!d}),y("updateStageId",o.opportunity.id)},w=async(x,d)=>{const A=d==="APPROVED"?"NOT_APPROVED":"APPROVED";console.log(`Procedimiento ${x} marcado como: ${d}`),await S(x,{status:A}),y("updateStageId",o.opportunity.id)};return(x,d)=>{const A=ie("RouterLink"),R=ie("IconBtn");return n(),f(T,null,[l("div",dt,[l("div",pt,[d[3]||(d[3]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Perfil ",-1)),l("div",ct,[l("div",mt,[l("span",yt,D(("avatarText"in x?x.avatarText:a(Ae))(o.opportunity.customer.name)),1),l("div",ft,[e(A,{to:{name:"apps-ecommerce-customer-details-id",params:{id:1}},class:"font-weight-base"},{default:t(()=>[C(D(o.opportunity.customer.name),1)]),_:1}),l("span",vt,D(o.opportunity.customer.phone),1)]),e(j,{color:"secondary",variant:"tonal",size:"small",onClick:v},{default:t(()=>d[2]||(d[2]=[C(" Editar Perfil ")])),_:1})])])])]),l("div",null,[d[5]||(d[5]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(n(),f("div",gt,[(n(!0),f(T,null,M(o.opportunity.procedure,s=>(n(),f("div",{key:s.id},[e(Z,{color:s.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:p=>V(s.id,s.pivot.is_check)},{default:t(()=>[s.pivot.is_check?(n(),q(W,{key:0,icon:"tabler-check",class:"mr-2"})):L("",!0),C(" "+D(s.title),1)]),_:2},1032,["color","onClick"])]))),128))])):(n(),f("div",_t,d[4]||(d[4]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),l("div",null,[d[9]||(d[9]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Cotizaciones ",-1)),o.opportunity.quotes&&o.opportunity.quotes.length>0?(n(),f("div",bt,[e(ne,{density:"compact",class:"text-no-wrap",style:{"font-size":"12px"}},{default:t(()=>[d[7]||(d[7]=l("thead",null,[l("tr",null,[l("th",null," Nombre "),l("th",null," Propiedad "),l("th",null," Fecha "),l("th")])],-1)),l("tbody",null,[(n(!0),f(T,null,M(o.opportunity.quotes,s=>(n(),f("tr",{key:s.id},[l("td",null,D(s.social_reason),1),l("td",null,D(s.properties[0].title),1),l("td",null,D(s.created_at),1),l("td",null,[e(H,null,{default:t(()=>[e(fe,{modelValue:s.status,"onUpdate:modelValue":p=>s.status=p,"true-value":"APPROVED","false-value":"NOT_APPROVED",onClick:p=>w(s.id,s.status)},{default:t(()=>[e(Oe,{activator:"parent",location:"top"},{default:t(()=>d[6]||(d[6]=[C(" Aprobar Cotizacion ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","onClick"]),e(A,{to:{name:"quote-id",params:{id:s.id}}},{default:t(()=>[e(R,null,{default:t(()=>[e(W,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])]),_:2},1024)])]))),128))])]),_:1})])):(n(),f("div",Vt,d[8]||(d[8]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(Q,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(A,{to:{name:"quote-add-quote"},class:"text-white"},{default:t(()=>[e(j,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>d[10]||(d[10]=[C(" Generar Cotización ")])),_:1})]),_:1}),e(j,{color:"primary",class:"mx-auto",size:"small",onClick:_},{default:t(()=>d[11]||(d[11]=[C(" Generar Venta ")])),_:1})]),_:1}),e(qe,{"is-dialog-visible":a(m),"onUpdate:isDialogVisible":d[0]||(d[0]=s=>B(m)?m.value=s:null),"opportunity-kanban":o.opportunity,"onUpdate:newProperty":u},null,8,["is-dialog-visible","opportunity-kanban"]),e(ke,{"is-dialog-visible":a(r),"onUpdate:isDialogVisible":d[1]||(d[1]=s=>B(r)?r.value=s:null),opportunity:o.opportunity,stage:"PRESALE",onRegisterSale:O},null,8,["is-dialog-visible","opportunity"])],64)}}},xt={class:"d-flex align-bottom flex-sm-row flex-column"},kt={class:"user-profile-info"},Pt={class:"d-flex align-center justify-center justify-sm-space-between flex-wrap gap-4"},Dt={class:"d-flex align-center gap-x-3"},Ct={class:"text-4xl font-weight-medium"},$t={class:"d-flex flex-column py-2",style:{"font-size":"14px"}},ht={class:"text-sm text-disabled"},St={key:0,class:"d-flex flex-wrap gap-2 my-5"},At={key:1},zt={key:0,class:"d-flex flex-wrap gap-2 my-5"},Ot={key:1},Ut={__name:"EditProspectOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","update:newProperty"],setup(h,{emit:z}){const o=h,y=z,{checkProcessForOpportunity:U}=ce(),{changeStatusByOpportunity:S,loadingOpportunity:m}=le(),r=b(!1),v=()=>{r.value=!0},u=()=>{console.log("Se escucho el evento en EditProspectOpportunity"),y("update:newProperty")},_=async V=>{await S(V,xe.PRESALE.value,{}),y("updateStageId",V)},O=async V=>{console.log(`Procedimiento ${V.id} marcado como: ${V.pivot.is_check?"realizado":"no realizado"}`),await U(o.opportunity.id,V.id,{is_check:!V.pivot.is_check}),V.pivot.is_check=!V.pivot.is_check,y("updateStageId",o.opportunity.id)};return(V,w)=>{const x=ie("RouterLink"),d=ie("IconBtn");return n(),f(T,null,[l("div",xt,[l("div",kt,[w[3]||(w[3]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Perfil ",-1)),l("div",Pt,[l("div",Dt,[l("span",Ct,D(("avatarText"in V?V.avatarText:a(Ae))(o.opportunity.customer.name)),1),l("div",$t,[e(x,{to:{name:"apps-ecommerce-customer-details-id",params:{id:1}},class:"font-weight-base"},{default:t(()=>[C(D(o.opportunity.customer.name),1)]),_:1}),l("span",ht,D(o.opportunity.customer.phone),1)]),l("div",null,[e(j,{color:"secondary",variant:"tonal",size:"small",onClick:v},{default:t(()=>w[2]||(w[2]=[C(" Editar Perfil ")])),_:1})])])])])]),l("div",null,[w[5]||(w[5]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(n(),f("div",St,[(n(!0),f(T,null,M(o.opportunity.procedure,A=>(n(),f("div",{key:A.id},[e(Z,{color:A.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:R=>O(A)},{default:t(()=>[A.pivot.is_check?(n(),q(W,{key:0,icon:"tabler-check",class:"mr-2"})):L("",!0),C(" "+D(A.title),1)]),_:2},1032,["color","onClick"])]))),128))])):(n(),f("div",At,w[4]||(w[4]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),l("div",null,[w[8]||(w[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Cotizaciones ",-1)),o.opportunity.quotes&&o.opportunity.quotes.length>0?(n(),f("div",zt,[e(ne,{density:"compact",class:"text-no-wrap",style:{"font-size":"12px"}},{default:t(()=>[w[6]||(w[6]=l("thead",null,[l("tr",null,[l("th",null," Nombre "),l("th",null," Propiedad "),l("th",null," Fecha "),l("th")])],-1)),l("tbody",null,[(n(!0),f(T,null,M(o.opportunity.quotes,A=>(n(),f("tr",{key:A.id},[l("td",null,D(A.social_reason),1),l("td",null,D(A.properties[0].title),1),l("td",null,D(A.created_at),1),l("td",null,[e(x,{to:{name:"quote-id",params:{id:A.id}}},{default:t(()=>[e(d,null,{default:t(()=>[e(W,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])])]))),128))])]),_:1})])):(n(),f("div",Ot,w[7]||(w[7]=[l("span",null,"No hay cotizaciones disponibles.",-1)])))]),e(Q,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(x,{to:{name:"quote-add-quote"},class:"text-white"},{default:t(()=>[e(j,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>w[9]||(w[9]=[C(" Generar Cotización ")])),_:1})]),_:1}),e(j,{color:"primary",class:"mx-auto",size:"small",disabled:a(m),loading:a(m),onClick:w[0]||(w[0]=A=>_(o.opportunity.id))},{default:t(()=>w[10]||(w[10]=[C(" Siguiente Etapa ")])),_:1},8,["disabled","loading"])]),_:1}),e(qe,{"is-dialog-visible":a(r),"onUpdate:isDialogVisible":w[1]||(w[1]=A=>B(r)?r.value=A:null),"opportunity-kanban":o.opportunity,"onUpdate:newProperty":u},null,8,["is-dialog-visible","opportunity-kanban"])],64)}}},Ft=async h=>await re(`/sale/paymentPlans/${h}/confirm`,{method:"PATCH"}),qt=async(h,z)=>await re(`/sale/paymentPlans/${h}`,{method:"PATCH",body:z});function _e(){const h=b(!1),z=b([]),o=b(null),y=b(null);return{loadingPaymentPlans:h,paymentPlan:y,error:o,paymentPlans:z,confirmPaymentPlans:async m=>{try{const r=await Ft(m);Ce("Actualizacion Exitosa","Se confirmo el pago")}catch(r){console.log(r)}},updatePaymentPlans:async(m,r)=>{h.value=!0,o.value=null;try{console.log(r);const v=await qt(m,r);y.value=v.data,Te("¡Planes de pago actualizados exitosamente! ","Los planes de pago han sido modificados y guardados correctamente."),console.log(v)}catch(v){console.log(v),v.response&&v.response.status==422&&Ne("Advertencia","Faltan datos por Completar"),o.value=v.message}finally{h.value=!1}}}}const Et={__name:"DeliveryForm",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(h,{emit:z}){const o=h,y=z,{changeStatusByOpportunity:U}=le(),S=u=>{y("update:isDialogVisible",u)},m=b(structuredClone(J(o.opportunity)));oe(o,()=>{m.value=structuredClone(J(o.opportunity))});const r=async()=>{y("update:isDialogVisible",!1);try{await U(o.opportunity.id,5,{delivery_date:m.value.sales.delivery_date}),y("updateDeliveryDate",m.value.id)}catch(u){console.error("Error updating customer:",u)}},v=()=>{y("update:isDialogVisible",!1)};return(u,_)=>{const O=ue;return n(),q(pe,{"model-value":o.isDialogVisible,"max-width":"800","onUpdate:modelValue":S},{default:t(()=>[e(O,{onClick:_[0]||(_[0]=V=>u.$emit("update:isDialogVisible",!1))}),e(Y,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(de,{class:"text-h3 text-center"},{default:t(()=>_[2]||(_[2]=[C(" Confirmar Fecha ")])),_:1}),e(Q,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(H,null,{default:t(()=>[e(g,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(ae,{modelValue:a(m).sales.delivery_date,"onUpdate:modelValue":_[1]||(_[1]=V=>a(m).sales.delivery_date=V),label:"Fecha de Entrega",type:"date",rules:["requiredValidator"in u?u.requiredValidator:a(K)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),e(g,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(j,{onClick:r},{default:t(()=>_[3]||(_[3]=[C(" Pasar a Entrega ")])),_:1}),e(j,{color:"secondary",variant:"tonal",onClick:v},{default:t(()=>_[4]||(_[4]=[C(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},jt={key:0},It={__name:"PaymentPlanEdit",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},payment:{type:Object,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(h,{emit:z}){const o=h,y=z,{updatePaymentPlans:U}=_e(),S=b(!1),m=s=>{y("update:isDialogVisible",s)},r=b(structuredClone(J(o.payment))),v=b(structuredClone(J(o.opportunity))),u=b([]);oe(o,()=>{r.value=structuredClone(J(o.payment)),v.value=structuredClone(J(o.opportunity))});const _=()=>{u.value.push({amount:"",date:"",type:r.value.type})},O=s=>{u.value.splice(s,1)},V=X(()=>u.value.reduce((s,p)=>{const N=parseFloat(p.amount)||0;return s+N},0)),w=X(()=>u.value.length>0&&u.value.every(s=>s.amount&&s.date&&s.type)),x=X(()=>{if(u.value.length===0)return!0;const s=u.value.reduce((k,c)=>k+(parseFloat(c.amount)||0),0),p=parseFloat(s),N=parseFloat(r.value.amount);return p===N}),d=X(()=>u.value.length===0?!0:w.value&&x.value),A=async()=>{if(!x.value){$e("Validación fallida","La suma de las diferencias no es correcta");return}if(!d.value){alert("Por favor, completa todos los campos obligatorios.");return}S.value=!0;try{await U(r.value.id,{date:r.value.date,differData:u.value})}catch(s){console.error("Error updating customer:",s)}finally{y("updateDeliveryDate",v.value.id),y("update:isDialogVisible",!1),u.value=[],S.value=!1}},R=()=>{y("update:isDialogVisible",!1),u.value=[],errorMessage.value=""};return(s,p)=>{const N=ue;return n(),q(pe,{"model-value":o.isDialogVisible,"max-width":"800","onUpdate:modelValue":m},{default:t(()=>[e(N,{onClick:p[0]||(p[0]=k=>s.$emit("update:isDialogVisible",!1))}),e(Y,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(de,{class:"text-h3 text-center"},{default:t(()=>p[2]||(p[2]=[C(" Editar Pago ")])),_:1}),e(Q,null,{default:t(()=>[e(H,{class:"mx-5"},{default:t(()=>[e(g,{cols:"6"},{default:t(()=>[l("h3",null," Monto a Pagar : $ "+D(a(r).amount),1)]),_:1}),e(g,{cols:"6"},{default:t(()=>[e(ae,{modelValue:a(r).date,"onUpdate:modelValue":p[1]||(p[1]=k=>a(r).date=k),label:"Cambiar Fecha",type:"date",rules:["requiredValidator"in s?s.requiredValidator:a(K)]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(Y,{flat:"",class:"d-flex flex-column pa-5 px-5"},{default:t(()=>[(n(!0),f(T,null,M(a(u),(k,c)=>(n(),f("div",{key:k.id,class:"d-flex align-center my-4"},[e(ae,{modelValue:k.amount,"onUpdate:modelValue":i=>k.amount=i,label:"Monto *",type:"number",class:"mr-4",outlined:"",rules:["requiredValidator"in s?s.requiredValidator:a(K)]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(ae,{modelValue:k.date,"onUpdate:modelValue":i=>k.date=i,label:"Fecha de Pago *",type:"date",class:"mr-3",outlined:"",rules:["requiredValidator"in s?s.requiredValidator:a(K)]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(j,{color:"error",onClick:i=>O(c)},{default:t(()=>[e(W,{icon:"tabler-square-x"})]),_:2},1032,["onClick"])]))),128)),a(u).length>0?(n(),f("div",jt,[p[3]||(p[3]=l("strong",null,"Monto Restante:",-1)),C(" $"+D((a(r).amount-a(V)).toFixed(2)),1)])):L("",!0),e(j,{color:"primary",variant:"tonal",class:"mt-4",size:"small",onClick:_},{default:t(()=>p[4]||(p[4]=[C(" Diferir Pago ")])),_:1})]),_:1}),e(g,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(j,{loading:a(S),disabled:!a(d)||a(S),onClick:A},{default:t(()=>p[5]||(p[5]=[C(" Guardar ")])),_:1},8,["loading","disabled"]),e(j,{color:"error",variant:"tonal",onClick:R},{default:t(()=>p[6]||(p[6]=[C(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Tt={__name:"SalePaymentPlan",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},salesPayment:{type:Array,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(h,{emit:z}){const o=h,y=z;_e();const U=v=>{y("update:isDialogVisible",v)},S=b(structuredClone(J(o.opportunity)));oe(o,()=>{S.value=structuredClone(J(o.opportunity)),console.log("Sales Payment:",o.salesPayment)});const m=b([]),r=()=>{y("update:isDialogVisible",!1),m.value=[]};return(v,u)=>{const _=ue;return n(),q(pe,{"model-value":o.isDialogVisible,"max-width":"800","onUpdate:modelValue":U},{default:t(()=>[e(_,{onClick:u[0]||(u[0]=O=>v.$emit("update:isDialogVisible",!1))}),e(Y,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(de,{class:"text-h3 text-center"},{default:t(()=>u[1]||(u[1]=[C(" Confirmar Fecha ")])),_:1}),e(Q,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(H,null,{default:t(()=>[e(g,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l("span",null," Monto a Pagar : "+D(a(S)),1)]),_:1})]),_:1})]),_:1}),e(g,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(j,{onClick:v.onFormSubmit},{default:t(()=>u[2]||(u[2]=[C(" Guardar ")])),_:1},8,["onClick"]),e(j,{color:"error",variant:"tonal",onClick:r},{default:t(()=>u[3]||(u[3]=[C(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Nt={class:"text-h6"},Rt={class:"text-h6"},Bt={class:"text-h6"},Lt={class:"my-5"},Mt={key:0},Ht=["src"],Gt={class:"mb-4"},Kt=["onClick"],Qt=["onClick"],Wt={class:"my-5"},Jt={key:0,class:"d-flex flex-wrap gap-2 my-5"},Yt={key:1},Xt={__name:"EditSaleOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId"],setup(h,{emit:z}){const o=h,y=z,{checkProcessForOpportunity:U}=ce(),{confirmPaymentPlans:S}=_e(),{changeStatusByOpportunity:m,loadingOpportunity:r}=le(),v=b(!1),u=b(!1),_=b(!1),O=b(""),V=X(()=>o.opportunity.sales.reduce((c,i)=>c+i.amount,0)),w=X(()=>o.opportunity.sales.reduce((c,i)=>c+i.initial_fee,0)),x=X(()=>V.value-w.value),d=()=>{_.value=!0},A=c=>{if(c.is_paid===1){$e("Advertencia","No se puede editar un pago ya realizado.");return}console.log("entro aqui"),u.value=!0,O.value={...c}},R=async c=>{y("updateStageId",c)},s=async c=>{console.log(`Procedimiento ${c.id} marcado como: ${c.pivot.is_check?"realizado":"no realizado"}`),await U(o.opportunity.id,c.id,{is_check:!c.pivot.is_check}),c.pivot.is_check=!c.pivot.is_check,y("updateStageId",o.opportunity.id)},p=async c=>{console.log(c),await S(c),y("updateStageId",o.opportunity.id)},N=async c=>{await m(c,5,{}),y("updateStageId",c)},k=async c=>{y("updateStageId",c)};return(c,i)=>(n(),f(T,null,[l("div",null,[e(Y,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(H,null,{default:t(()=>[e(g,{cols:"4",class:"border rounded-sm mx-1"},{default:t(()=>[e(ee,{class:"font-weight-medium"},{default:t(()=>i[5]||(i[5]=[C(" Saldo ")])),_:1}),e(te,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Nt,D(("formatCurrency"in c?c.formatCurrency:a(ye))(a(x))),1)]),_:1})]),_:1}),e(g,{cols:"3",class:"border rounded-sm mx-1"},{default:t(()=>[e(ee,{class:"font-weight-medium"},{default:t(()=>i[6]||(i[6]=[C(" Anticipo ")])),_:1}),e(te,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Rt,D(("formatCurrency"in c?c.formatCurrency:a(ye))(a(w))),1)]),_:1})]),_:1}),e(g,{cols:"4",class:"border rounded-sm mx-1"},{default:t(()=>[e(ee,{class:"font-weight-medium"},{default:t(()=>i[7]||(i[7]=[C(" Precio Final ")])),_:1}),e(te,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Bt,D(("formatCurrency"in c?c.formatCurrency:a(ye))(a(V))),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),l("div",Lt,[i[8]||(i[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Propiedades ",-1)),o.opportunity.sales.length>0?(n(),f("div",Mt,[(n(!0),f(T,null,M(o.opportunity.sales,P=>(n(),f("div",{key:P.id},[(n(!0),f(T,null,M(P.properties,F=>(n(),f("div",{key:F.id,class:"d-flex align-center justify-between"},[e(Se,{size:"50",rounded:""},{default:t(()=>[l("img",{src:a(we),alt:"Logo pora",style:{"border-radius":"30%"}},null,8,Ht)]),_:1}),e(g,{cols:"12",md:"7"},{default:t(()=>[e(ee,{class:"font-weight-medium"},{default:t(()=>[C(D(F.project_title)+" | "+D(F.title),1)]),_:2},1024),e(te,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",null,"$ "+D(F.pivot_price),1)]),_:2},1024)]),_:2},1024)]))),128))]))),128))])):L("",!0)]),l("div",Gt,[i[10]||(i[10]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Anticipo ",-1)),o.opportunity.initial_payments&&o.opportunity.initial_payments.length>0?(n(),q(ne,{key:0,density:"compact",class:"text-no-wrap my-2",style:{"font-size":"12px"}},{default:t(()=>[i[9]||(i[9]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th",null," Action ")])],-1)),l("tbody",null,[(n(!0),f(T,null,M(o.opportunity.initial_payments,P=>(n(),f("tr",{key:P.id},[l("td",null,D(P.property_title),1),l("td",null,D(P.date),1),l("td",null,D(P.amount),1),l("td",null,[e(H,null,{default:t(()=>[e(fe,{modelValue:P.is_paid,"onUpdate:modelValue":F=>P.is_paid=F,"true-value":1,"false-value":0,disabled:P.is_paid===1,onChange:F=>p(P.id)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"]),P.is_paid===0?(n(),f("div",{key:0,"fill-dot":"",onClick:F=>A(P)},[e(W,{size:"25",icon:"tabler-edit"})],8,Kt)):L("",!0)]),_:2},1024)])]))),128))])]),_:1})):L("",!0)]),l("div",null,[i[13]||(i[13]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Saldos ",-1)),o.opportunity.balance_payments&&o.opportunity.balance_payments.length>0?(n(),q(ne,{key:0,density:"compact",class:"text-no-wrap my-2",style:{"font-size":"12px"}},{default:t(()=>[i[12]||(i[12]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th",null," Action ")])],-1)),l("tbody",null,[(n(!0),f(T,null,M(o.opportunity.balance_payments,P=>(n(),f("tr",{key:P.id},[l("td",null,D(P.property_title),1),l("td",null,D(P.date),1),l("td",null,D(P.amount),1),l("td",null,[e(H,null,{default:t(()=>[e(fe,{modelValue:P.is_paid,"onUpdate:modelValue":F=>P.is_paid=F,"true-value":1,"false-value":0,disabled:P.is_paid===1,onChange:F=>p(P.id)},{default:t(()=>[e(Oe,{activator:"parent",location:"top"},{default:t(()=>i[11]||(i[11]=[C(" Confirmar Pago ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"]),P.is_paid===0?(n(),f("div",{key:0,"fill-dot":"",onClick:F=>A(P)},[e(W,{size:"25",icon:"tabler-edit"})],8,Qt)):L("",!0)]),_:2},1024)])]))),128))])]),_:1})):L("",!0)]),l("div",Wt,[i[15]||(i[15]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(n(),f("div",Jt,[(n(!0),f(T,null,M(o.opportunity.procedure,P=>(n(),f("div",{key:P.id},[e(Z,{color:P.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:F=>s(P)},{default:t(()=>[P.pivot.is_check?(n(),q(W,{key:0,icon:"tabler-check",class:"mr-2"})):L("",!0),C(" "+D(P.title),1)]),_:2},1032,["color","onClick"])]))),128))])):(n(),f("div",Yt,i[14]||(i[14]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(Q,{class:"d-flex mt-4"},{default:t(()=>[e(j,{color:"primary",variant:"tonal",class:"mx-auto",size:"small",onClick:d},{default:t(()=>i[16]||(i[16]=[C(" Generar Venta ")])),_:1}),e(j,{color:"primary",class:"mx-auto",size:"small",onClick:i[0]||(i[0]=P=>N(o.opportunity.id))},{default:t(()=>i[17]||(i[17]=[C(" Siguiente Etapa ")])),_:1})]),_:1}),e(Et,{"is-dialog-visible":a(v),"onUpdate:isDialogVisible":i[1]||(i[1]=P=>B(v)?v.value=P:null),opportunity:o.opportunity,onUpdateDeliveryDate:k},null,8,["is-dialog-visible","opportunity"]),e(It,{"is-dialog-visible":a(u),"onUpdate:isDialogVisible":i[2]||(i[2]=P=>B(u)?u.value=P:null),payment:a(O),opportunity:o.opportunity,onUpdateDeliveryDate:k},null,8,["is-dialog-visible","payment","opportunity"]),e(ke,{"is-dialog-visible":a(_),"onUpdate:isDialogVisible":i[3]||(i[3]=P=>B(_)?_.value=P:null),opportunity:o.opportunity,stage:"SALE",onRegisterSale:R},null,8,["is-dialog-visible","opportunity"]),e(Tt,{"is-dialog-visible":c.openSaleEditPaymentPlan,"onUpdate:isDialogVisible":i[4]||(i[4]=P=>c.openSaleEditPaymentPlan=P),opportunity:o.opportunity,"sales-payment":c.salePaymentPlan,onUpdateDeliveryDate:k},null,8,["is-dialog-visible","opportunity","sales-payment"])],64))}};const Zt={__name:"SellerReport",setup(h){return b([{title:"Actividad 1",date:"2024-10-09",status:"Pendiente"},{title:"Actividad 2",date:"2024-10-10",status:"Completada"},{title:"Actividad 3",date:"2024-10-11",status:"En Progreso"}]),(z,o)=>(n(),q(Q,null,{default:t(()=>o[0]||(o[0]=[l("p",null,"No hay actividades seleccionadas. Aquí tienes un resumen de las actividades:",-1)])),_:1}))}},el=Ue(Zt,[["__scopeId","data-v-c9cbe3f1"]]),tl={__name:"CustomerHistory",props:{isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","userData"],setup(h,{emit:z}){const o=h,y=z,U=b(!1),S=b(),m=b(""),r=b(""),v=b(""),u=b(""),_=b(),O=b(""),V=b(),w=b(),x=b(),d=()=>{y("update:isDrawerOpen",!1),be(()=>{var s,p;(s=S.value)==null||s.reset(),(p=S.value)==null||p.resetValidation()})},A=()=>{var s;(s=S.value)==null||s.validate().then(({valid:p})=>{p&&(y("userData",{id:0,fullName:m.value,company:u.value,role:V.value,country:_.value,contact:O.value,email:v.value,currentPlan:w.value,status:x.value,avatar:"",billing:"Auto Debit"}),y("update:isDrawerOpen",!1),be(()=>{var N,k;(N=S.value)==null||N.reset(),(k=S.value)==null||k.resetValidation()}))})},R=s=>{y("update:isDrawerOpen",s)};return(s,p)=>{const N=Ge,k=ve,c=ge;return n(),q(Qe,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":o.isDrawerOpen,"onUpdate:modelValue":R},{default:t(()=>[e(N,{title:"Historial del Cliente",onCancel:d}),e(a(Ke),{options:{wheelPropagation:!1}},{default:t(()=>[e(Y,{flat:""},{default:t(()=>[e(Q,null,{default:t(()=>[e(ze,{ref_key:"refForm",ref:S,modelValue:a(U),"onUpdate:modelValue":p[9]||(p[9]=i=>B(U)?U.value=i:null),onSubmit:he(A,["prevent"])},{default:t(()=>[e(H,null,{default:t(()=>[e(g,{cols:"12"},{default:t(()=>[e(k,{modelValue:a(m),"onUpdate:modelValue":p[0]||(p[0]=i=>B(m)?m.value=i:null),rules:["requiredValidator"in s?s.requiredValidator:a(K)],label:"Full Name",placeholder:"John Doe"},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(k,{modelValue:a(r),"onUpdate:modelValue":p[1]||(p[1]=i=>B(r)?r.value=i:null),rules:["requiredValidator"in s?s.requiredValidator:a(K)],label:"Username",placeholder:"Johndoe"},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(k,{modelValue:a(v),"onUpdate:modelValue":p[2]||(p[2]=i=>B(v)?v.value=i:null),rules:["requiredValidator"in s?s.requiredValidator:a(K),"emailValidator"in s?s.emailValidator:a(je)],label:"Email",placeholder:"johndoe@email.com"},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(k,{modelValue:a(u),"onUpdate:modelValue":p[3]||(p[3]=i=>B(u)?u.value=i:null),rules:["requiredValidator"in s?s.requiredValidator:a(K)],label:"Company",placeholder:"PixInvent"},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(c,{modelValue:a(_),"onUpdate:modelValue":p[4]||(p[4]=i=>B(_)?_.value=i:null),label:"Select Country",placeholder:"Select Country",rules:["requiredValidator"in s?s.requiredValidator:a(K)],items:["USA","UK","India","Australia"]},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(k,{modelValue:a(O),"onUpdate:modelValue":p[5]||(p[5]=i=>B(O)?O.value=i:null),type:"number",rules:["requiredValidator"in s?s.requiredValidator:a(K)],label:"Contact",placeholder:"+1-541-754-3010"},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(c,{modelValue:a(V),"onUpdate:modelValue":p[6]||(p[6]=i=>B(V)?V.value=i:null),label:"Select Role",placeholder:"Select Role",rules:["requiredValidator"in s?s.requiredValidator:a(K)],items:["Admin","Author","Editor","Maintainer","Subscriber"]},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(c,{modelValue:a(w),"onUpdate:modelValue":p[7]||(p[7]=i=>B(w)?w.value=i:null),label:"Select Plan",placeholder:"Select Plan",rules:["requiredValidator"in s?s.requiredValidator:a(K)],items:["Basic","Company","Enterprise","Team"]},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(c,{modelValue:a(x),"onUpdate:modelValue":p[8]||(p[8]=i=>B(x)?x.value=i:null),label:"Select Status",placeholder:"Select Status",rules:["requiredValidator"in s?s.requiredValidator:a(K)],items:[{title:"Active",value:"active"},{title:"Inactive",value:"inactive"},{title:"Pending",value:"pending"}]},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(j,{type:"submit",class:"me-3"},{default:t(()=>p[10]||(p[10]=[C(" Submit ")])),_:1}),e(j,{type:"reset",variant:"outlined",color:"secondary",onClick:d},{default:t(()=>p[11]||(p[11]=[C(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},ll={class:"mb-2"},ol={__name:"AddActivity",props:{activitiesData:{type:Object,required:!0,default:()=>({title:"",description:"",schedule_at:""})},isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","refreshActivities"],setup(h,{emit:z}){const o=h,y=z,U=b(!1);b(!1);const S=b("radio-1"),m=b({title:"",description:"",type_activity_id:null,opportunity_id:null,assigned_to:null,scheduled_at:null,status:"COMPLETED"}),{completedActivityAndRegister:r,getallTypeActivities:v,typeActivities:u,loadingActivity:_}=Pe(),{getOpportunitybyId:O,opportunity:V}=le(),w=b(structuredClone(J(o.activitiesData))),x=c=>{console.log("esta consultando de nuevo despues de cambiar etapa "),O(c)};oe(o,()=>{w.value=structuredClone(J(o.activitiesData)),O(w.value.opportunity_id),d()});const d=async()=>{await v()},A=()=>{O(w.value.opportunity_id)},R=()=>{y("update:isDrawerOpen",!1),m.value={title:null,description:null,type_activity_id:null,scheduled_at:null,opportunity_id:null,assigned_to:null,status:"COMPLETED"},y("refreshActivities")},s=async()=>{let c="";S.value==="radio-1"?c="COMPLETED":S.value==="radio-2"&&(c="CANCELLED"),r(w.value.id,{title:m.value.title,description:m.value.description,type_activity_id:m.value.type_activity_id,scheduled_at:m.value.scheduled_at,assigned_to:V.value.user_id,property_id:V.value.property_id,opportunity_id:V.value.id,status:c}),R()},p=async()=>{y("update:isDrawerOpen",!1),y("refreshActivities")},N=()=>{console.log("Se escucho el evento en AddActivity"),y("refreshActivities")},k=c=>{const i=new Date(c),P=i.getDate(),$=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][i.getMonth()],E=i.getHours().toString().padStart(2,"0"),I=i.getMinutes().toString().padStart(2,"0");return`${P} de ${$}, ${E}:${I}`};return(c,i)=>{const P=ve,F=Ie,$=De;return n(),q(H,{class:"d-flex justify-space-between"},{default:t(()=>[e(g,{cols:"12"},{default:t(()=>[h.isDrawerOpen?(n(),q(Y,{key:0},{default:t(()=>[e(Q,null,{default:t(()=>[e(Fe,{class:"mx-2 my-2"},{default:t(()=>[e(H,null,{default:t(()=>[e(g,{cols:"12",sm:"5"},{default:t(()=>[e(H,null,{default:t(()=>[e(g,{cols:"12"},{default:t(()=>i[6]||(i[6]=[l("span",{style:{"font-size":"18px","font-weight":"500"}}," Actividad ",-1)])),_:1}),e(g,{cols:"12"},{default:t(()=>[l("div",ll,[l("span",null,D(o.activitiesData.title)+" • "+D(k(o.activitiesData.scheduled_at)),1)]),e(Je,{modelValue:a(S),"onUpdate:modelValue":i[0]||(i[0]=E=>B(S)?S.value=E:null),style:{"font-size":"14px"},inline:""},{default:t(()=>[i[7]||(i[7]=l("span",{class:"my-1"}," ¿ Se Realizo ? ",-1)),e(Ve,{label:"Si",value:"radio-1",density:"compact",class:"mx-2"}),e(Ve,{label:"No",value:"radio-2",class:"mx-2",density:"compact"})]),_:1},8,["modelValue"]),e(Ye,{class:"mt-2"})]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(P,{modelValue:a(m).title,"onUpdate:modelValue":i[1]||(i[1]=E=>a(m).title=E),label:"Titulo de la actividad",placeholder:"..."},null,8,["modelValue"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(ge,{modelValue:a(m).type_activity_id,"onUpdate:modelValue":i[2]||(i[2]=E=>a(m).type_activity_id=E),label:"Tipo de Actividad",placeholder:"Selecciona el Tipo de Actividad",items:a(u).map(E=>({title:E.name,value:E.id}))},null,8,["modelValue","items"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(F,{modelValue:a(m).scheduled_at,"onUpdate:modelValue":i[3]||(i[3]=E=>a(m).scheduled_at=E),label:"Seleccione la Fecha y Hora",placeholder:"Select date and time",config:{enableTime:!0,dateFormat:"Y-m-d H:i"},rules:["requiredValidator"in c?c.requiredValidator:a(K)]},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e($,{modelValue:a(m).description,"onUpdate:modelValue":i[4]||(i[4]=E=>a(m).description=E),label:"Descripcion",rows:"3",rules:["requiredValidator"in c?c.requiredValidator:a(K)]},null,8,["modelValue","rules"])]),_:1}),e(g,null,{default:t(()=>[e(j,{color:"primary",class:"mx-auto",size:"small",loading:a(_),disabled:a(_),onClick:s},{default:t(()=>i[8]||(i[8]=[C(" Crear Actividad ")])),_:1},8,["loading","disabled"]),e(j,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>i[9]||(i[9]=[C(" Dar de Baja ")])),_:1})]),_:1})]),_:1})]),_:1}),e(g,{cols:"12",sm:"7",style:{"align-items":"center"}},{default:t(()=>[e(H,{class:"mb-2"},{default:t(()=>[e(g,{cols:"6"},{default:t(()=>i[10]||(i[10]=[l("span",{style:{"font-size":"18px","font-weight":"500"}}," Etapa ",-1)])),_:1}),e(g,{cols:"12",md:"6",class:"d-flex justify-end align-center"},{default:t(()=>[e(Z,{label:"",color:"primary"},{default:t(()=>[C(D(a(V).stage.title),1)]),_:1})]),_:1})]),_:1}),a(V).stage_id===2?(n(),q(Ut,{key:0,opportunity:a(V),onUpdateStageId:x,"onUpdate:newProperty":N},null,8,["opportunity"])):L("",!0),a(V).stage_id===3?(n(),q(wt,{key:1,opportunity:a(V),onUpdateStageId:x,"onUpdate:newProperty":N},null,8,["opportunity"])):L("",!0),a(V).stage_id===4?(n(),q(Xt,{key:2,opportunity:a(V),onRefreshActivities:A,onUpdateStageId:x},null,8,["opportunity"])):L("",!0),a(V).stage_id===5?(n(),q(ut,{key:3,opportunity:a(V),onRefreshActivities:A,onUpdateStageId:x,onComplet:p},null,8,["opportunity"])):L("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):(n(),q(Y,{key:1,title:"Reporte de Actividades"},{default:t(()=>[e(el)]),_:1}))]),_:1}),e(g,{cols:"12",md:"6"},{default:t(()=>[e(tl,{"is-drawer-open":a(U),"onUpdate:isDrawerOpen":i[5]||(i[5]=E=>B(U)?U.value=E:null)},null,8,["is-drawer-open"])]),_:1})]),_:1})}}};const al={class:"title-search-container"},il={style:{"font-size":"14px"}},sl={key:0,class:"no-activities-message d-flex flex-column justify-center align-center",style:{"min-block-size":"200px","text-align":"center"}},nl=["onClick"],rl={class:"mx-2"},ul={class:"d-flex justify-content-between",style:{"font-size":"0.9em"}},dl={__name:"list",setup(h){const z=b(""),o=b("Anteriores");b(["Todos","PORA"]),b("Todos");const{getallActivitiesByAsesorFecha:y,getallActivitiesByFechaPast:U,getallActivitiesByFechaFuture:S,activities:m,activitiesPast:r,activitiesFuture:v}=Pe(),u=b(""),_=Re("userData").value,O=b(!0),V=b([]),w=b([]),x=b([]),d=async()=>{await y(_.id),V.value=m.value},A=async()=>{await U(_.id),w.value=r.value},R=async()=>{await S(_.id),x.value=v.value};Be(async()=>{await d(),await A(),await R(),O.value=!1});const s=b(!1),p=F=>{s.value=!0,u.value={...F}},N=async()=>{O.value=!0,await d(),await A(),await R(),O.value=!1},k=X(()=>[{tabName:"Anteriores",icon:"tabler-calendar",actividades:w,badge:w.value.length},{tabName:"Hoy",icon:"tabler-edit",actividades:V,badge:V.value.length},{tabName:"Futuros",icon:"tabler-calendar",actividades:x,badge:x.value.length}]),c=[{type:"Visita",icon:"tabler-current-location"},{type:"Llamada",icon:"tabler-phone"},{type:"Cotizacion",icon:"tabler-cash"},{type:"Otro",icon:"tabler-table"}],i=F=>{const $=c.find(E=>E.type===F);return $?$.icon:"tabler-default"},P=F=>{const $=new Date(F),E=$.getDate(),G=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][$.getMonth()],se=$.getHours().toString().padStart(2,"0"),Ee=$.getMinutes().toString().padStart(2,"0");return`${E} de ${G}, ${se}:${Ee}`};return oe(z,F=>{const $=E=>E.filter(I=>{const G=I.name_opportunity.toLowerCase().includes(F.toLowerCase()),se=I.phone_opportunity.toLowerCase().includes(F.toLowerCase());return G||se});F.length>2?(V.value=$(m.value),w.value=$(r.value),x.value=$(v.value)):(V.value=m.value,w.value=r.value,x.value=v.value)}),(F,$)=>{const E=ie("VCircularProgress");return n(),q(H,{class:"match-height",style:{display:"flex","block-size":"100vh"}},{default:t(()=>[e(g,{cols:"12",md:"4",style:{display:"flex","flex-direction":"column"}},{default:t(()=>[e(Y,{class:"flex-grow-1"},{default:t(()=>[e(de,{class:"d-flex justify-between align-center flex-wrap"},{default:t(()=>[l("div",al,[$[5]||($[5]=l("h4",{class:"title-responsive"}," Mis Actividades ",-1)),e(ae,{modelValue:z.value,"onUpdate:modelValue":$[0]||($[0]=I=>z.value=I),placeholder:"Buscar actividad...",class:"search-field","hide-details":"",dense:"","solo-inverted":"","prepend-inner-icon":"tabler-search"},null,8,["modelValue"])])]),_:1}),e(Xe,{modelValue:o.value,"onUpdate:modelValue":$[1]||($[1]=I=>o.value=I),grow:""},{default:t(()=>[(n(!0),f(T,null,M(k.value,I=>(n(),q(Ze,{key:I.tabName},{default:t(()=>[l("span",il,D(I.tabName),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),$[11]||($[11]=l("br",null,null,-1)),e(Q,{style:{"flex-grow":"1","overflow-y":"auto"}},{default:t(()=>[O.value?(n(),q(et,{key:0,absolute:"",opacity:"0.7"},{default:t(()=>[e(E,{indeterminate:"",size:"70"})]),_:1})):L("",!0),e(Fe,{modelValue:o.value,"onUpdate:modelValue":$[2]||($[2]=I=>o.value=I),class:"disable-tab-transition",style:{"max-block-size":"500px","overflow-y":"auto"}},{default:t(()=>[(n(!0),f(T,null,M(k.value,I=>(n(),q(We,{key:I.tabName,value:I.tabName},{default:t(()=>[I.actividades.value.length===0?(n(),f("div",sl,[e(W,{size:"64",color:"grey",icon:"tabler-calendar-off",class:"mb-4",style:{animation:"bounce 1s infinite"}}),$[6]||($[6]=l("div",{style:{color:"#888","font-size":"1.2em"}}," ¡No tienes actividades pendientes! ",-1)),$[7]||($[7]=l("div",{style:{color:"#aaa","font-size":"0.9em","margin-block-start":"8px"}}," ¡Relájate y disfruta tu día! ",-1))])):(n(!0),f(T,{key:1},M(I.actividades.value,G=>(n(),f("div",{key:G.id,"fill-dot":"",class:"border mb-2 rounded-sm py-2",onClick:se=>p(G)},[e(me,null,{default:t(()=>[e(H,null,{default:t(()=>[e(g,{cols:"12",md:"2",style:{"padding-inline-end":"0"}},{default:t(()=>[e(Z,{class:"d-flex justify-center align-center",style:{display:"inline-flex","border-radius":"4px","block-size":"36px","inline-size":"36px"}},{default:t(()=>[e(W,{size:"25",icon:"tabler-home"})]),_:1})]),_:1}),G.project_name?(n(),q(g,{key:0,cols:"12",md:"5",class:"d-flex flex-column align-start",style:{"padding-inline-start":"0"}},{default:t(()=>[e(te,{class:"text-left"},{default:t(()=>[l("strong",null,D(G.property_title),1)]),_:2},1024),e(ee,{class:"font-weight-medium text-left"},{default:t(()=>[l("span",null,"$ "+D(G.price),1)]),_:2},1024)]),_:2},1024)):L("",!0),G.project_name?L("",!0):(n(),q(g,{key:1,cols:"12",md:"5"},{default:t(()=>[e(te,{class:"text-left"},{default:t(()=>$[8]||($[8]=[l("strong",null," Departamento ",-1)])),_:1}),e(ee,{class:"font-weight-medium text-left"},{default:t(()=>$[9]||($[9]=[l("span",null,"Indefinido",-1)])),_:1})]),_:1})),e(g,{cols:"12",md:"5",class:"d-flex justify-end align-center"},{default:t(()=>[e(Z,{label:"",color:"primary",class:"ml-auto",style:{"font-size":"10px"}},{default:t(()=>[C(D(G.stage),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(me,{class:""},{default:t(()=>[e(Z,{label:"",color:"secondary",class:"w-100 h-48"},{default:t(()=>[e(W,{size:"20",icon:i(G.type_activity)},null,8,["icon"]),l("div",rl,D(G.type_activity)+"   •   "+D(G.name_opportunity),1)]),_:2},1024)]),_:2},1024),e(me,null,{default:t(()=>[l("div",ul,[$[10]||($[10]=l("div",{style:{"flex-grow":"1"}}," Ver ",-1)),l("div",null,D(P(G.scheduled_at)),1)])]),_:2},1024)],8,nl))),128))]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(g,{cols:"12",md:"8",style:{display:"flex","flex-direction":"column"}},{default:t(()=>[e(ol,{"is-drawer-open":s.value,"onUpdate:isDrawerOpen":$[3]||($[3]=I=>s.value=I),"activities-data":u.value,class:"flex-grow-1",onRefreshActivities:N,onLoaded:$[4]||($[4]=I=>O.value=!1)},null,8,["is-drawer-open","activities-data"])]),_:1})]),_:1})}}},bo=Ue(dl,[["__scopeId","data-v-7cbc9b68"]]);export{bo as default};
