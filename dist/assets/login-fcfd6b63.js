import{r as L,e as B}from"./validators-dea6e3a5.js";import{r as d,k as D,ac as w,ab as N,o as $,f as z,e as u,b as l,d as g,n as s,J as E,I as S,v as _,x as F,a3 as M,a0 as q,a4 as J}from"./index-e5c0b4ed.js";import{_ as G}from"./AppTextField-6bc62c92.js";import{$ as k}from"./api-29616858.js";import{a as V}from"./notifications-73ea9381.js";import{u as I}from"./useGenerateImageVariant-ed8dac8a.js";import{a as W,b as H,c as K,d as Q}from"./auth-v2-login-illustration-light-19d5c0bb.js";import{a as X,b as Y}from"./misc-mask-light-1aeffaee.js";import{V as Z}from"./VNodeRenderer-bc9ed2b1.js";import{V as ee}from"./VImg-a2965643.js";import{a as b,V as C}from"./VRow-526174fd.js";import{V as ae}from"./VCard-2e8ba0d4.js";import{V as O}from"./VCardText-80aa9c0d.js";import{V as se}from"./VForm-bff4dccd.js";import{V as te}from"./VCheckbox-c321d3e2.js";import"./helpers-61e4df1a.js";import"./form-67a63666.js";import"./VTextField-d5633d45.js";/* empty css                   */import"./VCounter-8409c803.js";import"./VField-c16e9788.js";import"./easing-9f15041e.js";import"./VInput-c8ba46bc.js";import"./forwardRefs-8348545e.js";import"./index-9c720871.js";import"./constants-8e30317b.js";import"./VAvatar-eac6ee04.js";import"./VCheckboxBtn-20697c4b.js";import"./VSelectionControl-b44f121b.js";const oe="/assets/postPora-d216cd12.png",re=async n=>await k("/authen/login",{method:"POST",body:n}),le=async n=>k("/authen/forgot-password",{method:"POST",body:n}),ne=async n=>k("/authen/reset-password",{method:"PUT",body:n}),ie=async(n,c)=>k(`/authen/verify-token/${n}/${c}`,{method:"GET"});function ue(){const n=d(null),c=d(!1),t=d(!1),r=d(null),m=D(),v=w("accessToken");let p=N();return{user:n,isAuthenticated:c,loading:t,error:r,loginUser:async e=>{t.value=!0;try{const a=await re(e);if(console.log("Login successful:",a),a.status==403){V("",a._data.message);return}if(a.status==401){V("",a._data.message);return}const o=Object.fromEntries(Object.entries(a.data));let h=[{action:"manage",subject:"all"}];if(a.data.roles.forEach(j=>{h.push({action:"manage",subject:j})}),w("userAbilityRules").value=h,p.update(h),w("userData").value=o,w("accessToken").value=a.meta.accessToken,(o.roles||[]).includes("ADMINISTRADOR")){m.push("/dashboards/crm");return}m.push("/activity/list")}catch(a){console.log(a),a.response&&a.response._data?(console.log(a.response._data.message),V("ERROR",a.response._data.message)):V("ERROR","An error occurred while logging in")}finally{t.value=!1}},logoutUser:async()=>{t.value=!0,r.value=null;try{await logout(),n.value=null,c.value=!1,v.value=null,m.push("/auth/login")}catch(e){r.value="Logout failed: "+e.message}finally{t.value=!1}},resetUserPassword:async e=>{t.value=!0,r.value=null;try{const a=await ne(e);console.log(a),await m.push("/auth/login")}catch(a){console.log(a),r.value="Password reset failed: "+a.message}finally{t.value=!1}},changeUserPassword:async e=>{t.value=!0,r.value=null;try{await changePassword(e)}catch(a){r.value="Password reset failed: "+a.message}finally{t.value=!1}},forgotUserPassword:async e=>{t.value=!0,r.value=null;try{await le({email:e}),m.push({name:"auth-two-steps",params:{mail:e}})}catch(a){r.value="Password reset failed: "+a.message}finally{t.value=!1}},verifyCodResetPassword:async(e,a)=>{t.value=!0,r.value=null;try{const o=await ie(e,a),h={id:o.data.id,username:o.data.username,email:o.data.email,token:e},x=JSON.stringify(h),A=encodeURIComponent(x);m.push({name:"auth-reset-password",params:{user:A}})}catch(o){r.value="Password reset failed: "+o.message,console.log(o)}finally{t.value=!1}},checkAuthenticationStatus:async()=>{t.value=!0,r.value=null;try{const e=await checkAuthStatus();n.value=e.data.user,c.value=!0}catch(e){r.value="Auth status check failed: "+e.message,c.value=!1}finally{t.value=!1}}}}const de={class:"text-h4 mb-1"},ce={class:"text-capitalize"},me={class:"d-flex align-center flex-wrap justify-space-between mt-1 mb-4"},Fe={__name:"login",setup(n){const c=d(!1);I(Q,K,H,W,!0);const t=I(Y,X),r=i=>i.length>=8||"La contrase帽a debe tener al menos 8 caracteres",{loginUser:m,loading:v}=ue(),p=d(!1),P=d(),R=d({email:void 0,password:void 0}),f=d({email:"admin@canzza.com",password:"admin"}),y=d(!1),U=async()=>{c.value=!0,await m(f.value),c.value=!1},T=()=>{var i;(i=P.value)==null||i.validate().then(({valid:e})=>{e&&U()})};return(i,e)=>{const a=G;return $(),z(C,{"no-gutters":"",class:"auth-wrapper bg-surface"},{default:u(()=>[l(b,{lg:"8",class:"d-none d-lg-flex"},{default:u(()=>[g("div",{class:"position-relative bg-background rounded-lg w-100 ma-8 me-0",style:E({backgroundImage:`url(${s(oe)})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",height:"100%",width:"100%"})},[e[4]||(e[4]=g("div",{class:"d-flex align-center justify-center",style:{position:"absolute","z-index":"1","inset-block":"0 0","inset-inline":"0 0"}},null,-1)),l(ee,{src:s(t),class:"auth-footer-mask"},null,8,["src"])],4)]),_:1}),l(b,{cols:"12",lg:"4",class:"auth-card-v2 d-flex align-center justify-center"},{default:u(()=>[l(ae,{flat:"","max-width":500,class:"mt-12 mt-sm-0 pa-4"},{default:u(()=>[l(O,null,{default:u(()=>[l(s(Z),{nodes:s(S).app.logo,class:"mb-6"},null,8,["nodes"]),g("h4",de,[e[5]||(e[5]=_(" Welcome to ")),g("span",ce,F(s(S).app.title),1),e[6]||(e[6]=_("!  "))])]),_:1}),l(O,null,{default:u(()=>[l(s(se),{ref_key:"refVForm",ref:P,onSubmit:M(T,["prevent"])},{default:u(()=>[l(C,null,{default:u(()=>[l(b,{cols:"12"},{default:u(()=>[l(a,{modelValue:s(f).email,"onUpdate:modelValue":e[0]||(e[0]=o=>s(f).email=o),label:"Email",placeholder:"johndoe@email.com",type:"email",autofocus:"",rules:["requiredValidator"in i?i.requiredValidator:s(L),"emailValidator"in i?i.emailValidator:s(B)],"error-messages":s(R).email},null,8,["modelValue","rules","error-messages"])]),_:1}),l(b,{cols:"12"},{default:u(()=>[l(a,{modelValue:s(f).password,"onUpdate:modelValue":e[1]||(e[1]=o=>s(f).password=o),label:"Password",placeholder:"路路路路路路路路路路路路",rules:["requiredValidator"in i?i.requiredValidator:s(L),r],type:s(p)?"text":"password","error-messages":s(R).password,"append-inner-icon":s(p)?"tabler-eye-off":"tabler-eye","onClick:appendInner":e[2]||(e[2]=o=>p.value=!s(p))},null,8,["modelValue","rules","type","error-messages","append-inner-icon"]),g("div",me,[l(te,{modelValue:s(y),"onUpdate:modelValue":e[3]||(e[3]=o=>q(y)?y.value=o:null),label:"Recordar"},null,8,["modelValue"])]),e[8]||(e[8]=g("br",null,null,-1)),l(J,{block:"",type:"submit",disabled:s(v),loading:s(v)},{default:u(()=>e[7]||(e[7]=[_(" Login ")])),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})}}};export{Fe as default};
