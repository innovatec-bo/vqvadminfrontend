import{u as le,p as Ve,S as we,_ as xe,a as ke}from"./PreSaleForm-0caefef9.js";import{r as K,e as Ee}from"./validators-dea6e3a5.js";import{_ as Pe}from"./AppTextarea-cbb85b21.js";import{_ as je}from"./AppDateTimePicker-896d50cc.js";import{_ as fe}from"./AppTextField-f5d3b8ee.js";import{_ as ve}from"./AppSelect-ab40609c.js";import{$ as re}from"./api-8079bf60.js";import{s as De,a as Ie,b as Te,c as Ce}from"./notifications-ada6c777.js";import{r as b,o as n,c as y,d as l,F as T,i as M,b as e,e as t,n as i,v as C,x as D,z as L,f as q,$ as W,a4 as j,w as oe,a3 as $e,a as ie,a0 as B,am as J,a2 as X,an as _e,ac as Ne,H as Re}from"./index-b4bea750.js";import{V as he}from"./VAvatar-91c9c0c6.js";import{b as ee,c as te,a as me}from"./VList-9a1c22e8.js";import{a as g,V as H}from"./VRow-bc11a231.js";import{V as Z}from"./VChip-e7473304.js";import{V as Q}from"./VCardText-a5c39627.js";import{a as Se}from"./formatters-b3558c7d.js";import{u as Be}from"./useQuote-91611965.js";import{_ as Le}from"./AppAutocomplete-8fe2925c.js";import{_ as ue}from"./DialogCloseBtn-63b42b44.js";import{u as Me}from"./useProperty-b2071d9e.js";import{V as Y,b as de}from"./VCard-1cfd8877.js";import{V as Ae}from"./VForm-0711c9c2.js";import{V as pe}from"./VDialog-84282397.js";import{V as ye}from"./VCheckbox-c0606195.js";import{V as ze}from"./VTooltip-4f2c813a.js";import{V as ne}from"./VTable-4b5ef4a1.js";import{V as ae}from"./VTextField-a9844dab.js";import{_ as Oe}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as He}from"./AppDrawerHeaderSection-7fd33d12.js";import{P as Ge}from"./vue3-perfect-scrollbar.esm-e4aff421.js";import{V as Ke}from"./VNavigationDrawer-2f67ef8b.js";import{V as Ue,a as Qe}from"./VWindowItem-64042b25.js";import{V as We,a as be}from"./VRadioGroup-489c16e5.js";import{V as Je}from"./VDivider-f285f37d.js";import{V as Ye,a as Xe}from"./VTabs-ce8a0cbe.js";import{V as Ze}from"./VOverlay-5a76c00a.js";import"./useSales-81652f30.js";import"./InvoiceAddMoney-a3741cc7.js";import"./VNodeRenderer-88a79e97.js";import"./helpers-61e4df1a.js";import"./form-fce97c39.js";/* empty css                   */import"./VCounter-911d0828.js";import"./VImg-bb3f5fef.js";import"./VField-099959c0.js";import"./easing-9f15041e.js";import"./VInput-cf59e3bd.js";import"./forwardRefs-8348545e.js";import"./VSelect-daad5e4e.js";import"./dialog-transition-1404d7b9.js";import"./VMenu-c358c80a.js";import"./scopeId-1116c792.js";import"./VCheckboxBtn-ab7b6b76.js";import"./VSelectionControl-adab1655.js";import"./index-9c720871.js";import"./constants-8e30317b.js";import"./ssrBoot-66342520.js";import"./filter-a190cb7b.js";import"./VSpacer-e0fd5300.js";import"./lazy-fe7f6497.js";import"./VSlideGroup-696f8a43.js";const et=async(h,z)=>await re(`/opportunity/${h}/stage/${z}`,{method:"GET"}),tt=async(h,z,o)=>await re(`/opportunity/${h}/procedure/${z}`,{method:"PATCH",body:o});function ce(){const h=b(null),z=b(!1),o=b(!1),m=b([]);return{process:h,loadingProcess:z,errorProcess:o,processes:m,allProcessesOpportunityForStage:async(c,r)=>{try{const f=await et(c,r);m.value=f.data}catch(f){console.log(f)}},checkProcessForOpportunity:async(c,r,f)=>{try{console.log(f);const u=await tt(c,r,f);De("¡Proceso completado exitosamente!","El proceso ha sido llevado a cabo sin inconvenientes. ")}catch(u){console.log(u)}}}}const lt={class:"my-5"},ot={key:0},at=["src"],it={class:"my-5"},st={key:0,class:"d-flex flex-wrap gap-2 my-5"},nt={key:1},rt={__name:"EditDeliveryOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","complet"],setup(h,{emit:z}){const o=h,m=z,{changeStatusByOpportunity:U}=le(),{checkProcessForOpportunity:S}=ce(),c=async()=>{try{await U(o.opportunity.id,7,{}),m("complet")}catch(f){console.error("Error updating customer:",f)}},r=async(f,u)=>{console.log(`Procedimiento ${f} marcado como: ${u?"realizado":"no realizado"}`),await S(o.opportunity.id,f,{is_check:!u}),m("updateStageId",o.opportunity.id)};return(f,u)=>(n(),y(T,null,[l("div",lt,[u[0]||(u[0]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Propiedades ",-1)),o.opportunity.sales.length>0?(n(),y("div",ot,[(n(!0),y(T,null,M(o.opportunity.sales,_=>(n(),y("div",{key:_.id},[(n(!0),y(T,null,M(_.properties,O=>(n(),y("div",{key:O.id,class:"d-flex align-center justify-between"},[e(he,{size:"50",rounded:""},{default:t(()=>[l("img",{src:i(Ve),alt:"Logo pora",style:{"border-radius":"30%"}},null,8,at)]),_:1}),e(g,{cols:"12",md:"7"},{default:t(()=>[e(ee,{class:"font-weight-medium"},{default:t(()=>[C(D(O.project_title)+" | "+D(O.title),1)]),_:2},1024),e(te,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",null,"$ "+D(O.pivot_price),1)]),_:2},1024)]),_:2},1024)]))),128))]))),128))])):L("",!0)]),l("div",it,[u[2]||(u[2]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(n(),y("div",st,[(n(!0),y(T,null,M(o.opportunity.procedure,_=>(n(),y("div",{key:_.id},[e(Z,{color:_.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:O=>r(_.id,_.pivot.is_check)},{default:t(()=>[_.pivot.is_check?(n(),q(W,{key:0,icon:"tabler-check",class:"mr-2"})):L("",!0),C(" "+D(_.title),1)]),_:2},1032,["color","onClick"])]))),128))])):(n(),y("div",nt,u[1]||(u[1]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(Q,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(j,{color:"primary",size:"small",onClick:c},{default:t(()=>u[3]||(u[3]=[C(" Finalizar Oportunidad ")])),_:1})]),_:1})],64))}},Fe={__name:"EditCustomerDialog",props:{isDialogVisible:{type:Boolean,required:!0},opportunityKanban:{type:Object,required:!0}},emits:["update:isDialogVisible","update:newProperty"],setup(h,{emit:z}){const o=h,m=z;Object.values(we).map(x=>({title:x.label,value:x.value}));const{propertiesAvailbles:U,properties:S}=Me(),{getOpportunitybyId:c,opportunity:r,changeOpportunity:f,loadingOpportunity:u}=le(),_=()=>{m("update:isDialogVisible",!1)},O=async()=>{console.log("antes del save:",r);const x={id:r.value.id,description:r.value.description,property_id:r.value.property_id,customer:{id:r.value.customer.id,name:r.value.customer.name,email:r.value.customer.email,ci:r.value.customer.ci,cod_phone:r.value.cod_phone,phone:r.value.customer.phone}};await f(r.value.id,x),r.value.property_id&&(console.log("Cambio y geenero el Emit Principal"),m("update:newProperty",r.value.property_id)),m("update:isDialogVisible",!1)},V=async()=>{var x;(x=o.opportunityKanban)!=null&&x.id&&await c(o.opportunityKanban.id)},w=async()=>{await U()};return oe(()=>o.isDialogVisible,async x=>{x===!0&&(V(),await w())}),(x,d)=>{const A=ue,R=fe,s=ve,p=Le,N=Pe;return n(),q(pe,{"max-width":"800","model-value":o.isDialogVisible,persistent:"","close-on-esc":!1,"onUpdate:modelValue":_},{default:t(()=>[e(A,{onClick:_}),e(Y,{title:"Información del Cliente y Oportunidad",class:"pa-sm-8 pa-5"},{default:t(()=>[e(Q,null,{default:t(()=>[e(Ae,{onSubmit:$e(O,["prevent"])},{default:t(()=>[e(H,{dense:""},{default:t(()=>[e(g,{cols:"12",md:"6"},{default:t(()=>[e(R,{modelValue:i(r).customer.name,"onUpdate:modelValue":d[0]||(d[0]=k=>i(r).customer.name=k),label:"Nombre del Cliente",placeholder:"Ingresa el nombre",outlined:""},null,8,["modelValue"])]),_:1}),e(g,{cols:"12",md:"6"},{default:t(()=>[e(R,{modelValue:i(r).customer.email,"onUpdate:modelValue":d[1]||(d[1]=k=>i(r).customer.email=k),label:"Email del Cliente",placeholder:"Ingresa el email",outlined:""},null,8,["modelValue"])]),_:1}),e(g,{cols:"12",md:"6"},{default:t(()=>[e(H,null,{default:t(()=>[e(g,{cols:"4"},{default:t(()=>[e(s,{modelValue:i(r).customer.cod_phone,"onUpdate:modelValue":d[2]||(d[2]=k=>i(r).customer.cod_phone=k),label:"Código",items:["+591","+1","+52"],placeholder:"Cód.",outlined:""},null,8,["modelValue"])]),_:1}),e(g,{cols:"8"},{default:t(()=>[e(R,{modelValue:i(r).customer.phone,"onUpdate:modelValue":d[3]||(d[3]=k=>i(r).customer.phone=k),label:"Número de Teléfono",placeholder:"Ingresa el teléfono",outlined:"",dense:"",maxlength:"9"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(g,{cols:"12",md:"6"},{default:t(()=>[e(R,{modelValue:i(r).customer.ci,"onUpdate:modelValue":d[4]||(d[4]=k=>i(r).customer.ci=k),label:"CI del Cliente",placeholder:"Ingresa el CI",outlined:""},null,8,["modelValue"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(p,{modelValue:i(r).property_id,"onUpdate:modelValue":d[5]||(d[5]=k=>i(r).property_id=k),label:"Departamento de Interés",placeholder:"Selecciona un Departamento",items:i(S).map(k=>({title:k.title,value:k.id})),outlined:""},null,8,["modelValue","items"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(N,{modelValue:i(r).description,"onUpdate:modelValue":d[6]||(d[6]=k=>i(r).description=k),label:"Descripción de la Oportunidad",placeholder:"Ingresa una descripción",rows:"3","auto-grow":"",outlined:""},null,8,["modelValue"])]),_:1}),e(g,{cols:"12",class:"text-center"},{default:t(()=>[e(j,{type:"submit",color:"primary",class:"me-3",disabled:i(u),loading:i(u)},{default:t(()=>d[7]||(d[7]=[C(" Guardar ")])),_:1},8,["disabled","loading"]),e(j,{color:"secondary",variant:"tonal",onClick:_},{default:t(()=>d[8]||(d[8]=[C(" Cancelar ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},ut={class:"d-flex align-bottom flex-sm-row flex-column"},dt={class:"user-profile-info"},pt={class:"d-flex align-center justify-center justify-sm-space-between flex-wrap gap-4"},ct={class:"d-flex align-center gap-x-3"},mt={class:"text-4xl font-weight-medium"},yt={class:"d-flex flex-column py-2",style:{"font-size":"14px"}},ft={class:"text-sm text-disabled"},vt={key:0,class:"d-flex flex-wrap gap-2 my-5"},gt={key:1},_t={key:0,class:"d-flex flex-wrap gap-2 my-5"},bt={key:1},Vt={__name:"EditPreSaleOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","update:newProperty"],setup(h,{emit:z}){const o=h,m=z,{checkProcessForOpportunity:U}=ce(),{changeStatusQuotes:S}=Be(),c=b(!1),r=b(!1),f=()=>{c.value=!0},u=()=>{console.log("Se escucho el evento en EditProspectOpportunity"),m("update:newProperty")},_=()=>{r.value=!0},O=async x=>{m("updateStageId",x)},V=async(x,d)=>{console.log(`Procedimiento ${x} marcado como: ${d?"realizado":"no realizado"}`),await U(o.opportunity.id,x,{is_check:!d}),m("updateStageId",o.opportunity.id)},w=async(x,d)=>{const A=d==="APPROVED"?"NOT_APPROVED":"APPROVED";console.log(`Procedimiento ${x} marcado como: ${d}`),await S(x,{status:A}),m("updateStageId",o.opportunity.id)};return(x,d)=>{const A=ie("RouterLink"),R=ie("IconBtn");return n(),y(T,null,[l("div",ut,[l("div",dt,[d[3]||(d[3]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Perfil ",-1)),l("div",pt,[l("div",ct,[l("span",mt,D(("avatarText"in x?x.avatarText:i(Se))(o.opportunity.customer.name)),1),l("div",yt,[e(A,{to:{name:"apps-ecommerce-customer-details-id",params:{id:1}},class:"font-weight-base"},{default:t(()=>[C(D(o.opportunity.customer.name),1)]),_:1}),l("span",ft,D(o.opportunity.customer.phone),1)]),e(j,{color:"secondary",variant:"tonal",size:"small",onClick:f},{default:t(()=>d[2]||(d[2]=[C(" Editar Perfil ")])),_:1})])])])]),l("div",null,[d[5]||(d[5]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(n(),y("div",vt,[(n(!0),y(T,null,M(o.opportunity.procedure,s=>(n(),y("div",{key:s.id},[e(Z,{color:s.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:p=>V(s.id,s.pivot.is_check)},{default:t(()=>[s.pivot.is_check?(n(),q(W,{key:0,icon:"tabler-check",class:"mr-2"})):L("",!0),C(" "+D(s.title),1)]),_:2},1032,["color","onClick"])]))),128))])):(n(),y("div",gt,d[4]||(d[4]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),l("div",null,[d[9]||(d[9]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Cotizaciones ",-1)),o.opportunity.quotes&&o.opportunity.quotes.length>0?(n(),y("div",_t,[e(ne,{density:"compact",class:"text-no-wrap",style:{"font-size":"12px"}},{default:t(()=>[d[7]||(d[7]=l("thead",null,[l("tr",null,[l("th",null," Nombre "),l("th",null," Propiedad "),l("th",null," Fecha "),l("th")])],-1)),l("tbody",null,[(n(!0),y(T,null,M(o.opportunity.quotes,s=>(n(),y("tr",{key:s.id},[l("td",null,D(s.social_reason),1),l("td",null,D(s.properties[0].title),1),l("td",null,D(new Date(s.creation_date).toLocaleDateString()),1),l("td",null,[e(H,null,{default:t(()=>[e(ye,{modelValue:s.status,"onUpdate:modelValue":p=>s.status=p,"true-value":"APPROVED","false-value":"NOT_APPROVED",onClick:p=>w(s.id,s.status)},{default:t(()=>[e(ze,{activator:"parent",location:"top"},{default:t(()=>d[6]||(d[6]=[C(" Aprobar Cotizacion ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","onClick"]),e(A,{to:{name:"quote-id",params:{id:s.id}}},{default:t(()=>[e(R,null,{default:t(()=>[e(W,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])]),_:2},1024)])]))),128))])]),_:1})])):(n(),y("div",bt,d[8]||(d[8]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(Q,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(A,{to:{name:"quote-add-quote"},class:"text-white"},{default:t(()=>[e(j,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>d[10]||(d[10]=[C(" Generar Cotización ")])),_:1})]),_:1}),e(j,{color:"primary",class:"mx-auto",size:"small",onClick:_},{default:t(()=>d[11]||(d[11]=[C(" Generar Venta ")])),_:1})]),_:1}),e(Fe,{"is-dialog-visible":i(c),"onUpdate:isDialogVisible":d[0]||(d[0]=s=>B(c)?c.value=s:null),"opportunity-kanban":o.opportunity,"onUpdate:newProperty":u},null,8,["is-dialog-visible","opportunity-kanban"]),e(xe,{"is-dialog-visible":i(r),"onUpdate:isDialogVisible":d[1]||(d[1]=s=>B(r)?r.value=s:null),opportunity:o.opportunity,stage:"PRESALE",onRegisterSale:O},null,8,["is-dialog-visible","opportunity"])],64)}}},wt={class:"d-flex align-bottom flex-sm-row flex-column"},xt={class:"user-profile-info"},kt={class:"d-flex align-center justify-center justify-sm-space-between flex-wrap gap-4"},Pt={class:"d-flex align-center gap-x-3"},Dt={class:"text-4xl font-weight-medium"},Ct={class:"d-flex flex-column py-2",style:{"font-size":"14px"}},$t={class:"text-sm text-disabled"},ht={key:0,class:"d-flex flex-wrap gap-2 my-5"},St={key:1},At={key:0,class:"d-flex flex-wrap gap-2 my-5"},zt={key:1},Ot={__name:"EditProspectOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId","update:newProperty"],setup(h,{emit:z}){const o=h,m=z,{checkProcessForOpportunity:U}=ce(),{changeStatusByOpportunity:S,loadingOpportunity:c}=le(),r=b(!1),f=()=>{r.value=!0},u=()=>{console.log("Se escucho el evento en EditProspectOpportunity"),m("update:newProperty")},_=async V=>{await S(V,we.PRESALE.value,{}),m("updateStageId",V)},O=async V=>{console.log(`Procedimiento ${V.id} marcado como: ${V.pivot.is_check?"realizado":"no realizado"}`),await U(o.opportunity.id,V.id,{is_check:!V.pivot.is_check}),V.pivot.is_check=!V.pivot.is_check,m("updateStageId",o.opportunity.id)};return(V,w)=>{const x=ie("RouterLink"),d=ie("IconBtn");return n(),y(T,null,[l("div",wt,[l("div",xt,[w[3]||(w[3]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Perfil ",-1)),l("div",kt,[l("div",Pt,[l("span",Dt,D(("avatarText"in V?V.avatarText:i(Se))(o.opportunity.customer.name)),1),l("div",Ct,[e(x,{to:{name:"apps-ecommerce-customer-details-id",params:{id:1}},class:"font-weight-base"},{default:t(()=>[C(D(o.opportunity.customer.name),1)]),_:1}),l("span",$t,D(o.opportunity.customer.phone),1)]),l("div",null,[e(j,{color:"secondary",variant:"tonal",size:"small",onClick:f},{default:t(()=>w[2]||(w[2]=[C(" Editar Perfil ")])),_:1})])])])])]),l("div",null,[w[5]||(w[5]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(n(),y("div",ht,[(n(!0),y(T,null,M(o.opportunity.procedure,A=>(n(),y("div",{key:A.id},[e(Z,{color:A.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:R=>O(A)},{default:t(()=>[A.pivot.is_check?(n(),q(W,{key:0,icon:"tabler-check",class:"mr-2"})):L("",!0),C(" "+D(A.title),1)]),_:2},1032,["color","onClick"])]))),128))])):(n(),y("div",St,w[4]||(w[4]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),l("div",null,[w[8]||(w[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Cotizaciones ",-1)),o.opportunity.quotes&&o.opportunity.quotes.length>0?(n(),y("div",At,[e(ne,{density:"compact",class:"text-no-wrap",style:{"font-size":"12px"}},{default:t(()=>[w[6]||(w[6]=l("thead",null,[l("tr",null,[l("th",null," Nombre "),l("th",null," Propiedad "),l("th",null," Fecha "),l("th")])],-1)),l("tbody",null,[(n(!0),y(T,null,M(o.opportunity.quotes,A=>(n(),y("tr",{key:A.id},[l("td",null,D(A.social_reason),1),l("td",null,D(A.properties[0].title),1),l("td",null,D(new Date(A.created_at).toLocaleDateString()),1),l("td",null,[e(x,{to:{name:"quote-id",params:{id:A.id}}},{default:t(()=>[e(d,null,{default:t(()=>[e(W,{icon:"tabler-eye"})]),_:1})]),_:2},1032,["to"])])]))),128))])]),_:1})])):(n(),y("div",zt,w[7]||(w[7]=[l("span",null,"No hay cotizaciones disponibles.",-1)])))]),e(Q,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(x,{to:{name:"quote-add-quote"},class:"text-white"},{default:t(()=>[e(j,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>w[9]||(w[9]=[C(" Generar Cotización ")])),_:1})]),_:1}),e(j,{color:"primary",class:"mx-auto",size:"small",disabled:i(c),loading:i(c),onClick:w[0]||(w[0]=A=>_(o.opportunity.id))},{default:t(()=>w[10]||(w[10]=[C(" Siguiente Etapa ")])),_:1},8,["disabled","loading"])]),_:1}),e(Fe,{"is-dialog-visible":i(r),"onUpdate:isDialogVisible":w[1]||(w[1]=A=>B(r)?r.value=A:null),"opportunity-kanban":o.opportunity,"onUpdate:newProperty":u},null,8,["is-dialog-visible","opportunity-kanban"])],64)}}},Ut=async h=>await re(`/sale/paymentPlans/${h}/confirm`,{method:"PATCH"}),Ft=async(h,z)=>await re(`/sale/paymentPlans/${h}`,{method:"PATCH",body:z});function ge(){const h=b(!1),z=b([]),o=b(null),m=b(null);return{loadingPaymentPlans:h,paymentPlan:m,error:o,paymentPlans:z,confirmPaymentPlans:async c=>{try{const r=await Ut(c);De("Actualizacion Exitosa","Se confirmo el pago")}catch(r){console.log(r)}},updatePaymentPlans:async(c,r)=>{h.value=!0,o.value=null;try{console.log(r);const f=await Ft(c,r);m.value=f.data,Ie("¡Planes de pago actualizados exitosamente! ","Los planes de pago han sido modificados y guardados correctamente."),console.log(f)}catch(f){console.log(f),f.response&&f.response.status==422&&Te("Advertencia","Faltan datos por Completar"),o.value=f.message}finally{h.value=!1}}}}const qt={__name:"DeliveryForm",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(h,{emit:z}){const o=h,m=z,{changeStatusByOpportunity:U}=le(),S=u=>{m("update:isDialogVisible",u)},c=b(structuredClone(J(o.opportunity)));oe(o,()=>{c.value=structuredClone(J(o.opportunity))});const r=async()=>{m("update:isDialogVisible",!1);try{await U(o.opportunity.id,5,{delivery_date:c.value.sales.delivery_date}),m("updateDeliveryDate",c.value.id)}catch(u){console.error("Error updating customer:",u)}},f=()=>{m("update:isDialogVisible",!1)};return(u,_)=>{const O=ue;return n(),q(pe,{"model-value":o.isDialogVisible,"max-width":"800","onUpdate:modelValue":S},{default:t(()=>[e(O,{onClick:_[0]||(_[0]=V=>u.$emit("update:isDialogVisible",!1))}),e(Y,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(de,{class:"text-h3 text-center"},{default:t(()=>_[2]||(_[2]=[C(" Confirmar Fecha ")])),_:1}),e(Q,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(H,null,{default:t(()=>[e(g,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[e(ae,{modelValue:i(c).sales.delivery_date,"onUpdate:modelValue":_[1]||(_[1]=V=>i(c).sales.delivery_date=V),label:"Fecha de Entrega",type:"date",rules:["requiredValidator"in u?u.requiredValidator:i(K)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),e(g,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(j,{onClick:r},{default:t(()=>_[3]||(_[3]=[C(" Pasar a Entrega ")])),_:1}),e(j,{color:"secondary",variant:"tonal",onClick:f},{default:t(()=>_[4]||(_[4]=[C(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Et={key:0},jt={__name:"PaymentPlanEdit",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},payment:{type:Object,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(h,{emit:z}){const o=h,m=z,{updatePaymentPlans:U}=ge(),S=b(!1),c=s=>{m("update:isDialogVisible",s)},r=b(structuredClone(J(o.payment))),f=b(structuredClone(J(o.opportunity))),u=b([]);oe(o,()=>{r.value=structuredClone(J(o.payment)),f.value=structuredClone(J(o.opportunity))});const _=()=>{u.value.push({amount:"",date:"",type:r.value.type})},O=s=>{u.value.splice(s,1)},V=X(()=>u.value.reduce((s,p)=>{const N=parseFloat(p.amount)||0;return s+N},0)),w=X(()=>u.value.length>0&&u.value.every(s=>s.amount&&s.date&&s.type)),x=X(()=>{if(u.value.length===0)return!0;const s=u.value.reduce((k,v)=>k+(parseFloat(v.amount)||0),0),p=parseFloat(s),N=parseFloat(r.value.amount);return p===N}),d=X(()=>u.value.length===0?!0:w.value&&x.value),A=async()=>{if(!x.value){Ce("Validación fallida","La suma de las diferencias no es correcta");return}if(!d.value){alert("Por favor, completa todos los campos obligatorios.");return}S.value=!0;try{await U(r.value.id,{date:r.value.date,differData:u.value})}catch(s){console.error("Error updating customer:",s)}finally{m("updateDeliveryDate",f.value.id),m("update:isDialogVisible",!1),u.value=[],S.value=!1}},R=()=>{m("update:isDialogVisible",!1),u.value=[],errorMessage.value=""};return(s,p)=>{const N=ue;return n(),q(pe,{"model-value":o.isDialogVisible,"max-width":"800","onUpdate:modelValue":c},{default:t(()=>[e(N,{onClick:p[0]||(p[0]=k=>s.$emit("update:isDialogVisible",!1))}),e(Y,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(de,{class:"text-h3 text-center"},{default:t(()=>p[2]||(p[2]=[C(" Editar Pago ")])),_:1}),e(Q,null,{default:t(()=>[e(H,{class:"mx-5"},{default:t(()=>[e(g,{cols:"6"},{default:t(()=>[l("h3",null," Monto a Pagar : $ "+D(i(r).amount),1)]),_:1}),e(g,{cols:"6"},{default:t(()=>[e(ae,{modelValue:i(r).date,"onUpdate:modelValue":p[1]||(p[1]=k=>i(r).date=k),label:"Cambiar Fecha",type:"date",rules:["requiredValidator"in s?s.requiredValidator:i(K)]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(Y,{flat:"",class:"d-flex flex-column pa-5 px-5"},{default:t(()=>[(n(!0),y(T,null,M(i(u),(k,v)=>(n(),y("div",{key:k.id,class:"d-flex align-center my-4"},[e(ae,{modelValue:k.amount,"onUpdate:modelValue":a=>k.amount=a,label:"Monto *",type:"number",class:"mr-4",outlined:"",rules:["requiredValidator"in s?s.requiredValidator:i(K)]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(ae,{modelValue:k.date,"onUpdate:modelValue":a=>k.date=a,label:"Fecha de Pago *",type:"date",class:"mr-3",outlined:"",rules:["requiredValidator"in s?s.requiredValidator:i(K)]},null,8,["modelValue","onUpdate:modelValue","rules"]),e(j,{color:"error",onClick:a=>O(v)},{default:t(()=>[e(W,{icon:"tabler-square-x"})]),_:2},1032,["onClick"])]))),128)),i(u).length>0?(n(),y("div",Et,[p[3]||(p[3]=l("strong",null,"Monto Restante:",-1)),C(" $"+D((i(r).amount-i(V)).toFixed(2)),1)])):L("",!0),e(j,{color:"primary",variant:"tonal",class:"mt-4",size:"small",onClick:_},{default:t(()=>p[4]||(p[4]=[C(" Diferir Pago ")])),_:1})]),_:1}),e(g,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(j,{loading:i(S),disabled:!i(d)||i(S),onClick:A},{default:t(()=>p[5]||(p[5]=[C(" Guardar ")])),_:1},8,["loading","disabled"]),e(j,{color:"error",variant:"tonal",onClick:R},{default:t(()=>p[6]||(p[6]=[C(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},It={__name:"SalePaymentPlan",props:{isDialogVisible:{type:Boolean,required:!0},opportunity:{type:Object,required:!0},salesPayment:{type:Array,required:!0}},emits:["update:isDialogVisible","updateDeliveryDate"],setup(h,{emit:z}){const o=h,m=z;ge();const U=f=>{m("update:isDialogVisible",f)},S=b(structuredClone(J(o.opportunity)));oe(o,()=>{S.value=structuredClone(J(o.opportunity)),console.log("Sales Payment:",o.salesPayment)});const c=b([]),r=()=>{m("update:isDialogVisible",!1),c.value=[]};return(f,u)=>{const _=ue;return n(),q(pe,{"model-value":o.isDialogVisible,"max-width":"800","onUpdate:modelValue":U},{default:t(()=>[e(_,{onClick:u[0]||(u[0]=O=>f.$emit("update:isDialogVisible",!1))}),e(Y,{class:"pa-sm-8 pa-5"},{default:t(()=>[e(de,{class:"text-h3 text-center"},{default:t(()=>u[1]||(u[1]=[C(" Confirmar Fecha ")])),_:1}),e(Q,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(H,null,{default:t(()=>[e(g,{cols:"12",style:{"padding-block":"0","padding-inline":"8px"}},{default:t(()=>[l("span",null," Monto a Pagar : "+D(i(S)),1)]),_:1})]),_:1})]),_:1}),e(g,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:t(()=>[e(j,{onClick:f.onFormSubmit},{default:t(()=>u[2]||(u[2]=[C(" Guardar ")])),_:1},8,["onClick"]),e(j,{color:"error",variant:"tonal",onClick:r},{default:t(()=>u[3]||(u[3]=[C(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Tt={class:"text-h6"},Nt={class:"text-h6"},Rt={class:"text-h6"},Bt={class:"my-5"},Lt={key:0},Mt=["src"],Ht={class:"mb-4"},Gt=["onClick"],Kt=["onClick"],Qt={class:"my-5"},Wt={key:0,class:"d-flex flex-wrap gap-2 my-5"},Jt={key:1},Yt={__name:"EditSaleOpportunity",props:{opportunity:{type:Object,required:!0}},emits:["updateStageId"],setup(h,{emit:z}){const o=h,m=z,{checkProcessForOpportunity:U}=ce(),{confirmPaymentPlans:S}=ge(),{changeStatusByOpportunity:c,loadingOpportunity:r}=le(),f=b(!1),u=b(!1),_=b(!1),O=b(""),V=X(()=>o.opportunity.sales.reduce((v,a)=>v+a.amount,0)),w=X(()=>o.opportunity.sales.reduce((v,a)=>v+a.initial_fee,0)),x=X(()=>V.value-w.value),d=()=>{_.value=!0},A=v=>{if(v.is_paid===1){Ce("Advertencia","No se puede editar un pago ya realizado.");return}console.log("entro aqui"),u.value=!0,O.value={...v}},R=async v=>{m("updateStageId",v)},s=async v=>{console.log(`Procedimiento ${v.id} marcado como: ${v.pivot.is_check?"realizado":"no realizado"}`),await U(o.opportunity.id,v.id,{is_check:!v.pivot.is_check}),v.pivot.is_check=!v.pivot.is_check,m("updateStageId",o.opportunity.id)},p=async v=>{console.log(v),await S(v),m("updateStageId",o.opportunity.id)},N=async v=>{await c(v,5,{}),m("updateStageId",v)},k=async v=>{m("updateStageId",v)};return(v,a)=>(n(),y(T,null,[l("div",null,[e(Y,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(H,null,{default:t(()=>[e(g,{cols:"4",class:"border rounded-sm mx-1"},{default:t(()=>[e(ee,{class:"font-weight-medium"},{default:t(()=>a[5]||(a[5]=[C(" Saldo ")])),_:1}),e(te,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Tt,"$ "+D(i(x).toFixed(2)),1)]),_:1})]),_:1}),e(g,{cols:"3",class:"border rounded-sm mx-1"},{default:t(()=>[e(ee,{class:"font-weight-medium"},{default:t(()=>a[6]||(a[6]=[C(" Anticipo ")])),_:1}),e(te,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Nt,"$ "+D(i(w).toFixed(2)),1)]),_:1})]),_:1}),e(g,{cols:"4",class:"border rounded-sm mx-1"},{default:t(()=>[e(ee,{class:"font-weight-medium"},{default:t(()=>a[7]||(a[7]=[C(" Precio Final ")])),_:1}),e(te,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",Rt,"$ "+D(i(V).toFixed(2)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),l("div",Bt,[a[8]||(a[8]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Propiedades ",-1)),o.opportunity.sales.length>0?(n(),y("div",Lt,[(n(!0),y(T,null,M(o.opportunity.sales,P=>(n(),y("div",{key:P.id},[(n(!0),y(T,null,M(P.properties,F=>(n(),y("div",{key:F.id,class:"d-flex align-center justify-between"},[e(he,{size:"50",rounded:""},{default:t(()=>[l("img",{src:i(Ve),alt:"Logo pora",style:{"border-radius":"30%"}},null,8,Mt)]),_:1}),e(g,{cols:"12",md:"7"},{default:t(()=>[e(ee,{class:"font-weight-medium"},{default:t(()=>[C(D(F.project_title)+" | "+D(F.title),1)]),_:2},1024),e(te,{class:"text-disabled d-flex justify-between mt-1"},{default:t(()=>[l("span",null,"$ "+D(F.pivot_price),1)]),_:2},1024)]),_:2},1024)]))),128))]))),128))])):L("",!0)]),l("div",Ht,[a[10]||(a[10]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Anticipo ",-1)),o.opportunity.initial_payments&&o.opportunity.initial_payments.length>0?(n(),q(ne,{key:0,density:"compact",class:"text-no-wrap my-2",style:{"font-size":"12px"}},{default:t(()=>[a[9]||(a[9]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th",null," Action ")])],-1)),l("tbody",null,[(n(!0),y(T,null,M(o.opportunity.initial_payments,P=>(n(),y("tr",{key:P.id},[l("td",null,D(P.property_title),1),l("td",null,D(P.date),1),l("td",null,D(P.amount),1),l("td",null,[e(H,null,{default:t(()=>[e(ye,{modelValue:P.is_paid,"onUpdate:modelValue":F=>P.is_paid=F,"true-value":1,"false-value":0,disabled:P.is_paid===1,onChange:F=>p(P.id)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"]),P.is_paid===0?(n(),y("div",{key:0,"fill-dot":"",onClick:F=>A(P)},[e(W,{size:"25",icon:"tabler-edit"})],8,Gt)):L("",!0)]),_:2},1024)])]))),128))])]),_:1})):L("",!0)]),l("div",null,[a[13]||(a[13]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Saldos ",-1)),o.opportunity.balance_payments&&o.opportunity.balance_payments.length>0?(n(),q(ne,{key:0,density:"compact",class:"text-no-wrap my-2",style:{"font-size":"12px"}},{default:t(()=>[a[12]||(a[12]=l("thead",null,[l("tr",null,[l("th",null," Propiedad "),l("th",null," Fecha "),l("th",null," Monto "),l("th",null," Action ")])],-1)),l("tbody",null,[(n(!0),y(T,null,M(o.opportunity.balance_payments,P=>(n(),y("tr",{key:P.id},[l("td",null,D(P.property_title),1),l("td",null,D(P.date),1),l("td",null,D(P.amount),1),l("td",null,[e(H,null,{default:t(()=>[e(ye,{modelValue:P.is_paid,"onUpdate:modelValue":F=>P.is_paid=F,"true-value":1,"false-value":0,disabled:P.is_paid===1,onChange:F=>p(P.id)},{default:t(()=>[e(ze,{activator:"parent",location:"top"},{default:t(()=>a[11]||(a[11]=[C(" Confirmar Pago ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"]),P.is_paid===0?(n(),y("div",{key:0,"fill-dot":"",onClick:F=>A(P)},[e(W,{size:"25",icon:"tabler-edit"})],8,Kt)):L("",!0)]),_:2},1024)])]))),128))])]),_:1})):L("",!0)]),l("div",Qt,[a[15]||(a[15]=l("span",{style:{"font-size":"14px","font-weight":"500"}}," Procesos ",-1)),o.opportunity.procedure&&o.opportunity.procedure.length>0?(n(),y("div",Wt,[(n(!0),y(T,null,M(o.opportunity.procedure,P=>(n(),y("div",{key:P.id},[e(Z,{color:P.pivot.is_check?"primary":"secondary",variant:"outlined",class:"my-1",style:{cursor:"pointer"},"fill-dot":"",onClick:F=>s(P)},{default:t(()=>[P.pivot.is_check?(n(),q(W,{key:0,icon:"tabler-check",class:"mr-2"})):L("",!0),C(" "+D(P.title),1)]),_:2},1032,["color","onClick"])]))),128))])):(n(),y("div",Jt,a[14]||(a[14]=[l("span",null,"No hay procedimientos disponibles.",-1)])))]),e(Q,{class:"d-flex mt-4"},{default:t(()=>[e(j,{color:"primary",variant:"tonal",class:"mx-auto",size:"small",onClick:d},{default:t(()=>a[16]||(a[16]=[C(" Generar Venta ")])),_:1}),e(j,{color:"primary",class:"mx-auto",size:"small",onClick:a[0]||(a[0]=P=>N(o.opportunity.id))},{default:t(()=>a[17]||(a[17]=[C(" Siguiente Etapa ")])),_:1})]),_:1}),e(qt,{"is-dialog-visible":i(f),"onUpdate:isDialogVisible":a[1]||(a[1]=P=>B(f)?f.value=P:null),opportunity:o.opportunity,onUpdateDeliveryDate:k},null,8,["is-dialog-visible","opportunity"]),e(jt,{"is-dialog-visible":i(u),"onUpdate:isDialogVisible":a[2]||(a[2]=P=>B(u)?u.value=P:null),payment:i(O),opportunity:o.opportunity,onUpdateDeliveryDate:k},null,8,["is-dialog-visible","payment","opportunity"]),e(xe,{"is-dialog-visible":i(_),"onUpdate:isDialogVisible":a[3]||(a[3]=P=>B(_)?_.value=P:null),opportunity:o.opportunity,stage:"SALE",onRegisterSale:R},null,8,["is-dialog-visible","opportunity"]),e(It,{"is-dialog-visible":v.openSaleEditPaymentPlan,"onUpdate:isDialogVisible":a[4]||(a[4]=P=>v.openSaleEditPaymentPlan=P),opportunity:o.opportunity,"sales-payment":v.salePaymentPlan,onUpdateDeliveryDate:k},null,8,["is-dialog-visible","opportunity","sales-payment"])],64))}};const Xt={__name:"SellerReport",setup(h){return b([{title:"Actividad 1",date:"2024-10-09",status:"Pendiente"},{title:"Actividad 2",date:"2024-10-10",status:"Completada"},{title:"Actividad 3",date:"2024-10-11",status:"En Progreso"}]),(z,o)=>(n(),q(Q,null,{default:t(()=>o[0]||(o[0]=[l("p",null,"No hay actividades seleccionadas. Aquí tienes un resumen de las actividades:",-1)])),_:1}))}},Zt=Oe(Xt,[["__scopeId","data-v-c9cbe3f1"]]),el={__name:"CustomerHistory",props:{isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","userData"],setup(h,{emit:z}){const o=h,m=z,U=b(!1),S=b(),c=b(""),r=b(""),f=b(""),u=b(""),_=b(),O=b(""),V=b(),w=b(),x=b(),d=()=>{m("update:isDrawerOpen",!1),_e(()=>{var s,p;(s=S.value)==null||s.reset(),(p=S.value)==null||p.resetValidation()})},A=()=>{var s;(s=S.value)==null||s.validate().then(({valid:p})=>{p&&(m("userData",{id:0,fullName:c.value,company:u.value,role:V.value,country:_.value,contact:O.value,email:f.value,currentPlan:w.value,status:x.value,avatar:"",billing:"Auto Debit"}),m("update:isDrawerOpen",!1),_e(()=>{var N,k;(N=S.value)==null||N.reset(),(k=S.value)==null||k.resetValidation()}))})},R=s=>{m("update:isDrawerOpen",s)};return(s,p)=>{const N=He,k=fe,v=ve;return n(),q(Ke,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":o.isDrawerOpen,"onUpdate:modelValue":R},{default:t(()=>[e(N,{title:"Historial del Cliente",onCancel:d}),e(i(Ge),{options:{wheelPropagation:!1}},{default:t(()=>[e(Y,{flat:""},{default:t(()=>[e(Q,null,{default:t(()=>[e(Ae,{ref_key:"refForm",ref:S,modelValue:i(U),"onUpdate:modelValue":p[9]||(p[9]=a=>B(U)?U.value=a:null),onSubmit:$e(A,["prevent"])},{default:t(()=>[e(H,null,{default:t(()=>[e(g,{cols:"12"},{default:t(()=>[e(k,{modelValue:i(c),"onUpdate:modelValue":p[0]||(p[0]=a=>B(c)?c.value=a:null),rules:["requiredValidator"in s?s.requiredValidator:i(K)],label:"Full Name",placeholder:"John Doe"},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(k,{modelValue:i(r),"onUpdate:modelValue":p[1]||(p[1]=a=>B(r)?r.value=a:null),rules:["requiredValidator"in s?s.requiredValidator:i(K)],label:"Username",placeholder:"Johndoe"},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(k,{modelValue:i(f),"onUpdate:modelValue":p[2]||(p[2]=a=>B(f)?f.value=a:null),rules:["requiredValidator"in s?s.requiredValidator:i(K),"emailValidator"in s?s.emailValidator:i(Ee)],label:"Email",placeholder:"johndoe@email.com"},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(k,{modelValue:i(u),"onUpdate:modelValue":p[3]||(p[3]=a=>B(u)?u.value=a:null),rules:["requiredValidator"in s?s.requiredValidator:i(K)],label:"Company",placeholder:"PixInvent"},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(v,{modelValue:i(_),"onUpdate:modelValue":p[4]||(p[4]=a=>B(_)?_.value=a:null),label:"Select Country",placeholder:"Select Country",rules:["requiredValidator"in s?s.requiredValidator:i(K)],items:["USA","UK","India","Australia"]},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(k,{modelValue:i(O),"onUpdate:modelValue":p[5]||(p[5]=a=>B(O)?O.value=a:null),type:"number",rules:["requiredValidator"in s?s.requiredValidator:i(K)],label:"Contact",placeholder:"+1-541-754-3010"},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(v,{modelValue:i(V),"onUpdate:modelValue":p[6]||(p[6]=a=>B(V)?V.value=a:null),label:"Select Role",placeholder:"Select Role",rules:["requiredValidator"in s?s.requiredValidator:i(K)],items:["Admin","Author","Editor","Maintainer","Subscriber"]},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(v,{modelValue:i(w),"onUpdate:modelValue":p[7]||(p[7]=a=>B(w)?w.value=a:null),label:"Select Plan",placeholder:"Select Plan",rules:["requiredValidator"in s?s.requiredValidator:i(K)],items:["Basic","Company","Enterprise","Team"]},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(v,{modelValue:i(x),"onUpdate:modelValue":p[8]||(p[8]=a=>B(x)?x.value=a:null),label:"Select Status",placeholder:"Select Status",rules:["requiredValidator"in s?s.requiredValidator:i(K)],items:[{title:"Active",value:"active"},{title:"Inactive",value:"inactive"},{title:"Pending",value:"pending"}]},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(j,{type:"submit",class:"me-3"},{default:t(()=>p[10]||(p[10]=[C(" Submit ")])),_:1}),e(j,{type:"reset",variant:"outlined",color:"secondary",onClick:d},{default:t(()=>p[11]||(p[11]=[C(" Cancel ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},tl={class:"mb-2"},ll={__name:"AddActivity",props:{activitiesData:{type:Object,required:!0,default:()=>({title:"",description:"",schedule_at:""})},isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","refreshActivities"],setup(h,{emit:z}){const o=h,m=z,U=b(!1);b(!1);const S=b("radio-1"),c=b({title:"",description:"",type_activity_id:null,opportunity_id:null,assigned_to:null,scheduled_at:null,status:"COMPLETED"}),{completedActivityAndRegister:r,getallTypeActivities:f,typeActivities:u,loadingActivity:_}=ke(),{getOpportunitybyId:O,opportunity:V}=le(),w=b(structuredClone(J(o.activitiesData))),x=v=>{console.log("esta consultando de nuevo despues de cambiar etapa "),O(v)};oe(o,()=>{w.value=structuredClone(J(o.activitiesData)),O(w.value.opportunity_id),d()});const d=async()=>{await f()},A=()=>{O(w.value.opportunity_id)},R=()=>{m("update:isDrawerOpen",!1),c.value={title:null,description:null,type_activity_id:null,scheduled_at:null,opportunity_id:null,assigned_to:null,status:"COMPLETED"},m("refreshActivities")},s=async()=>{let v="";S.value==="radio-1"?v="COMPLETED":S.value==="radio-2"&&(v="CANCELLED"),r(w.value.id,{title:c.value.title,description:c.value.description,type_activity_id:c.value.type_activity_id,scheduled_at:c.value.scheduled_at,assigned_to:V.value.user_id,property_id:V.value.property_id,opportunity_id:V.value.id,status:v}),R()},p=async()=>{m("update:isDrawerOpen",!1),m("refreshActivities")},N=()=>{console.log("Se escucho el evento en AddActivity"),m("refreshActivities")},k=v=>{const a=new Date(v),P=a.getDate(),$=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][a.getMonth()],E=a.getHours().toString().padStart(2,"0"),I=a.getMinutes().toString().padStart(2,"0");return`${P} de ${$}, ${E}:${I}`};return(v,a)=>{const P=fe,F=je,$=Pe;return n(),q(H,{class:"d-flex justify-space-between"},{default:t(()=>[e(g,{cols:"12"},{default:t(()=>[h.isDrawerOpen?(n(),q(Y,{key:0},{default:t(()=>[e(Q,null,{default:t(()=>[e(Ue,{class:"mx-2 my-2"},{default:t(()=>[e(H,null,{default:t(()=>[e(g,{cols:"12",sm:"5"},{default:t(()=>[e(H,null,{default:t(()=>[e(g,{cols:"12"},{default:t(()=>a[6]||(a[6]=[l("span",{style:{"font-size":"18px","font-weight":"500"}}," Actividad ",-1)])),_:1}),e(g,{cols:"12"},{default:t(()=>[l("div",tl,[l("span",null,D(o.activitiesData.title)+" • "+D(k(o.activitiesData.scheduled_at)),1)]),e(We,{modelValue:i(S),"onUpdate:modelValue":a[0]||(a[0]=E=>B(S)?S.value=E:null),style:{"font-size":"14px"},inline:""},{default:t(()=>[a[7]||(a[7]=l("span",null," ¿ Se Realizo ? ",-1)),e(be,{label:"Si",value:"radio-1",density:"compact"}),e(be,{label:"No",value:"radio-2",density:"compact"})]),_:1},8,["modelValue"]),e(Je,{class:"mt-2"})]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(P,{modelValue:i(c).title,"onUpdate:modelValue":a[1]||(a[1]=E=>i(c).title=E),label:"Titulo de la actividad",placeholder:"..."},null,8,["modelValue"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(ve,{modelValue:i(c).type_activity_id,"onUpdate:modelValue":a[2]||(a[2]=E=>i(c).type_activity_id=E),label:"Tipo de Actividad",placeholder:"Selecciona el Tipo de Actividad",items:i(u).map(E=>({title:E.name,value:E.id}))},null,8,["modelValue","items"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(F,{modelValue:i(c).scheduled_at,"onUpdate:modelValue":a[3]||(a[3]=E=>i(c).scheduled_at=E),label:"Seleccione la Fecha y Hora",placeholder:"Select date and time",config:{enableTime:!0,dateFormat:"Y-m-d H:i"},rules:["requiredValidator"in v?v.requiredValidator:i(K)]},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e($,{modelValue:i(c).description,"onUpdate:modelValue":a[4]||(a[4]=E=>i(c).description=E),label:"Descripcion",rows:"3",rules:["requiredValidator"in v?v.requiredValidator:i(K)]},null,8,["modelValue","rules"])]),_:1}),e(g,null,{default:t(()=>[e(j,{color:"primary",class:"mx-auto",size:"small",loading:i(_),disabled:i(_),onClick:s},{default:t(()=>a[8]||(a[8]=[C(" Crear Actividad ")])),_:1},8,["loading","disabled"]),e(j,{color:"primary",class:"mx-1",variant:"tonal",size:"small"},{default:t(()=>a[9]||(a[9]=[C(" Dar de Baja ")])),_:1})]),_:1})]),_:1})]),_:1}),e(g,{cols:"12",sm:"7",style:{"align-items":"center"}},{default:t(()=>[e(H,{class:"mb-2"},{default:t(()=>[e(g,{cols:"6"},{default:t(()=>a[10]||(a[10]=[l("span",{style:{"font-size":"18px","font-weight":"500"}}," Etapa ",-1)])),_:1}),e(g,{cols:"12",md:"6",class:"d-flex justify-end align-center"},{default:t(()=>[e(Z,{label:"",color:"primary"},{default:t(()=>[C(D(i(V).stage.title),1)]),_:1})]),_:1})]),_:1}),i(V).stage_id===2?(n(),q(Ot,{key:0,opportunity:i(V),onUpdateStageId:x,"onUpdate:newProperty":N},null,8,["opportunity"])):L("",!0),i(V).stage_id===3?(n(),q(Vt,{key:1,opportunity:i(V),onUpdateStageId:x,"onUpdate:newProperty":N},null,8,["opportunity"])):L("",!0),i(V).stage_id===4?(n(),q(Yt,{key:2,opportunity:i(V),onRefreshActivities:A,onUpdateStageId:x},null,8,["opportunity"])):L("",!0),i(V).stage_id===5?(n(),q(rt,{key:3,opportunity:i(V),onRefreshActivities:A,onUpdateStageId:x,onComplet:p},null,8,["opportunity"])):L("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):(n(),q(Y,{key:1,title:"Reporte de Actividades"},{default:t(()=>[e(Zt)]),_:1}))]),_:1}),e(g,{cols:"12",md:"6"},{default:t(()=>[e(el,{"is-drawer-open":i(U),"onUpdate:isDrawerOpen":a[5]||(a[5]=E=>B(U)?U.value=E:null)},null,8,["is-drawer-open"])]),_:1})]),_:1})}}};const ol={class:"title-search-container"},al={style:{"font-size":"14px"}},il={key:0,class:"no-activities-message d-flex flex-column justify-center align-center",style:{"min-block-size":"200px","text-align":"center"}},sl=["onClick"],nl={class:"mx-2"},rl={class:"d-flex justify-content-between",style:{"font-size":"0.9em"}},ul={__name:"list",setup(h){const z=b(""),o=b("Anteriores");b(["Todos","PORA"]),b("Todos");const{getallActivitiesByAsesorFecha:m,getallActivitiesByFechaPast:U,getallActivitiesByFechaFuture:S,activities:c,activitiesPast:r,activitiesFuture:f}=ke(),u=b(""),_=Ne("userData").value,O=b(!0),V=b([]),w=b([]),x=b([]),d=async()=>{await m(_.id),V.value=c.value},A=async()=>{await U(_.id),w.value=r.value},R=async()=>{await S(_.id),x.value=f.value};Re(async()=>{await d(),await A(),await R(),O.value=!1});const s=b(!1),p=F=>{s.value=!0,u.value={...F}},N=async()=>{O.value=!0,await d(),await A(),await R(),O.value=!1,o.value="Anteriores"},k=X(()=>[{tabName:"Anteriores",icon:"tabler-calendar",actividades:w,badge:w.value.length},{tabName:"Hoy",icon:"tabler-edit",actividades:V,badge:V.value.length},{tabName:"Futuros",icon:"tabler-calendar",actividades:x,badge:x.value.length}]),v=[{type:"Visita",icon:"tabler-current-location"},{type:"Llamada",icon:"tabler-phone"},{type:"Cotizacion",icon:"tabler-cash"},{type:"Otro",icon:"tabler-table"}],a=F=>{const $=v.find(E=>E.type===F);return $?$.icon:"tabler-default"},P=F=>{const $=new Date(F),E=$.getDate(),G=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][$.getMonth()],se=$.getHours().toString().padStart(2,"0"),qe=$.getMinutes().toString().padStart(2,"0");return`${E} de ${G}, ${se}:${qe}`};return oe(z,F=>{const $=E=>E.filter(I=>{const G=I.name_opportunity.toLowerCase().includes(F.toLowerCase()),se=I.phone_opportunity.toLowerCase().includes(F.toLowerCase());return G||se});F.length>2?(V.value=$(c.value),w.value=$(r.value),x.value=$(f.value)):(V.value=c.value,w.value=r.value,x.value=f.value)}),(F,$)=>{const E=ie("VCircularProgress");return n(),q(H,{class:"match-height",style:{display:"flex","block-size":"100vh"}},{default:t(()=>[e(g,{cols:"12",md:"4",style:{display:"flex","flex-direction":"column"}},{default:t(()=>[e(Y,{class:"flex-grow-1"},{default:t(()=>[e(de,{class:"d-flex justify-between align-center flex-wrap"},{default:t(()=>[l("div",ol,[$[5]||($[5]=l("h4",{class:"title-responsive"}," Mis Actividades ",-1)),e(ae,{modelValue:z.value,"onUpdate:modelValue":$[0]||($[0]=I=>z.value=I),placeholder:"Buscar actividad...",class:"search-field","hide-details":"",dense:"","solo-inverted":"","prepend-inner-icon":"tabler-search"},null,8,["modelValue"])])]),_:1}),e(Ye,{modelValue:o.value,"onUpdate:modelValue":$[1]||($[1]=I=>o.value=I),grow:""},{default:t(()=>[(n(!0),y(T,null,M(k.value,I=>(n(),q(Xe,{key:I.tabName},{default:t(()=>[l("span",al,D(I.tabName),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),$[11]||($[11]=l("br",null,null,-1)),e(Q,{style:{"flex-grow":"1","overflow-y":"auto"}},{default:t(()=>[O.value?(n(),q(Ze,{key:0,absolute:"",opacity:"0.7"},{default:t(()=>[e(E,{indeterminate:"",size:"70"})]),_:1})):L("",!0),e(Ue,{modelValue:o.value,"onUpdate:modelValue":$[2]||($[2]=I=>o.value=I),class:"disable-tab-transition",style:{"max-block-size":"500px","overflow-y":"auto"}},{default:t(()=>[(n(!0),y(T,null,M(k.value,I=>(n(),q(Qe,{key:I.tabName,value:I.tabName},{default:t(()=>[I.actividades.value.length===0?(n(),y("div",il,[e(W,{size:"64",color:"grey",icon:"tabler-calendar-off",class:"mb-4",style:{animation:"bounce 1s infinite"}}),$[6]||($[6]=l("div",{style:{color:"#888","font-size":"1.2em"}}," ¡No tienes actividades pendientes! ",-1)),$[7]||($[7]=l("div",{style:{color:"#aaa","font-size":"0.9em","margin-block-start":"8px"}}," ¡Relájate y disfruta tu día! ",-1))])):(n(!0),y(T,{key:1},M(I.actividades.value,G=>(n(),y("div",{key:G.id,"fill-dot":"",class:"border mb-2 rounded-sm py-2",onClick:se=>p(G)},[e(me,null,{default:t(()=>[e(H,null,{default:t(()=>[e(g,{cols:"12",md:"2",style:{"padding-inline-end":"0"}},{default:t(()=>[e(Z,{class:"d-flex justify-center align-center",style:{display:"inline-flex","border-radius":"4px","block-size":"36px","inline-size":"36px"}},{default:t(()=>[e(W,{size:"25",icon:"tabler-home"})]),_:1})]),_:1}),G.project_name?(n(),q(g,{key:0,cols:"12",md:"5",class:"d-flex flex-column align-start",style:{"padding-inline-start":"0"}},{default:t(()=>[e(te,{class:"text-left"},{default:t(()=>[l("strong",null,D(G.property_title),1)]),_:2},1024),e(ee,{class:"font-weight-medium text-left"},{default:t(()=>[l("span",null,"$ "+D(G.price),1)]),_:2},1024)]),_:2},1024)):L("",!0),G.project_name?L("",!0):(n(),q(g,{key:1,cols:"12",md:"5"},{default:t(()=>[e(te,{class:"text-left"},{default:t(()=>$[8]||($[8]=[l("strong",null," Departamento ",-1)])),_:1}),e(ee,{class:"font-weight-medium text-left"},{default:t(()=>$[9]||($[9]=[l("span",null,"Indefinido",-1)])),_:1})]),_:1})),e(g,{cols:"12",md:"5",class:"d-flex justify-end align-center"},{default:t(()=>[e(Z,{label:"",color:"primary",class:"ml-auto",style:{"font-size":"10px"}},{default:t(()=>[C(D(G.stage),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(me,{class:""},{default:t(()=>[e(Z,{label:"",color:"secondary",class:"w-100 h-48"},{default:t(()=>[e(W,{size:"20",icon:a(G.type_activity)},null,8,["icon"]),l("div",nl,D(G.type_activity)+"   •   "+D(G.name_opportunity),1)]),_:2},1024)]),_:2},1024),e(me,null,{default:t(()=>[l("div",rl,[$[10]||($[10]=l("div",{style:{"flex-grow":"1"}}," Ver ",-1)),l("div",null,D(P(G.scheduled_at)),1)])]),_:2},1024)],8,sl))),128))]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(g,{cols:"12",md:"8",style:{display:"flex","flex-direction":"column"}},{default:t(()=>[e(ll,{"is-drawer-open":s.value,"onUpdate:isDrawerOpen":$[3]||($[3]=I=>s.value=I),"activities-data":u.value,class:"flex-grow-1",onRefreshActivities:N,onLoaded:$[4]||($[4]=I=>O.value=!1)},null,8,["is-drawer-open","activities-data"])]),_:1})]),_:1})}}},go=Oe(ul,[["__scopeId","data-v-9e58f0ea"]]);export{go as default};
